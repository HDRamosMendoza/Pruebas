{"version":3,"sources":["../../../../widgets/InfoSummary/setting/MySymbolPicker.js"],"names":["define","declare","_WidgetsInTemplateMixin","Select","ValidationTextBox","lang","html","domStyle","domConstruct","on","dom","gfx","query","Color","registry","jsonUtils","esriRequest","_Color","SymbolPicker1","BaseWidget","TabContainer","jimuUtils","Table","Message","ColorPicker","ImageChooser","array","SimpleMarkerSymbol","SimpleLineSymbol","PictureMarkerSymbol","template","Evented","templateString","baseClass","nls","row","layerInfo","clusteringEnabled","symbolInfo","symbolType","map","supportsDynamic","tabContainer","field_options","groupFeaturesEnabled","lyrSymbolSet","_highLightColor","panelHTML","svg","constructor","options","callerRow","renderer","geometryType","ac","layerId","value","fields","hidePanel","oidFieldName","popupFields","infoTemplate","info","fieldInfos","i","length","visible","push","fieldName","postMixInProperties","inherited","arguments","common","window","jimuNls","postCreate","_initImageChoosers","_setFields","_initTabControl","_initSymbolPickerTab","_initFeatureOptionsTab","own","btnAddField","hitch","_addFieldRow","fieldOptionsTable","fieldRows","getRows","removeClass","addClass","iconOptionsTextLabel","featureOptionsTextLabel","groupOptionsTextLabel","chkGroupLabel","rdoLayerIconLabel","rdoCustomIconLabel","chkGroup","set","rdoLayerIcon","rdoCustomIcon","imageIconChooser","format","GIF","JPEG","PNG","cropImage","showTip","goldenWidth","goldenHeight","domNode","place","uploadCustomIcon","imageSymbolChooser","uploadCustomSymbol","nulls","undefined","name","label","indexOf","alias","tabs","title","symbolOptions","content","symbolPickerContainer","panelFeatureDisplay","panelFeatureDisplayContainer","isNested","tabParent","startup","geom","geoType","getTypeByGeometryType","_loadLayerSymbol","_initSymbolPicker","_initClusterSymbolPicker","_addEventHandlers","_initSymbolUI","isInitalLoad","fieldLoadCount","selectField","type","width","fieldLabel","actions","selectable","autoHeight","placeAt","fieldOptions","_rowDeleted","grpFields","groupOptionsTable","groupFieldOptions","_initFeatureOptionsUI","fdo","featureDisplayOptions","_populateLayerRow","fieldLength","fI","groupEnabled","_chkGroupChanged","groupField","t","groupByField","_rdoGroupByFieldChanged","renGrouping","attributeField","field","field1","visualVariables","grpRenderer","groupByRenderer","_rdoGroupByRendererChanged","table","css","result","addRow","success","tr","_addFieldsOption","_addLabelOption","selectFields","labelText","message","max_records","lyrFields","clone","td","setStyle","selFields","style","height","cells","innerText","labelTextBox","clusterType","iconType","displayFeatureCount","userDefinedSymbol","_setSymbolType","_setClusterType","_setIconType","clusterSymbol","clusterPicker","showBySymbol","fromJson","chkClusterSym","_chkClusterChanged","rdoLayerSym","_rdoEsriSymChanged","_rdoCustomSymChanged","chkClusterCnt","_rdoCustomIconChanged","parent_div_uploadCustomSymbol","div_rdoEsriSym","v","symbolOverride","rdoEsriSym","_rdoLayerSymChanged","symbolPicker","symbol","rdoCustomSym","_createImageDataDiv","customSymbolPlaceholder","icon","updateImg","customIconPlaceholder","colorPicker","setColor","toString","img","document","createElement","innerHTML","children","src","toJson","remove","d","uploadImage","btnOk","ok","_setSymbol","emit","btnCancel","cancel","getSymbol","firstChild","ssss","layerSym","outerHTML","isCustom","_createImageDataDiv2","vals","ren","r","l","rVal","isNaN","description","classMaxValue","rendererVals","split","groupByRendererFields","attributeField2","attributeField3","_getFields","color","toHex","s","selectedId","selectedID","listDisabled","groupByRendererOptions","values","trs","flds","forEach","setLayerSymbol","byId","customSymbolDIV","grpClusterOptions","featureFont","clusterPickerContainer","_chkClusterCntChanged","_rdoLayerIconChanged","gt","symType","showByType","parent_div_clusterOptions","infos","sym","uniqueValueInfos","classBreakInfos","colorStops","colors","_c","c","fromArray","g","b","STYLE_CIRCLE","STYLE_SOLID","appendChild","_createCombinedImageDataDiv","w","h","isPanel","a","create","ar","setWidth","setHeight","size","setSize","mySurface","createSurface","descriptors","getShapeDescriptors","shape","createShape","defaultShape","setFill","fill","setStroke","stroke","applyTransform","dx","dy","url","convert","node","setSym","isDefault","onclick","layerSymbolClick","insertBefore","id","rawNode","evt","currentTarget","elm","idx","parentElement","child","data","join","editCustomSymbol","editCustomIcon","groupByOptions","rdoGroupField","rdoGroupRenderer","destroy","destroyRecursive"],"mappings":"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","file":"MySymbolPicker.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© 2014 - 2018 Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the 'License');\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an 'AS IS' BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\ndefine(['dojo/_base/declare',\r\n    'dijit/_WidgetsInTemplateMixin',\r\n    'dijit/form/Select',\r\n    'dijit/form/ValidationTextBox',\r\n    'dojo/_base/lang',\r\n    'dojo/_base/html',\r\n    'dojo/dom-style',\r\n    'dojo/dom-construct',\r\n    'dojo/on',\r\n    'dojo/dom',\r\n    'dojox/gfx',\r\n    'dojo/query',\r\n    'dojo/_base/Color',\r\n    'dijit/registry',\r\n    'esri/symbols/jsonUtils',\r\n    'esri/request',\r\n    'esri/Color',\r\n    'jimu/dijit/SymbolPicker',\r\n    'jimu/BaseWidget',\r\n    'jimu/dijit/TabContainer3',\r\n    'jimu/utils',\r\n    'jimu/dijit/SimpleTable',\r\n    'jimu/dijit/Message',\r\n    'jimu/dijit/ColorPicker',\r\n    'jimu/dijit/ImageChooser',\r\n    'dojo/_base/array',\r\n    'esri/symbols/SimpleMarkerSymbol',\r\n    'esri/symbols/SimpleLineSymbol',\r\n    'esri/symbols/PictureMarkerSymbol',\r\n    'dojo/text!./MySymbolPicker.html',\r\n    'dojo/Evented',\r\n    'dojox/form/FileUploader'\r\n],\r\n  function (declare,\r\n    _WidgetsInTemplateMixin,\r\n    Select,\r\n    ValidationTextBox,\r\n    lang,\r\n    html,\r\n    domStyle,\r\n    domConstruct,\r\n    on,\r\n    dom,\r\n    gfx,\r\n    query,\r\n    Color,\r\n    registry,\r\n    jsonUtils,\r\n    esriRequest,\r\n    _Color,\r\n    SymbolPicker1,\r\n    BaseWidget,\r\n    TabContainer,\r\n    jimuUtils,\r\n    Table,\r\n    Message,\r\n    ColorPicker,\r\n    ImageChooser,\r\n    array,\r\n    SimpleMarkerSymbol,\r\n    SimpleLineSymbol,\r\n    PictureMarkerSymbol,\r\n    template,\r\n    Evented) {\r\n    return declare([BaseWidget, _WidgetsInTemplateMixin, Evented], {\r\n      templateString: template,\r\n      baseClass: 'jimu-widget-InfoSummary-setting',\r\n      nls: null,\r\n      row: null,\r\n      layerInfo: null,\r\n      clusteringEnabled: null,\r\n      symbolInfo: null,\r\n      symbolType: \"\",\r\n      map: null,\r\n      supportsDynamic: true,\r\n      tabContainer: null,\r\n      field_options: [],\r\n      groupFeaturesEnabled: false,\r\n      lyrSymbolSet: [],\r\n      _highLightColor: '#ffffff',\r\n      panelHTML: null,\r\n      svg: null,\r\n\r\n      /*jshint unused:false*/\r\n      constructor: function ( /*Object*/ options) {\r\n        this.nls = options.nls;\r\n        this.row = options.callerRow;\r\n        this.layerInfo = options.layerInfo;\r\n        this.renderer = options.layerInfo.renderer;\r\n        this.geometryType = options.layerInfo.geometryType;\r\n        this.symbolInfo = options.symbolInfo;\r\n        this.map = options.map;\r\n        this.ac = options.ac;\r\n        this.layerId = options.value;\r\n        this.supportsDynamic = options.layerInfo.supportsDynamic;\r\n        this.fields = options.layerInfo.fields;\r\n        this.hidePanel = options.hidePanel;\r\n        this.oidFieldName = options.layerInfo.oidFieldName;\r\n        this.popupFields = [];\r\n        if (options.layerInfo.infoTemplate && options.layerInfo.infoTemplate.info) {\r\n          var fieldInfos = options.layerInfo.infoTemplate.info.fieldInfos;\r\n          if (fieldInfos) {\r\n            for (var i = 0; i < fieldInfos.length; i++) {\r\n              if (fieldInfos[i].visible) {\r\n                //TODO make sure this is pushing the alias\r\n                this.popupFields.push(fieldInfos[i].fieldName);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n\r\n      postMixInProperties: function(){\r\n        this.inherited(arguments);\r\n        this.nls.common = window.jimuNls.common;\r\n      },\r\n\r\n      postCreate: function () {\r\n        this.inherited(arguments);\r\n        this._initImageChoosers();\r\n        this._setFields(this.fields);\r\n        this._initTabControl();\r\n        this._initSymbolPickerTab(this.geometryType);\r\n        this._initFeatureOptionsTab();\r\n        if (!this.hidePanel) {\r\n          this.own(on(this.btnAddField, 'click', lang.hitch(this, this._addFieldRow,\r\n            this.fieldOptionsTable, 'loSelect')));\r\n          var fieldRows = this.fieldOptionsTable.getRows();\r\n          if (fieldRows && fieldRows.length >= 3) {\r\n            html.removeClass(this.btnAddField, \"btn-add-section\");\r\n            html.addClass(this.btnAddField, \"btn-add-section-disabled\");\r\n          } else {\r\n            html.removeClass(this.btnAddField, \"btn-add-section-disabled\");\r\n            html.addClass(this.btnAddField, \"btn-add-section\");\r\n          }\r\n          html.removeClass(this.iconOptionsTextLabel, 'text-disabled');\r\n          html.removeClass(this.featureOptionsTextLabel, 'text-disabled');\r\n          html.removeClass(this.groupOptionsTextLabel, 'text-disabled');\r\n          html.removeClass(this.chkGroupLabel, 'text-disabled');\r\n          html.removeClass(this.rdoLayerIconLabel, 'text-disabled');\r\n          html.removeClass(this.rdoCustomIconLabel, 'text-disabled');\r\n        } else {\r\n          html.removeClass(this.btnAddField, \"btn-add-section\");\r\n          html.addClass(this.btnAddField, \"btn-add-section-disabled\");\r\n          html.addClass(this.iconOptionsTextLabel, 'text-disabled');\r\n          html.addClass(this.featureOptionsTextLabel, 'text-disabled');\r\n          html.addClass(this.groupOptionsTextLabel, 'text-disabled');\r\n          html.addClass(this.chkGroupLabel, 'text-disabled');\r\n          html.addClass(this.rdoLayerIconLabel, 'text-disabled');\r\n          html.addClass(this.rdoCustomIconLabel, 'text-disabled');\r\n        }\r\n        this.chkGroup.set('disabled', this.hidePanel);\r\n        this.rdoLayerIcon.set('disabled', this.hidePanel);\r\n        this.rdoCustomIcon.set('disabled', this.hidePanel);\r\n      },\r\n\r\n      _initImageChoosers: function () {\r\n        this.imageIconChooser = new ImageChooser({\r\n          format: [ImageChooser.GIF, ImageChooser.JPEG, ImageChooser.PNG],\r\n          cropImage: false,\r\n          showTip: false,\r\n          goldenWidth: 10,\r\n          goldenHeight: 15\r\n        });\r\n        html.addClass(this.imageIconChooser.domNode, 'uploadCustom');\r\n        html.place(this.imageIconChooser.domNode, this.uploadCustomIcon, 'replace');\r\n\r\n        this.imageSymbolChooser = new ImageChooser({\r\n          format: [ImageChooser.GIF, ImageChooser.JPEG, ImageChooser.PNG],\r\n          cropImage: false,\r\n          showTip: false,\r\n          goldenWidth: 10,\r\n          goldenHeight: 15\r\n        });\r\n        html.addClass(this.imageSymbolChooser.domNode, 'uploadCustom');\r\n        html.place(this.imageSymbolChooser.domNode, this.uploadCustomSymbol, 'replace');\r\n      },\r\n\r\n      _setFields: function(fields){\r\n        if (fields) {\r\n          this.field_options = [];\r\n          var nulls = [\"\", \" \", undefined, null];\r\n          for (var i = 0; i < fields.length; i++) {\r\n            this.field_options.push({\r\n              value: fields[i].name,\r\n              label: nulls.indexOf(fields[i].alias) === -1 ? fields[i].alias : fields[i].name\r\n            });\r\n          }\r\n        }\r\n      },\r\n\r\n      _initTabControl: function() {\r\n        this.tabContainer = new TabContainer({\r\n          tabs: [{\r\n            title: this.nls.symbolOptions,\r\n            content: this.symbolPickerContainer\r\n          }, {\r\n            title: this.nls.panelFeatureDisplay,\r\n            content: this.panelFeatureDisplayContainer\r\n          }],\r\n          isNested: true\r\n        }, this.tabParent);\r\n        this.tabContainer.startup();\r\n      },\r\n\r\n      _initSymbolPickerTab: function (geom) {\r\n        var geoType = jimuUtils.getTypeByGeometryType(geom);\r\n        this._loadLayerSymbol();\r\n        if (this.supportsDynamic) {\r\n          this._initSymbolPicker(geoType);\r\n        }\r\n        this._initClusterSymbolPicker(geoType);\r\n        this._addEventHandlers(geoType);\r\n        //this._initUI();//change\r\n        this._initSymbolUI();\r\n      },\r\n\r\n      _initFeatureOptionsTab: function () {\r\n        this.isInitalLoad = true;\r\n        this.fieldLoadCount = 0;\r\n        var fields = [{\r\n          name: \"field\",\r\n          title: this.nls.selectField,\r\n          \"class\": \"label\",\r\n          type: \"empty\",\r\n          width: \"100px\"\r\n        }, {\r\n          name: \"label\",\r\n          \"class\": \"label\",\r\n          title: this.nls.fieldLabel,\r\n          type: \"empty\",\r\n          width: \"100px\"\r\n        }, {\r\n          name: \"actions\",\r\n          \"class\": \"label\",\r\n          title: this.nls.actions,\r\n          type: \"actions\",\r\n          actions: [\"up\", \"down\", \"delete\"],\r\n          width: \"50px\"\r\n        }];\r\n\r\n        this.fieldOptionsTable = new Table({\r\n          fields: fields,\r\n          selectable: false,\r\n          autoHeight: true\r\n        });\r\n\r\n        this.fieldOptionsTable.placeAt(this.fieldOptions);\r\n        this.fieldOptionsTable.startup();\r\n        this.fieldOptionsTable.on('row-delete', lang.hitch(this, this._rowDeleted));\r\n\r\n        var grpFields = [{\r\n          name: \"field\",\r\n          title: this.nls.selectField,\r\n          \"class\": \"label\",\r\n          type: \"empty\",\r\n          width: \"180px\"//change from 160\r\n        }, {\r\n          name: \"label\",\r\n          \"class\": \"label\",\r\n          title: this.nls.fieldLabel,\r\n          type: \"empty\",\r\n          width: \"140px\"//change from 160\r\n        }];\r\n\r\n        this.groupOptionsTable = new Table({\r\n          fields: grpFields,\r\n          selectable: false,\r\n          autoHeight: true\r\n        });\r\n\r\n        this.groupOptionsTable.placeAt(this.groupFieldOptions);\r\n        this.groupOptionsTable.startup();\r\n\r\n        this._initFeatureOptionsUI();\r\n        this.isInitalLoad = false;\r\n      },\r\n\r\n      _initFeatureOptionsUI: function () {\r\n        var fdo;\r\n        if (this.symbolInfo && this.symbolInfo.featureDisplayOptions) {\r\n          fdo = this.symbolInfo.featureDisplayOptions;\r\n        }\r\n\r\n        //fields options\r\n        if (fdo && fdo.fields) {\r\n          for (var i = 0; i < fdo.fields.length; i++) {\r\n            this._populateLayerRow(this.fieldOptionsTable, fdo.fields[i], 'loSelect');\r\n          }\r\n        } else {\r\n          this._addFieldRow(this.groupOptionsTable, 'goSelect');\r\n\r\n          if (this.popupFields && this.popupFields.length > 0) {\r\n            var fieldLength = this.popupFields.length > 2 ? 3 : this.popupFields.length;\r\n            for (var fI = 0; fI < fieldLength; fI++) {\r\n              this._populateLayerRow(this.fieldOptionsTable, {\r\n                name: this.popupFields[fI]\r\n              }, 'loSelect');\r\n            }\r\n          }\r\n        }\r\n\r\n        //group options\r\n        this.groupFeaturesEnabled = (fdo && typeof (fdo.groupEnabled) !== 'undefined') ? fdo.groupEnabled : false;\r\n        this._chkGroupChanged(this.groupFeaturesEnabled);\r\n        this.chkGroup.set('checked', this.groupFeaturesEnabled);\r\n        if (fdo && fdo.groupField) {\r\n          this._populateLayerRow(this.groupOptionsTable, fdo.groupField, 'goSelect');\r\n        }\r\n\r\n        var t = true;\r\n        if (fdo && typeof (fdo.groupByField) !== 'undefined') {\r\n          this._rdoGroupByFieldChanged(fdo.groupByField);\r\n          t = false;\r\n        }\r\n\r\n        var renGrouping = false;\r\n        if(this.renderer){\r\n          if (this.renderer.attributeField || this.renderer.field || this.renderer.field1) {\r\n            if (typeof(this.renderer.visualVariables) === 'undefined') {\r\n              renGrouping = true;\r\n            }\r\n          }\r\n        }\r\n        if (!renGrouping) {\r\n          domStyle.set(this.grpRenderer, 'display', 'none');\r\n        }\r\n        if (fdo && typeof (fdo.groupByRenderer) !== 'undefined') {\r\n          this._rdoGroupByRendererChanged(fdo.groupByRenderer);\r\n          t = false;\r\n        }\r\n        if (t) {\r\n          this._rdoGroupByFieldChanged(t);\r\n        }\r\n      },\r\n\r\n      _rowDeleted: function(table){\r\n        if (this.fieldOptionsTable.getRows().length < 3) {\r\n          html.removeClass(this.btnAddField, \"btn-add-section-disabled\");\r\n          html.addClass(this.btnAddField, \"btn-add-section\");\r\n        }\r\n      },\r\n\r\n      _populateLayerRow: function (table, field, css) {\r\n        this.fieldLoadCount += 1;\r\n        var result = table.addRow({});\r\n        if (result.success && result.tr) {\r\n          var tr = result.tr;\r\n          this._addFieldsOption(tr, css);\r\n          this._addLabelOption(tr);\r\n          tr.selectFields.set(\"value\", field.name);\r\n          tr.labelText.set(\"value\", field.label);\r\n        }\r\n      },\r\n\r\n      _addFieldRow: function (table, css) {\r\n        if (table === this.fieldOptionsTable) {\r\n          if (table.getRows().length >= 3) {\r\n            new Message({\r\n              message: this.nls.max_records\r\n            });\r\n            return;\r\n          }\r\n        }\r\n\r\n        this.isInitalLoad = false;\r\n        var result = table.addRow({});\r\n        if (result.success && result.tr) {\r\n          var tr = result.tr;\r\n          this._addFieldsOption(tr, css);\r\n          this._addLabelOption(tr);\r\n        }\r\n\r\n        if (table === this.fieldOptionsTable) {\r\n          if (table.getRows().length >= 3) {\r\n            html.removeClass(this.btnAddField, \"btn-add-section\");\r\n            html.addClass(this.btnAddField, \"btn-add-section-disabled\");\r\n          }\r\n        }\r\n      },\r\n\r\n      _addFieldsOption: function (tr, css) {\r\n        var lyrFields = lang.clone(this.field_options);\r\n        var td = query('.simple-table-cell', tr)[0];\r\n        if (td) {\r\n          html.setStyle(td, \"verticalAlign\", \"middle\");\r\n          html.setStyle(td, \"line-height\", \"inherit\");\r\n          var selFields = new Select({\r\n            style: {\r\n              width: \"100%\",\r\n              height: \"28px\"\r\n            },\r\n            \"class\": css,\r\n            options: lyrFields\r\n          });\r\n          selFields.placeAt(td);\r\n          selFields.startup();\r\n          tr.selectFields = selFields;\r\n          this.own(on(selFields, 'change', lang.hitch(this, function () {\r\n            if (this.fieldLoadCount && this.fieldLoadCount > 0) {\r\n              this.fieldLoadCount -= 1;\r\n            } else {\r\n              tr.labelText.set('value', \"\");\r\n            }\r\n            tr.cells[0].title = tr.cells[0].innerText;\r\n          })));\r\n          tr.cells[0].title = tr.cells[0].innerText;\r\n        }\r\n      },\r\n\r\n      _addLabelOption: function(tr){\r\n        var td = query('.simple-table-cell', tr)[1];\r\n        html.setStyle(td, \"verticalAlign\", \"middle\");\r\n        html.setStyle(td, \"line-height\", \"inherit\");\r\n        var labelTextBox = new ValidationTextBox({\r\n          style: {\r\n            width: \"100%\",\r\n            height: \"28px\"\r\n          }\r\n        });\r\n        labelTextBox.placeAt(td);\r\n        labelTextBox.startup();\r\n        tr.labelText = labelTextBox;\r\n      },\r\n\r\n      _initSymbolUI: function () {\r\n        if (typeof (this.symbolInfo) !== 'undefined') {\r\n          //set retained symbol properties\r\n          this.symbolType = this.symbolInfo.symbolType;\r\n          this.clusterType = this.symbolInfo.clusterType;\r\n          this.iconType = this.symbolInfo.iconType;\r\n          this.displayFeatureCount = this.symbolInfo.displayFeatureCount;\r\n          this.clusteringEnabled = this.symbolInfo.clusteringEnabled;\r\n          this.userDefinedSymbol = this.symbolInfo.userDefinedSymbol;\r\n          this._highLightColor = this.symbolInfo._highLightColor;\r\n\r\n          this._setSymbolType(this.symbolInfo.symbolType);\r\n          this._setClusterType(this.symbolInfo.clusterType);\r\n          this._setIconType(this.symbolInfo.iconType);\r\n\r\n          //set cluster options properties\r\n          if (typeof (this.symbolInfo.clusterType) !== 'undefined') {\r\n            if (this.symbolInfo.clusterType === \"CustomCluster\") {\r\n              if (this.symbolInfo.clusterSymbol) {\r\n                this.clusterPicker.showBySymbol(jsonUtils.fromJson(this.symbolInfo.clusterSymbol));\r\n              }\r\n            }\r\n            this.userDefinedSymbol = true;\r\n          }\r\n          this.chkClusterSym.set('checked', this.symbolInfo.clusteringEnabled);\r\n          this._chkClusterChanged(this.symbolInfo.clusteringEnabled);\r\n        } else {\r\n          //default state\r\n          this.rdoLayerSym.set('checked', true);\r\n          this._rdoEsriSymChanged(false);\r\n          this._rdoCustomSymChanged(false);\r\n          this.chkClusterSym.set('checked', false);\r\n          this.chkClusterCnt.set('checked', false);\r\n          this.rdoLayerIcon.set('checked', true);\r\n          this._rdoCustomIconChanged(false);\r\n          this.symbolType = \"LayerSymbol\";\r\n          this.iconType = \"LayerIcon\";\r\n          this.clusteringEnabled = false;\r\n          this.userDefinedSymbol = false;\r\n        }\r\n\r\n        if (this.geometryType !== 'esriGeometryPoint' || !this.supportsDynamic) {\r\n          domStyle.set(this.parent_div_uploadCustomSymbol, \"display\", \"none\");\r\n          if (!this.supportsDynamic) {\r\n            domStyle.set(this.div_rdoEsriSym, \"display\", \"none\");\r\n          }\r\n        }\r\n      },\r\n\r\n      _setSymbolType: function (v) {\r\n        switch (v) {\r\n          case 'LayerSymbol':\r\n            if (this.symbolInfo.symbolOverride) {\r\n              this.userDefinedSymbol = true;\r\n              this.rdoEsriSym.set('checked', true);\r\n              this._rdoLayerSymChanged(false);\r\n              this._rdoCustomSymChanged(false);\r\n              this.symbolPicker.showBySymbol(jsonUtils.fromJson(this.symbolInfo.symbol));\r\n            } else {\r\n              this.rdoLayerSym.set('checked', true);\r\n              this._rdoEsriSymChanged(false);\r\n              this._rdoCustomSymChanged(false);\r\n            }\r\n            break;\r\n          case 'EsriSymbol':\r\n            this.userDefinedSymbol = true;\r\n            this.rdoEsriSym.set('checked', true);\r\n            this._rdoLayerSymChanged(false);\r\n            this._rdoCustomSymChanged(false);\r\n            this.symbolPicker.showBySymbol(jsonUtils.fromJson(this.symbolInfo.symbol));\r\n            break;\r\n          case 'CustomSymbol':\r\n            this.userDefinedSymbol = true;\r\n            this.rdoCustomSym.set('checked', true);\r\n            this._rdoEsriSymChanged(false);\r\n            this._rdoLayerSymChanged(false);\r\n            this._createImageDataDiv(this.symbolInfo.symbol, true, this.customSymbolPlaceholder);\r\n            break;\r\n        }\r\n      },\r\n\r\n      _setIconType: function (v) {\r\n        switch (v) {\r\n          case 'LayerIcon':\r\n            this.rdoLayerIcon.set('checked', true);\r\n            break;\r\n          case 'CustomIcon':\r\n            this.userDefinedSymbol = true;\r\n            this.rdoCustomIcon.set('checked', true);\r\n\r\n            if (this.symbolInfo.icon) {\r\n              this.updateImg();\r\n              var icon = jsonUtils.fromJson(this.symbolInfo.icon);\r\n              this._createImageDataDiv(icon, true, this.customIconPlaceholder);\r\n            }\r\n            break;\r\n        }\r\n      },\r\n\r\n      _setClusterType: function (v) {\r\n        switch (v) {\r\n          case 'ThemeCluster':\r\n            this.userDefinedSymbol = true;\r\n            this.clusterType = 'ThemeCluster';\r\n            break;\r\n          case 'CustomCluster':\r\n            this.userDefinedSymbol = true;\r\n            this.clusterType = 'CustomCluster';\r\n            this.chkClusterCnt.set('checked', this.displayFeatureCount);\r\n            this.colorPicker.setColor(new Color(this._highLightColor));\r\n            break;\r\n        }\r\n      },\r\n\r\n      updateImg: function () {\r\n        if (this.symbolInfo.icon.toString().indexOf('<img') > -1) {\r\n          var img = document.createElement('div');\r\n          img.innerHTML = this.symbolInfo.icon;\r\n          var icon = new PictureMarkerSymbol(img.children[0].src, 26, 26);\r\n          this.symbolInfo.icon = icon.toJson();\r\n          img.remove();\r\n        }\r\n      },\r\n\r\n      _addEventHandlers: function (geoType) {\r\n        if (geoType === 'point') {\r\n          this.own(on(this.imageSymbolChooser, 'ImageChange', lang.hitch(this, function (d) {\r\n            this.uploadImage(\"Symbol\", d);\r\n          })));\r\n        }\r\n\r\n        this.own(on(this.imageIconChooser, 'ImageChange', lang.hitch(this, function (d) {\r\n          this.uploadImage(\"Icon\", d);\r\n        })));\r\n\r\n        this.btnOk.innerText = this.nls.common.ok;\r\n        this.own(on(this.btnOk, 'click', lang.hitch(this, function () {\r\n          this._setSymbol();\r\n          this.emit('ok', this.symbolInfo);\r\n        })));\r\n\r\n        this.btnCancel.innerText = this.nls.common.cancel;\r\n        this.own(on(this.btnCancel, 'click', lang.hitch(this, function () {\r\n          this.emit('cancel');\r\n        })));\r\n      },\r\n\r\n      _setSymbol: function () {\r\n        //regardless of type we need to get and store in a common way\r\n        var symbol;\r\n        switch (this.symbolType) {\r\n          case 'LayerSymbol':\r\n            symbol = this.symbol;\r\n            break;\r\n          case 'EsriSymbol':\r\n            this.userDefinedSymbol = true;\r\n            symbol = this.symbolPicker.getSymbol();\r\n            break;\r\n          case 'CustomSymbol':\r\n            this.userDefinedSymbol = true;\r\n            if (this.customSymbolPlaceholder.children.length > 0) {\r\n              if (typeof (this.customSymbolPlaceholder.children[0].src) !== 'undefined') {\r\n                symbol = new PictureMarkerSymbol(this.customSymbolPlaceholder.children[0].src, 26, 26);\r\n              } else {\r\n                symbol = jsonUtils.fromJson(this.symbolInfo.symbol);\r\n              }\r\n            }\r\n            break;\r\n        }\r\n\r\n        var icon;\r\n        if (this.iconType === \"LayerIcon\") {\r\n          icon = symbol;\r\n        } else {\r\n          if (this.customIconPlaceholder.children.length > 0) {\r\n            if (typeof (this.customIconPlaceholder.children[0].src) !== 'undefined') {\r\n              html.removeClass(this.customIconPlaceholder.firstChild, 'customPlaceholder');\r\n              html.addClass(this.customIconPlaceholder.firstChild, 'customPlaceholderSettings');\r\n              icon = new PictureMarkerSymbol(this.customIconPlaceholder.children[0].src, 26, 26);\r\n            } else {\r\n              //this.updateImg();\r\n              icon = jsonUtils.fromJson(this.symbolInfo.icon);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (this.clusteringEnabled && this.geometryType === 'esriGeometryPoint') {\r\n          if (this.clusterType === \"ThemeCluster\") {\r\n            this.clusterSymbol = \"custom\";\r\n          } else {\r\n            this.clusterSymbol = this.clusterPicker.getSymbol().toJson();\r\n          }\r\n          this.userDefinedSymbol = true;\r\n        } else {\r\n          this.clusterSymbol = undefined;\r\n          this.clusteringEnabled = false;\r\n        }\r\n\r\n        if (symbol) {\r\n          if (typeof (symbol.toJson) !== 'undefined') {\r\n            symbol = symbol.toJson();\r\n          }\r\n        }\r\n\r\n        var ssss;\r\n        if (this.customIconPlaceholder.children.length > 0) {\r\n          ssss = this.customIconPlaceholder.children[0].src;\r\n        } else if (this.layerSym.children.length > 0) {\r\n          ssss = this.layerSym.children[0].innerHTML;\r\n        }\r\n        else {\r\n          ssss = this.customIconPlaceholder.outerHTML;\r\n        }\r\n\r\n        if (typeof (icon) !== 'undefined') {\r\n          var isCustom = this.iconType !== \"LayerIcon\" || this.symbolType === 'CustomSymbol';\r\n          this._createImageDataDiv2(icon, 44, 44, true, isCustom);\r\n          this._createImageDataDiv2(icon, 28, 28, false, isCustom);\r\n        }\r\n\r\n        var vals;\r\n        if (typeof (this.ren) !== 'undefined') {\r\n          vals = [];\r\n          for (var i = 0; i < this.ren.length; i++) {\r\n            var r = this.ren[i];\r\n            //var l, r, d;\r\n            var l, v, d;\r\n            if (typeof (r.value) !== 'undefined') {\r\n              var rVal = isNaN(r.value) ? \"'\" + r.value + \"'\" : r.value;\r\n              l = typeof (r.label) !== 'undefined' ? r.label : r.value;\r\n              v = typeof (rVal) !== 'undefined' ? \" === \" + rVal : undefined;\r\n              d = typeof (r.description) !== 'undefined' && r.description !== \"\" ? r.description : undefined;\r\n            } else if (typeof (r.classMaxValue) !== 'undefined') {\r\n              l = r.label;\r\n              var rendererVals;\r\n              if (l) {\r\n                rendererVals = l.split(\" - \");\r\n              }\r\n              if (rendererVals) {\r\n                if (rendererVals.length > 1) {\r\n                  v = \" >= \" + rendererVals[0] + \" && <= \" + rendererVals[1];\r\n                } else {\r\n                  v = \" === \" + rendererVals[0];\r\n                }\r\n              }\r\n              d = typeof (r.description) !== 'undefined' && r.description !== \"\" ? r.description : undefined;\r\n            }\r\n            vals.push({ value: v, label: l, description: d });\r\n          }\r\n        }\r\n\r\n        var groupByRendererFields = [];\r\n        if (this.renderer && this.renderer.attributeField) {\r\n          groupByRendererFields.push({ name: this.renderer.attributeField });\r\n          if (this.renderer.attributeField2) {\r\n            groupByRendererFields.push({ name: this.renderer.attributeField2 });\r\n          }\r\n          if (this.renderer.attributeField3) {\r\n            groupByRendererFields.push({ name: this.renderer.attributeField3 });\r\n          }\r\n        } else if (this.renderer && this.renderer.field) {\r\n          groupByRendererFields.push({ name: this.renderer.field });\r\n        } else if (this.renderer && this.renderer.field1) {\r\n          groupByRendererFields.push({ name: this.renderer.field1 });\r\n        }\r\n\r\n        var fields = this.fieldOptionsTable ? this._getFields(this.fieldOptionsTable) : null;\r\n\r\n        this.symbolInfo = {\r\n          symbolType: this.symbolType,\r\n          symbol: symbol,\r\n          clusterSymbol: this.clusterSymbol,\r\n          clusteringEnabled: this.clusteringEnabled,\r\n          displayFeatureCount: this.displayFeatureCount,\r\n          _highLightColor: this.colorPicker.color.toHex(),\r\n          icon: icon && icon.toJson ? icon.toJson() : icon,\r\n          clusterType: this.clusterType,\r\n          iconType: this.iconType,\r\n          renderer: this.renderer,\r\n          s: ssss,\r\n          svg: this.svg,\r\n          panelHTML: this.panelHTML,\r\n          userDefinedSymbol: this.userDefinedSymbol ? this.userDefinedSymbol : false,\r\n          layerId: this.layerId,\r\n          selectedId: this.selectedID,\r\n          featureDisplayOptions: {\r\n            groupEnabled: this.groupFeaturesEnabled,\r\n            listDisabled: (fields && fields.length > 0) ? false : true,\r\n            groupByRenderer: typeof (this.groupByRenderer) === 'undefined' ? false : this.groupByRenderer,\r\n            groupByField: typeof (this.groupByField) === 'undefined' ? false : this.groupByField,\r\n            fields: fields,\r\n            groupField: this.groupOptionsTable ? this._getFields(this.groupOptionsTable)[0] : null,\r\n            groupByRendererOptions: {\r\n              fields: groupByRendererFields,\r\n              values: vals\r\n            }\r\n          }\r\n        };\r\n      },\r\n\r\n      _getFields: function(table){\r\n        var trs = table.getRows();\r\n        var flds = [];\r\n        array.forEach(trs, function (tr) {\r\n          if (tr.selectFields) {\r\n            flds.push({\r\n              name: tr.selectFields.value,\r\n              label: tr.labelText.value\r\n            });\r\n          }\r\n        });\r\n        return flds;\r\n      },\r\n\r\n      _rdoLayerSymChanged: function (v) {\r\n        if (v) {\r\n          this.symbolType = \"LayerSymbol\";\r\n          if (this.selectedID) {\r\n            this.setLayerSymbol(dom.byId(this.selectedID));\r\n          }\r\n        }\r\n        html.setStyle(this.layerSym, 'display', v ? \"block\" : \"none\");\r\n      },\r\n\r\n      _rdoEsriSymChanged: function (v) {\r\n        if (v) {\r\n          this.symbolType = \"EsriSymbol\";\r\n        }\r\n        html.setStyle(this.symbolPicker.domNode, 'display', v ? \"block\" : \"none\");\r\n      },\r\n\r\n      _rdoCustomSymChanged: function (v) {\r\n        if (v) {\r\n          this.symbolType = \"CustomSymbol\";\r\n        }\r\n        html.setStyle(this.customSymbolDIV, 'display', v ? \"block\" : \"none\");\r\n      },\r\n\r\n      _chkClusterChanged: function (v) {\r\n        this.clusteringEnabled = v;\r\n        html.setStyle(this.grpClusterOptions, 'display', v ? \"block\" : \"none\");\r\n        html.setStyle(this.featureFont, 'display', v ? \"block\" : \"none\");\r\n        html.setStyle(this.clusterPickerContainer, 'display', v ? \"block\" : \"none\");\r\n        if (v) {\r\n          if (typeof (this.clusterType) === 'undefined') {\r\n            this.clusterType = \"CustomCluster\";\r\n            //this.rdoCustomCluster.set('checked', true);\r\n          }\r\n        }\r\n      },\r\n\r\n      _chkClusterCntChanged: function(v){\r\n        this.displayFeatureCount = v;\r\n        html.setStyle(this.featureFont, 'display', (v && this.clusteringEnabled) ? \"block\" : \"none\");\r\n      },\r\n\r\n      _rdoLayerIconChanged: function (v) {\r\n        if (v) {\r\n          this.iconType = \"LayerIcon\";\r\n        }\r\n        html.setStyle(this.imageIconChooser.domNode, 'display', !v ? \"block\" : \"none\");\r\n        html.setStyle(this.customIconPlaceholder, 'display', !v ? \"block\" : \"none\");\r\n      },\r\n\r\n      _rdoCustomIconChanged: function (v) {\r\n        if (v) {\r\n          this.iconType = \"CustomIcon\";\r\n        }\r\n        html.setStyle(this.imageIconChooser.domNode, 'display', v ? \"block\" : \"none\");\r\n        html.setStyle(this.customIconPlaceholder, 'display', v ? \"block\" : \"none\");\r\n      },\r\n\r\n      _initSymbolPicker: function (gt) {\r\n        var symType = gt === 'point' ? 'marker' : gt === 'polyline' ? 'line' : gt === 'polygon' ? 'fill' : '';\r\n        this.symbolPicker.showByType(symType);\r\n      },\r\n\r\n      _initClusterSymbolPicker: function (geoType) {\r\n        if (geoType === 'point') {\r\n          this.clusterPicker.showByType('fill');\r\n        }\r\n        var d = geoType === 'point' ? 'block' : 'none';\r\n        domStyle.set(this.parent_div_clusterOptions, \"display\", d);\r\n      },\r\n\r\n      _loadLayerSymbol: function () {\r\n        this.infos = undefined;\r\n        this.ren = undefined;\r\n        if (typeof (this.renderer) !== 'undefined') {\r\n          var renderer = this.renderer;\r\n          var sym;\r\n          var ren;\r\n          if (typeof (renderer.symbol) !== 'undefined') {\r\n            this._createImageDataDiv(renderer.symbol, true, this.layerSym);\r\n          } else if (typeof (renderer.infos) !== 'undefined') {\r\n            ren = renderer.infos;\r\n          } else if (typeof (renderer.uniqueValueInfos) !== 'undefined') {\r\n            ren = renderer.uniqueValueInfos;\r\n          } else if (typeof (renderer.classBreakInfos) !== 'undefined') {\r\n            ren = renderer.classBreakInfos;\r\n          } else if (renderer.type && renderer.type === 'heatmap' && renderer.colorStops) {\r\n            var colors = renderer.colorStops;\r\n            var infos = [];\r\n            if (colors && colors.length >= 1) {\r\n              var _c = colors[0].color;\r\n              var c = _Color.fromArray([_c.r, _c.g, _c.b]);\r\n              infos.push({\r\n                symbol: new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CIRCLE, 10,\r\n                  new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, c), c)\r\n              });\r\n              if (colors.length > 2) {\r\n                _c = colors[colors.length - 1].color;\r\n                c = _Color.fromArray([_c.r, _c.g, _c.b]);\r\n                infos.push({\r\n                  symbol: new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CIRCLE, 10,\r\n                    new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, c), c)\r\n                });\r\n              }\r\n            }\r\n            this.infos = infos;\r\n            if (infos.length > 0) {\r\n              this.layerSym.appendChild(this._createCombinedImageDataDiv(infos));\r\n            } else {\r\n              this._createImageDataDiv2(undefined, 44, 44, true, false);\r\n              this._createImageDataDiv2(undefined, 28, 28, false, false);\r\n            }\r\n          } else {\r\n            this.rdoEsriSym.set('checked', true);\r\n            this.symbolType = \"EsriSymbol\";\r\n            this.iconType = \"LayerIcon\";\r\n            this._initSymbolPicker(jimuUtils.getTypeByGeometryType(this.geometryType));\r\n            this._setFields(this.fields);\r\n            this._setSymbol();\r\n            this.symbolInfo.symbolType = \"LayerSymbol\";\r\n            this.symbolInfo.symbolOverride = true;\r\n          }\r\n          if (ren) {\r\n            this.ren = ren;\r\n            this.layerSym.innerHTML = \"<div></div>\";\r\n            this.layerSym.appendChild(this._createCombinedImageDataDiv(ren));\r\n            html.setStyle(this.layerSym, \"cursor\", \"pointer\");\r\n          }\r\n        }\r\n      },\r\n\r\n      _createImageDataDiv2: function (sym, w, h, isPanel, isCustom) {\r\n        var a;\r\n        if (typeof (sym) === \"string\") {\r\n          a = domConstruct.create(\"div\", { 'class': \"imageDataGFX\", 'innerHTML': sym });\r\n          if (isPanel) {\r\n            this.panelHTML = a.innerHTML;\r\n          } else {\r\n            this.svg = a;\r\n          }\r\n        } else if (typeof (sym) === 'undefined') {\r\n          a = domConstruct.create(\"div\", { 'class': \"imageDataGFX\" });\r\n          a.innerHTML = '<div></div>';\r\n          if (isPanel) {\r\n            this.panelHTML = a.innerHTML;\r\n          } else {\r\n            this.svg = a;\r\n          }\r\n        } else {\r\n          var symbol = jsonUtils.fromJson(sym);\r\n          if (!symbol) {\r\n            symbol = sym;\r\n          }\r\n\r\n          if (symbol) {\r\n            var height = h;\r\n            var width = w;\r\n            if (symbol.height && symbol.width) {\r\n              var ar = symbol.width / symbol.height;\r\n              if (symbol.height > symbol.width) {\r\n                width = w * ar;\r\n              } else if (symbol.width > symbol.height) {\r\n                height = width / ar;\r\n              }\r\n            }\r\n            if (typeof (symbol.setWidth) !== 'undefined') {\r\n              if (typeof (symbol.setHeight) !== 'undefined') {\r\n                symbol.setWidth(isCustom ? width - (width * 0.25) : width);\r\n                symbol.setHeight(isCustom ? height - (height * 0.25) : height);\r\n              } else {\r\n                symbol.setWidth(2);\r\n              }\r\n            } else if (typeof (symbol.size) !== 'undefined') {\r\n              if (symbol.size > 20) {\r\n                symbol.setSize(20);\r\n              }\r\n            }\r\n            a = domConstruct.create(\"div\", { 'class': \"imageDataGFX\" });\r\n            var mySurface = gfx.createSurface(a, width, height);\r\n            var descriptors = jsonUtils.getShapeDescriptors(symbol);\r\n            var shape = mySurface.createShape(descriptors.defaultShape)\r\n                          .setFill(descriptors.fill)\r\n                          .setStroke(descriptors.stroke);\r\n            shape.applyTransform({ dx: width / 2, dy: height / 2 });\r\n            if (isPanel) {\r\n              this.panelHTML = a.innerHTML;\r\n            } else {\r\n              this.svg = a;\r\n            }\r\n          } else if (typeof (sym.url) !== 'undefined') {\r\n            a = domConstruct.create(\"div\", { 'class': \"imageDataGFX\" });\r\n            domStyle.set(a, \"background-image\", \"url(\" + sym.url + \")\");\r\n            domStyle.set(a, \"background-repeat\", \"no-repeat\");\r\n            if (isPanel) {\r\n              this.panelHTML = a.innerHTML;\r\n            } else {\r\n              this.svg = a;\r\n            }\r\n          }\r\n        }\r\n        return a;\r\n      },\r\n\r\n      _createImageDataDiv: function (sym, convert, node) {\r\n        var a = domConstruct.create(\"div\", { 'class': \"imageDataGFX-display\" }, node);\r\n        var symbol = convert ? jsonUtils.fromJson(sym) : sym;\r\n        if (!symbol) {\r\n          symbol = sym;\r\n        }\r\n        this.symbol = symbol;\r\n        var height = 26;\r\n        var width = 26;\r\n        if (symbol.height && symbol.width) {\r\n          if (symbol.height > symbol.width) {\r\n            var ar = symbol.width / symbol.height;\r\n            height = 26;\r\n            width = 26 * ar;\r\n          }\r\n        }\r\n        var mySurface = gfx.createSurface(a, width, height);\r\n        var descriptors = jsonUtils.getShapeDescriptors(this.setSym(symbol, width, height));\r\n        var shape = mySurface.createShape(descriptors.defaultShape)\r\n                      .setFill(descriptors.fill)\r\n                      .setStroke(descriptors.stroke);\r\n        shape.applyTransform({ dx: width / 2, dy: height / 2 });\r\n        this.svg = a.firstChild;\r\n        return a;\r\n      },\r\n\r\n      _createCombinedImageDataDiv: function (infos) {\r\n        var a = domConstruct.create(\"div\", { 'class': \"imageDataGFXMulti\" }, this.customSymbolPlaceholder);\r\n        this.lyrSymbolSet = [];\r\n        var isDefault = this.symbolInfo && this.symbolInfo.selectedId ? false : true;\r\n        for (var i = 0; i < infos.length; i++) {\r\n          var sym = infos[i].symbol;\r\n          var symbol = jsonUtils.fromJson(sym);\r\n          if (!symbol) {\r\n            symbol = sym;\r\n          }\r\n          if (typeof (this.symbol) === 'undefined') {\r\n            this.symbol = symbol;\r\n          }\r\n          this.lyrSymbolSet.push(symbol);\r\n\r\n          var height = 26;\r\n          var width = 26;\r\n          if (symbol.height && symbol.width) {\r\n            if (symbol.height > symbol.width) {\r\n              var ar = symbol.width / symbol.height;\r\n              height = 26;\r\n              width = 26 * ar;\r\n            }\r\n          }\r\n\r\n          var b = domConstruct.create(\"div\", {\r\n            'class': \"imageDataGFX imageDataGFX2\",\r\n            'id': \"imageGFX_\" + i,\r\n            onclick: lang.hitch(this, this.layerSymbolClick)\r\n          }, a);\r\n\r\n          var mySurface = gfx.createSurface(b, width, height);\r\n          var descriptors = jsonUtils.getShapeDescriptors(this.setSym(symbol, width, height));\r\n          var shape = mySurface.createShape(descriptors.defaultShape)\r\n                        .setFill(descriptors.fill)\r\n                        .setStroke(descriptors.stroke);\r\n          shape.applyTransform({ dx: width / 2, dy: height / 2 });\r\n          a.insertBefore(b, a.firstChild);\r\n          a.appendChild(b);\r\n          if (isDefault || (this.symbolInfo && b.id === this.symbolInfo.selectedId)) {\r\n            this.setLayerSymbol(b);\r\n            isDefault = false;\r\n          }\r\n          if (mySurface.rawNode) {\r\n            html.setStyle(mySurface.rawNode, 'display', \"block\");\r\n            html.setStyle(mySurface.rawNode, 'margin', \"auto\");\r\n          }\r\n        }\r\n        return a;\r\n      },\r\n\r\n      layerSymbolClick: function (evt) {\r\n        this.setLayerSymbol(evt.currentTarget);\r\n      },\r\n\r\n      setLayerSymbol: function (elm) {\r\n        var idx;\r\n        for (var i = 0; i < elm.parentElement.children.length; i++) {\r\n          var child = elm.parentElement.children[i];\r\n          html.removeClass(child, \"lyrSymbolSelected\");\r\n          if (child.id === elm.id) {\r\n            idx = i;\r\n          }\r\n        }\r\n        html.addClass(elm, \"lyrSymbolSelected\");\r\n        this.selectedID = elm.id;\r\n        this.svg = elm;\r\n        this.panelHTML = elm.innerHTML;\r\n        this.symbol = this.lyrSymbolSet[idx];\r\n      },\r\n\r\n      setSym: function (symbol, width, height) {\r\n        if (typeof (symbol.setWidth) !== 'undefined') {\r\n          if (this.geometryType === 'esriGeometryPoint') {\r\n            symbol.setWidth(width);\r\n          }\r\n          if (typeof (symbol.setHeight) !== 'undefined') {\r\n            symbol.setHeight(height);\r\n          }\r\n        } else {\r\n          //used for point symbols from hosted services\r\n          if (typeof (symbol.size) !== 'undefined') {\r\n            if (symbol.size > 20) {\r\n              symbol.setSize(20);\r\n            }\r\n          }\r\n          //used for point symbols from MapServer services\r\n          if (typeof (symbol.width) !== 'undefined') {\r\n            symbol.width = width;\r\n          }\r\n          if (typeof (symbol.height) !== 'undefined') {\r\n            symbol.height = height;\r\n          }\r\n        }\r\n\r\n        return symbol;\r\n      },\r\n\r\n      uploadImage: function (type, data) {\r\n        var node = type === \"Symbol\" ? this.customSymbolPlaceholder : this.customIconPlaceholder;\r\n        node.innerHTML = \"\";\r\n        node.innerHTML = domConstruct.create(\"div\", {\r\n          'class': \"customPlaceholder\",\r\n          innerHTML: ['<img class=\"customPlaceholder\" src=\"', data, '\"/>'].join(''),\r\n          title: type === \"Symbol\" ? this.nls.editCustomSymbol : this.nls.editCustomIcon\r\n        }).innerHTML;\r\n      },\r\n\r\n      _chkGroupChanged: function(v){\r\n        this.groupFeaturesEnabled = v;\r\n        html.setStyle(this.groupByOptions, 'display', v ? \"inline-block\" : \"none\");\r\n      },\r\n\r\n      _rdoGroupByFieldChanged: function (v) {\r\n        this.groupByField = v;\r\n        this.rdoGroupField.set('checked', v);\r\n        html.setStyle(this.groupFieldOptions, 'display', v ? \"inline-block\" : \"none\");\r\n      },\r\n\r\n      _rdoGroupByRendererChanged: function (v) {\r\n        this.groupByRenderer = v;\r\n        this.rdoGroupRenderer.set('checked', v);\r\n      },\r\n\r\n      destroy: function () {\r\n        this.symbolInfo = null;\r\n        this.tabContainer.destroyRecursive();\r\n      }\r\n    });\r\n  });\r\n"]}
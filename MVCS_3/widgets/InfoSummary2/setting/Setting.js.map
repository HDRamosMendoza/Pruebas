{"version":3,"sources":["../../../../widgets/InfoSummary2/setting/Setting.js"],"names":["define","query","domConstruct","domClass","declare","xhr","dojoColor","_WidgetsInTemplateMixin","BaseWidgetSetting","LayerInfos","ValidationTextBox","CheckBox","Popup","Table","ImageChooser","utils","Message","LayerChooserFromMapSelect","LoadingShelter","esriRequest","dijitPopup","lang","DeferredList","Deferred","on","domStyle","html","array","SymbolPicker","UniqueLayerChooser","baseClass","_layerInfos","mpi","layer_options","refreshLayers","displayPanelIcon","used_layers","unsupported_ids","postCreate","inherited","arguments","opLayers","map","itemInfo","itemData","operationalLayers","length","set","btnAddLayer","optionsContainer","displayOptionsContainer","_disableOk","message","nls","missingLayerInWebMap","shelter","hidden","setupLayerTable","setupRefreshInterval","_getAllLayers","own","hitch","_addLayerRow","hidePanelOptions","v","hidePanel","panelCountOptions","panelIconOptions","expandListOptions","showAllFeaturesOptions","previewContainer","addClass","panelIconOptionsLabel","panelCountOptionsLabel","expandListOptionsLabel","showAllFeaturesOptionsLabel","mainPanelPreviewContainer","domNode","removeClass","contains","hidePanelHelpText","checked","countEnabled","startup","imageChooser","format","GIF","JPEG","PNG","label","uploadImage","cropImage","showTip","goldenWidth","goldenHeight","place","mainPanelPreviewButton","connect","isInitalLoad","refreshInterval","invalidMessage","invalidInterval","missingMessage","missingRefreshValue","fields","name","title","layerName","type","width","layerLabel","iconColumnText","optionsText","actions","layerRefresh","displayLayerTable","selectable","autoHeight","placeAt","layerTable","_pickSymbol","_rowDeleted","itemId","getInstance","then","operLayerInfos","wmLayerInfos","getLayerInfoArrayOfWebmap","configLayerInfos","config","layerInfos","_updateLayerIDs","upgradeFields","_upgradeFields","show","_setLayers","getLayerInfoArray","setConfig","hide","removeIDs","config_layer_loop","i","configLayer","jimuLayerInfo","getLayerInfoById","id","updated","wm_layer_loop","ii","_opLayer","originOpLayer","originOperLayer","undefined","urlId","_compareURL","_compareItemID","subId","_compareSubId","layer","push","sort","a","b","forEach","splice","opLayer","indexOf","layerObject","geomMatch","_compareGeom","fieldMatch","_compareFields","featureCollection","layers","hasOwnProperty","fcLayers","fcLayer","url","geometryType","matchingFields","filter","f","fn","configField","def","unSupportedLayerTypes","gtQueries","gtQueryUrls","options","rootLayerIDs","layerInfo","supportsDL","supportsDynamicLayers","declaredClass","_checkItemId","rootLayerInfo","getRootLayerInfo","parentLayerIDs","parentLayerTitles","traversal","subLayerInfo","newSubLayers","unshift","geomType","setGeometryType","getUrl","lyrType","join","value","imageData","_type","renderer","infoTemplate","getInfoTemplate","panelImageData","supportsDynamic","oidFieldName","objectIdField","parentLayerID","subLayerId","parseInt","substr","lastIndexOf","scaleRange","getScaleRange","selfType","queryList","queryResults","deleteIds","q","resultInfo","lIdx","drawingInfo","reverse","resolve","clone","isItemLayer","op_layer_loop","mapID","oldConfig","mainPanelText","mainPanelIcon","panelMainIcon","innerHTML","loadStaticData","chkStatic","expandList","showAllFeatures","clear","lyrInfo","_populateLayerRow","_updateLayerLists","rows","getRows","r","_updateRefresh","li","symbolData","featureDisplayOptions","firstLayerFieldName","firstLayerFieldAlias","layerFields","layer_field_loop","_i","alias","keyFieldName","keyFieldAlias","info","fieldInfos","subLayers","getSubLayers","sub_layers_loop","sli","sl","popupFields","popup_field_loop","j","popupField","visible","fieldName","_updateStyleColor","changedData","tName","appConfig","theme","sName","appId","window","location","href","split","get","sync","handleAs","load","data","styles","st","_styleColor","styleColor","_styleColorName","updateThemeClusterSymbol","sd","_rgb","fromHex","x","xx","evenOdd","g","rr","bb","gg","clusterType","clusterSymbol","color","outline","style","layerItem","selectLayers","getSelectedItem","_removeRefreshLayer","result","addRow","success","tr","cells","_addLayersOption","_addLabelOption","_addRefreshOption","_setNextLayer","selectBox","lo","getLayerObject","setSelectedLayer","cLo","_getLayerOptionByValue","validateFields","labelText","refreshBox","refresh","s","removeChild","create","_createLayerChooserSelect","parent","td","layerChooserSelect","layerChooserFromMap","showTable","onlyShowVisible","createMapResponse","webMapResponse","row","layerChooser","_onLayerChanged","item","layerID","_addDefaultSymbol","_row","_onLayerInfosChanged","setStyle","labelTextBox","height","refreshCheckBox","onChange","_addRefreshLayer","layerId","rO","refreshOptions","isValid","_enableOk","lInfo","enableRefresh","disableRefresh","_updateOK","children","curRow","selectLayersValue","hasSymbolData","userDefinedSymbol","callerRow","symbolInfo","ac","sourceDijit","_setSymbol","svg","appendChild","panelHTML","destroy","errorDiv","errorSpan","fieldsWarning","popup","content","titleLabel","sympolPopupTitle","close","OpLayer","match","featureInfos","validGeomTypes","fi","getConfig","table","labelTextValue","stripHTML","refreshEnabled","continuousRefreshEnabled"],"mappings":"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","file":"Setting.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright Â© 2014 - 2018 Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n\ndefine(['dojo/query', 'dojo/dom-construct', 'dojo/dom-class', 'dojo/_base/declare', 'dojo/_base/xhr', 'dojo/_base/Color', 'dijit/_WidgetsInTemplateMixin', 'jimu/BaseWidgetSetting', 'jimu/LayerInfos/LayerInfos', 'dijit/form/ValidationTextBox', 'dijit/form/CheckBox', 'jimu/dijit/Popup', 'jimu/dijit/SimpleTable', 'jimu/dijit/ImageChooser', 'jimu/utils', 'jimu/dijit/Message', 'jimu/dijit/LayerChooserFromMapWithDropbox', 'jimu/dijit/LoadingShelter', 'esri/request', 'dijit/popup', 'dojo/_base/lang', 'dojo/DeferredList', 'dojo/Deferred', 'dojo/on', 'dojo/dom-style', 'dojo/_base/html', 'dojo/_base/array', './MySymbolPicker', './UniqueLayerChooser', 'dojox/form/FileUploader'], function (query, domConstruct, domClass, declare, xhr, dojoColor, _WidgetsInTemplateMixin, BaseWidgetSetting, LayerInfos, ValidationTextBox, CheckBox, Popup, Table, ImageChooser, utils, Message, LayerChooserFromMapSelect, LoadingShelter, esriRequest, dijitPopup, lang, DeferredList, Deferred, on, domStyle, html, array, SymbolPicker, UniqueLayerChooser) {\n  return declare([BaseWidgetSetting, _WidgetsInTemplateMixin], {\n    baseClass: 'jimu-widget-InfoSummary-setting',\n    _layerInfos: null,\n    mpi: null,\n    layer_options: [],\n    refreshLayers: [],\n    displayPanelIcon: false,\n    used_layers: [],\n    unsupported_ids: [],\n\n    postCreate: function postCreate() {\n      this.inherited(arguments);\n\n      this.opLayers = this.map.itemInfo.itemData.operationalLayers;\n      if (this.opLayers.length === 0) {\n        domStyle.set(this.btnAddLayer, \"display\", \"none\");\n        domStyle.set(this.optionsContainer, \"display\", \"none\");\n        domStyle.set(this.displayOptionsContainer, \"display\", \"none\");\n        this._disableOk();\n        new Message({\n          message: this.nls.missingLayerInWebMap\n        });\n        return;\n      }\n      this.shelter = new LoadingShelter({\n        hidden: true\n      });\n      this.setupLayerTable();\n      this.setupRefreshInterval();\n      this._getAllLayers();\n      this.own(on(this.btnAddLayer, 'click', lang.hitch(this, this._addLayerRow)));\n      this.own(on(this.hidePanelOptions, 'change', lang.hitch(this, function (v) {\n        this.hidePanel = v;\n        this.panelCountOptions.set('disabled', v);\n        this.panelIconOptions.set('disabled', v);\n        this.expandListOptions.set('disabled', v);\n        this.showAllFeaturesOptions.set('disabled', v);\n        var previewContainer;\n        if (v) {\n          html.addClass(this.panelIconOptionsLabel, 'text-disabled');\n          html.addClass(this.panelCountOptionsLabel, 'text-disabled');\n          html.addClass(this.expandListOptionsLabel, 'text-disabled');\n          html.addClass(this.showAllFeaturesOptionsLabel, 'text-disabled');\n          this.displayPanelIcon = false;\n          previewContainer = query('.mainPanelPreviewContainerOn', this.mainPanelPreviewContainer.domNode)[0];\n          if (previewContainer) {\n            html.removeClass(previewContainer, \"mainPanelPreviewContainerOn\");\n            html.addClass(previewContainer, \"mainPanelPreviewContainerOff\");\n          }\n          if (domClass.contains(this.hidePanelHelpText, 'help-off')) {\n            html.removeClass(this.hidePanelHelpText, 'help-off');\n          }\n          html.addClass(this.hidePanelHelpText, 'help-on');\n        } else {\n          html.removeClass(this.panelIconOptionsLabel, 'text-disabled');\n          html.removeClass(this.panelCountOptionsLabel, 'text-disabled');\n          html.removeClass(this.expandListOptionsLabel, 'text-disabled');\n          html.removeClass(this.showAllFeaturesOptionsLabel, 'text-disabled');\n          if (this.panelIconOptions.checked) {\n            this.displayPanelIcon = true;\n            previewContainer = query('.mainPanelPreviewContainerOff', this.mainPanelPreviewContainer.domNode)[0];\n            if (previewContainer) {\n              html.removeClass(previewContainer, \"mainPanelPreviewContainerOff\");\n              html.addClass(previewContainer, \"mainPanelPreviewContainerOn\");\n            }\n          }\n          if (domClass.contains(this.hidePanelHelpText, 'help-on')) {\n            html.removeClass(this.hidePanelHelpText, 'help-on');\n          }\n          html.addClass(this.hidePanelHelpText, 'help-off');\n        }\n      })));\n      this.own(on(this.panelCountOptions, 'change', lang.hitch(this, function (v) {\n        this.countEnabled = v;\n      })));\n      this.own(on(this.panelIconOptions, 'change', lang.hitch(this, function () {\n        var previewContainer;\n        if (this.panelIconOptions.checked) {\n          this.displayPanelIcon = true;\n          previewContainer = query('.mainPanelPreviewContainerOff', this.mainPanelPreviewContainer.domNode)[0];\n          html.removeClass(previewContainer, \"mainPanelPreviewContainerOff\");\n          html.addClass(previewContainer, \"mainPanelPreviewContainerOn\");\n        } else {\n          this.displayPanelIcon = false;\n          previewContainer = query('.mainPanelPreviewContainerOn', this.mainPanelPreviewContainer.domNode)[0];\n          html.removeClass(previewContainer, \"mainPanelPreviewContainerOn\");\n          html.addClass(previewContainer, \"mainPanelPreviewContainerOff\");\n        }\n      })));\n    },\n\n    startup: function startup() {\n      this.inherited(arguments);\n      this.refreshLayers = [];\n\n      this.imageChooser = new ImageChooser({\n        format: [ImageChooser.GIF, ImageChooser.JPEG, ImageChooser.PNG],\n        label: this.nls.uploadImage,\n        cropImage: false,\n        showTip: false,\n        goldenWidth: 10,\n        goldenHeight: 15\n      });\n\n      domStyle.set(this.imageChooser.domNode, \"font-size\", \"14px\");\n      html.place(this.imageChooser.domNode, this.mainPanelPreviewButton, 'replace');\n\n      this.connect(this.imageChooser, \"onImageChange\", \"uploadImage\");\n      this.isInitalLoad = false;\n    },\n\n    setupRefreshInterval: function setupRefreshInterval() {\n      this.refreshInterval.invalidMessage = this.nls.invalidInterval;\n      this.refreshInterval.missingMessage = this.nls.missingRefreshValue;\n    },\n\n    setupLayerTable: function setupLayerTable() {\n      var fields = [{\n        name: \"layer\",\n        title: this.nls.layerName,\n        \"class\": \"label\",\n        type: \"empty\",\n        width: \"320px\"\n      }, {\n        name: \"label\",\n        \"class\": \"label\",\n        title: this.nls.layerLabel,\n        type: \"empty\",\n        width: \"255px\"\n      }, {\n        name: \"image\",\n        \"class\": \"label\",\n        title: this.nls.iconColumnText + \" \" + this.nls.optionsText,\n        width: \"110px\",\n        actions: [\"edit\"],\n        type: \"actions\"\n      }, {\n        name: \"refresh\",\n        \"class\": \"label\",\n        title: this.nls.layerRefresh,\n        type: \"empty\",\n        width: \"80px\"\n      }, {\n        name: \"actions\",\n        \"class\": \"label\",\n        title: this.nls.actions,\n        type: \"actions\",\n        actions: [\"up\", \"down\", \"delete\"],\n        width: \"93px\"\n      }];\n\n      this.displayLayerTable = new Table({\n        fields: fields,\n        selectable: false,\n        autoHeight: true\n      });\n\n      this.displayLayerTable.placeAt(this.layerTable);\n      this.displayLayerTable.startup();\n      this.own(on(this.displayLayerTable, 'actions-edit', lang.hitch(this, this._pickSymbol)));\n      this.own(on(this.displayLayerTable, 'row-delete', lang.hitch(this, this._rowDeleted)));\n    },\n\n    _getAllLayers: function _getAllLayers() {\n      if (this.map.itemId) {\n        LayerInfos.getInstance(this.map, this.map.itemInfo).then(lang.hitch(this, function (operLayerInfos) {\n          this.operLayerInfos = operLayerInfos;\n          this.wmLayerInfos = operLayerInfos.getLayerInfoArrayOfWebmap();\n          this.configLayerInfos = this.config.layerInfos;\n          this._updateLayerIDs();\n          if (this.config.upgradeFields) {\n            this._upgradeFields();\n          }\n          this.shelter.placeAt(this.domNode);\n          this.shelter.startup();\n          this.shelter.show();\n          this._setLayers(operLayerInfos.getLayerInfoArray()).then(lang.hitch(this, function () {\n            this.setConfig(this.config);\n            this.shelter.hide();\n          }));\n        }));\n      }\n    },\n\n    _updateLayerIDs: function _updateLayerIDs() {\n      var removeIDs = [];\n      config_layer_loop: for (var i = 0; i < this.configLayerInfos.length; i++) {\n        var configLayer = this.configLayerInfos[i];\n        var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(configLayer.id);\n\n        //If we cannot find the jimu layer info based on the stored ID we need to determine it\n        if (!jimuLayerInfo) {\n          var updated = false;\n          wm_layer_loop: for (var ii = 0; ii < this.wmLayerInfos.length; ii++) {\n            var _opLayer = this.wmLayerInfos[ii];\n            //var opLayer = this.layerInfos[ii];\n            var originOpLayer = _opLayer ? _opLayer.originOperLayer : undefined;\n\n            var urlId = this._compareURL(originOpLayer, configLayer);\n            var itemId = this._compareItemID(originOpLayer, configLayer);\n            var subId = this._compareSubId(_opLayer, configLayer);\n\n            var id = urlId ? urlId : itemId ? itemId : subId ? subId : undefined;\n            jimuLayerInfo = id ? this.operLayerInfos.getLayerInfoById(id) : jimuLayerInfo;\n\n            if (jimuLayerInfo) {\n              this.configLayerInfos[i].id = jimuLayerInfo.id;\n              this.configLayerInfos[i].layer = jimuLayerInfo.id;\n              updated = true;\n              break wm_layer_loop;\n            }\n          }\n\n          if (!updated && !jimuLayerInfo) {\n            removeIDs.push(i);\n          }\n        }\n      }\n\n      if (removeIDs.length > 0) {\n        //removeIDs.sort((a, b) => (b - a));\n        removeIDs.sort(function (a, b) {\n          return b - a;\n        });\n        array.forEach(removeIDs, lang.hitch(this, function (id) {\n          this.configLayerInfos.splice(id, 1);\n        }));\n      }\n    },\n\n    _compareSubId: function _compareSubId(opLayer, configLayer) {\n      if (opLayer && opLayer.subId && opLayer.subId.indexOf(configLayer.id) > -1) {\n        if (opLayer.layerObject) {\n          var geomMatch = this._compareGeom(opLayer.layerObject, configLayer);\n          var fieldMatch = this._compareFields(opLayer.layerObject, configLayer);\n          if (geomMatch && fieldMatch) {\n            return opLayer.subId;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    _compareItemID: function _compareItemID(originOpLayer, configLayer) {\n      if (originOpLayer && originOpLayer.itemId && originOpLayer.itemId === configLayer.itemId) {\n        if (originOpLayer.featureCollection && originOpLayer.featureCollection.layers && originOpLayer.featureCollection.layers.hasOwnProperty('length')) {\n          var fcLayers = originOpLayer.featureCollection.layers;\n          for (var i = 0; i < fcLayers.length; i++) {\n            var fcLayer = fcLayers[i];\n            if (this._compareGeom(fcLayer, configLayer)) {\n              if (this._compareFields(fcLayer, configLayer)) {\n                return fcLayer.id;\n              }\n            }\n          }\n          return undefined;\n        }\n      }\n    },\n\n    _compareURL: function _compareURL(originOpLayer, configLayer) {\n      return originOpLayer && originOpLayer.url && configLayer.url && originOpLayer.url === configLayer.url ? originOpLayer.id : undefined;\n    },\n\n    _compareGeom: function _compareGeom(layerObject, configLayer) {\n      return layerObject && layerObject.geometryType && configLayer.geometryType ? layerObject.geometryType === configLayer.geometryType : undefined;\n    },\n\n    _compareFields: function _compareFields(layerObject, configLayer) {\n      var fieldMatch;\n      if (layerObject && layerObject.fields && configLayer.fields && layerObject.fields.length === configLayer.fields.length) {\n        //test if Names match\n        var matchingFields = layerObject.fields.filter(function (f) {\n          for (var fn = 0; fn < configLayer.fields.length; fn++) {\n            var configField = configLayer.fields[fn];\n            if (f.name === configField.name) {\n              return f;\n            }\n          }\n        });\n        fieldMatch = matchingFields.length === layerObject.fields.length;\n      }\n      return fieldMatch;\n    },\n\n    /*jshint loopfunc:true */\n    _setLayers: function _setLayers(layerInfos) {\n      var def = new Deferred();\n      var unSupportedLayerTypes = [\"esri.layers.WMSLayer\", \"esri.layers.ArcGISImageServiceLayer\", \"esri.layers.ArcGISImageServiceVectorLayer\", \"esri.layers.ArcGISTiledMapServiceLayer\", \"ClusterLayer\"];\n      this.gtQueries = [];\n      this.gtQueryUrls = [];\n      var options = [];\n      var rootLayerIDs = [];\n      for (var i = 0; i < layerInfos.length; i++) {\n        var layerInfo = layerInfos[i];\n        var supportsDL = layerInfo.layerObject.hasOwnProperty('supportsDynamicLayers') ? layerInfo.layerObject.supportsDynamicLayers : true;\n        var type = layerInfo.layerObject.declaredClass;\n        var itemId = this._checkItemId(layerInfo, type);\n        if (unSupportedLayerTypes.indexOf(type) === -1) {\n          var rootLayerInfo = layerInfo.getRootLayerInfo();\n          if (rootLayerIDs.indexOf(rootLayerInfo.id) === -1) {\n            rootLayerIDs.push(rootLayerInfo.id);\n            var parentLayerIDs = [];\n            var parentLayerTitles = [];\n            rootLayerInfo.traversal(lang.hitch(this, function (subLayerInfo) {\n              //check if this is a parent layer\n              if (subLayerInfo.newSubLayers && subLayerInfo.newSubLayers.length > 0) {\n                //may not need to do this if we can use the layerInfo object to control\n                // layer visibility up the chain...but may need to keep the parent Layer ID in case of duplicate child names\n                // so we can show...oh...wait if we use the jimu layer chooser it has a tree and this would also not be necessary!!\n                if (parentLayerIDs.indexOf(rootLayerInfo.id) === -1) {\n                  parentLayerIDs.push(rootLayerInfo.id);\n                }\n                if (parentLayerIDs.indexOf(subLayerInfo.id) === -1) {\n                  parentLayerIDs.push(subLayerInfo.id);\n                  parentLayerTitles.unshift(subLayerInfo.title);\n                }\n              } else {\n                //geomType is necessary for getting and showing symbol options\n                var geomType = subLayerInfo.layerObject.geometryType;\n                if (typeof geomType === 'undefined') {\n                  geomType = this.setGeometryType(subLayerInfo.layerObject);\n                }\n\n                var url = subLayerInfo.getUrl();\n\n                var lyrType;\n                if (url) {\n                  lyrType = url.indexOf('MapServer') > -1 ? \"Map Service Layer\" : \"\";\n                } else if (type === \"esri.layers.FeatureCollection\" || type === \"Feature Collection\" || itemId) {\n                  lyrType = \"Feature Collection\";\n                } else {\n                  lyrType = \"\";\n                }\n\n                //changed from unshift to push\n                options.push({\n                  label: parentLayerTitles.length > 0 ? parentLayerTitles.join(\"-\") + \"-\" + subLayerInfo.title : subLayerInfo.title,\n                  value: subLayerInfo.id,\n                  url: url,\n                  imageData: subLayerInfo.imageData,\n                  id: subLayerInfo.id,\n                  geometryType: geomType,\n                  fields: subLayerInfo.layerObject.fields,\n                  _type: type, //NEW type is set...check BC\n                  renderer: subLayerInfo.layerObject.renderer,\n                  itemId: itemId,\n                  infoTemplate: subLayerInfo.getInfoTemplate(),\n                  lyrType: lyrType,\n                  panelImageData: subLayerInfo.panelImageData,\n                  supportsDynamic: supportsDL,\n                  oidFieldName: subLayerInfo.layerObject.objectIdField, //NEW...check BC\n                  parentLayerID: rootLayerInfo.id, //keeping for BC\n                  subLayerId: url ? parseInt(url.substr(url.lastIndexOf('/') + 1), 10) : undefined,\n                  scaleRange: subLayerInfo.getScaleRange(), //NEW...check BC\n                  selfType: subLayerInfo.originOperLayer.selfType //NEW...check BC\n                });\n              }\n            }));\n          }\n        }\n      }\n\n      //execute the setGeomType queries\n      if (this.gtQueries.length > 0) {\n        var queryList = new DeferredList(this.gtQueries);\n        //disable add\n        html.removeClass(this.btnAddLayer, \"btn-add-section enable\");\n        html.addClass(this.btnAddLayer, \"btn-add-section-disabled\");\n        queryList.then(lang.hitch(this, function (queryResults) {\n          var deleteIds = [];\n          if (queryResults) {\n            if (queryResults.length > 0) {\n              for (var q = 0; q < queryResults.length; q++) {\n                var resultInfo = queryResults[q][1];\n                var url = this.gtQueryUrls[q];\n                var lIdx;\n                for (var i = 0; i < this.layer_options.length; i++) {\n                  if (url === this.layer_options[i].url) {\n                    lIdx = i;\n                    break;\n                  }\n                }\n                if (typeof lIdx !== 'undefined') {\n                  if (resultInfo.geometryType) {\n                    this.layer_options[lIdx].geometryType = resultInfo.geometryType;\n                    if (typeof resultInfo.drawingInfo !== 'undefined') {\n                      this.layer_options[lIdx].renderer = resultInfo.drawingInfo.renderer;\n                      this.layer_options[lIdx].drawingInfo = resultInfo.drawingInfo;\n                      this.layer_options[lIdx].fields = resultInfo.fields;\n\n                      var f;\n                      for (var ii = 0; ii < resultInfo.fields.length; ii++) {\n                        f = resultInfo.fields[ii];\n                        if (f.type === \"esriFieldTypeOID\") {\n                          break;\n                        }\n                      }\n                      this.layer_options[lIdx].oidFieldName = f.name;\n                    }\n                  } else {\n                    //some layers from the traffic service don't have a geom type or fields\n                    deleteIds.push(lIdx);\n                  }\n                }\n              }\n              //enable add\n              html.removeClass(this.btnAddLayer, \"btn-add-section-disabled\");\n              html.addClass(this.btnAddLayer, \"btn-add-section enable\");\n            }\n          }\n          array.forEach(deleteIds.reverse(), lang.hitch(this, function (id) {\n            this.unsupported_ids.push(this.layer_options[id].id);\n            this.layer_options.splice(id, 1);\n          }));\n          def.resolve();\n        }));\n      } else {\n        def.resolve();\n      }\n      this.layer_options = lang.clone(options);\n      return def;\n    },\n\n    _checkItemId: function _checkItemId(layerInfo, type) {\n      var itemId;\n      //some FC return this others return FeatureLayer\n      if (type === \"esri.layers.FeatureCollection\") {\n        itemId = layerInfo.isItemLayer();\n        itemId = itemId.itemId || itemId;\n      } else if (type === \"esri.layers.FeatureLayer\" || type === 'FeatureLayer') {\n        op_layer_loop: for (var b = 0; b < this.opLayers.length; b++) {\n          var opLayer = this.opLayers[b];\n          if (opLayer && opLayer.id && (opLayer.id === layerInfo.id || layerInfo.id.indexOf(opLayer.id) > -1)) {\n            type = opLayer.type;\n            if (type === 'Feature Collection') {\n              itemId = opLayer.itemId;\n            }\n            break op_layer_loop;\n          }\n        }\n      }\n      return itemId;\n    },\n\n    setConfig: function setConfig(config) {\n      this.config = config;\n\n      if (!this.config.mapID || this.config.mapID && this.config.mapID === this.map.itemId) {\n        this.oldConfig = !this.config.mapID;\n\n        if (this.config.mainPanelText) {\n          this.mainPanelText.set('value', this.config.mainPanelText);\n        }\n        if (this.config.mainPanelIcon) {\n          this.panelMainIcon.innerHTML = this.config.mainPanelIcon;\n        }\n\n        if (this.config.refreshInterval) {\n          this.refreshInterval.set('value', this.config.refreshInterval);\n        }\n\n        if (this.config.loadStaticData) {\n          this.chkStatic.set('value', this.config.loadStaticData);\n        }\n\n        if (this.config.countEnabled) {\n          this.panelCountOptions.set('checked', this.config.countEnabled);\n        }\n\n        if (typeof this.config.hidePanel !== 'undefined') {\n          this.hidePanel = this.config.hidePanel;\n        } else {\n          this.hidePanel = false;\n        }\n        this.hidePanelOptions.set('checked', this.hidePanel);\n        this.panelCountOptions.set('disabled', this.hidePanel);\n        this.panelIconOptions.set('disabled', this.hidePanel);\n        this.expandListOptions.set('disabled', this.hidePanel);\n        this.showAllFeaturesOptions.set('disabled', this.hidePanel);\n\n        if (this.hidePanel) {\n          html.addClass(this.panelIconOptionsLabel, 'text-disabled');\n          html.addClass(this.panelCountOptionsLabel, 'text-disabled');\n          html.addClass(this.expandListOptionsLabel, 'text-disabled');\n          html.addClass(this.showAllFeaturesOptionsLabel, 'text-disabled');\n          if (domClass.contains(this.hidePanelHelpText, 'help-off')) {\n            html.removeClass(this.hidePanelHelpText, 'help-off');\n          }\n          html.addClass(this.hidePanelHelpText, 'help-on');\n        } else {\n          html.removeClass(this.panelIconOptionsLabel, 'text-disabled');\n          html.removeClass(this.panelCountOptionsLabel, 'text-disabled');\n          html.removeClass(this.expandListOptionsLabel, 'text-disabled');\n          html.removeClass(this.showAllFeaturesOptionsLabel, 'text-disabled');\n          if (domClass.contains(this.hidePanelHelpText, 'help-on')) {\n            html.removeClass(this.hidePanelHelpText, 'help-on');\n          }\n          html.addClass(this.hidePanelHelpText, 'help-off');\n        }\n\n        if (this.config.displayPanelIcon) {\n          this.panelIconOptions.set('checked', this.config.displayPanelIcon);\n        }\n        if (this.config.expandList) {\n          this.expandListOptions.set('checked', this.config.expandList);\n        }\n\n        var showAllFeatures = typeof this.config.showAllFeatures === 'undefined' ? false : this.config.showAllFeatures;\n        this.showAllFeaturesOptions.set('checked', showAllFeatures);\n\n        this.displayLayerTable.clear();\n        this.isInitalLoad = true;\n        for (var i = 0; i < this.config.layerInfos.length; i++) {\n          var lyrInfo = this.config.layerInfos[i];\n          this._populateLayerRow(lyrInfo, i);\n        }\n        this._updateLayerLists();\n        var rows = this.displayLayerTable.getRows();\n        for (var r = 0; r < rows.length; r++) {\n          this._updateRefresh(rows[r]);\n        }\n        if (this.displayLayerTable.getRows().length < this.layer_options.length) {\n          html.removeClass(this.btnAddLayer, \"btn-add-section-disabled\");\n          html.addClass(this.btnAddLayer, \"btn-add-section enable\");\n        } else {\n          html.addClass(this.btnAddLayer, \"btn-add-section-disabled\");\n          html.removeClass(this.btnAddLayer, \"btn-add-section enable\");\n        }\n      }\n    },\n\n    //added for backwards compatability\n    //could not handle directly in VersionManager as some stored layerInfos\n    // do not have a valid infoTemplate saved\n    _upgradeFields: function _upgradeFields() {\n      if (this.config.layerInfos) {\n        for (var i = 0; i < this.config.layerInfos.length; i++) {\n          var li = this.config.layerInfos[i];\n          if (li && li.symbolData && li.symbolData.featureDisplayOptions) {\n            var lyrInfo = this.operLayerInfos.getLayerInfoById(li.id);\n            var fields = li.symbolData.featureDisplayOptions.fields;\n            //At previous releases we would use the first field from the infoTemplate or\n            //the first non-OID field from the layer if no fields were selected by the user\n            if (typeof fields === 'undefined' || fields.hasOwnProperty('length') && fields.length === 0) {\n              //check layer fields\n              var layerObject = lyrInfo && lyrInfo.layerObject ? lyrInfo.layerObject : undefined;\n              var oidFieldName = layerObject && layerObject.objectIdField ? layerObject.objectIdField : undefined;\n              var firstLayerFieldName = \"\";\n              var firstLayerFieldAlias = \"\";\n              var layerFields = li.fields ? li.fields : layerObject ? layerObject.fields : undefined;\n              if (layerFields && layerFields.length > 0) {\n                layer_field_loop: for (var _i = 0; _i < layerFields.length; _i++) {\n                  var f = layerFields[_i];\n                  if (firstLayerFieldName === \"\" && f.type !== \"esriFieldTypeOID\" && f.type !== \"esriFieldTypeGeometry\" && f.name !== oidFieldName) {\n                    firstLayerFieldName = f.name;\n                    firstLayerFieldAlias = f.alias || f.name;\n                  }\n                  if (!oidFieldName) {\n                    oidFieldName = f.type === \"esriFieldTypeOID\" ? f.name : undefined;\n                  }\n                  if (oidFieldName && firstLayerFieldName !== \"\") {\n                    break layer_field_loop;\n                  }\n                }\n              }\n\n              //check popup fields\n              var keyFieldName = \"\";\n              var keyFieldAlias = \"\";\n              var infoTemplate = li.infoTemplate && li.infoTemplate.info && li.infoTemplate.info.fieldInfos ? li.infoTemplate : lyrInfo ? lyrInfo.getInfoTemplate() : undefined;\n              if (!infoTemplate) {\n                var subLayers = lyrInfo.getSubLayers();\n                sub_layers_loop: for (var sli = 0; sli < subLayers.length; sli++) {\n                  var sl = subLayers[sli];\n                  if (sl.title && sl.layerObject && sl.layerObject.name && sl.title === sl.layerObject.name) {\n                    infoTemplate = sl.getInfoTemplate ? sl.getInfoTemplate() : infoTemplate;\n                    break sub_layers_loop;\n                  }\n                }\n              }\n              var popupFields = infoTemplate ? infoTemplate.info.fieldInfos : [];\n              popup_field_loop: for (var j = 0; j < popupFields.length; j++) {\n                var popupField = popupFields[j];\n                if (popupField && popupField.visible) {\n                  if (!oidFieldName || oidFieldName !== popupField.fieldName) {\n                    keyFieldName = popupField.fieldName;\n                    keyFieldAlias = popupField.label || popupField.fieldName;\n                    break popup_field_loop;\n                  }\n                }\n              }\n\n              //update the config\n              this.config.layerInfos[i].symbolData.featureDisplayOptions.fields = [{\n                name: keyFieldName ? keyFieldName : firstLayerFieldName,\n                label: keyFieldName ? keyFieldAlias : firstLayerFieldAlias\n              }];\n            }\n          }\n        }\n      }\n    },\n\n    _updateStyleColor: function _updateStyleColor(changedData) {\n      var tName = this.appConfig.theme.name;\n      var sName = changedData;\n      var appId = this.appConfig.appId;\n      if (appId === \"\") {\n        appId = window.location.href.split('id=')[1];\n      }\n      var url = \"./apps/\" + appId + \"/themes/\" + tName + \"/manifest.json\";\n      xhr.get({\n        url: url,\n        sync: true,\n        handleAs: \"json\",\n        load: lang.hitch(this, function (data) {\n          var styles = data.styles;\n          for (var i = 0; i < styles.length; i++) {\n            var st = styles[i];\n            if (st.name === sName) {\n              this._styleColor = st.styleColor;\n              this._styleColorName = st.name;\n              break;\n            }\n          }\n        })\n      });\n    },\n\n    updateThemeClusterSymbol: function updateThemeClusterSymbol(lyrInfo, i) {\n      var sd = lyrInfo.symbolData;\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        if (typeof this._styleColor === 'undefined') {\n          this._updateStyleColor(this.appConfig.theme.styles[0]);\n        }\n      }\n      if (this._styleColor) {\n        var _rgb = dojoColor.fromHex(this._styleColor);\n        var x = i + 1;\n        var xx = x > 0 ? x * 30 : 30;\n        var evenOdd = x % 2 === 0;\n        var r = _rgb.r;\n        var g = _rgb.g;\n        var b = _rgb.b;\n\n        var rr = r - xx;\n        if (evenOdd) {\n          if (rr > 255) {\n            rr = rr - 255;\n          } else if (rr < 0) {\n            rr = rr + 255;\n          }\n        }\n\n        var bb = b - xx;\n        if (x % 3 === 0) {\n          if (evenOdd) {\n            if (bb > 255) {\n              bb = bb - 255;\n            } else if (bb < 0) {\n              bb = bb + 255;\n            }\n          }\n        }\n\n        var gg = g - xx;\n        if (x % 5 === 0) {\n          if (evenOdd) {\n            if (gg > 255) {\n              gg = gg - 255;\n            } else if (gg < 0) {\n              gg = gg + 255;\n            }\n          }\n        }\n        sd.clusterType = 'CustomCluster';\n        sd.clusterSymbol = {\n          color: [rr, gg, bb, 128],\n          outline: {\n            color: [0, 0, 0, 255],\n            width: 0,\n            type: \"esriSLS\",\n            style: \"esriSLSSolid\"\n          },\n          type: \"esriSFS\",\n          style: \"esriSFSSolid\"\n        };\n\n        lyrInfo.symbolData = sd;\n      }\n      return lyrInfo;\n    },\n\n    _rowDeleted: function _rowDeleted(r) {\n      if (r) {\n        var layerItem = r.selectLayers.getSelectedItem();\n        if (layerItem && layerItem.layerInfo && layerItem.layerInfo.id) {\n          this._removeRefreshLayer(layerItem.layerInfo.id);\n        }\n      }\n      this._updateLayerLists();\n      if (this.displayLayerTable.getRows().length < this.layer_options.length) {\n        html.removeClass(this.btnAddLayer, \"btn-add-section-disabled\");\n        html.addClass(this.btnAddLayer, \"btn-add-section enable\");\n      }\n    },\n\n    _addLayerRow: function _addLayerRow() {\n      this.isInitalLoad = false;\n      if (this.displayLayerTable.getRows().length >= this.layer_options.length) {\n        return;\n      }\n      this.shelter.show();\n      var result = this.displayLayerTable.addRow({});\n      if (result.success && result.tr) {\n        var tr = result.tr;\n        html.addClass(tr.cells[2], \"displayOptions\");\n        this._addLayersOption(tr);\n        this._addLabelOption(tr);\n        this._addRefreshOption(tr);\n        //get the first layer that is not already selected\n        this._setNextLayer(tr.selectLayers);\n        this._updateLayerLists();\n      }\n      this.shelter.hide();\n      if (this.displayLayerTable.getRows().length >= this.layer_options.length) {\n        html.removeClass(this.btnAddLayer, \"btn-add-section enable\");\n        html.addClass(this.btnAddLayer, \"btn-add-section-disabled\");\n        return;\n      }\n    },\n\n    _setNextLayer: function _setNextLayer(selectBox) {\n      var id;\n      for (var i = 0; i < this.layer_options.length; i++) {\n        var lo = this.layer_options[i];\n        if (this.used_layers.indexOf(lo.id) === -1) {\n          id = lo.id;\n          break;\n        }\n      }\n\n      if (id) {\n        var layerInfo = this.operLayerInfos.getLayerInfoById(id);\n        if (layerInfo) {\n          layerInfo.getLayerObject().then(lang.hitch(this, function (layer) {\n            selectBox.setSelectedLayer(layer);\n          }));\n        }\n      }\n    },\n\n    _populateLayerRow: function _populateLayerRow(lyrInfo, i) {\n      var result = this.displayLayerTable.addRow({});\n      if (result.success && result.tr) {\n        var tr = result.tr;\n        html.addClass(tr.cells[2], \"displayOptions\");\n        this._addLayersOption(tr);\n        this._addLabelOption(tr);\n        this._addRefreshOption(tr);\n\n        var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.id);\n        jimuLayerInfo.getLayerObject().then(lang.hitch(this, function (layer) {\n          tr.selectLayers.setSelectedLayer(layer).then(lang.hitch(this, function () {\n            if (lyrInfo.symbolData.clusterType === 'ThemeCluster') {\n              lyrInfo = this.updateThemeClusterSymbol(lyrInfo, i);\n            }\n            var cLo = this._getLayerOptionByValue(tr);\n            cLo.filter = lyrInfo.filter;\n            cLo.imageData = lyrInfo.imageData;\n            cLo.symbolData = lyrInfo.symbolData;\n            tr.symbolData = lyrInfo.symbolData;\n            this.validateFields(tr.symbolData, tr);\n          }));\n        }));\n        tr.labelText.set(\"value\", lyrInfo.label);\n        tr.refreshBox.set(\"checked\", lyrInfo.refresh);\n        tr.imageData = lyrInfo.panelImageData;\n\n        var s = query('.imageDataGFX', tr.cells[2])[0];\n        if (s) {\n          tr.cells[2].removeChild(s);\n        }\n\n        domConstruct.create(\"div\", {\n          'class': \"imageDataGFX margin2\",\n          innerHTML: [lyrInfo.imageData],\n          title: this.nls.iconColumnText\n        }, tr.cells[2]);\n      }\n    },\n\n    _addLayersOption: function _addLayersOption(tr) {\n      var selectBox = this._createLayerChooserSelect(tr);\n      if (selectBox) {\n        selectBox.tr = tr;\n        selectBox.parent = this;\n        tr.selectLayers = selectBox;\n      }\n    },\n\n    _createLayerChooserSelect: function _createLayerChooserSelect(tr) {\n      var td = query('.simple-table-cell', tr)[0];\n      var layerChooserSelect;\n      if (td) {\n        var layerChooserFromMap = new UniqueLayerChooser({\n          showTable: false,\n          onlyShowVisible: false,\n          createMapResponse: this.map.webMapResponse,\n          parent: this,\n          row: tr\n        });\n        layerChooserFromMap.startup();\n\n        layerChooserSelect = new LayerChooserFromMapSelect({\n          layerChooser: layerChooserFromMap\n        });\n        layerChooserSelect.placeAt(td);\n        layerChooserSelect.startup();\n        this.own(on(layerChooserSelect, 'selection-change', this._onLayerChanged));\n      }\n      return layerChooserSelect;\n    },\n\n    _onLayerChanged: function _onLayerChanged() {\n      var item = this.getSelectedItem();\n      if (!item) {\n        return;\n      }\n      var layerID = item && item.layerInfo && item.layerInfo.id ? item.layerInfo.id : undefined;\n      if (this.tr.layerID && layerID && layerID !== this.tr.layerID) {\n        this.parent._removeRefreshLayer(this.tr.layerID);\n        this.tr.refreshBox.set('checked', false);\n      }\n      this.tr.layerID = layerID;\n      if (!this.parent.isInitalLoad) {\n        lang.hitch(this.parent, this.parent._updateRefresh(this.tr));\n        lang.hitch(this.parent, this.parent._updateLayerLists());\n        lang.hitch(this.parent, this.parent._addDefaultSymbol(this.tr));\n        this.tr.labelText.set('value', \"\");\n      }\n    },\n\n    _updateLayerLists: function _updateLayerLists() {\n      this.used_layers = [];\n      var rows = this.displayLayerTable.getRows();\n      //rebuild the used_layers list\n      for (var i = 0; i < rows.length; i++) {\n        var row = rows[i];\n        var item = row.selectLayers.getSelectedItem();\n        if (item && item.layerInfo && item.layerInfo.id) {\n          this.used_layers.push(item.layerInfo.id);\n          //used as a part of the LayerChoosers filter function so it will always\n          // show the chosen layer for a row\n          row.layerID = item.layerInfo.id;\n        }\n      }\n      //update the other layer chooser instances so they will not show\n      // layer instances that have been used in other rows\n      for (var _i = 0; _i < rows.length; _i++) {\n        var _row = rows[_i];\n        //This concept does not work when the layers are not subLayers\n        //if (_row.rowOpened) {\n        _row.selectLayers.layerChooser._onLayerInfosChanged();\n        //_row.rowOpened = false;\n        //}\n      }\n    },\n\n    _addLabelOption: function _addLabelOption(tr) {\n      var td = query('.simple-table-cell', tr)[1];\n      html.setStyle(td, \"verticalAlign\", \"middle\");\n      html.setStyle(td, \"line-height\", \"inherit\");\n      var labelTextBox = new ValidationTextBox({\n        style: {\n          width: \"100%\",\n          height: \"28px\"\n        }\n      });\n      labelTextBox.placeAt(td);\n      labelTextBox.startup();\n      tr.labelText = labelTextBox;\n    },\n\n    _addRefreshOption: function _addRefreshOption(tr) {\n      var td = query('.simple-table-cell', tr)[3];\n      html.setStyle(td, \"verticalAlign\", \"middle\");\n      html.setStyle(td, \"line-height\", \"inherit\");\n      var refreshCheckBox = new CheckBox({\n        \"class\": \"checkBox\",\n        onChange: function onChange(v) {\n          var layerItem = this.tr.selectLayers.getSelectedItem();\n          if (layerItem && layerItem.layerInfo && layerItem.layerInfo.id) {\n            if (v) {\n              this.parent._addRefreshLayer(layerItem.layerInfo.id);\n            } else {\n              this.parent._removeRefreshLayer(layerItem.layerInfo.id);\n            }\n          }\n        }\n      });\n      refreshCheckBox.placeAt(td);\n      refreshCheckBox.startup();\n      refreshCheckBox.parent = this;\n      refreshCheckBox.tr = tr;\n      tr.refreshBox = refreshCheckBox;\n      this._updateRefresh(tr);\n    },\n\n    _addRefreshLayer: function _addRefreshLayer(layerId) {\n      this.refreshLayers.push(layerId);\n      var rO = query('.refreshOff', this.refreshOptions.domNode)[0];\n      if (rO) {\n        html.removeClass(rO, 'refreshOff');\n        html.addClass(rO, 'refreshOn');\n      }\n      if (!this.refreshInterval.isValid()) {\n        this._disableOk();\n      }\n    },\n\n    _removeRefreshLayer: function _removeRefreshLayer(layerId) {\n      var i = this.refreshLayers.indexOf(layerId);\n      if (i > -1) {\n        this.refreshLayers.splice(i, 1);\n        if (this.refreshLayers.length === 0) {\n          var rO = query('.refreshOn', this.refreshOptions.domNode)[0];\n          if (rO) {\n            html.removeClass(rO, 'refreshOn');\n            html.addClass(rO, 'refreshOff');\n          }\n          this._enableOk();\n        }\n      }\n    },\n\n    _updateRefresh: function _updateRefresh(tr) {\n      var lInfo = this._getLayerOptionByValue(tr);\n\n      if (tr && tr.refreshBox) {\n        var refreshCheckBox = tr.refreshBox;\n        if (lInfo && lInfo.lyrType === 'Feature Collection' && typeof lInfo.itemId !== 'undefined') {\n          refreshCheckBox.set('disabled', false);\n          refreshCheckBox.set('title', this.nls.enableRefresh);\n        } else {\n          refreshCheckBox.set('disabled', true);\n          refreshCheckBox.set('title', this.nls.disableRefresh);\n        }\n      }\n    },\n\n    _updateOK: function _updateOK() {\n      if (this.refreshInterval.isValid()) {\n        this._enableOk();\n      } else {\n        this._disableOk();\n      }\n    },\n\n    _disableOk: function _disableOk() {\n      var s = query(\".button-container\")[0];\n      domStyle.set(s.children[2], \"display\", \"none\");\n      domStyle.set(s.children[3], \"display\", \"inline-block\");\n    },\n\n    _enableOk: function _enableOk() {\n      var s = query(\".button-container\")[0];\n      domStyle.set(s.children[2], \"display\", \"inline-block\");\n      domStyle.set(s.children[3], \"display\", \"none\");\n    },\n\n    _addDefaultSymbol: function _addDefaultSymbol(tr) {\n      var td = query('.simple-table-cell', tr)[0];\n      this.curRow = tr;\n      if (td) {\n        html.setStyle(td, \"line-height\", \"inherit\");\n        html.setStyle(td, \"margin-left\", \"0px\");\n        var lo = this._getLayerOptionByValue(tr);\n        var item = tr.selectLayers.getSelectedItem();\n        if (item && item.layerInfo) {\n          var selectLayersValue = item.layerInfo.id;\n          var hasSymbolData = false;\n          var sd;\n          if (typeof this.curRow.symbolData !== 'undefined') {\n            sd = this.curRow.symbolData;\n            hasSymbolData = sd.userDefinedSymbol && sd.layerId === selectLayersValue;\n          }\n          var a;\n          var s;\n          if (!hasSymbolData || typeof lo.symbolData === 'undefined') {\n            var options = {\n              nls: this.nls,\n              callerRow: tr,\n              layerInfo: lo,\n              value: selectLayersValue,\n              symbolInfo: hasSymbolData ? this.curRow.symbolData : lo.symbolData,\n              map: this.map,\n              ac: this.appConfig,\n              hidePanel: this.hidePanel\n            };\n            var sourceDijit = new SymbolPicker(options);\n            sourceDijit._setSymbol();\n            s = query(\".imageDataGFX\", this.curRow.cells[2])[0];\n            if (s) {\n              this.curRow.cells[2].removeChild(s);\n            }\n            this.curRow.symbolData = sourceDijit.symbolInfo;\n            this.validateFields(this.curRow.symbolData, this.curRow);\n            a = domConstruct.create(\"div\", { 'class': \"imageDataGFX margin2\" }, this.curRow.cells[2]);\n            if (this.curRow.symbolData.svg !== null && typeof this.curRow.symbolData.svg !== 'undefined') {\n              a.appendChild(this.curRow.symbolData.svg);\n            }\n            this.curRow.imageData = this.curRow.symbolData.panelHTML;\n            this.curRow = null;\n            sourceDijit.destroy();\n            sourceDijit = null;\n          } else {\n            s = query(\".imageDataGFX\", this.curRow.cells[2])[0];\n            if (s) {\n              this.curRow.cells[2].removeChild(s);\n            }\n            this.curRow.symbolData = lo.symbolData;\n            this.validateFields(this.curRow.symbolData, this.curRow);\n            a = domConstruct.create(\"div\", { 'class': \"imageDataGFX margin2\" }, this.curRow.cells[2]);\n            a.appendChild(this.curRow.symbolData.svg);\n            this.curRow.imageData = this.curRow.symbolData.panelHTML;\n          }\n        }\n      }\n    },\n\n    _getLayerOptionByValue: function _getLayerOptionByValue(tr) {\n      var item = tr.selectLayers.getSelectedItem();\n      var id = item && item.layerInfo ? item.layerInfo.id : undefined;\n      if (id) {\n        for (var i = 0; i < this.layer_options.length; i++) {\n          var lo = this.layer_options[i];\n          if (lo.id === id) {\n            return lo;\n          }\n        }\n      }\n    },\n\n    validateFields: function validateFields(symbolData, tr) {\n      var isValid;\n      if (symbolData && symbolData.featureDisplayOptions && symbolData.featureDisplayOptions.fields) {\n        isValid = symbolData.featureDisplayOptions.fields.length > 0;\n      } else {\n        isValid = false;\n      }\n      var td = query('.simple-table-cell', tr)[4];\n      if (td && !isValid) {\n        if (!tr.errorDiv) {\n          tr.errorDiv = domConstruct.create(\"div\", {\n            'class': \"field-error\"\n          }, td);\n          tr.errorSpan = domConstruct.create(\"span\", {\n            'class': \"jimu-icon jimu-icon-error\",\n            title: this.nls.fieldsWarning\n          }, tr.errorDiv);\n        } else {\n          domStyle.set(tr.errorSpan, 'display', 'inline-block');\n        }\n      } else if (isValid && tr.errorSpan) {\n        domStyle.set(tr.errorSpan, 'display', 'none');\n      }\n    },\n\n    _pickSymbol: function _pickSymbol(tr) {\n      //var selectLayersValue = tr.selectLayers;\n      var lo = this._getLayerOptionByValue(tr);\n      this.curRow = tr;\n\n      var options = {\n        nls: this.nls,\n        callerRow: tr,\n        layerInfo: lo,\n        value: lo.id,\n        symbolInfo: typeof this.curRow.symbolData !== 'undefined' ? this.curRow.symbolData : lo.symbolData,\n        map: this.map,\n        ac: this.appConfig,\n        hidePanel: this.hidePanel\n      };\n      var sourceDijit = new SymbolPicker(options);\n\n      var popup = new Popup({\n        width: 420,\n        autoHeight: true,\n        content: sourceDijit,\n        titleLabel: this.nls.sympolPopupTitle\n      });\n\n      this.own(on(sourceDijit, 'ok', lang.hitch(this, function (data) {\n        var s = query(\".imageDataGFX\", this.curRow.cells[2])[0];\n        if (s) {\n          this.curRow.cells[2].removeChild(s);\n        }\n        this.curRow.symbolData = data;\n        this.validateFields(this.curRow.symbolData, this.curRow);\n        var a = domConstruct.create(\"div\", { 'class': \"imageDataGFX margin2\" }, this.curRow.cells[2]);\n        a.appendChild(data.svg);\n        this.curRow.imageData = data.panelHTML;\n        this.curRow = null;\n        sourceDijit.destroy();\n        sourceDijit = null;\n        popup.close();\n      })));\n\n      this.own(on(sourceDijit, 'cancel', lang.hitch(this, function () {\n        this.curRow = null;\n        sourceDijit.destroy();\n        sourceDijit = null;\n        popup.close();\n      })));\n    },\n\n    setGeometryType: function setGeometryType(OpLayer) {\n      var match = true;\n      var type;\n      if (OpLayer.url && OpLayer.url.indexOf) {\n        if (OpLayer.url.indexOf(\"MapServer\") > -1) {\n          this.gtQueries.push(esriRequest({ \"url\": OpLayer.url + \"?f=json\" }));\n          this.gtQueryUrls.push(OpLayer.url);\n        }\n      } else if (OpLayer.featureInfos && OpLayer.featureInfos.hasOwnProperty('length')) {\n        var validGeomTypes = ['esriGeometryPoint', 'esriGeometryLine', 'esriGeometryPolygon'];\n        array.forEach(OpLayer.featureInfos, function (fi) {\n          if (fi.type && validGeomTypes.indexOf(fi.type) > -1) {\n            type = fi.type;\n            if (type !== fi.type) {\n              match = false;\n            }\n          }\n        });\n      }\n      return match && type ? type : undefined;\n    },\n\n    uploadImage: function uploadImage(i) {\n      this.panelMainIcon.innerHTML = \"\";\n      this.mpi = i;\n      domConstruct.create(\"div\", {\n        \"class\": \"innerMainPanelIcon\",\n        style: 'background-image: url(' + i + ');',\n        title: this.nls.mainPanelIcon\n      }, this.panelMainIcon);\n    },\n\n    getConfig: function getConfig() {\n      dijitPopup.close();\n\n      var rows = this.displayLayerTable.getRows();\n      var table = [];\n      var lInfo;\n      array.forEach(rows, lang.hitch(this, function (tr) {\n        var selectLayersValue;\n        var layerItem = tr.selectLayers.getSelectedItem();\n        if (layerItem && layerItem.layerInfo && layerItem.layerInfo.id) {\n          selectLayersValue = layerItem.layerInfo.id;\n        }\n\n        var labelTextValue = utils.stripHTML(tr.labelText.value);\n        var refreshBox = tr.refreshBox;\n        var lo = this._getLayerOptionByValue(tr);\n        var symbolData = tr.symbolData ? tr.symbolData : lo.symbolData;\n\n        lInfo = {\n          layer: selectLayersValue,\n          label: labelTextValue !== \"\" ? labelTextValue : lo.label,\n          refresh: refreshBox.checked,\n          url: lo.url,\n          type: lo.type,\n          id: lo.id,\n          symbolData: symbolData,\n          geometryType: lo.geometryType,\n          itemId: lo.itemId,\n          parentLayerID: lo.parentLayerID,\n          renderer: lo.renderer,\n          drawingInfo: lo.drawingInfo,\n          fields: lo.fields,\n          oidFieldName: lo.oidFieldName,\n          subLayerId: lo.subLayerId,\n          infoTemplate: lo.infoTemplate\n        };\n\n        if (tr.imageData) {\n          lInfo.panelImageData = tr.imageData;\n        }\n\n        var td = query('.imageDataGFX', tr)[0];\n        lInfo.imageData = typeof td !== 'undefined' ? td.innerHTML : \"<div></div>\";\n        table.push(lInfo);\n      }));\n\n      this.config.mapID = this.map.itemId;\n\n      this.config.layerInfos = table;\n      this.config.mainPanelText = utils.stripHTML(this.mainPanelText.value);\n      this.config.mainPanelIcon = this.panelMainIcon.innerHTML;\n      this.config.refreshInterval = utils.stripHTML(this.refreshInterval.value);\n      this.config.refreshEnabled = this.refreshLayers.length > 0 ? true : false;\n      this.config.countEnabled = this.countEnabled;\n      this.config.displayPanelIcon = this.displayPanelIcon;\n      this.config.hidePanel = this.hidePanel;\n      this.config.continuousRefreshEnabled = this.hidePanel;\n      this.config.expandList = this.expandListOptions.checked;\n      this.config.showAllFeatures = this.showAllFeaturesOptions.checked;\n      this.config.upgradeFields = false;\n\n      return this.config;\n    },\n\n    destroy: function destroy() {\n      dijitPopup.close();\n      this.inherited(arguments);\n    }\n  });\n});\n//# sourceMappingURL=Setting.js.map\n"]}
{"version":3,"sources":["../../../widgets/Estadisticas_wgt/Widget.js"],"names":["declare","BaseWidget","lang","LayerInfos","Query","QueryTask","StatisticDefinition","on","Point","baseClass","layersMap","iniClause","field_x_vertical_bar","field_y_vertical_bar","label_y_vertical_bar","field_x_pie","field_y_pie","label_y_pie","field_x_horizontal_bar","field_y_horizontal_bar","label_y_horizontal_bar","field_dep_nm_depa","field_dep_cd_depa","chart_tipo_persona","chart_tipo_origen","widthPanel","controller_query","postCreate","self_ew","_getAllLayers","panel","getPanel","getInstance","map","itemInfo","then","hitch","layerInfosObj","_configureStylePanelWidget","create","panel_child","getChildren","styleElement","document","createElement","panel_child_child","domNode","children","removeChild","length","style","backgroundColor","style_thumb","style_scrollbar","style_background","appendChild","createTextNode","_indicatorReinfo","where","query","returnCountOnly","queryTask","feature_dc_tb_url","executeForCount","results","el","odometer_ew","od","Odometer","value","format","update","innerHTML","error","console","log","_controllerZoom","extent","screenPoint","toScreen","getCenter","upperLeftScreenPoint","x","y","upperLeftMapPoint","toMap","distance","xmax","_zoomToRegion","evt","backColor","where_dep","where_dc","colorSelected","colorAnother","i","getElementAtEvent","feature_dc","hide","setFilter","data","labels","_index","ap_title_indicador_ew","nls","title_indicador","title_indicador_nacional","_yScale","ticks","forEach","elm","idx","push","active","_chart","config","datasets","outSpatialReference","spatialReference","feature_dep","getUrl","executeForExtent","setExtent","show","_drawPieChart","process","_drawHorizontalBarChart","_drawVerticalBarChart","url","feature_dc_tb","groupByFieldsForStatistics","countStatDef","statisticType","onStatisticField","outStatisticFieldName","orderByFields","outStatistics","execute","features","attributes","_VerticalBarChart","ctx","VerticalBarAp","getContext","canvas","height","myChart","Chart","type","label","borderWidth","borderColor","options","responsive","legend","display","scales","yAxes","fontColor","gridLines","color","lineWidth","xAxes","plugins","render","onClick","_pieChart","_updatePieChart","PieAp","hoverOffset","animation","animateScale","animateRotate","index","_HorizontalBarChart","_updateHorizontalBarChart","HorizontalBarAp","_acordeonFunction","target","nextElementSibling","parentElement","classList","toggle","startup","inherited","arguments","getLayerInfoById","layer_id_dc","getTableInfoById","service_id_horizontal_bar","layer_id_dep","onOpen","onClose"],"mappings":"QAAoB,oB,EACG,iB,EACN,iB,EACM,4B,EACL,kB,EACI,sB,EACU,gC,EACjB,S,EACG,qB,EACX,0C,aATAA,O,EACAC,U,EACAC,I,EACAC,U,EACAC,K,EACAC,S,EACAC,mB,EACAC,E,EACAC,K;WAIQR,QAAQ,CACnBC,UADmB,EAEnBG,KAFmB,EAGnBC,SAHmB,EAInBC,mBAJmB,CAAR,EAKZ;;AAEC;AACA;AACA;;AAEA;;AAEAG,mBAAW,kBARZ;;AAUC;AACAC,mBAAW,EAXZ;AAYCC,mBAAW,KAZZ;;AAcC;AACA;AACAC,8BAAsB,cAhBvB;AAiBCC,8BAAsB,oBAjBvB;AAkBCC,8BAAsB,mBAlBvB;;AAoBC;AACA;AACAC,qBAAa,gBAtBd;AAuBCC,qBAAa,sBAvBd;AAwBCC,qBAAa,iBAxBd;;AA0BC;AACA;AACAC,gCAAwB,QA5BzB;AA6BCC,gCAAwB,cA7BzB;AA8BCC,gCAAwB,QA9BzB;;AAgCCC,2BAAmB,SAhCpB;AAiCCC,2BAAmB,SAjCpB;;AAmCCC,4BAAoB,IAnCrB;AAoCCC,2BAAmB,IApCpB;AAqCCC,oBAAY,GArCb;;AAuCC;AACAC,0BAAkB,IAxCnB;;AA2CCC,kBA3CD,wBA2Cc;AACTC,sBAAU,IAAV;AACA,iBAAKC,aAAL;AACA,iBAAKC,KAAL,GAAa,KAAKC,QAAL,EAAb;AACA;AACA;AACA;AACH,SAlDF;AAoDCF,qBApDD,2BAoDiB;AACZ1B,uBAAW6B,WAAX,CAAuB,KAAKC,GAA5B,EAAiC,KAAKA,GAAL,CAASC,QAA1C,EACKC,IADL,CACUjC,KAAKkC,KAAL,CAAW,IAAX,EAAiB,UAASC,aAAT,EAAwB;AAC3C,qBAAK3B,SAAL,GAAiB2B,aAAjB;AACH,aAFK,CADV;AAIH,SAzDF;AA2DCC,kCA3DD,wCA2D2C;AAAA,gBAAfC,MAAe,uEAAN,IAAM;;AACtC;AACA,gBAAIC,cAAc,KAAKV,KAAL,CAAWW,WAAX,GAAyB,CAAzB,CAAlB;;AAEA,gBAAIC,eAAeC,SAASC,aAAT,CAAuB,OAAvB,CAAnB;AACA,gBAAI,CAACL,MAAL,EAAa;AACT,oBAAIM,oBAAoBL,YAAYM,OAAZ,CAAoBC,QAA5C;AACAP,4BAAYM,OAAZ,CAAoBE,WAApB,CAAgCH,kBAAkBA,kBAAkBI,MAAlB,GAA2B,CAA7C,CAAhC;AACAT,4BAAYM,OAAZ,CAAoBI,KAApB,CAA0BC,eAA1B,GAA4C,OAA5C;AACA;AACH;AACDX,wBAAYM,OAAZ,CAAoBI,KAApB,CAA0BC,eAA1B,GAA4C,MAA5C;AACA,gBAAIC,cAAc,oFAAlB;AACA,gBAAIC,kBAAkB,4FAAtB;AACA,gBAAIC,mBAAmB,8DAAvB;;AAEAZ,yBAAaa,WAAb,CAAyBZ,SAASa,cAAT,CAAwBH,eAAxB,CAAzB;AACAX,yBAAaa,WAAb,CAAyBZ,SAASa,cAAT,CAAwBJ,WAAxB,CAAzB;AACAV,yBAAaa,WAAb,CAAyBZ,SAASa,cAAT,CAAwBF,gBAAxB,CAAzB;AACAd,wBAAYM,OAAZ,CAAoBS,WAApB,CAAgCb,YAAhC;AACH,SA/EF;AAiFCe,wBAjFD,8BAiF6C;AAAA,gBAA3BC,KAA2B,uEAAnB9B,QAAQjB,SAAW;;AACxC,gBAAIgD,QAAQ,IAAIvD,KAAJ,EAAZ;AACAuD,kBAAMD,KAAN,GAAcA,KAAd;AACAC,kBAAMC,eAAN,GAAwB,IAAxB;AACA;AACA,gBAAIC,YAAY,IAAIxD,SAAJ,CAAc,KAAKyD,iBAAnB,CAAhB;AACAD,sBAAUE,eAAV,CAA0BJ,KAA1B,EACI,UAASK,OAAT,EAAkB;AACd,oBAAIC,KAAKrC,QAAQsC,WAAjB;AACAC,qBAAK,IAAIC,QAAJ,CAAa,EAAEH,IAAIA,EAAN,EAAUI,OAAO,CAAjB,EAAoBC,QAAQ,EAA5B,EAAb,CAAL;AACAH,mBAAGI,MAAH,CAAU,CAAV;AACAN,mBAAGO,SAAH,GAAeR,OAAf;AACH,aANL,EAOI,UAASS,KAAT,EAAgB;AACZC,wBAAQC,GAAR,CAAYF,KAAZ;AACH,aATL;AAUH,SAjGF;AAmGCG,uBAnGD,2BAmGiBC,MAnGjB,EAmGyB;AACpB,gBAAIC,cAAclD,QAAQK,GAAR,CAAY8C,QAAZ,CAAqBnD,QAAQK,GAAR,CAAY4C,MAAZ,CAAmBG,SAAnB,EAArB,CAAlB;AACA,gBAAIC,uBAAuB,IAAIzE,KAAJ,CAAUsE,YAAYI,CAAZ,GAAgBtD,QAAQH,UAAlC,EAA8CqD,YAAYK,CAAZ,GAAgBvD,QAAQH,UAAtE,CAA3B;AACA,gBAAI2D,oBAAoBxD,QAAQK,GAAR,CAAYoD,KAAZ,CAAkBJ,oBAAlB,CAAxB;AACA,gBAAIK,WAAW1D,QAAQK,GAAR,CAAY4C,MAAZ,CAAmBG,SAAnB,GAA+BE,CAA/B,GAAmCE,kBAAkBF,CAApE;AACAL,mBAAOU,IAAP,GAAcV,OAAOU,IAAP,GAAcD,QAA5B;AACA,mBAAOT,MAAP;AACH,SA1GF;AA4GCW,qBA5GD,yBA4GeC,GA5Gf,EA4GoB;AACf,gBAAIC,YAAY,EAAhB;AACA,gBAAIC,kBAAJ;AACA,gBAAIC,iBAAJ;AACA,gBAAIC,gBAAgB,SAApB;AACA,gBAAIC,eAAe,SAAnB;;AAEA,gBAAIC,IAAI,KAAKC,iBAAL,CAAuBP,GAAvB,CAAR;AACA,gBAAIM,EAAE9C,MAAF,IAAY,CAAhB,EAAmB;AACf;AACH;;AAEDrB,oBAAQqE,UAAR,CAAmBC,IAAnB;AACAtE,oBAAQqE,UAAR,CAAmBE,SAAnB,CAA6B,KAAKxF,SAAlC;;AAEA,gBAAI0D,QAAQ,KAAK+B,IAAL,CAAUC,MAAV,CAAiBN,EAAE,CAAF,EAAKO,MAAtB,CAAZ;;AAEA,gBAAIjC,SAASzC,QAAQF,gBAArB,EAAuC;AACnCmE,gCAAgBC,YAAhB;AACAF,2BAAWhE,QAAQjB,SAAnB;AACAgF,4BAAY/D,QAAQjB,SAApB;AACAiB,wBAAQ2E,qBAAR,CAA8B/B,SAA9B,GAA6C5C,QAAQ4E,GAAR,CAAYC,eAAzD,aAAgF7E,QAAQ4E,GAAR,CAAYE,wBAA5F;AACH,aALD,MAKO;AACHd,sCAAoBhE,QAAQhB,oBAA5B,oBAA8DyD,KAA9D;AACAsB,uCAAqB/D,QAAQP,iBAA7B,oBAA4DgD,KAA5D;AACAzC,wBAAQF,gBAAR,GAA2B2C,KAA3B;AACAzC,wBAAQ2E,qBAAR,CAA8B/B,SAA9B,GAA6C5C,QAAQ4E,GAAR,CAAYC,eAAzD,aAAgFpC,KAAhF;AACH;;AAED0B,cAAE,CAAF,EAAKY,OAAL,CAAaC,KAAb,CAAmBC,OAAnB,CAA2B,UAASC,GAAT,EAAcC,GAAd,EAAmB;AAC1CA,uBAAOhB,EAAE,CAAF,EAAKO,MAAZ,GAAqBZ,UAAUsB,IAAV,CAAenB,aAAf,CAArB,GAAqDH,UAAUsB,IAAV,CAAelB,YAAf,CAArD;AACH,aAFD;AAGA,iBAAKmB,MAAL,CAAY,CAAZ,EAAeC,MAAf,CAAsBC,MAAtB,CAA6Bf,IAA7B,CAAkCgB,QAAlC,CAA2C,CAA3C,EAA8CjE,eAA9C,GAAgEuC,SAAhE;AACA,iBAAKnB,MAAL;;AAEA,gBAAIZ,QAAQ,IAAIvD,KAAJ,EAAZ;AACAuD,kBAAMD,KAAN,GAAciC,SAAd;AACAhC,kBAAM0D,mBAAN,GAA4BzF,QAAQK,GAAR,CAAYqF,gBAAxC;AACAzD,wBAAY,IAAIxD,SAAJ,CAAcuB,QAAQ2F,WAAR,CAAoBC,MAApB,EAAd,CAAZ;;AAGA3D,sBAAU4D,gBAAV,CAA2B9D,KAA3B,EACI,UAASK,OAAT,EAAkB;AACdpC,wBAAQK,GAAR,CAAYyF,SAAZ,CAAsB1D,QAAQa,MAA9B,EAAsC,IAAtC;AACH,aAHL,EAII,UAASJ,KAAT,EAAgB;AACZC,wBAAQC,GAAR,CAAYF,KAAZ;AACH,aANL;;AAQA7C,oBAAQqE,UAAR,CAAmBE,SAAnB,CAA6BP,QAA7B;AACAhE,oBAAQqE,UAAR,CAAmB0B,IAAnB;;AAEA/F,oBAAQ6B,gBAAR,CAAyBC,QAAQkC,QAAjC;AACAhE,oBAAQgG,aAAR,CAAsBhC,QAAtB,EAAgCiC,UAAU,QAA1C;AACAjG,oBAAQkG,uBAAR,CAAgClC,QAAhC,EAA0CiC,UAAU,QAApD;AACH,SAnKF;AAqKCE,6BArKD,mCAqKyB;AACpB,gBAAIC,MAAM,KAAKC,aAAL,CAAmBT,MAAnB,EAAV;;AAEA,gBAAI3D,YAAY,IAAIxD,SAAJ,CAAc2H,GAAd,CAAhB;AACA,gBAAIrE,QAAQ,IAAIvD,KAAJ,EAAZ;;AAEAuD,kBAAMD,KAAN,GAAc,KAAK/C,SAAnB;AACAgD,kBAAMuE,0BAAN,GAAmC,CAACtG,QAAQhB,oBAAT,CAAnC;;AAEA,gBAAIuH,eAAe,IAAI7H,mBAAJ,EAAnB;AACA6H,yBAAaC,aAAb,GAA6B,OAA7B;AACAD,yBAAaE,gBAAb,GAAgCzG,QAAQhB,oBAAxC;AACAuH,yBAAaG,qBAAb,GAAqC1G,QAAQf,oBAA7C;;AAEA8C,kBAAM4E,aAAN,GAAsB,YAAU3G,QAAQhB,oBAAlB,YAAtB;;AAEA+C,kBAAM6E,aAAN,GAAsB,CAACL,YAAD,CAAtB;;AAEAtE,sBAAU4E,OAAV,CAAkB9E,KAAlB,EAAyB,UAASK,OAAT,EAAkB;AACvCkB,oBAAIlB,QAAQ0E,QAAR,CAAiBzG,GAAjB,CAAqB,UAAC8D,CAAD;AAAA,2BAAOA,EAAE4C,UAAF,CAAa/G,QAAQhB,oBAArB,CAAP;AAAA,iBAArB,CAAJ;AACAuE,oBAAInB,QAAQ0E,QAAR,CAAiBzG,GAAjB,CAAqB,UAAC8D,CAAD;AAAA,2BAAOA,EAAE4C,UAAF,CAAa/G,QAAQf,oBAArB,CAAP;AAAA,iBAArB,CAAJ;AACAe,wBAAQgH,iBAAR,CAA0B1D,CAA1B,EAA6BC,CAA7B;AACH,aAJD;AAMH,SA7LF;AA+LCyD,yBA/LD,6BA+LmB1D,CA/LnB,EA+LsBC,CA/LtB,EA+LyB;AACpB,gBAAI0D,MAAMjH,QAAQkH,aAAR,CAAsBC,UAAtB,CAAiC,IAAjC,CAAV;AACAF,gBAAIG,MAAJ,CAAWC,MAAX,GAAoB,GAApB;AACA,gBAAIC,UAAU,IAAIC,KAAJ,CAAUN,GAAV,EAAe;AACzBO,sBAAM,eADmB;AAEzBhD,sBAAM;AACFC,4BAAQnB,CADN;AAEFkC,8BAAU,CAAC;AACPiC,+BAAOzH,QAAQd,oBADR;AAEPsF,8BAAMjB,CAFC;AAGPmE,qCAAa,GAHN;AAIPC,qCAAa,SAJN;AAKPpG,yCAAiB;AALV,qBAAD;AAFR,iBAFmB;AAYzBqG,yBAAS;AACLC,gCAAY,IADP;AAEL;AACAC,4BAAQ;AACJC,iCAAS;AADL,qBAHH;AAMLC,4BAAQ;AACJC,+BAAO,CAAC;AACJjD,mCAAO;AACH;AACAkD,2CAAW;AAFR,6BADH;AAKJC,uCAAW;AACPC,uCAAO,SADA;AAEPC,2CAAW;AAFJ;AALP,yBAAD,CADH;AAWJC,+BAAO,CAAC;AACJtD,mCAAO;AACH;AACAkD,2CAAW;AAFR,6BADH;AAKJC,uCAAW;AACPC,uCAAO,SADA;AAEPC,2CAAW;AAFJ;AALP,yBAAD;AAXH,qBANH;AA4BLE,6BAAS;AACL9D,gCAAQ;AACJ+D,oCAAQ,OADJ;AAEJN,uCAAW;AAFP;AADH,qBA5BJ;AAkCLO,6BAASzI,QAAQ4D;AAlCZ;AAZgB,aAAf,CAAd;AAiDH,SAnPF;AAqPCoC,qBArPD,2BAqP+D;AAAA,gBAAhDlE,KAAgD,uEAAxC9B,QAAQjB,SAAgC;AAAA,gBAArBkH,OAAqB,uEAAX,SAAW;;AAC1D,gBAAIG,MAAM,KAAKC,aAAL,CAAmBT,MAAnB,EAAV;;AAEA,gBAAI3D,YAAY,IAAIxD,SAAJ,CAAc2H,GAAd,CAAhB;AACA,gBAAIrE,QAAQ,IAAIvD,KAAJ,EAAZ;;AAEAuD,kBAAMD,KAAN,GAAcA,KAAd;AACAC,kBAAMuE,0BAAN,GAAmC,CAACtG,QAAQb,WAAT,CAAnC;;AAEA,gBAAIoH,eAAe,IAAI7H,mBAAJ,EAAnB;AACA6H,yBAAaC,aAAb,GAA6B,OAA7B;AACAD,yBAAaE,gBAAb,GAAgCzG,QAAQb,WAAxC;AACAoH,yBAAaG,qBAAb,GAAqC1G,QAAQZ,WAA7C;;AAEA2C,kBAAM6E,aAAN,GAAsB,CAACL,YAAD,CAAtB;;AAEAtE,sBAAU4E,OAAV,CAAkB9E,KAAlB,EAAyB,UAASK,OAAT,EAAkB;AACvCkB,oBAAIlB,QAAQ0E,QAAR,CAAiBzG,GAAjB,CAAqB,UAAC8D,CAAD;AAAA,2BAAOA,EAAE4C,UAAF,CAAa/G,QAAQb,WAArB,CAAP;AAAA,iBAArB,CAAJ;AACAoE,oBAAInB,QAAQ0E,QAAR,CAAiBzG,GAAjB,CAAqB,UAAC8D,CAAD;AAAA,2BAAOA,EAAE4C,UAAF,CAAa/G,QAAQZ,WAArB,CAAP;AAAA,iBAArB,CAAJ;AACA,oBAAI6G,WAAW,SAAf,EAA0B;AACtBjG,4BAAQ0I,SAAR,CAAkBpF,CAAlB,EAAqBC,CAArB;AACH,iBAFD,MAEO,IAAI0C,WAAW,QAAf,EAAyB;AAC5BjG,4BAAQ2I,eAAR,CAAwBrF,CAAxB,EAA2BC,CAA3B;AACH;AACJ,aARD;AASH,SA9QF;AAgRCmF,iBAhRD,qBAgRWpF,CAhRX,EAgRcC,CAhRd,EAgRiB;AACZ,gBAAI0D,MAAMjH,QAAQ4I,KAAR,CAAczB,UAAd,CAAyB,IAAzB,CAAV;AACAF,gBAAIG,MAAJ,CAAWC,MAAX,GAAoB,GAApB;AACArH,oBAAQL,kBAAR,GAA6B,IAAI4H,KAAJ,CAAUN,GAAV,EAAe;AACxCO,sBAAM,UADkC;AAExChD,sBAAM;AACFC,4BAAQnB,CADN;AAEFkC,8BAAU,CAAC;AACPiC,+BAAOzH,QAAQX,WADR;AAEPmF,8BAAMjB,CAFC;AAGPhC,yCAAiB,CACb,SADa,EAEb,SAFa,EAGb,mBAHa,EAIb,mBAJa,EAKb,SALa,CAHV;AAUPsH,qCAAa;AAVN,qBAAD;AAFR,iBAFkC;AAiBxC;AACAjB,yBAAS;AACLC,gCAAY,IADP;AAEL;AACAiB,+BAAW;AACPC,sCAAc,IADP;AAEPC,uCAAe;AAFR,qBAHN;AAOLlB,4BAAQ;AACJC,iCAAS,IADL;AAEJtD,gCAAQ;AACJyD,uCAAW;AADP;AAFJ,qBAPH;AAaLK,6BAAS;AACL9D,gCAAQ;AACJ+D,oCAAQ,OADJ;AAEJN,uCAAW;AAFP;AADH;AAbJ;AAlB+B,aAAf,CAA7B;AAuCH,SA1TF;AA4TCS,uBA5TD,2BA4TiBrF,CA5TjB,EA4ToBC,CA5TpB,EA4TuB;AAClB;AACA;AACA;AACA;AACAvD,oBAAQL,kBAAR,CAA2B6E,IAA3B,CAAgCC,MAAhC,GAAyCnB,CAAzC;AACAtD,oBAAQL,kBAAR,CAA2B6E,IAA3B,CAAgCgB,QAAhC,CAAyC,CAAzC,EAA4ChB,IAA5C,GAAmDjB,CAAnD;AACAvD,oBAAQL,kBAAR,CAA2BgD,MAA3B;AACH,SApUF;AAsUCuD,+BAtUD,qCAsUyE;AAAA,gBAAhDpE,KAAgD,uEAAxC9B,QAAQjB,SAAgC;AAAA,gBAArBkH,OAAqB,uEAAX,SAAW;;AACpE,gBAAIG,MAAM,KAAKC,aAAL,CAAmBT,MAAnB,EAAV;;AAEA,gBAAI3D,YAAY,IAAIxD,SAAJ,CAAc2H,GAAd,CAAhB;AACA,gBAAIrE,QAAQ,IAAIvD,KAAJ,EAAZ;;AAEAuD,kBAAMD,KAAN,GAAcA,KAAd;AACAC,kBAAMuE,0BAAN,GAAmC,CAACtG,QAAQV,sBAAT,CAAnC;;AAEA,gBAAIiH,eAAe,IAAI7H,mBAAJ,EAAnB;AACA6H,yBAAaC,aAAb,GAA6B,OAA7B;AACAD,yBAAaE,gBAAb,GAAgCzG,QAAQV,sBAAxC;AACAiH,yBAAaG,qBAAb,GAAqC1G,QAAQT,sBAA7C;;AAEAwC,kBAAM6E,aAAN,GAAsB,CAACL,YAAD,CAAtB;;AAEAtE,sBAAU4E,OAAV,CAAkB9E,KAAlB,EAAyB,UAASK,OAAT,EAAkB;AACvC,oBAAIkB,IAAIlB,QAAQ0E,QAAR,CAAiBzG,GAAjB,CAAqB,UAAC8D,CAAD;AAAA,2BAAOA,EAAE4C,UAAF,CAAa/G,QAAQV,sBAArB,CAAP;AAAA,iBAArB,CAAR;AACA,qBAAK,IAAI2J,QAAQ,CAAjB,EAAoBA,QAAQ3F,EAAEjC,MAA9B,EAAsC4H,OAAtC,EAA+C;AAC3C,wBAAI3F,EAAE2F,KAAF,KAAY,QAAhB,EAA0B;AACtB3F,0BAAE2F,KAAF,IAAW,YAAX;AACH,qBAFD,MAEO,IAAI3F,EAAE2F,KAAF,KAAY,OAAhB,EAAyB;AAC5B3F,0BAAE2F,KAAF,IAAW,YAAX;AACH,qBAFM,MAEA,CAEN;AACJ;AACD,oBAAI1F,IAAInB,QAAQ0E,QAAR,CAAiBzG,GAAjB,CAAqB,UAAC8D,CAAD;AAAA,2BAAOA,EAAE4C,UAAF,CAAa/G,QAAQT,sBAArB,CAAP;AAAA,iBAArB,CAAR;AACA,oBAAI0G,WAAW,SAAf,EAA0B;AACtBjG,4BAAQkJ,mBAAR,CAA4B5F,CAA5B,EAA+BC,CAA/B;AACH,iBAFD,MAEO,IAAI0C,WAAW,QAAf,EAAyB;AAC5BjG,4BAAQmJ,yBAAR,CAAkC7F,CAAlC,EAAqCC,CAArC;AACH;AACJ,aAjBD;AAmBH,SAzWF;AA2WC2F,2BA3WD,+BA2WqB5F,CA3WrB,EA2WwBC,CA3WxB,EA2W2B;AACtB,gBAAI0D,MAAMjH,QAAQoJ,eAAR,CAAwBjC,UAAxB,CAAmC,IAAnC,CAAV;AACAF,gBAAIG,MAAJ,CAAWC,MAAX,GAAoB,GAApB;AACArH,oBAAQJ,iBAAR,GAA4B,IAAI2H,KAAJ,CAAUN,GAAV,EAAe;AACvCO,sBAAM,KADiC;AAEvChD,sBAAM;AACFC,4BAAQnB,CADN;AAEFkC,8BAAU,CAAC;AACPiC,+BAAOzH,QAAQR,sBADR;AAEPgF,8BAAMjB,CAFC;AAGPmE,qCAAa,GAHN;AAIPC,qCAAa,SAJN;AAKPpG,yCAAiB,CACb,SADa,EAEb,mBAFa,EAGb,mBAHa,EAIb,SAJa;AAMjB;AAXO,qBAAD;AAFR,iBAFiC;AAkBvCqG,yBAAS;AACLC,gCAAY,IADP;AAEL;AACAC,4BAAQ;AACJC,iCAAS;AADL,qBAHH;AAMLC,4BAAQ;AACJC,+BAAO,CAAC;AACJjD,mCAAO;AACH;AACAkD,2CAAW;AAFR,6BADH;AAKJC,uCAAW;AACPC,uCAAO,SADA;AAEPC,2CAAW;AAFJ;AALP,yBAAD,CADH;AAWJC,+BAAO,CAAC;AACJtD,mCAAO;AACH;AACAkD,2CAAW;AAFR,6BADH;AAKJC,uCAAW;AACPC,uCAAO,SADA;AAEPC,2CAAW;AAFJ;AALP,yBAAD;AAXH,qBANH;AA4BLE,6BAAS;AACL9D,gCAAQ;AACJ+D,oCAAQ,OADJ;AAEJN,uCAAW;AAFP;AADH;AA5BJ;AAlB8B,aAAf,CAA5B;AAsDH,SApaF;AAsaCiB,iCAtaD,qCAsa2B7F,CAta3B,EAsa8BC,CAta9B,EAsaiC;AAC5BvD,oBAAQJ,iBAAR,CAA0B4E,IAA1B,CAA+BC,MAA/B,GAAwCnB,CAAxC;AACAtD,oBAAQJ,iBAAR,CAA0B4E,IAA1B,CAA+BgB,QAA/B,CAAwC,CAAxC,EAA2ChB,IAA3C,GAAkDjB,CAAlD;AACAvD,oBAAQJ,iBAAR,CAA0B+C,MAA1B;AACH,SA1aF;AA4aC0G,yBA5aD,6BA4amBxF,GA5anB,EA4awB;AACnB,gBAAI3D,QAAQ2D,IAAIyF,MAAJ,CAAWC,kBAAvB;AACA,gBAAI,CAACrJ,KAAL,EAAY;AACRA,wBAAQ2D,IAAIyF,MAAJ,CAAWE,aAAX,CAAyBD,kBAAjC;AACA1F,oBAAIyF,MAAJ,CAAWE,aAAX,CAAyBC,SAAzB,CAAmCC,MAAnC,CAA0C,QAA1C;AACH;AACD7F,gBAAIyF,MAAJ,CAAWG,SAAX,CAAqBC,MAArB,CAA4B,QAA5B;AACAxJ,kBAAMuJ,SAAN,CAAgBC,MAAhB,CAAuB,QAAvB;;AAGA;AACA;AACA;AACA;AACA;AACH,SA3bF;AA4bCC,eA5bD,qBA4bW;AACN,iBAAKC,SAAL,CAAeC,SAAf;AACA,iBAAKxF,UAAL,GAAkB,KAAKvF,SAAL,CAAegL,gBAAf,CAAgC,KAAKvE,MAAL,CAAYwE,WAA5C,CAAlB;AACA,iBAAK1D,aAAL,GAAqB,KAAKvH,SAAL,CAAekL,gBAAf,CAAgC,KAAKzE,MAAL,CAAY0E,yBAA5C,CAArB;AACA,iBAAK/H,iBAAL,GAAyB,KAAKmE,aAAL,CAAmBT,MAAnB,EAAzB;AACA,iBAAKD,WAAL,GAAmB,KAAK7G,SAAL,CAAegL,gBAAf,CAAgC,KAAKvE,MAAL,CAAY2E,YAA5C,CAAnB;AACA,iBAAKrI,gBAAL;AACA,iBAAKsE,qBAAL;AACA,iBAAKH,aAAL;AACA,iBAAKE,uBAAL;AACA;AAEH,SAxcF;AAycCiE,cAzcD,oBAycU;AACLrH,oBAAQC,GAAR,CAAY,0BAAZ;AACA,iBAAKrC,0BAAL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,SApdF;AAsdC0J,eAtdD,qBAsdW;AACNtH,oBAAQC,GAAR,CAAY,2BAAZ;AACA,iBAAKrC,0BAAL,CAAgCC,SAAS,KAAzC;AACH;AAzdF;AA0dC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvfW,K","file":"Widget.js","sourcesContent":["import declare from 'dojo/_base/declare';\nimport BaseWidget from 'jimu/BaseWidget';\nimport lang from 'dojo/_base/lang';\nimport LayerInfos from 'jimu/LayerInfos/LayerInfos';\nimport Query from \"esri/tasks/query\";\nimport QueryTask from \"esri/tasks/QueryTask\";\nimport StatisticDefinition from \"esri/tasks/StatisticDefinition\";\nimport on from 'dojo/on';\nimport Point from \"esri/geometry/Point\";\nimport '../../libs/chartjs/chartjs-plugin-labels';\n\n// To create a widget, you need to derive from BaseWidget.\nexport default declare([\n    BaseWidget,\n    Query,\n    QueryTask,\n    StatisticDefinition,\n], {\n\n    // Desarrollador: Ing. Geógrafo Daniel Aguado H.\n    // linkedin: https://www.linkedin.com/in/danielgis\n    // WebSite: https://danielgis.github.io/\n\n    // Custom widget code goes here\n\n    baseClass: 'estadisticas-wgt',\n\n    // add additional properties here\n    layersMap: [],\n    iniClause: '1=1',\n\n    // Elementos del grafico de barras vertical\n    // feature_id_vertical_bar: '',\n    field_x_vertical_bar: 'DEPARTAMENTO',\n    field_y_vertical_bar: 'COUNT_DEPARTAMENTO',\n    label_y_vertical_bar: 'Numero de Reinfos',\n\n    // Elementos del gráfico de torta\n    // feature_id_vertical_bar: '',\n    field_x_pie: 'M_TIPO_PERSONA',\n    field_y_pie: 'COUNT_M_TIPO_PERSONA',\n    label_y_pie: 'Tipo de persona',\n\n    // Elementos del grafico de barras horizontal\n    // feature_id_vertical_bar: '',\n    field_x_horizontal_bar: 'ORIGEN',\n    field_y_horizontal_bar: 'COUNT_ORIGEN',\n    label_y_horizontal_bar: 'Origen',\n\n    field_dep_nm_depa: 'NM_DEPA',\n    field_dep_cd_depa: 'CD_DEPA',\n\n    chart_tipo_persona: null,\n    chart_tipo_origen: null,\n    widthPanel: 360,\n\n    // Almacena el valor de la ultima region seleccionada\n    controller_query: null,\n\n    // methods to communication with app container:\n    postCreate() {\n        self_ew = this;\n        this._getAllLayers();\n        this.panel = this.getPanel();\n        // this.panel.position.width = 720\n        // this.panel.setPosition(this.panel.position);\n        // this.panel.panelManager.normalizePanel(this.panel);\n    },\n\n    _getAllLayers() {\n        LayerInfos.getInstance(this.map, this.map.itemInfo)\n            .then(lang.hitch(this, function(layerInfosObj) {\n                this.layersMap = layerInfosObj;\n            }));\n    },\n\n    _configureStylePanelWidget(create = true) {\n        // let panel = this.getPanel();\n        let panel_child = this.panel.getChildren()[0];\n\n        let styleElement = document.createElement(\"style\");\n        if (!create) {\n            let panel_child_child = panel_child.domNode.children\n            panel_child.domNode.removeChild(panel_child_child[panel_child_child.length - 1]);\n            panel_child.domNode.style.backgroundColor = 'white';\n            return;\n        }\n        panel_child.domNode.style.backgroundColor = '#333';\n        let style_thumb = '::-webkit-scrollbar-thumb {border-radius: 0px; opacity: 0.6; background: #999999;}'\n        let style_scrollbar = '::-webkit-scrollbar {border-radius: 0px; width: 6px; background-color: #333; height: 6px;}'\n        let style_background = '.jimu-widget-frame.jimu-container {background-color: white;}'\n\n        styleElement.appendChild(document.createTextNode(style_scrollbar))\n        styleElement.appendChild(document.createTextNode(style_thumb))\n        styleElement.appendChild(document.createTextNode(style_background))\n        panel_child.domNode.appendChild(styleElement);\n    },\n\n    _indicatorReinfo(where = self_ew.iniClause) {\n        let query = new Query();\n        query.where = where;\n        query.returnCountOnly = true;\n        // let url = this.feature_dc_tb.getUrl();\n        let queryTask = new QueryTask(this.feature_dc_tb_url);\n        queryTask.executeForCount(query,\n            function(results) {\n                var el = self_ew.odometer_ew;\n                od = new Odometer({ el: el, value: 0, format: '' });\n                od.update(0)\n                el.innerHTML = results;\n            },\n            function(error) {\n                console.log(error)\n            })\n    },\n\n    _controllerZoom(extent) {\n        let screenPoint = self_ew.map.toScreen(self_ew.map.extent.getCenter())\n        let upperLeftScreenPoint = new Point(screenPoint.x - self_ew.widthPanel, screenPoint.y - self_ew.widthPanel);\n        let upperLeftMapPoint = self_ew.map.toMap(upperLeftScreenPoint);\n        let distance = self_ew.map.extent.getCenter().x - upperLeftMapPoint.x\n        extent.xmax = extent.xmax + distance;\n        return extent;\n    },\n\n    _zoomToRegion(evt) {\n        let backColor = [];\n        let where_dep;\n        let where_dc;\n        let colorSelected = '#00feca';\n        let colorAnother = '#36a2eb';\n\n        let i = this.getElementAtEvent(evt);\n        if (i.length == 0) {\n            return;\n        }\n\n        self_ew.feature_dc.hide()\n        self_ew.feature_dc.setFilter(this.iniClause)\n\n        let value = this.data.labels[i[0]._index];\n\n        if (value == self_ew.controller_query) {\n            colorSelected = colorAnother;\n            where_dc = self_ew.iniClause;\n            where_dep = self_ew.iniClause;\n            self_ew.ap_title_indicador_ew.innerHTML = `${self_ew.nls.title_indicador}<br/>${self_ew.nls.title_indicador_nacional}`;\n        } else {\n            where_dc = `lower(${self_ew.field_x_vertical_bar}) = lower('${value}')`;\n            where_dep = `lower(${self_ew.field_dep_nm_depa}) = lower('${value}')`;\n            self_ew.controller_query = value;\n            self_ew.ap_title_indicador_ew.innerHTML = `${self_ew.nls.title_indicador}<br/>${value}`;\n        }\n\n        i[0]._yScale.ticks.forEach(function(elm, idx) {\n            idx == i[0]._index ? backColor.push(colorSelected) : backColor.push(colorAnother);\n        });\n        this.active[0]._chart.config.data.datasets[0].backgroundColor = backColor;\n        this.update()\n\n        let query = new Query();\n        query.where = where_dep;\n        query.outSpatialReference = self_ew.map.spatialReference;\n        queryTask = new QueryTask(self_ew.feature_dep.getUrl())\n\n\n        queryTask.executeForExtent(query,\n            function(results) {\n                self_ew.map.setExtent(results.extent, true);\n            },\n            function(error) {\n                console.log(error);\n            })\n\n        self_ew.feature_dc.setFilter(where_dc)\n        self_ew.feature_dc.show()\n\n        self_ew._indicatorReinfo(where = where_dc);\n        self_ew._drawPieChart(where_dc, process = 'update');\n        self_ew._drawHorizontalBarChart(where_dc, process = 'update');\n    },\n\n    _drawVerticalBarChart() {\n        var url = this.feature_dc_tb.getUrl();\n\n        var queryTask = new QueryTask(url);\n        var query = new Query();\n\n        query.where = this.iniClause;\n        query.groupByFieldsForStatistics = [self_ew.field_x_vertical_bar];\n\n        var countStatDef = new StatisticDefinition();\n        countStatDef.statisticType = \"count\";\n        countStatDef.onStatisticField = self_ew.field_x_vertical_bar;\n        countStatDef.outStatisticFieldName = self_ew.field_y_vertical_bar;\n\n        query.orderByFields = [`COUNT(${self_ew.field_x_vertical_bar}) DESC`]\n\n        query.outStatistics = [countStatDef];\n\n        queryTask.execute(query, function(results) {\n            x = results.features.map((i) => i.attributes[self_ew.field_x_vertical_bar]);\n            y = results.features.map((i) => i.attributes[self_ew.field_y_vertical_bar]);\n            self_ew._VerticalBarChart(x, y);\n        });\n\n    },\n\n    _VerticalBarChart(x, y) {\n        var ctx = self_ew.VerticalBarAp.getContext('2d');\n        ctx.canvas.height = 500;\n        var myChart = new Chart(ctx, {\n            type: 'horizontalBar',\n            data: {\n                labels: x,\n                datasets: [{\n                    label: self_ew.label_y_vertical_bar,\n                    data: y,\n                    borderWidth: 0.1,\n                    borderColor: '#eeeeee',\n                    backgroundColor: '#36a2eb'\n                }]\n            },\n            options: {\n                responsive: true,\n                // maintainAspectRatio: false,\n                legend: {\n                    display: false,\n                },\n                scales: {\n                    yAxes: [{\n                        ticks: {\n                            // beginAtZero: true,\n                            fontColor: '#eeeeee'\n                        },\n                        gridLines: {\n                            color: '#eeeeee',\n                            lineWidth: 0.1\n                        }\n                    }],\n                    xAxes: [{\n                        ticks: {\n                            // beginAtZero: true,\n                            fontColor: '#eeeeee'\n                        },\n                        gridLines: {\n                            color: '#eeeeee',\n                            lineWidth: 0.1\n                        }\n                    }]\n                },\n                plugins: {\n                    labels: {\n                        render: 'value',\n                        fontColor: '#eeeeee'\n                    },\n                },\n                onClick: self_ew._zoomToRegion\n            }\n        });\n    },\n\n    _drawPieChart(where = self_ew.iniClause, process = 'initial') {\n        var url = this.feature_dc_tb.getUrl();\n\n        var queryTask = new QueryTask(url);\n        var query = new Query();\n\n        query.where = where;\n        query.groupByFieldsForStatistics = [self_ew.field_x_pie];\n\n        var countStatDef = new StatisticDefinition();\n        countStatDef.statisticType = \"count\";\n        countStatDef.onStatisticField = self_ew.field_x_pie;\n        countStatDef.outStatisticFieldName = self_ew.field_y_pie;\n\n        query.outStatistics = [countStatDef];\n\n        queryTask.execute(query, function(results) {\n            x = results.features.map((i) => i.attributes[self_ew.field_x_pie]);\n            y = results.features.map((i) => i.attributes[self_ew.field_y_pie]);\n            if (process == 'initial') {\n                self_ew._pieChart(x, y);\n            } else if (process == 'update') {\n                self_ew._updatePieChart(x, y)\n            }\n        });\n    },\n\n    _pieChart(x, y) {\n        var ctx = self_ew.PieAp.getContext('2d');\n        ctx.canvas.height = 250;\n        self_ew.chart_tipo_persona = new Chart(ctx, {\n            type: 'doughnut',\n            data: {\n                labels: x,\n                datasets: [{\n                    label: self_ew.label_y_pie,\n                    data: y,\n                    backgroundColor: [\n                        '#07689f',\n                        '#68b0ab',\n                        'rgb(255, 99, 132)',\n                        'rgb(255, 205, 86)',\n                        '#fff48f',\n                    ],\n                    hoverOffset: 4\n                }]\n            },\n            // plugins: [ChartDataLabels],\n            options: {\n                responsive: true,\n                // maintainAspectRatio: false,\n                animation: {\n                    animateScale: true,\n                    animateRotate: true\n                },\n                legend: {\n                    display: true,\n                    labels: {\n                        fontColor: '#eeeeee'\n                    }\n                },\n                plugins: {\n                    labels: {\n                        render: 'value',\n                        fontColor: '#eeeeee'\n                    }\n                }\n            }\n        });\n    },\n\n    _updatePieChart(x, y) {\n        // self_ew.chart_tipo_persona.data.datasets.forEach((dataset) => {\n        // dataset.data = y;\n        // dataset.label = x;\n        // });\n        self_ew.chart_tipo_persona.data.labels = x;\n        self_ew.chart_tipo_persona.data.datasets[0].data = y\n        self_ew.chart_tipo_persona.update();\n    },\n\n    _drawHorizontalBarChart(where = self_ew.iniClause, process = 'initial') {\n        var url = this.feature_dc_tb.getUrl();\n\n        var queryTask = new QueryTask(url);\n        var query = new Query();\n\n        query.where = where;\n        query.groupByFieldsForStatistics = [self_ew.field_x_horizontal_bar];\n\n        var countStatDef = new StatisticDefinition();\n        countStatDef.statisticType = \"count\";\n        countStatDef.onStatisticField = self_ew.field_x_horizontal_bar;\n        countStatDef.outStatisticFieldName = self_ew.field_y_horizontal_bar;\n\n        query.outStatistics = [countStatDef];\n\n        queryTask.execute(query, function(results) {\n            let x = results.features.map((i) => i.attributes[self_ew.field_x_horizontal_bar]);\n            for (let index = 0; index < x.length; index++) {\n                if (x[index] == 'SUNAT2') {\n                    x[index] = 'SUNAT 2020';\n                } else if (x[index] == 'SUNAT') {\n                    x[index] = 'SUNAT 2017';\n                } else {\n\n                }\n            }\n            let y = results.features.map((i) => i.attributes[self_ew.field_y_horizontal_bar]);\n            if (process == 'initial') {\n                self_ew._HorizontalBarChart(x, y);\n            } else if (process == 'update') {\n                self_ew._updateHorizontalBarChart(x, y)\n            }\n        });\n\n    },\n\n    _HorizontalBarChart(x, y) {\n        var ctx = self_ew.HorizontalBarAp.getContext('2d');\n        ctx.canvas.height = 250;\n        self_ew.chart_tipo_origen = new Chart(ctx, {\n            type: 'bar',\n            data: {\n                labels: x,\n                datasets: [{\n                    label: self_ew.label_y_horizontal_bar,\n                    data: y,\n                    borderWidth: 0.1,\n                    borderColor: '#eeeeee',\n                    backgroundColor: [\n                        '#00d1b2',\n                        'rgb(255, 99, 132)',\n                        'rgb(255, 205, 86)',\n                        '#fff48f',\n                    ],\n                    // borderWidth: 1,\n                }]\n            },\n            options: {\n                responsive: true,\n                // maintainAspectRatio: false,\n                legend: {\n                    display: false,\n                },\n                scales: {\n                    yAxes: [{\n                        ticks: {\n                            // beginAtZero: true,\n                            fontColor: '#eeeeee'\n                        },\n                        gridLines: {\n                            color: '#eeeeee',\n                            lineWidth: 0.1\n                        }\n                    }],\n                    xAxes: [{\n                        ticks: {\n                            // beginAtZero: true,\n                            fontColor: '#eeeeee'\n                        },\n                        gridLines: {\n                            color: '#eeeeee',\n                            lineWidth: 0.1\n                        }\n                    }]\n                },\n                plugins: {\n                    labels: {\n                        render: 'value',\n                        fontColor: '#eeeeee'\n                    }\n                }\n            }\n        });\n    },\n\n    _updateHorizontalBarChart(x, y) {\n        self_ew.chart_tipo_origen.data.labels = x\n        self_ew.chart_tipo_origen.data.datasets[0].data = y\n        self_ew.chart_tipo_origen.update();\n    },\n\n    _acordeonFunction(evt) {\n        let panel = evt.target.nextElementSibling;\n        if (!panel) {\n            panel = evt.target.parentElement.nextElementSibling;\n            evt.target.parentElement.classList.toggle(\"active\");\n        }\n        evt.target.classList.toggle(\"active\");\n        panel.classList.toggle(\"active\");\n\n\n        // if (panel.style.maxHeight) {\n        //     panel.style.maxHeight = null;\n        // } else {\n        //     panel.style.maxHeight = panel.scrollHeight + \"px\";\n        // }\n    },\n    startup() {\n        this.inherited(arguments);\n        this.feature_dc = this.layersMap.getLayerInfoById(this.config.layer_id_dc);\n        this.feature_dc_tb = this.layersMap.getTableInfoById(this.config.service_id_horizontal_bar);\n        this.feature_dc_tb_url = this.feature_dc_tb.getUrl();\n        this.feature_dep = this.layersMap.getLayerInfoById(this.config.layer_id_dep);\n        this._indicatorReinfo();\n        this._drawVerticalBarChart();\n        this._drawPieChart();\n        this._drawHorizontalBarChart();\n        // console.log('Estadisticas_wgt::startup');\n\n    },\n    onOpen() {\n        console.log('Estadisticas_wgt::onOpen');\n        this._configureStylePanelWidget();\n        // this.panel = this.getPanel();\n        // if (this.ownerDocumentBody.clientWidth > 1270) {\n        //     this.panel.position.width = 720\n        // } else {\n        //     this.panel.position.width = 360\n        // }\n        // this.panel.setPosition(this.panel.position);\n        // this.panel.panelManager.normalizePanel(this.panel);\n    },\n\n    onClose() {\n        console.log('Estadisticas_wgt::onClose');\n        this._configureStylePanelWidget(create = false);\n    },\n    // _resizeController() {\n    //     this.panel = this.getPanel();\n    //     this.panel.position.width = screen.width > 1270 ? 720 : 320;\n    //     this.panel.setPosition(this.panel.position);\n    //     this.panel.panelManager.normalizePanel(this.panel);\n    // },\n    // onMinimize(){\n    //   console.log('Estadisticas_wgt::onMinimize');\n    // },\n    // onMaximize(){\n    //   console.log('Estadisticas_wgt::onMaximize');\n    // },\n    // onSignIn(credential){\n    //   console.log('Estadisticas_wgt::onSignIn', credential);\n    // },\n    // onSignOut(){\n    //   console.log('Estadisticas_wgt::onSignOut');\n    // }\n    // onPositionChange(){\n    //   console.log('Estadisticas_wgt::onPositionChange');\n    // },\n    // resize() {\n    //     console.log('Estadisticas_wgt::resize');\n    //     // this._resizeController()\n    // }\n});"]}
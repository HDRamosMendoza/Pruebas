{"version":3,"sources":["../../../../widgets/InfoSummary/setting/Setting.js"],"names":["define","query","domConstruct","domClass","declare","xhr","dojoColor","_WidgetsInTemplateMixin","BaseWidgetSetting","LayerInfos","ValidationTextBox","CheckBox","Popup","Table","ImageChooser","utils","Message","LayerChooserFromMapSelect","LoadingShelter","esriRequest","dijitPopup","lang","DeferredList","Deferred","on","domStyle","html","array","SymbolPicker","UniqueLayerChooser","baseClass","_layerInfos","mpi","layer_options","refreshLayers","displayPanelIcon","used_layers","unsupported_ids","postCreate","inherited","arguments","opLayers","map","itemInfo","itemData","operationalLayers","length","set","btnAddLayer","optionsContainer","displayOptionsContainer","_disableOk","message","nls","missingLayerInWebMap","shelter","hidden","setupLayerTable","setupRefreshInterval","_getAllLayers","own","hitch","_addLayerRow","hidePanelOptions","v","hidePanel","panelCountOptions","panelIconOptions","expandListOptions","showAllFeaturesOptions","previewContainer","addClass","panelIconOptionsLabel","panelCountOptionsLabel","expandListOptionsLabel","showAllFeaturesOptionsLabel","mainPanelPreviewContainer","domNode","removeClass","contains","hidePanelHelpText","checked","countEnabled","startup","imageChooser","format","GIF","JPEG","PNG","label","uploadImage","cropImage","showTip","goldenWidth","goldenHeight","place","mainPanelPreviewButton","connect","isInitalLoad","refreshInterval","invalidMessage","invalidInterval","missingMessage","missingRefreshValue","fields","name","title","layerName","type","width","layerLabel","iconColumnText","optionsText","actions","layerRefresh","displayLayerTable","selectable","autoHeight","placeAt","layerTable","_pickSymbol","_rowDeleted","itemId","getInstance","then","operLayerInfos","wmLayerInfos","getLayerInfoArrayOfWebmap","configLayerInfos","config","layerInfos","_updateLayerIDs","upgradeFields","_upgradeFields","show","_setLayers","getLayerInfoArray","setConfig","hide","removeIDs","config_layer_loop","i","configLayer","jimuLayerInfo","getLayerInfoById","id","updated","wm_layer_loop","ii","_opLayer","originOpLayer","originOperLayer","undefined","urlId","_compareURL","_compareItemID","subId","_compareSubId","layer","push","sort","a","b","forEach","splice","opLayer","indexOf","layerObject","geomMatch","_compareGeom","fieldMatch","_compareFields","featureCollection","layers","hasOwnProperty","fcLayers","fcLayer","url","geometryType","matchingFields","filter","f","fn","configField","def","unSupportedLayerTypes","gtQueries","gtQueryUrls","options","rootLayerIDs","layerInfo","supportsDL","supportsDynamicLayers","declaredClass","_checkItemId","rootLayerInfo","getRootLayerInfo","parentLayerIDs","parentLayerTitles","traversal","subLayerInfo","newSubLayers","unshift","geomType","setGeometryType","getUrl","lyrType","join","value","imageData","_type","renderer","infoTemplate","getInfoTemplate","panelImageData","supportsDynamic","oidFieldName","objectIdField","parentLayerID","subLayerId","parseInt","substr","lastIndexOf","scaleRange","getScaleRange","selfType","queryList","queryResults","deleteIds","q","resultInfo","lIdx","drawingInfo","reverse","resolve","clone","isItemLayer","op_layer_loop","mapID","oldConfig","mainPanelText","mainPanelIcon","panelMainIcon","innerHTML","loadStaticData","chkStatic","expandList","showAllFeatures","clear","lyrInfo","_populateLayerRow","_updateLayerLists","rows","getRows","r","_updateRefresh","li","symbolData","featureDisplayOptions","firstLayerFieldName","firstLayerFieldAlias","layerFields","layer_field_loop","_i","alias","keyFieldName","keyFieldAlias","info","fieldInfos","subLayers","getSubLayers","sub_layers_loop","sli","sl","popupFields","popup_field_loop","j","popupField","visible","fieldName","_updateStyleColor","changedData","tName","appConfig","theme","sName","appId","window","location","href","split","get","sync","handleAs","load","data","styles","st","_styleColor","styleColor","_styleColorName","updateThemeClusterSymbol","sd","_rgb","fromHex","x","xx","evenOdd","g","rr","bb","gg","clusterType","clusterSymbol","color","outline","style","layerItem","selectLayers","getSelectedItem","_removeRefreshLayer","result","addRow","success","tr","cells","_addLayersOption","_addLabelOption","_addRefreshOption","_setNextLayer","selectBox","lo","getLayerObject","setSelectedLayer","cLo","_getLayerOptionByValue","validateFields","labelText","refreshBox","refresh","s","removeChild","create","_createLayerChooserSelect","parent","td","layerChooserSelect","layerChooserFromMap","showTable","onlyShowVisible","createMapResponse","webMapResponse","row","layerChooser","_onLayerChanged","item","layerID","_addDefaultSymbol","_row","_onLayerInfosChanged","setStyle","labelTextBox","height","refreshCheckBox","onChange","_addRefreshLayer","layerId","rO","refreshOptions","isValid","_enableOk","lInfo","enableRefresh","disableRefresh","_updateOK","children","curRow","selectLayersValue","hasSymbolData","userDefinedSymbol","callerRow","symbolInfo","ac","sourceDijit","_setSymbol","svg","appendChild","panelHTML","destroy","errorDiv","errorSpan","fieldsWarning","popup","content","titleLabel","sympolPopupTitle","close","OpLayer","match","featureInfos","validGeomTypes","fi","getConfig","table","labelTextValue","stripHTML","refreshEnabled","continuousRefreshEnabled"],"mappings":"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","file":"Setting.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\r\n// Copyright Â© 2014 - 2018 Esri. All Rights Reserved.\r\n//\r\n// Licensed under the Apache License Version 2.0 (the \"License\");\r\n// you may not use this file except in compliance with the License.\r\n// You may obtain a copy of the License at\r\n//\r\n//    http://www.apache.org/licenses/LICENSE-2.0\r\n//\r\n// Unless required by applicable law or agreed to in writing, software\r\n// distributed under the License is distributed on an \"AS IS\" BASIS,\r\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n// See the License for the specific language governing permissions and\r\n// limitations under the License.\r\n///////////////////////////////////////////////////////////////////////////\r\n\r\ndefine([\r\n    'dojo/query',\r\n    'dojo/dom-construct',\r\n    'dojo/dom-class',\r\n    'dojo/_base/declare',\r\n    'dojo/_base/xhr',\r\n    'dojo/_base/Color',\r\n    'dijit/_WidgetsInTemplateMixin',\r\n    'jimu/BaseWidgetSetting',\r\n    'jimu/LayerInfos/LayerInfos',\r\n    'dijit/form/ValidationTextBox',\r\n    'dijit/form/CheckBox',\r\n    'jimu/dijit/Popup',\r\n    'jimu/dijit/SimpleTable',\r\n    'jimu/dijit/ImageChooser',\r\n    'jimu/utils',\r\n    'jimu/dijit/Message',\r\n    'jimu/dijit/LayerChooserFromMapWithDropbox',\r\n    'jimu/dijit/LoadingShelter',\r\n    'esri/request',\r\n    'dijit/popup',\r\n    'dojo/_base/lang',\r\n    'dojo/DeferredList',\r\n    'dojo/Deferred',\r\n    'dojo/on',\r\n    'dojo/dom-style',\r\n    'dojo/_base/html',\r\n    'dojo/_base/array',\r\n    './MySymbolPicker',\r\n    './UniqueLayerChooser',\r\n    'dojox/form/FileUploader'\r\n],\r\n  function (\r\n    query,\r\n    domConstruct,\r\n    domClass,\r\n    declare,\r\n    xhr,\r\n    dojoColor,\r\n    _WidgetsInTemplateMixin,\r\n    BaseWidgetSetting,\r\n    LayerInfos,\r\n    ValidationTextBox,\r\n    CheckBox,\r\n    Popup,\r\n    Table,\r\n    ImageChooser,\r\n    utils,\r\n    Message,\r\n    LayerChooserFromMapSelect,\r\n    LoadingShelter,\r\n    esriRequest,\r\n    dijitPopup,\r\n    lang,\r\n    DeferredList,\r\n    Deferred,\r\n    on,\r\n    domStyle,\r\n    html,\r\n    array,\r\n    SymbolPicker,\r\n    UniqueLayerChooser\r\n    ) {\r\n    return declare([BaseWidgetSetting, _WidgetsInTemplateMixin], {\r\n      baseClass: 'jimu-widget-InfoSummary-setting',\r\n      _layerInfos: null,\r\n      mpi: null,\r\n      layer_options: [],\r\n      refreshLayers: [],\r\n      displayPanelIcon: false,\r\n      used_layers: [],\r\n      unsupported_ids: [],\r\n\r\n      postCreate: function () {\r\n        this.inherited(arguments);\r\n\r\n        this.opLayers = this.map.itemInfo.itemData.operationalLayers;\r\n        if (this.opLayers.length === 0) {\r\n          domStyle.set(this.btnAddLayer, \"display\", \"none\");\r\n          domStyle.set(this.optionsContainer, \"display\", \"none\");\r\n          domStyle.set(this.displayOptionsContainer, \"display\", \"none\");\r\n          this._disableOk();\r\n          new Message({\r\n            message: this.nls.missingLayerInWebMap\r\n          });\r\n          return;\r\n        }\r\n        this.shelter = new LoadingShelter({\r\n          hidden: true\r\n        });\r\n        this.setupLayerTable();\r\n        this.setupRefreshInterval();\r\n        this._getAllLayers();\r\n        this.own(on(this.btnAddLayer, 'click', lang.hitch(this, this._addLayerRow)));\r\n        this.own(on(this.hidePanelOptions, 'change', lang.hitch(this, function (v) {\r\n          this.hidePanel = v;\r\n          this.panelCountOptions.set('disabled', v);\r\n          this.panelIconOptions.set('disabled', v);\r\n          this.expandListOptions.set('disabled', v);\r\n          this.showAllFeaturesOptions.set('disabled', v);\r\n          var previewContainer;\r\n          if (v) {\r\n            html.addClass(this.panelIconOptionsLabel, 'text-disabled');\r\n            html.addClass(this.panelCountOptionsLabel, 'text-disabled');\r\n            html.addClass(this.expandListOptionsLabel, 'text-disabled');\r\n            html.addClass(this.showAllFeaturesOptionsLabel, 'text-disabled');\r\n            this.displayPanelIcon = false;\r\n            previewContainer = query('.mainPanelPreviewContainerOn', this.mainPanelPreviewContainer.domNode)[0];\r\n            if (previewContainer) {\r\n              html.removeClass(previewContainer, \"mainPanelPreviewContainerOn\");\r\n              html.addClass(previewContainer, \"mainPanelPreviewContainerOff\");\r\n            }\r\n            if (domClass.contains(this.hidePanelHelpText, 'help-off')) {\r\n              html.removeClass(this.hidePanelHelpText, 'help-off');\r\n            }\r\n            html.addClass(this.hidePanelHelpText, 'help-on');\r\n          } else {\r\n            html.removeClass(this.panelIconOptionsLabel, 'text-disabled');\r\n            html.removeClass(this.panelCountOptionsLabel, 'text-disabled');\r\n            html.removeClass(this.expandListOptionsLabel, 'text-disabled');\r\n            html.removeClass(this.showAllFeaturesOptionsLabel, 'text-disabled');\r\n            if (this.panelIconOptions.checked) {\r\n              this.displayPanelIcon = true;\r\n              previewContainer = query('.mainPanelPreviewContainerOff', this.mainPanelPreviewContainer.domNode)[0];\r\n              if (previewContainer) {\r\n                html.removeClass(previewContainer, \"mainPanelPreviewContainerOff\");\r\n                html.addClass(previewContainer, \"mainPanelPreviewContainerOn\");\r\n              }\r\n            }\r\n            if (domClass.contains(this.hidePanelHelpText, 'help-on')) {\r\n              html.removeClass(this.hidePanelHelpText, 'help-on');\r\n            }\r\n            html.addClass(this.hidePanelHelpText, 'help-off');\r\n          }\r\n        })));\r\n        this.own(on(this.panelCountOptions, 'change', lang.hitch(this, function (v) {\r\n          this.countEnabled = v;\r\n        })));\r\n        this.own(on(this.panelIconOptions, 'change', lang.hitch(this, function () {\r\n          var previewContainer;\r\n          if (this.panelIconOptions.checked) {\r\n            this.displayPanelIcon = true;\r\n            previewContainer = query('.mainPanelPreviewContainerOff', this.mainPanelPreviewContainer.domNode)[0];\r\n            html.removeClass(previewContainer, \"mainPanelPreviewContainerOff\");\r\n            html.addClass(previewContainer, \"mainPanelPreviewContainerOn\");\r\n          } else {\r\n            this.displayPanelIcon = false;\r\n            previewContainer = query('.mainPanelPreviewContainerOn', this.mainPanelPreviewContainer.domNode)[0];\r\n            html.removeClass(previewContainer, \"mainPanelPreviewContainerOn\");\r\n            html.addClass(previewContainer, \"mainPanelPreviewContainerOff\");\r\n          }\r\n        })));\r\n      },\r\n\r\n      startup: function () {\r\n        this.inherited(arguments);\r\n        this.refreshLayers = [];\r\n\r\n        this.imageChooser = new ImageChooser({\r\n          format: [ImageChooser.GIF, ImageChooser.JPEG, ImageChooser.PNG],\r\n          label: this.nls.uploadImage,\r\n          cropImage: false,\r\n          showTip: false,\r\n          goldenWidth: 10,\r\n          goldenHeight: 15\r\n        });\r\n\r\n        domStyle.set(this.imageChooser.domNode, \"font-size\", \"14px\");\r\n        html.place(this.imageChooser.domNode, this.mainPanelPreviewButton, 'replace');\r\n\r\n        this.connect(this.imageChooser, \"onImageChange\", \"uploadImage\");\r\n        this.isInitalLoad = false;\r\n      },\r\n\r\n      setupRefreshInterval: function () {\r\n        this.refreshInterval.invalidMessage = this.nls.invalidInterval;\r\n        this.refreshInterval.missingMessage = this.nls.missingRefreshValue;\r\n      },\r\n\r\n      setupLayerTable: function () {\r\n        var fields = [{\r\n          name: \"layer\",\r\n          title: this.nls.layerName,\r\n          \"class\": \"label\",\r\n          type: \"empty\",\r\n          width: \"320px\"\r\n        }, {\r\n          name: \"label\",\r\n          \"class\": \"label\",\r\n          title: this.nls.layerLabel,\r\n          type: \"empty\",\r\n          width: \"255px\"\r\n        }, {\r\n          name: \"image\",\r\n          \"class\": \"label\",\r\n          title: this.nls.iconColumnText + \" \" + this.nls.optionsText,\r\n          width: \"110px\",\r\n          actions: [\"edit\"],\r\n          type: \"actions\"\r\n        }, {\r\n          name: \"refresh\",\r\n          \"class\": \"label\",\r\n          title: this.nls.layerRefresh,\r\n          type: \"empty\",\r\n          width: \"80px\"\r\n        }, {\r\n          name: \"actions\",\r\n          \"class\": \"label\",\r\n          title: this.nls.actions,\r\n          type: \"actions\",\r\n          actions: [\"up\", \"down\", \"delete\"],\r\n          width: \"93px\"\r\n        }];\r\n\r\n        this.displayLayerTable = new Table({\r\n          fields: fields,\r\n          selectable: false,\r\n          autoHeight: true\r\n        });\r\n\r\n        this.displayLayerTable.placeAt(this.layerTable);\r\n        this.displayLayerTable.startup();\r\n        this.own(on(this.displayLayerTable, 'actions-edit', lang.hitch(this, this._pickSymbol)));\r\n        this.own(on(this.displayLayerTable, 'row-delete', lang.hitch(this, this._rowDeleted)));\r\n      },\r\n\r\n      _getAllLayers: function () {\r\n        if (this.map.itemId) {\r\n          LayerInfos.getInstance(this.map, this.map.itemInfo)\r\n            .then(lang.hitch(this, function (operLayerInfos) {\r\n              this.operLayerInfos = operLayerInfos;\r\n              this.wmLayerInfos = operLayerInfos.getLayerInfoArrayOfWebmap();\r\n              this.configLayerInfos = this.config.layerInfos;\r\n              this._updateLayerIDs();\r\n              if (this.config.upgradeFields) {\r\n                this._upgradeFields();\r\n              }\r\n              this.shelter.placeAt(this.domNode);\r\n              this.shelter.startup();\r\n              this.shelter.show();\r\n              this._setLayers(operLayerInfos.getLayerInfoArray()).then(lang.hitch(this, function () {\r\n                this.setConfig(this.config);\r\n                this.shelter.hide();\r\n              }));\r\n            }));\r\n        }\r\n      },\r\n\r\n      _updateLayerIDs: function () {\r\n        var removeIDs = [];\r\n        config_layer_loop:\r\n        for (var i = 0; i < this.configLayerInfos.length; i++) {\r\n          var configLayer = this.configLayerInfos[i];\r\n          var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(configLayer.id);\r\n\r\n          //If we cannot find the jimu layer info based on the stored ID we need to determine it\r\n          if (!jimuLayerInfo) {\r\n            var updated = false;\r\n            wm_layer_loop:\r\n            for (var ii = 0; ii < this.wmLayerInfos.length; ii++) {\r\n              var _opLayer = this.wmLayerInfos[ii];\r\n              //var opLayer = this.layerInfos[ii];\r\n              var originOpLayer = _opLayer ? _opLayer.originOperLayer : undefined;\r\n\r\n              var urlId = this._compareURL(originOpLayer, configLayer);\r\n              var itemId = this._compareItemID(originOpLayer, configLayer);\r\n              var subId = this._compareSubId(_opLayer, configLayer);\r\n\r\n              var id = urlId ? urlId : itemId ? itemId : subId ? subId : undefined;\r\n              jimuLayerInfo = id ? this.operLayerInfos.getLayerInfoById(id) : jimuLayerInfo;\r\n\r\n              if (jimuLayerInfo) {\r\n                this.configLayerInfos[i].id = jimuLayerInfo.id;\r\n                this.configLayerInfos[i].layer = jimuLayerInfo.id;\r\n                updated = true;\r\n                break wm_layer_loop;\r\n              }\r\n            }\r\n\r\n            if (!updated && !jimuLayerInfo) {\r\n              removeIDs.push(i);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (removeIDs.length > 0) {\r\n          //removeIDs.sort((a, b) => (b - a));\r\n          removeIDs.sort(function (a, b) { return b - a; });\r\n          array.forEach(removeIDs, lang.hitch(this, function (id) {\r\n            this.configLayerInfos.splice(id, 1);\r\n          }));\r\n        }\r\n      },\r\n\r\n      _compareSubId: function (opLayer, configLayer) {\r\n        if (opLayer && opLayer.subId && opLayer.subId.indexOf(configLayer.id) > -1) {\r\n          if (opLayer.layerObject) {\r\n            var geomMatch = this._compareGeom(opLayer.layerObject, configLayer);\r\n            var fieldMatch = this._compareFields(opLayer.layerObject, configLayer);\r\n            if (geomMatch && fieldMatch) {\r\n              return opLayer.subId;\r\n            }\r\n          }\r\n        }\r\n        return undefined;\r\n      },\r\n\r\n      _compareItemID: function (originOpLayer, configLayer) {\r\n        if (originOpLayer && originOpLayer.itemId && originOpLayer.itemId === configLayer.itemId) {\r\n          if (originOpLayer.featureCollection && originOpLayer.featureCollection.layers &&\r\n            originOpLayer.featureCollection.layers.hasOwnProperty('length')) {\r\n            var fcLayers = originOpLayer.featureCollection.layers;\r\n            for (var i = 0; i < fcLayers.length; i++) {\r\n              var fcLayer = fcLayers[i];\r\n              if (this._compareGeom(fcLayer, configLayer)) {\r\n                if (this._compareFields(fcLayer, configLayer)) {\r\n                  return fcLayer.id;\r\n                }\r\n              }\r\n            }\r\n            return undefined;\r\n          }\r\n        }\r\n      },\r\n\r\n      _compareURL: function (originOpLayer, configLayer) {\r\n        return (originOpLayer && originOpLayer.url && configLayer.url && originOpLayer.url === configLayer.url) ?\r\n          originOpLayer.id : undefined;\r\n      },\r\n\r\n      _compareGeom: function (layerObject, configLayer) {\r\n        return (layerObject && layerObject.geometryType && configLayer.geometryType) ?\r\n          layerObject.geometryType === configLayer.geometryType : undefined;\r\n      },\r\n\r\n      _compareFields: function (layerObject, configLayer) {\r\n        var fieldMatch;\r\n        if (layerObject && layerObject.fields && configLayer.fields &&\r\n          layerObject.fields.length === configLayer.fields.length) {\r\n          //test if Names match\r\n          var matchingFields = layerObject.fields.filter(function (f) {\r\n            for (var fn = 0; fn < configLayer.fields.length; fn++) {\r\n              var configField = configLayer.fields[fn];\r\n              if (f.name === configField.name) {\r\n                return f;\r\n              }\r\n            }\r\n          });\r\n          fieldMatch = matchingFields.length === layerObject.fields.length;\r\n        }\r\n        return fieldMatch;\r\n      },\r\n\r\n      /*jshint loopfunc:true */\r\n      _setLayers: function (layerInfos) {\r\n        var def = new Deferred();\r\n        var unSupportedLayerTypes = [\"esri.layers.WMSLayer\", \"esri.layers.ArcGISImageServiceLayer\",\r\n          \"esri.layers.ArcGISImageServiceVectorLayer\", \"esri.layers.ArcGISTiledMapServiceLayer\", \"ClusterLayer\"];\r\n        this.gtQueries = [];\r\n        this.gtQueryUrls = [];\r\n        var options = [];\r\n        var rootLayerIDs = [];\r\n        for (var i = 0; i < layerInfos.length; i++) {\r\n          var layerInfo = layerInfos[i];\r\n          var supportsDL = layerInfo.layerObject.hasOwnProperty('supportsDynamicLayers') ?\r\n            layerInfo.layerObject.supportsDynamicLayers : true;\r\n          var type = layerInfo.layerObject.declaredClass;\r\n          var itemId = this._checkItemId(layerInfo, type);\r\n          if (unSupportedLayerTypes.indexOf(type) === -1) {\r\n            var rootLayerInfo = layerInfo.getRootLayerInfo();\r\n            if (rootLayerIDs.indexOf(rootLayerInfo.id) === -1) {\r\n              rootLayerIDs.push(rootLayerInfo.id);\r\n              var parentLayerIDs = [];\r\n              var parentLayerTitles = [];\r\n              rootLayerInfo.traversal(lang.hitch(this, function (subLayerInfo) {\r\n                //check if this is a parent layer\r\n                if (subLayerInfo.newSubLayers && subLayerInfo.newSubLayers.length > 0) {\r\n                  //may not need to do this if we can use the layerInfo object to control\r\n                  // layer visibility up the chain...but may need to keep the parent Layer ID in case of duplicate child names\r\n                  // so we can show...oh...wait if we use the jimu layer chooser it has a tree and this would also not be necessary!!\r\n                  if (parentLayerIDs.indexOf(rootLayerInfo.id) === -1) {\r\n                    parentLayerIDs.push(rootLayerInfo.id);\r\n                  }\r\n                  if (parentLayerIDs.indexOf(subLayerInfo.id) === -1) {\r\n                    parentLayerIDs.push(subLayerInfo.id);\r\n                    parentLayerTitles.unshift(subLayerInfo.title);\r\n                  }\r\n                } else {\r\n                  //geomType is necessary for getting and showing symbol options\r\n                  var geomType = subLayerInfo.layerObject.geometryType;\r\n                  if (typeof (geomType) === 'undefined') {\r\n                    geomType = this.setGeometryType(subLayerInfo.layerObject);\r\n                  }\r\n\r\n                  var url = subLayerInfo.getUrl();\r\n\r\n                  var lyrType;\r\n                  if (url) {\r\n                    lyrType = url.indexOf('MapServer') > -1 ? \"Map Service Layer\" : \"\";\r\n                  } else if (type === \"esri.layers.FeatureCollection\" || type === \"Feature Collection\" || itemId) {\r\n                    lyrType = \"Feature Collection\";\r\n                  } else {\r\n                    lyrType = \"\";\r\n                  }\r\n\r\n                  //changed from unshift to push\r\n                  options.push({\r\n                    label: parentLayerTitles.length > 0 ?\r\n                      (parentLayerTitles.join(\"-\") + \"-\" + subLayerInfo.title) : subLayerInfo.title,\r\n                    value: subLayerInfo.id,\r\n                    url: url,\r\n                    imageData: subLayerInfo.imageData,\r\n                    id: subLayerInfo.id,\r\n                    geometryType: geomType,\r\n                    fields: subLayerInfo.layerObject.fields,\r\n                    _type: type, //NEW type is set...check BC\r\n                    renderer: subLayerInfo.layerObject.renderer,\r\n                    itemId: itemId,\r\n                    infoTemplate: subLayerInfo.getInfoTemplate(),\r\n                    lyrType: lyrType,\r\n                    panelImageData: subLayerInfo.panelImageData,\r\n                    supportsDynamic: supportsDL,\r\n                    oidFieldName: subLayerInfo.layerObject.objectIdField, //NEW...check BC\r\n                    parentLayerID: rootLayerInfo.id, //keeping for BC\r\n                    subLayerId: url ? parseInt(url.substr(url.lastIndexOf('/') + 1), 10) : undefined,\r\n                    scaleRange: subLayerInfo.getScaleRange(),//NEW...check BC\r\n                    selfType: subLayerInfo.originOperLayer.selfType//NEW...check BC\r\n                  });\r\n                }\r\n              }));\r\n            }\r\n          }\r\n        }\r\n\r\n        //execute the setGeomType queries\r\n        if (this.gtQueries.length > 0) {\r\n          var queryList = new DeferredList(this.gtQueries);\r\n          //disable add\r\n          html.removeClass(this.btnAddLayer, \"btn-add-section enable\");\r\n          html.addClass(this.btnAddLayer, \"btn-add-section-disabled\");\r\n          queryList.then(lang.hitch(this, function (queryResults) {\r\n            var deleteIds = [];\r\n            if (queryResults) {\r\n              if (queryResults.length > 0) {\r\n                for (var q = 0; q < queryResults.length; q++) {\r\n                  var resultInfo = queryResults[q][1];\r\n                  var url = this.gtQueryUrls[q];\r\n                  var lIdx;\r\n                  for (var i = 0; i < this.layer_options.length; i++) {\r\n                    if (url === this.layer_options[i].url) {\r\n                      lIdx = i;\r\n                      break;\r\n                    }\r\n                  }\r\n                  if (typeof (lIdx) !== 'undefined') {\r\n                    if (resultInfo.geometryType) {\r\n                      this.layer_options[lIdx].geometryType = resultInfo.geometryType;\r\n                      if (typeof (resultInfo.drawingInfo) !== 'undefined') {\r\n                        this.layer_options[lIdx].renderer = resultInfo.drawingInfo.renderer;\r\n                        this.layer_options[lIdx].drawingInfo = resultInfo.drawingInfo;\r\n                        this.layer_options[lIdx].fields = resultInfo.fields;\r\n\r\n                        var f;\r\n                        for (var ii = 0; ii < resultInfo.fields.length; ii++) {\r\n                          f = resultInfo.fields[ii];\r\n                          if (f.type === \"esriFieldTypeOID\") {\r\n                            break;\r\n                          }\r\n                        }\r\n                        this.layer_options[lIdx].oidFieldName = f.name;\r\n                      }\r\n                    } else {\r\n                      //some layers from the traffic service don't have a geom type or fields\r\n                      deleteIds.push(lIdx);\r\n                    }\r\n                  }\r\n                }\r\n                //enable add\r\n                html.removeClass(this.btnAddLayer, \"btn-add-section-disabled\");\r\n                html.addClass(this.btnAddLayer, \"btn-add-section enable\");\r\n              }\r\n            }\r\n            array.forEach(deleteIds.reverse(), lang.hitch(this, function (id) {\r\n              this.unsupported_ids.push(this.layer_options[id].id);\r\n              this.layer_options.splice(id, 1);\r\n            }));\r\n            def.resolve();\r\n          }));\r\n        } else {\r\n          def.resolve();\r\n        }\r\n        this.layer_options = lang.clone(options);\r\n        return def;\r\n      },\r\n\r\n      _checkItemId: function (layerInfo, type) {\r\n        var itemId;\r\n        //some FC return this others return FeatureLayer\r\n        if (type === \"esri.layers.FeatureCollection\") {\r\n          itemId = layerInfo.isItemLayer();\r\n          itemId = itemId.itemId || itemId;\r\n        } else if (type === \"esri.layers.FeatureLayer\" || type === 'FeatureLayer') {\r\n          op_layer_loop:\r\n          for (var b = 0; b < this.opLayers.length; b++) {\r\n            var opLayer = this.opLayers[b];\r\n            if (opLayer && opLayer.id && (opLayer.id === layerInfo.id || layerInfo.id.indexOf(opLayer.id) > -1)) {\r\n              type = opLayer.type;\r\n              if (type === 'Feature Collection') {\r\n                itemId = opLayer.itemId;\r\n              }\r\n              break op_layer_loop;\r\n            }\r\n          }\r\n        }\r\n        return itemId;\r\n      },\r\n\r\n      setConfig: function (config) {\r\n        this.config = config;\r\n\r\n        if (!this.config.mapID || (this.config.mapID && this.config.mapID === this.map.itemId)) {\r\n          this.oldConfig = !this.config.mapID;\r\n\r\n          if (this.config.mainPanelText) {\r\n            this.mainPanelText.set('value', this.config.mainPanelText);\r\n          }\r\n          if (this.config.mainPanelIcon) {\r\n            this.panelMainIcon.innerHTML = this.config.mainPanelIcon;\r\n          }\r\n\r\n          if (this.config.refreshInterval) {\r\n            this.refreshInterval.set('value', this.config.refreshInterval);\r\n          }\r\n\r\n          if (this.config.loadStaticData) {\r\n            this.chkStatic.set('value', this.config.loadStaticData);\r\n          }\r\n\r\n          if (this.config.countEnabled) {\r\n            this.panelCountOptions.set('checked', this.config.countEnabled);\r\n          }\r\n\r\n          if (typeof (this.config.hidePanel) !== 'undefined') {\r\n            this.hidePanel = this.config.hidePanel;\r\n          } else {\r\n            this.hidePanel = false;\r\n          }\r\n          this.hidePanelOptions.set('checked', this.hidePanel);\r\n          this.panelCountOptions.set('disabled', this.hidePanel);\r\n          this.panelIconOptions.set('disabled', this.hidePanel);\r\n          this.expandListOptions.set('disabled', this.hidePanel);\r\n          this.showAllFeaturesOptions.set('disabled', this.hidePanel);\r\n\r\n          if (this.hidePanel) {\r\n            html.addClass(this.panelIconOptionsLabel, 'text-disabled');\r\n            html.addClass(this.panelCountOptionsLabel, 'text-disabled');\r\n            html.addClass(this.expandListOptionsLabel, 'text-disabled');\r\n            html.addClass(this.showAllFeaturesOptionsLabel, 'text-disabled');\r\n            if (domClass.contains(this.hidePanelHelpText, 'help-off')) {\r\n              html.removeClass(this.hidePanelHelpText, 'help-off');\r\n            }\r\n            html.addClass(this.hidePanelHelpText, 'help-on');\r\n          } else {\r\n            html.removeClass(this.panelIconOptionsLabel, 'text-disabled');\r\n            html.removeClass(this.panelCountOptionsLabel, 'text-disabled');\r\n            html.removeClass(this.expandListOptionsLabel, 'text-disabled');\r\n            html.removeClass(this.showAllFeaturesOptionsLabel, 'text-disabled');\r\n            if (domClass.contains(this.hidePanelHelpText, 'help-on')) {\r\n              html.removeClass(this.hidePanelHelpText, 'help-on');\r\n            }\r\n            html.addClass(this.hidePanelHelpText, 'help-off');\r\n          }\r\n\r\n          if (this.config.displayPanelIcon) {\r\n            this.panelIconOptions.set('checked', this.config.displayPanelIcon);\r\n          }\r\n          if (this.config.expandList) {\r\n            this.expandListOptions.set('checked', this.config.expandList);\r\n          }\r\n\r\n          var showAllFeatures = typeof (this.config.showAllFeatures) === 'undefined' ?\r\n            false : this.config.showAllFeatures;\r\n          this.showAllFeaturesOptions.set('checked', showAllFeatures);\r\n\r\n          this.displayLayerTable.clear();\r\n          this.isInitalLoad = true;\r\n          for (var i = 0; i < this.config.layerInfos.length; i++) {\r\n            var lyrInfo = this.config.layerInfos[i];\r\n            this._populateLayerRow(lyrInfo, i);\r\n          }\r\n          this._updateLayerLists();\r\n          var rows = this.displayLayerTable.getRows();\r\n          for (var r = 0; r < rows.length; r++) {\r\n            this._updateRefresh(rows[r]);\r\n          }\r\n          if (this.displayLayerTable.getRows().length < this.layer_options.length) {\r\n            html.removeClass(this.btnAddLayer, \"btn-add-section-disabled\");\r\n            html.addClass(this.btnAddLayer, \"btn-add-section enable\");\r\n          } else {\r\n            html.addClass(this.btnAddLayer, \"btn-add-section-disabled\");\r\n            html.removeClass(this.btnAddLayer, \"btn-add-section enable\");\r\n          }\r\n        }\r\n      },\r\n\r\n      //added for backwards compatability\r\n      //could not handle directly in VersionManager as some stored layerInfos\r\n      // do not have a valid infoTemplate saved\r\n      _upgradeFields: function () {\r\n        if (this.config.layerInfos) {\r\n          for (var i = 0; i < this.config.layerInfos.length; i++) {\r\n            var li = this.config.layerInfos[i];\r\n            if (li && li.symbolData && li.symbolData.featureDisplayOptions) {\r\n              var lyrInfo = this.operLayerInfos.getLayerInfoById(li.id);\r\n              var fields = li.symbolData.featureDisplayOptions.fields;\r\n              //At previous releases we would use the first field from the infoTemplate or\r\n              //the first non-OID field from the layer if no fields were selected by the user\r\n              if (typeof (fields) === 'undefined' || (fields.hasOwnProperty('length') && fields.length === 0)) {\r\n                //check layer fields\r\n                var layerObject = (lyrInfo && lyrInfo.layerObject) ? lyrInfo.layerObject : undefined;\r\n                var oidFieldName = (layerObject && layerObject.objectIdField) ? layerObject.objectIdField : undefined;\r\n                var firstLayerFieldName = \"\";\r\n                var firstLayerFieldAlias = \"\";\r\n                var layerFields = li.fields ? li.fields : layerObject ? layerObject.fields : undefined;\r\n                if (layerFields && layerFields.length > 0) {\r\n                  layer_field_loop:\r\n                  for (var _i = 0; _i < layerFields.length; _i++) {\r\n                    var f = layerFields[_i];\r\n                    if (firstLayerFieldName === \"\" && f.type !== \"esriFieldTypeOID\" &&\r\n                      f.type !== \"esriFieldTypeGeometry\" && f.name !== oidFieldName) {\r\n                      firstLayerFieldName = f.name;\r\n                      firstLayerFieldAlias = f.alias || f.name;\r\n                    }\r\n                    if (!oidFieldName) {\r\n                      oidFieldName = f.type === \"esriFieldTypeOID\" ? f.name : undefined;\r\n                    }\r\n                    if (oidFieldName && firstLayerFieldName !== \"\") {\r\n                      break layer_field_loop;\r\n                    }\r\n                  }\r\n                }\r\n\r\n                //check popup fields\r\n                var keyFieldName = \"\";\r\n                var keyFieldAlias = \"\";\r\n                var infoTemplate = li.infoTemplate && li.infoTemplate.info && li.infoTemplate.info.fieldInfos ?\r\n                  li.infoTemplate : lyrInfo ? lyrInfo.getInfoTemplate() : undefined;\r\n                if (!infoTemplate) {\r\n                  var subLayers = lyrInfo.getSubLayers();\r\n                  sub_layers_loop:\r\n                  for (var sli = 0; sli < subLayers.length; sli++) {\r\n                    var sl = subLayers[sli];\r\n                    if (sl.title && sl.layerObject && sl.layerObject.name && sl.title === sl.layerObject.name) {\r\n                      infoTemplate = sl.getInfoTemplate ? sl.getInfoTemplate() : infoTemplate;\r\n                      break sub_layers_loop;\r\n                    }\r\n                  }\r\n                }\r\n                var popupFields = infoTemplate ? infoTemplate.info.fieldInfos : [];\r\n                popup_field_loop:\r\n                for (var j = 0; j < popupFields.length; j++) {\r\n                  var popupField = popupFields[j];\r\n                  if (popupField && popupField.visible) {\r\n                    if (!oidFieldName || oidFieldName !== popupField.fieldName) {\r\n                      keyFieldName = popupField.fieldName;\r\n                      keyFieldAlias = popupField.label || popupField.fieldName;\r\n                      break popup_field_loop;\r\n                    }\r\n                  }\r\n                }\r\n\r\n                //update the config\r\n                this.config.layerInfos[i].symbolData.featureDisplayOptions.fields = [{\r\n                  name: keyFieldName ? keyFieldName : firstLayerFieldName,\r\n                  label: keyFieldName ? keyFieldAlias : firstLayerFieldAlias\r\n                }];\r\n              }\r\n            }\r\n          }\r\n        }\r\n      },\r\n\r\n      _updateStyleColor: function (changedData) {\r\n        var tName = this.appConfig.theme.name;\r\n        var sName = changedData;\r\n        var appId = this.appConfig.appId;\r\n        if (appId === \"\") {\r\n          appId = window.location.href.split('id=')[1];\r\n        }\r\n        var url = \"./apps/\" + appId + \"/themes/\" + tName + \"/manifest.json\";\r\n        xhr.get({\r\n          url: url,\r\n          sync: true,\r\n          handleAs: \"json\",\r\n          load: lang.hitch(this, function (data) {\r\n            var styles = data.styles;\r\n            for (var i = 0; i < styles.length; i++) {\r\n              var st = styles[i];\r\n              if (st.name === sName) {\r\n                this._styleColor = st.styleColor;\r\n                this._styleColorName = st.name;\r\n                break;\r\n              }\r\n            }\r\n          })\r\n        });\r\n      },\r\n\r\n      updateThemeClusterSymbol: function (lyrInfo, i) {\r\n        var sd = lyrInfo.symbolData;\r\n        if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\r\n          if (typeof (this._styleColor) === 'undefined') {\r\n            this._updateStyleColor(this.appConfig.theme.styles[0]);\r\n          }\r\n        }\r\n        if (this._styleColor) {\r\n          var _rgb = dojoColor.fromHex(this._styleColor);\r\n          var x = i + 1;\r\n          var xx = x > 0 ? x * 30 : 30;\r\n          var evenOdd = x % 2 === 0;\r\n          var r = _rgb.r;\r\n          var g = _rgb.g;\r\n          var b = _rgb.b;\r\n\r\n          var rr = r - xx;\r\n          if (evenOdd) {\r\n            if (rr > 255) {\r\n              rr = rr - 255;\r\n            }\r\n            else if (rr < 0) {\r\n              rr = rr + 255;\r\n            }\r\n          }\r\n\r\n          var bb = b - xx;\r\n          if (x % 3 === 0) {\r\n            if (evenOdd) {\r\n              if (bb > 255) {\r\n                bb = bb - 255;\r\n              }\r\n              else if (bb < 0) {\r\n                bb = bb + 255;\r\n              }\r\n            }\r\n          }\r\n\r\n          var gg = g - xx;\r\n          if (x % 5 === 0) {\r\n            if (evenOdd) {\r\n              if (gg > 255) {\r\n                gg = gg - 255;\r\n              }\r\n              else if (gg < 0) {\r\n                gg = gg + 255;\r\n              }\r\n            }\r\n          }\r\n          sd.clusterType = 'CustomCluster';\r\n          sd.clusterSymbol = {\r\n            color: [rr, gg, bb, 128],\r\n            outline: {\r\n              color: [0, 0, 0, 255],\r\n              width: 0,\r\n              type: \"esriSLS\",\r\n              style: \"esriSLSSolid\"\r\n            },\r\n            type: \"esriSFS\",\r\n            style: \"esriSFSSolid\"\r\n          };\r\n\r\n          lyrInfo.symbolData = sd;\r\n        }\r\n        return lyrInfo;\r\n      },\r\n\r\n      _rowDeleted: function(r){\r\n        if(r){\r\n          var layerItem = r.selectLayers.getSelectedItem();\r\n          if (layerItem && layerItem.layerInfo && layerItem.layerInfo.id) {\r\n            this._removeRefreshLayer(layerItem.layerInfo.id);\r\n          }\r\n        }\r\n        this._updateLayerLists();\r\n        if (this.displayLayerTable.getRows().length < this.layer_options.length) {\r\n          html.removeClass(this.btnAddLayer, \"btn-add-section-disabled\");\r\n          html.addClass(this.btnAddLayer, \"btn-add-section enable\");\r\n        }\r\n      },\r\n\r\n      _addLayerRow: function () {\r\n        this.isInitalLoad = false;\r\n        if (this.displayLayerTable.getRows().length >= this.layer_options.length) {\r\n          return;\r\n        }\r\n        this.shelter.show();\r\n        var result = this.displayLayerTable.addRow({});\r\n        if (result.success && result.tr) {\r\n          var tr = result.tr;\r\n          html.addClass(tr.cells[2], \"displayOptions\");\r\n          this._addLayersOption(tr);\r\n          this._addLabelOption(tr);\r\n          this._addRefreshOption(tr);\r\n          //get the first layer that is not already selected\r\n          this._setNextLayer(tr.selectLayers);\r\n          this._updateLayerLists();\r\n        }\r\n        this.shelter.hide();\r\n        if (this.displayLayerTable.getRows().length >= this.layer_options.length) {\r\n          html.removeClass(this.btnAddLayer, \"btn-add-section enable\");\r\n          html.addClass(this.btnAddLayer, \"btn-add-section-disabled\");\r\n          return;\r\n        }\r\n      },\r\n\r\n      _setNextLayer: function(selectBox){\r\n        var id;\r\n        for (var i = 0; i < this.layer_options.length; i++) {\r\n          var lo = this.layer_options[i];\r\n          if(this.used_layers.indexOf(lo.id) === -1){\r\n            id = lo.id;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if(id){\r\n          var layerInfo = this.operLayerInfos.getLayerInfoById(id);\r\n          if (layerInfo) {\r\n            layerInfo.getLayerObject().then(lang.hitch(this, function (layer) {\r\n              selectBox.setSelectedLayer(layer);\r\n            }));\r\n          }\r\n        }\r\n      },\r\n\r\n      _populateLayerRow: function (lyrInfo, i) {\r\n        var result = this.displayLayerTable.addRow({});\r\n        if (result.success && result.tr) {\r\n          var tr = result.tr;\r\n          html.addClass(tr.cells[2], \"displayOptions\");\r\n          this._addLayersOption(tr);\r\n          this._addLabelOption(tr);\r\n          this._addRefreshOption(tr);\r\n\r\n          var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.id);\r\n          jimuLayerInfo.getLayerObject().then(lang.hitch(this, function (layer) {\r\n            tr.selectLayers.setSelectedLayer(layer).then(lang.hitch(this, function () {\r\n              if (lyrInfo.symbolData.clusterType === 'ThemeCluster') {\r\n                lyrInfo = this.updateThemeClusterSymbol(lyrInfo, i);\r\n              }\r\n              var cLo = this._getLayerOptionByValue(tr);\r\n              cLo.filter = lyrInfo.filter;\r\n              cLo.imageData = lyrInfo.imageData;\r\n              cLo.symbolData = lyrInfo.symbolData;\r\n              tr.symbolData = lyrInfo.symbolData;\r\n              this.validateFields(tr.symbolData, tr);\r\n            }));\r\n          }));\r\n          tr.labelText.set(\"value\", lyrInfo.label);\r\n          tr.refreshBox.set(\"checked\", lyrInfo.refresh);\r\n          tr.imageData = lyrInfo.panelImageData;\r\n\r\n          var s = query('.imageDataGFX', tr.cells[2])[0];\r\n          if (s) {\r\n            tr.cells[2].removeChild(s);\r\n          }\r\n\r\n          domConstruct.create(\"div\", {\r\n            'class': \"imageDataGFX margin2\",\r\n            innerHTML: [lyrInfo.imageData],\r\n            title: this.nls.iconColumnText\r\n          }, tr.cells[2]);\r\n        }\r\n      },\r\n\r\n      _addLayersOption: function (tr) {\r\n        var selectBox = this._createLayerChooserSelect(tr);\r\n        if (selectBox) {\r\n          selectBox.tr = tr;\r\n          selectBox.parent = this;\r\n          tr.selectLayers = selectBox;\r\n        }\r\n      },\r\n\r\n      _createLayerChooserSelect: function (tr) {\r\n        var td = query('.simple-table-cell', tr)[0];\r\n        var layerChooserSelect;\r\n        if (td) {\r\n          var layerChooserFromMap = new UniqueLayerChooser({\r\n            showTable: false,\r\n            onlyShowVisible: false,\r\n            createMapResponse: this.map.webMapResponse,\r\n            parent: this,\r\n            row: tr\r\n          });\r\n          layerChooserFromMap.startup();\r\n\r\n          layerChooserSelect = new LayerChooserFromMapSelect({\r\n            layerChooser: layerChooserFromMap\r\n          });\r\n          layerChooserSelect.placeAt(td);\r\n          layerChooserSelect.startup();\r\n          this.own(on(layerChooserSelect, 'selection-change', this._onLayerChanged));\r\n        }\r\n        return layerChooserSelect;\r\n      },\r\n\r\n      _onLayerChanged: function () {\r\n        var item = this.getSelectedItem();\r\n        if (!item) {\r\n          return;\r\n        }\r\n        var layerID = item && item.layerInfo && item.layerInfo.id ? item.layerInfo.id : undefined;\r\n        if (this.tr.layerID && layerID && layerID !== this.tr.layerID) {\r\n          this.parent._removeRefreshLayer(this.tr.layerID);\r\n          this.tr.refreshBox.set('checked', false);\r\n        }\r\n        this.tr.layerID = layerID;\r\n        if (!this.parent.isInitalLoad) {\r\n          lang.hitch(this.parent, this.parent._updateRefresh(this.tr));\r\n          lang.hitch(this.parent, this.parent._updateLayerLists());\r\n          lang.hitch(this.parent, this.parent._addDefaultSymbol(this.tr));\r\n          this.tr.labelText.set('value', \"\");\r\n        }\r\n      },\r\n\r\n      _updateLayerLists: function () {\r\n        this.used_layers = [];\r\n        var rows = this.displayLayerTable.getRows();\r\n        //rebuild the used_layers list\r\n        for (var i = 0; i < rows.length; i++) {\r\n          var row = rows[i];\r\n          var item = row.selectLayers.getSelectedItem();\r\n          if (item && item.layerInfo && item.layerInfo.id) {\r\n            this.used_layers.push(item.layerInfo.id);\r\n            //used as a part of the LayerChoosers filter function so it will always\r\n            // show the chosen layer for a row\r\n            row.layerID = item.layerInfo.id;\r\n          }\r\n        }\r\n        //update the other layer chooser instances so they will not show\r\n        // layer instances that have been used in other rows\r\n        for (var _i = 0; _i < rows.length; _i++) {\r\n          var _row = rows[_i];\r\n          //This concept does not work when the layers are not subLayers\r\n          //if (_row.rowOpened) {\r\n          _row.selectLayers.layerChooser._onLayerInfosChanged();\r\n          //_row.rowOpened = false;\r\n          //}\r\n        }\r\n      },\r\n\r\n      _addLabelOption: function (tr) {\r\n        var td = query('.simple-table-cell', tr)[1];\r\n        html.setStyle(td, \"verticalAlign\", \"middle\");\r\n        html.setStyle(td, \"line-height\", \"inherit\");\r\n        var labelTextBox = new ValidationTextBox({\r\n          style: {\r\n            width: \"100%\",\r\n            height: \"28px\"\r\n          }\r\n        });\r\n        labelTextBox.placeAt(td);\r\n        labelTextBox.startup();\r\n        tr.labelText = labelTextBox;\r\n      },\r\n\r\n      _addRefreshOption: function (tr) {\r\n        var td = query('.simple-table-cell', tr)[3];\r\n        html.setStyle(td, \"verticalAlign\", \"middle\");\r\n        html.setStyle(td, \"line-height\", \"inherit\");\r\n        var refreshCheckBox = new CheckBox({\r\n          \"class\": \"checkBox\",\r\n          onChange: function (v) {\r\n            var layerItem = this.tr.selectLayers.getSelectedItem();\r\n            if (layerItem && layerItem.layerInfo && layerItem.layerInfo.id) {\r\n              if (v) {\r\n                this.parent._addRefreshLayer(layerItem.layerInfo.id);\r\n              } else {\r\n                this.parent._removeRefreshLayer(layerItem.layerInfo.id);\r\n              }\r\n            }\r\n          }\r\n        });\r\n        refreshCheckBox.placeAt(td);\r\n        refreshCheckBox.startup();\r\n        refreshCheckBox.parent = this;\r\n        refreshCheckBox.tr = tr;\r\n        tr.refreshBox = refreshCheckBox;\r\n        this._updateRefresh(tr);\r\n      },\r\n\r\n      _addRefreshLayer: function (layerId) {\r\n        this.refreshLayers.push(layerId);\r\n        var rO = query('.refreshOff', this.refreshOptions.domNode)[0];\r\n        if (rO) {\r\n          html.removeClass(rO, 'refreshOff');\r\n          html.addClass(rO, 'refreshOn');\r\n        }\r\n        if (!this.refreshInterval.isValid()) {\r\n          this._disableOk();\r\n        }\r\n      },\r\n\r\n      _removeRefreshLayer: function (layerId) {\r\n        var i = this.refreshLayers.indexOf(layerId);\r\n        if (i > -1) {\r\n          this.refreshLayers.splice(i, 1);\r\n          if (this.refreshLayers.length === 0) {\r\n            var rO = query('.refreshOn', this.refreshOptions.domNode)[0];\r\n            if (rO) {\r\n              html.removeClass(rO, 'refreshOn');\r\n              html.addClass(rO, 'refreshOff');\r\n            }\r\n            this._enableOk();\r\n          }\r\n        }\r\n      },\r\n\r\n      _updateRefresh: function (tr) {\r\n        var lInfo = this._getLayerOptionByValue(tr);\r\n\r\n        if (tr && tr.refreshBox) {\r\n          var refreshCheckBox = tr.refreshBox;\r\n          if (lInfo && lInfo.lyrType === 'Feature Collection' && typeof (lInfo.itemId) !== 'undefined') {\r\n            refreshCheckBox.set('disabled', false);\r\n            refreshCheckBox.set('title', this.nls.enableRefresh);\r\n          } else {\r\n            refreshCheckBox.set('disabled', true);\r\n            refreshCheckBox.set('title', this.nls.disableRefresh);\r\n          }\r\n        }\r\n      },\r\n\r\n      _updateOK: function () {\r\n        if (this.refreshInterval.isValid()) {\r\n          this._enableOk();\r\n        } else {\r\n          this._disableOk();\r\n        }\r\n      },\r\n\r\n      _disableOk: function () {\r\n        var s = query(\".button-container\")[0];\r\n        domStyle.set(s.children[2], \"display\", \"none\");\r\n        domStyle.set(s.children[3], \"display\", \"inline-block\");\r\n      },\r\n\r\n      _enableOk: function () {\r\n        var s = query(\".button-container\")[0];\r\n        domStyle.set(s.children[2], \"display\", \"inline-block\");\r\n        domStyle.set(s.children[3], \"display\", \"none\");\r\n      },\r\n\r\n      _addDefaultSymbol: function (tr) {\r\n        var td = query('.simple-table-cell', tr)[0];\r\n        this.curRow = tr;\r\n        if (td) {\r\n          html.setStyle(td, \"line-height\", \"inherit\");\r\n          html.setStyle(td, \"margin-left\", \"0px\");\r\n          var lo = this._getLayerOptionByValue(tr);\r\n          var item = tr.selectLayers.getSelectedItem();\r\n          if(item && item.layerInfo){\r\n            var selectLayersValue = item.layerInfo.id;\r\n            var hasSymbolData = false;\r\n            var sd;\r\n            if (typeof (this.curRow.symbolData) !== 'undefined') {\r\n              sd = this.curRow.symbolData;\r\n              hasSymbolData = sd.userDefinedSymbol && (sd.layerId === selectLayersValue);\r\n            }\r\n            var a;\r\n            var s;\r\n            if (!hasSymbolData || typeof (lo.symbolData) === 'undefined') {\r\n              var options = {\r\n                nls: this.nls,\r\n                callerRow: tr,\r\n                layerInfo: lo,\r\n                value: selectLayersValue,\r\n                symbolInfo: hasSymbolData ? this.curRow.symbolData : lo.symbolData,\r\n                map: this.map,\r\n                ac: this.appConfig,\r\n                hidePanel: this.hidePanel\r\n              };\r\n              var sourceDijit = new SymbolPicker(options);\r\n              sourceDijit._setSymbol();\r\n              s = query(\".imageDataGFX\", this.curRow.cells[2])[0];\r\n              if (s) {\r\n                this.curRow.cells[2].removeChild(s);\r\n              }\r\n              this.curRow.symbolData = sourceDijit.symbolInfo;\r\n              this.validateFields(this.curRow.symbolData, this.curRow);\r\n              a = domConstruct.create(\"div\", { 'class': \"imageDataGFX margin2\" }, this.curRow.cells[2]);\r\n              if (this.curRow.symbolData.svg !== null &&\r\n                typeof (this.curRow.symbolData.svg) !== 'undefined') {\r\n                a.appendChild(this.curRow.symbolData.svg);\r\n              }\r\n              this.curRow.imageData = this.curRow.symbolData.panelHTML;\r\n              this.curRow = null;\r\n              sourceDijit.destroy();\r\n              sourceDijit = null;\r\n            } else {\r\n              s = query(\".imageDataGFX\", this.curRow.cells[2])[0];\r\n              if (s) {\r\n                this.curRow.cells[2].removeChild(s);\r\n              }\r\n              this.curRow.symbolData = lo.symbolData;\r\n              this.validateFields(this.curRow.symbolData, this.curRow);\r\n              a = domConstruct.create(\"div\", { 'class': \"imageDataGFX margin2\" }, this.curRow.cells[2]);\r\n              a.appendChild(this.curRow.symbolData.svg);\r\n              this.curRow.imageData = this.curRow.symbolData.panelHTML;\r\n            }\r\n          }\r\n        }\r\n      },\r\n\r\n      _getLayerOptionByValue: function (tr) {\r\n        var item = tr.selectLayers.getSelectedItem();\r\n        var id = (item && item.layerInfo) ? item.layerInfo.id : undefined;\r\n        if (id) {\r\n          for (var i = 0; i < this.layer_options.length; i++) {\r\n            var lo = this.layer_options[i];\r\n            if (lo.id === id) {\r\n              return lo;\r\n            }\r\n          }\r\n        }\r\n      },\r\n\r\n      validateFields: function (symbolData, tr) {\r\n        var isValid;\r\n        if (symbolData && symbolData.featureDisplayOptions && symbolData.featureDisplayOptions.fields) {\r\n          isValid = symbolData.featureDisplayOptions.fields.length > 0;\r\n        } else {\r\n          isValid = false;\r\n        }\r\n        var td = query('.simple-table-cell', tr)[4];\r\n        if (td && !isValid) {\r\n          if (!tr.errorDiv) {\r\n            tr.errorDiv = domConstruct.create(\"div\", {\r\n              'class': \"field-error\"\r\n            }, td);\r\n            tr.errorSpan = domConstruct.create(\"span\", {\r\n              'class': \"jimu-icon jimu-icon-error\",\r\n              title: this.nls.fieldsWarning\r\n            }, tr.errorDiv);\r\n          } else {\r\n            domStyle.set(tr.errorSpan, 'display', 'inline-block');\r\n          }\r\n        } else if (isValid && tr.errorSpan) {\r\n          domStyle.set(tr.errorSpan, 'display', 'none');\r\n        }\r\n      },\r\n\r\n      _pickSymbol: function (tr) {\r\n        //var selectLayersValue = tr.selectLayers;\r\n        var lo = this._getLayerOptionByValue(tr);\r\n        this.curRow = tr;\r\n\r\n        var options = {\r\n          nls: this.nls,\r\n          callerRow: tr,\r\n          layerInfo: lo,\r\n          value: lo.id,\r\n          symbolInfo: typeof (this.curRow.symbolData) !== 'undefined' ? this.curRow.symbolData : lo.symbolData,\r\n          map: this.map,\r\n          ac: this.appConfig,\r\n          hidePanel: this.hidePanel\r\n        };\r\n        var sourceDijit = new SymbolPicker(options);\r\n\r\n        var popup = new Popup({\r\n          width: 420,\r\n          autoHeight: true,\r\n          content: sourceDijit,\r\n          titleLabel: this.nls.sympolPopupTitle\r\n        });\r\n\r\n        this.own(on(sourceDijit, 'ok', lang.hitch(this, function (data) {\r\n          var s = query(\".imageDataGFX\", this.curRow.cells[2])[0];\r\n          if (s) {\r\n            this.curRow.cells[2].removeChild(s);\r\n          }\r\n          this.curRow.symbolData = data;\r\n          this.validateFields(this.curRow.symbolData, this.curRow);\r\n          var a = domConstruct.create(\"div\", { 'class': \"imageDataGFX margin2\" }, this.curRow.cells[2]);\r\n          a.appendChild(data.svg);\r\n          this.curRow.imageData = data.panelHTML;\r\n          this.curRow = null;\r\n          sourceDijit.destroy();\r\n          sourceDijit = null;\r\n          popup.close();\r\n        })));\r\n\r\n        this.own(on(sourceDijit, 'cancel', lang.hitch(this, function () {\r\n          this.curRow = null;\r\n          sourceDijit.destroy();\r\n          sourceDijit = null;\r\n          popup.close();\r\n        })));\r\n      },\r\n\r\n      setGeometryType: function (OpLayer) {\r\n        var match = true;\r\n        var type;\r\n        if (OpLayer.url && OpLayer.url.indexOf) {\r\n          if (OpLayer.url.indexOf(\"MapServer\") > -1) {\r\n            this.gtQueries.push(esriRequest({ \"url\": OpLayer.url + \"?f=json\" }));\r\n            this.gtQueryUrls.push(OpLayer.url);\r\n          }\r\n        } else if(OpLayer.featureInfos && OpLayer.featureInfos.hasOwnProperty('length')){\r\n          var validGeomTypes = ['esriGeometryPoint', 'esriGeometryLine', 'esriGeometryPolygon'];\r\n          array.forEach(OpLayer.featureInfos, function (fi) {\r\n            if (fi.type && validGeomTypes.indexOf(fi.type) > -1) {\r\n              type = fi.type;\r\n              if (type !== fi.type) {\r\n                match = false;\r\n              }\r\n            }\r\n          });\r\n        }\r\n        return match && type ? type : undefined;\r\n      },\r\n\r\n      uploadImage: function (i) {\r\n        this.panelMainIcon.innerHTML = \"\";\r\n        this.mpi = i;\r\n        domConstruct.create(\"div\", {\r\n          \"class\" : \"innerMainPanelIcon\",\r\n          style: 'background-image: url(' + i + ');',\r\n          title: this.nls.mainPanelIcon\r\n        }, this.panelMainIcon);\r\n      },\r\n\r\n      getConfig: function () {\r\n        dijitPopup.close();\r\n\r\n        var rows = this.displayLayerTable.getRows();\r\n        var table = [];\r\n        var lInfo;\r\n        array.forEach(rows, lang.hitch(this, function (tr) {\r\n          var selectLayersValue;\r\n          var layerItem = tr.selectLayers.getSelectedItem();\r\n          if (layerItem && layerItem.layerInfo && layerItem.layerInfo.id) {\r\n            selectLayersValue = layerItem.layerInfo.id;\r\n          }\r\n\r\n          var labelTextValue = utils.stripHTML(tr.labelText.value);\r\n          var refreshBox = tr.refreshBox;\r\n          var lo = this._getLayerOptionByValue(tr);\r\n          var symbolData = tr.symbolData ? tr.symbolData : lo.symbolData;\r\n\r\n          lInfo = {\r\n            layer: selectLayersValue,\r\n            label: labelTextValue !== \"\" ? labelTextValue : lo.label,\r\n            refresh: refreshBox.checked,\r\n            url: lo.url,\r\n            type: lo.type,\r\n            id: lo.id,\r\n            symbolData: symbolData,\r\n            geometryType: lo.geometryType,\r\n            itemId: lo.itemId,\r\n            parentLayerID: lo.parentLayerID,\r\n            renderer: lo.renderer,\r\n            drawingInfo: lo.drawingInfo,\r\n            fields: lo.fields,\r\n            oidFieldName: lo.oidFieldName,\r\n            subLayerId: lo.subLayerId,\r\n            infoTemplate: lo.infoTemplate\r\n          };\r\n\r\n          if (tr.imageData) {\r\n            lInfo.panelImageData = tr.imageData;\r\n          }\r\n\r\n          var td = query('.imageDataGFX', tr)[0];\r\n          lInfo.imageData = typeof (td) !== 'undefined' ? td.innerHTML : \"<div></div>\";\r\n          table.push(lInfo);\r\n        }));\r\n\r\n        this.config.mapID = this.map.itemId;\r\n\r\n        this.config.layerInfos = table;\r\n        this.config.mainPanelText = utils.stripHTML(this.mainPanelText.value);\r\n        this.config.mainPanelIcon = this.panelMainIcon.innerHTML;\r\n        this.config.refreshInterval = utils.stripHTML(this.refreshInterval.value);\r\n        this.config.refreshEnabled = this.refreshLayers.length > 0 ? true : false;\r\n        this.config.countEnabled = this.countEnabled;\r\n        this.config.displayPanelIcon = this.displayPanelIcon;\r\n        this.config.hidePanel = this.hidePanel;\r\n        this.config.continuousRefreshEnabled = this.hidePanel;\r\n        this.config.expandList = this.expandListOptions.checked;\r\n        this.config.showAllFeatures = this.showAllFeaturesOptions.checked;\r\n        this.config.upgradeFields = false;\r\n\r\n        return this.config;\r\n      },\r\n\r\n      destroy: function () {\r\n        dijitPopup.close();\r\n        this.inherited(arguments);\r\n      }\r\n    });\r\n  });\r\n"]}
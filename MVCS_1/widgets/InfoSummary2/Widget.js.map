{"version":3,"sources":["../../../widgets/InfoSummary2/Widget.js"],"names":["define","BaseWidget","LayerInfos","utils","dom","domClass","domConstruct","on","domStyle","declare","lang","html","dojoColor","all","array","DeferredList","Deferred","query","fx","gfx","xhr","_WidgetsInTemplateMixin","Graphic","Point","FeatureLayer","SimpleMarkerSymbol","PictureMarkerSymbol","SimpleLineSymbol","SimpleFillSymbol","Color","Query","QueryTask","FeatureSet","arcgisUtils","jsonUtils","esriRequest","SimpleRenderer","jsonUtil","ClusterLayer","LayerDrawingOptions","baseClass","name","opLayerInfos","layerList","UNIQUE_APPEND_VAL_CL","widgetChange","refreshInterval","refreshIntervalValue","configLayerInfos","legendNodes","currentQueryList","symbols","row","departamento","queryDepartamento","queryTaskDepartamento","featureLayerDepartamento","id","outFields","mode","MODE_SELECTION","showLabels","_lineColor","color","_fillLineColor","fill1","line1","line2","line3","_zoomDepartamento","objectId","booleanZoom","objectIds","selectFeatures","SELECTION_NEW","features","map","setExtent","geometry","getExtent","expand","bind","error","console","log","erro","message","_onClickDepartamento","CboDepartamento","value","trim","options","selectedIndex","getAttribute","_errorDepartamento","item","tagHtml","push","_callDepartamento","clearSelection","Window","itemFeaturesDepartamento","featuresLength","length","i","featureAttributes","attributes","OBJECTID","IDDEPARTAMENTO","NAME_DEPARTAMENTO","innerHTML","join","parentNode","classList","remove","_settingDepartamento","returnGeometry","setScaleRange","setRenderer","setObject","addLayer","_activeTabSearch","positionTab","tabs4","document","querySelectorAll","tabsContent4","deactvateAllTabs","forEach","tab","hideTabsContent","tabContent","activateTabsContent","getIndex","add","el","parentElement","children","indexOf","currentValue","index","addEventListener","click","_getPanel","paramWidget","paramHeight","panel","getPanel","pos","position","width","height","setPosition","_onLoadDepartamento","where","execute","postCreate","inherited","arguments","inPanelOverrides","appConfig","theme","config","layerInfos","_initWidget","_forceClose","themeName","dcThemes","p","containerNode","style","display","widgetManager","closeWidget","getParent","_toggleBox","ss","outerHTML","aw","widgets","widgetOnScreen","ii","isThemeWidget","getWidgetById","_switchNodeToClose","_closeDropMenu","iconClickHandler","undefined","hidePanel","iconNodeThemes","iconNodes","hitch","firstChild","className","padding","_updateBackgroundColors","isDartTheme","isDashboardTheme","contains","pageHeader","updateForDartTheme","updateForBoxTheme","updateForTabTheme","updateForLaunchpadTheme","updateForBillboardTheme","updateForPlateauTheme","updateForDashboardTheme","top","fc","isOnScreen","right","left","lastUpdated","useDarkText","startup","showAllFeatures","mapExtentChangedHandler","_mapExtentChange","getElementById","onOpen","_updatePanelHeader","styles","_updateStyleColor","visibleSubLayers","key","layerListLayer","li","lo","layerObject","orgRenderer","newRenderer","setLayerDrawingOptions","optionsArray","drawingOptions","renderer","subLayerId","refresh","_Pl","parentLayerID","getLayer","l","visibleLayers","_foundIt","sub_layers_id_loop","subVizLyrId","layers","x","subLayerLoop","o","visLayers","inVisLayers","plVis","parentLayerVisible","loPlVis","type","visible","splice","graphicsLayerIds","setVisibility","updatePanelVisibility","_parentLayer","expandList","legendOpen","isLoaded","visScaleRange","_inVisibleRange","updateList","parentLayer","setVisibleLayers","refreshEnabled","enableRefresh","infoWindow","highlight","c","byId","countEnabled","listDisabled","toggleLegend","checkedTime","itemId","getItem","tempVal","setInterval","refreshLayers","clearInterval","portalUrl","window","substr","url","content","f","requestTime","Date","now","then","response","itemModified","modified","update","lastModifiedTime","_updatePanelTime","_updateItem","modifiedTime","_d","_f","dateFormat","fieldFormatter","getFormattedDate","lyr","featureCollection","_updateLayerItem","responseLayer","list","fields","k","pl","layerDefinition","symbolData","featureDisplayOptions","refreshFeatures","_loadList","featureSet","graphics","responseFeatureSetFeatures","mapFeatureSetFeatures","responseSR","_getSpatialReference","mapSR","gra","g","geom","rings","paths","points","y","mixin","spatialReference","wkid","transform","fs","shouldUpdate","JSON","stringify","requiresReload","layerListExtentChanged","clear","sr","j","go","getGraphicOptions","setAttributes","_infoTemplate","setInfoTemplate","countFeatures","hasOwnProperty","firstFeature","graphicOptions","getInstance","itemInfo","operLayerInfos","wmLayerInfos","getLayerInfoArrayOfWebmap","getLayerInfoArray","_updateLayerIDs","upgradeFields","_upgradeFields","_createPanelUI","_addFilterChanged","_addVisibleChanged","_addZoomChanged","removeIDs","getUrl","configLayer","jimuLayerInfo","config_layer_loop","getLayerInfoById","updated","wm_layer_loop","_opLayer","originOpLayer","originOperLayer","urlId","_compareURL","_compareItemID","subId","_compareSubId","layer","sort","a","b","opLayer","geomMatch","_compareGeom","fieldMatch","_compareFields","fcLayers","fcLayer","geometryType","matchingFields","filter","fn","configField","lyrInfo","oidFieldName","objectIdField","firstLayerFieldName","firstLayerFieldAlias","layerFields","layer_field_loop","_i","alias","keyFieldName","keyFieldAlias","infoTemplate","info","fieldInfos","getInfoTemplate","subLayers","getSubLayers","sub_layers_loop","sli","sl","title","popupFields","popup_field_loop","popupField","fieldName","label","parseFloat","wabVersion","own","changedLayerInfoArray","layerInfo","clId","getFilter","_initFeatures","_updateVisibility","vis","isShowInMap","_toggleLayerUI","changedLayerInfos","traversal","panelTitle","w","displayPanelIcon","removeClass","mainPanelText","addClass","pageBody","pageTitle","panelMainIcon","mainPanelIcon","jimuLayerInfos","numClusterLayers","_updateUI","_clearChildNodes","pageMain","updateEnd","clusterType","updateThemeClusterSymbol","getLayerType","layerType","getLayerObject","updateLayerList","_updateEnd","addMapLayers","results","lid","target","updating","sd","_styleColor","_rgb","fromHex","xx","evenOdd","r","rr","bb","gg","clusterSymbol","outline","removeOldClusterLayers","lInfos","deleteLayers","layer_info_loop","potentialNewClusterID","clusteringEnabled","dl","_dl","setTopLayerVisible","removeLayer","destroy","ids","Object","keys","reverse","lyrType","ll","selfType","_checkSelfType","_checkListDisabled","_getClusterLayer","parentLayerInfo","_lyr","empty","getFeatureLayers","featureLayers","fl","updateRenderer","_addPanelItem","_lo","symbolType","fromJson","symbol","_onRecNodeMouseover","rec","isLightTheme","_onRecNodeMouseout","potentialNewID","cssAry","create","expandClass","isInScale","setStyle","recIcon","panelImageData","toString","img","createElement","icon","src","_createImageDataDiv","set","recLabel","recNum","node","_addLegend","_updateNode","nodeCount","_toggleLayerVisibility","_toggleLegend","_class","legendNode","_getListFields","infoTemp","_getInfoTemplate","fieldInfo","displayOptions","field","groupField","updateCount","_addSearching","clusterFeatures","clusterGraphics","_features","z","clusterGraphic","setTimeout","_updateList","_removeSearching","getFeatures","disabled","eD","eU","eS","clusterLayer","n","configChange","_layers","reloadData","refreshData","countColor","_highLightColor","toDom","displayFeatureCount","_setupSymbols","sym","h","parent","isCustom","ar","setWidth","setHeight","size","setSize","mySurface","createSurface","descriptors","getShapeDescriptors","shape","createShape","defaultShape","setFill","fill","setStroke","stroke","applyTransform","dx","dy","styleName","removeDownClass","addDownClass","_updateNodes","removeUpClass","addUpClass","removeExpandClass","addExpandClass","removeGroupItemUpClass","addGroupItemUpClass","removeGroupItemDownClass","addGroupItemDownClass","removeGroupItemClass","addGroupItemClass","nodes","obj","e","stopPropagation","hide","hasSubLayerId","_vis","currentLayerInfo","handleMapExtentChange","levelChange","flashFeatures","visibility","visScalRange","isCurrentScaleInTheScaleRange","_append","evt","currentTarget","_toggleGroup","slice","fI","toggle","gII","gIIUp","gIIDown","lId","_idx","childNodes","openGroups","groupOpen","idx","onAppConfigChanged","reason","changedData","_clearMap","bc","getComputedStyle","getPropertyValue","fromRgb","toHex","setStyleColor","_clear","continuousRefreshEnabled","_close","onClose","disableRefresh","hasChildNodes","removeChild","lastChild","visibleAtMapScale","queries","_clearList","groupEnabled","initalLoad","uNode","_needsGeom","maxRecordCount","q","_getQuery","queryFeatures","queryIds","qt","executeForIds","featurePromises","s_id","updateNode","previousSibling","_queries","queryIDs","count","_chunkRequest","fullFeatures","localizeNumber","updateExpand","IDs","max","needsGeom","def","queryList","queryResults","allFeatures","apply","resolve","countOnly","_graphicsLayer","_fields","groupNodes","finalGroupNodes","finalDomNodes","groupAdded","feature","getSymbol","oidName","_layer","flds","isNames","displayStringObj","getDisplayString","displayString","aliasNames","firstValue","groupNode","groupContainer","displayValue","groupType","featureValue","_value","appendVal","groupByField","groupByRendererOptions","groubByFields","groupByValues","values","expression_loop","_val","exp","expParts","split","isNaN","eval","replace","gId","addGroup","node_loop","iii","gNode","groupTitle","_getFormattedValue","clone","inGrpList","groupCountNode","imageContainer","cNames","countNode","result","featureItem","_panToFeature","_margin","_txtAlign","isRTL","localeCompare","cE","appendChild","sortedNodes","_a","_b","fdn","place","loaded","queryPending","en","displayField","_checkAliasName","hasLabel","append","_fieldsMap","Array","isArray","_getFieldByName","intField","_checkIntField","domainField","_checkDomainField","dateField","_checkDateField","formatDateValue","formatDomainValue","formatNumberValue","infoTemplates","v","num","format","localizeNumberByFieldInfo","domain","codedValues","cvs","cv","code","d","parseInt","localizeDateByFieldInfo","localizeDate","testTypes","_checkDisplayField","displayFields","featureField","includeField","flashGraphics","_flashFeature","color2","STYLE_CIRCLE","STYLE_SOLID","STYLE_DIAGONAL_CROSS","dShape","getDojoShape","animateStroke","duration","start","strokeStyle","end","play","_clearFeature","gl","path","Math","ceil","getCenter","_pan","setFeatures","select","show","centerPoint","extent","centerAt","ext","collectionTypes","isCollection","fullExtent","queryCount"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright  2014 - 2018 Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n/*jshint loopfunc: true */\ndefine([\n  'jimu/BaseWidget',\n  'jimu/LayerInfos/LayerInfos',\n  'jimu/utils',\n  'dojo/dom',\n  'dojo/dom-class',\n  'dojo/dom-construct',\n  'dojo/on',\n  'dojo/dom-style',\n  'dojo/_base/declare',\n  'dojo/_base/lang',\n  'dojo/_base/html',\n  'dojo/_base/Color',\n  'dojo/promise/all',\n  'dojo/_base/array',\n  'dojo/DeferredList',\n  'dojo/Deferred',\n  'dojo/query',\n  \"dojox/gfx/fx\",\n  'dojox/gfx',\n  'dojo/_base/xhr',\n  'dijit/_WidgetsInTemplateMixin',\n  'esri/graphic',\n  'esri/geometry/Point',\n  'esri/layers/FeatureLayer',/**/\n  'esri/symbols/SimpleMarkerSymbol',\n  'esri/symbols/PictureMarkerSymbol',\n  'esri/symbols/SimpleLineSymbol',\n  'esri/symbols/SimpleFillSymbol',\n  'esri/Color',\n  'esri/tasks/query',\n  'esri/tasks/QueryTask',\n  \"esri/tasks/FeatureSet\",\n  \"esri/arcgis/utils\",\n  'esri/symbols/jsonUtils',\n  'esri/request',\n  \"esri/renderers/SimpleRenderer\",\n  \"esri/renderers/jsonUtils\",\n  './js/ClusterLayer', 'esri/layers/LayerDrawingOptions'\n  ], \n  function (\n    BaseWidget,\n    LayerInfos,\n    utils,\n    dom,\n    domClass,\n    domConstruct,\n    on,\n    domStyle,\n    declare,\n    lang,\n    html,\n    dojoColor,\n    all,\n    array,\n    DeferredList,\n    Deferred,\n    query,\n    fx,\n    gfx,\n    xhr,\n    _WidgetsInTemplateMixin,\n    Graphic,\n    Point,\n    FeatureLayer,/**/\n    SimpleMarkerSymbol,\n    PictureMarkerSymbol,\n    SimpleLineSymbol,\n    SimpleFillSymbol,\n    Color,\n    Query,\n    QueryTask,\n    FeatureSet,\n    arcgisUtils,\n    jsonUtils,\n    esriRequest,\n    SimpleRenderer,\n    jsonUtil,\n    ClusterLayer,\n    LayerDrawingOptions\n  ) {\n  return declare([BaseWidget, _WidgetsInTemplateMixin], {\n    baseClass: 'jimu-widget-InfoSummary',\n\n    name: \"InfoSummary2\",\n    opLayerInfos: null,\n    layerList: {},\n    UNIQUE_APPEND_VAL_CL: \"_CL\",\n    widgetChange: false,\n    refreshInterval: 0,\n    refreshIntervalValue: 0,\n    configLayerInfos: [],\n    legendNodes: [],\n    currentQueryList: [],\n    symbols: [],\n    row: null,\n    \n    // FIELD Departamento\n    departamento: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dpto\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\"\n    },\n\n    // Query\n    queryDepartamento: new Query(),\n    // Query Task\n    queryTaskDepartamento: new QueryTask (\n      \"https://dportalgis.vivienda.gob.pe/dfdserver/rest/services/OGEI/limites_peru/MapServer/6\"\n    ),\n    // Feature Layer\n    featureLayerDepartamento: new FeatureLayer(\n      \"https://dportalgis.vivienda.gob.pe/dfdserver/rest/services/OGEI/limites_peru/MapServer/6\",\n      {\n        id:\"DepartamentoNuevo\", outFields: [\"*\"],\n        mode: FeatureLayer.MODE_SELECTION,\n        showLabels: true\n      }\n    ),\n\n    /* Color de lnea */\n    _lineColor: function(color){\n      if(color == null){\n        return color;\n      }else{\n        return (color = new Color(color));\n      }\n    },\n\n    /* Contornos de colores */\n    _fillLineColor: function(fill1, line1, line2, line3, color) {\n      return (\n        new SimpleRenderer(\n          new SimpleFillSymbol(\n            fill1, \n            new SimpleLineSymbol(\n              line1,this._lineColor(line2), line3\n            ), \n            this._lineColor(color)\n          )\n        )\n      );\n    }, \n\n    /* Realiza un acercameinto al departamento */\n    _zoomDepartamento: function (objectId, booleanZoom) {\n      // objectId. Es del departamento.\n      // booleanZoom. Es del INPUT CHECKBOX.\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerDepartamento.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            /* Valida si el zoom se activa o no */\n            if(booleanZoom) {\n              this.map.setExtent(features[0].geometry.getExtent().expand(1.6), true);\n            }\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(\"Error: _zoomDepartamento \" + erro.name + \" - \" + error.message);\n      }\n    },\n\n    _onClickDepartamento: function(){\n      try {\n        // Valida que el ID no este vaco\n        if(this.CboDepartamento.value.trim() != \"\") {\n          //this.ID_ZoomEspecifico.checked\n          // Acercamiento DEPARTAMENTO\n          console.log(this.CboDepartamento.options[this.CboDepartamento.selectedIndex].getAttribute(\"data-objectId\"));\n          this._zoomDepartamento (\n            this.CboDepartamento.options[this.CboDepartamento.selectedIndex].getAttribute(\"data-objectId\"),\n            true\n          );          \n        }\n      } catch (error) {\n        console.log(\"Error: _onClickDepartamento \" + error.name + \" - \"+ error.message);\n      }\n    },\n\n    // Error - Select DEPARTAMENTAL\n    _errorDepartamento: function(item) {\n      try {\n        let tagHtml = [];\n          tagHtml.push( \"\\\n            <li class=\\\"list-group-item\\\" \\\n              data-objectId=\\\"\\\" \\\n              data-departamentoId=\\\"\\\"> \\\n              Error al cargar \\\n            </li>\"\n          );\n        \n      } catch (error) {\n          console.log(\"Error: _errorDepartamento \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _callDepartamento: function(item) {\n      try {\n        let tagHtml = [];\n        this.featureLayerDepartamento.clearSelection();\n        if(item != null) {\n          Window.itemFeaturesDepartamento = this.featuresLength = item.features;\n          this.featuresLength = this.featuresLength.length;\n          tagHtml.push( \"\\\n              <option value =\\\"\\\"> - Seleccione Departamento - </option>\"\n            );\n          for(let i = 0; i < this.featuresLength; i++) {\n            this.featureAttributes = item.features[i].attributes;\n            tagHtml.push( \"\\\n              <option \\\n                data-objectId=\\\"\" + this.featureAttributes[this.departamento.OBJECTID] + \"\\\" \\\n                data-departamentoId=\\\"\" + this.featureAttributes[this.departamento.IDDEPARTAMENTO] + \"\\\" \\\n                value=\\\"\" + this.featureAttributes[this.departamento.IDDEPARTAMENTO] + \"\\\" \\\n                data-departamentoPolygon=\\\"\" + i + \"\\\" >\\\n                \"+ this.featureAttributes[this.departamento.NAME_DEPARTAMENTO] + \"\\\n              </option>\"\n            );\n          }\n          this.CboDepartamento.innerHTML = tagHtml.join(\"\");\n          this.CboDepartamento.parentNode.classList.remove(\"is-loading\");\n        } else {\n          this.CboDepartamento.value = \"\";\n        }\n      } catch (error) {\n          console.log(\"Error: _callDepartamento \" + error.name + \" - \" + error.message);\n      }\n    },\n\n\n    /* Configurar departamentos */\n    _settingDepartamento: function() {\n      this.queryDepartamento.returnGeometry = true;\n      this.queryDepartamento.outFields = [\n        this.departamento.OBJECTID,\n        this.departamento.IDDEPARTAMENTO,\n        this.departamento.NAME_DEPARTAMENTO\n      ];      \n      this.featureLayerDepartamento.setScaleRange(0,0);\n      this.featureLayerDepartamento.setRenderer(\n        this._fillLineColor(\"solid\",\"solid\",\"#D10202\",1.5,[209,2,2,0])\n      );\n      // Se elimina de la lista de capas\n      lang.setObject('_wabProperties.isTemporaryLayer', true, this.featureLayerDepartamento);\n      // Se adiciona al mapa\n      this.map.addLayer(this.featureLayerDepartamento);\n    },\n\n    _activeTabSearch: function(positionTab) {\n      let tabs4 = document.querySelectorAll('.jimu-widget-InfoSummary .tabs .tab');\n      let tabsContent4 = document.querySelectorAll('.jimu-widget-InfoSummary .tab-content');\n\n      let deactvateAllTabs = function () {\n        tabs4.forEach(function (tab) {\n          tab.classList.remove('jimu-state-selected');\n        });\n      };\n\n      let hideTabsContent = function () {\n        tabsContent4.forEach(function (tabContent) {\n          tabContent.classList.remove('jimu-state-selected');\n        });\n      };\n\n      let activateTabsContent = function (tab) {\n        tabsContent4[getIndex(tab)].classList.add('jimu-state-selected');\n      };\n\n      let getIndex = function (el) {\n        return [...el.parentElement.children].indexOf(el);\n      };\n\n      tabs4.forEach(function (currentValue, index, array) {\n        currentValue.addEventListener('click', function () {\n            deactvateAllTabs();\n            hideTabsContent();\n            currentValue.classList.add('jimu-state-selected');\n            activateTabsContent(currentValue);\n        }.bind(this));\n      }.bind(this));\n\n      tabs4[positionTab].click();\n    },\n\n    /* Cambiar el tamao del widget */\n    _getPanel: function(paramWidget, paramHeight) {  \n      try {\n        let panel = this.getPanel();\n        let pos = panel.position;\n        pos.width = paramWidget;\n        pos.height = paramHeight;\n        panel.setPosition(pos);\n      } catch (error) {\n        console.log(\"_getPanel: \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _onLoadDepartamento: function() {\n      this.queryDepartamento.where = \"1=1\";\n      this.queryTaskDepartamento.execute(\n        this.queryDepartamento,\n        this._callDepartamento.bind(this),\n        this._errorDepartamento.bind(this)\n      );\n    },\n\n    postCreate: function postCreate() {\n      this.inherited(arguments);\n      this.inPanelOverrides(this.appConfig.theme.name);\n      this.configLayerInfos = this.config.layerInfos;\n      this.layerList = {};\n      /* Configuracion departamento */\n      this._settingDepartamento();\n      /* Cargar los departamentos */\n      this._onLoadDepartamento();\n      //populates this.layerInfos and creates the panel\n      this._initWidget();\n      /* Cambiar el tamao del widget */\n      this._getPanel(320, 500);\n    },\n\n    _forceClose: function _forceClose() {\n      var themeName = this.appConfig.theme.name;\n      var dcThemes = ['LaunchpadTheme', 'DartTheme', 'FoldableTheme', 'JewelryBoxTheme', 'BillboardTheme', 'TabTheme', 'DashboardTheme'];\n      var p = this.getPanel();\n      if (dcThemes.indexOf(themeName) > -1) {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        this.widgetManager.closeWidget(this.id);\n      } else if (themeName === 'BoxTheme') {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        if (p.getParent && p.getParent()._toggleBox) {\n          var ss = query('.icon-node-active');\n          for (var i = 0; i < ss.length; i++) {\n            if (ss[i].outerHTML.indexOf(this.id) > -1) {\n              p.getParent()._toggleBox();\n            }\n          }\n        }\n      } else if (themeName === 'PlateauTheme') {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        this.widgetManager.closeWidget(this.id);\n        if (!this.aw) {\n          var widgets = this.widgetManager.appConfig.widgetOnScreen.widgets;\n          for (var ii = 0; ii < this.widgetManager.appConfig.widgetOnScreen.widgets.length; ii++) {\n            if (widgets[ii].isThemeWidget) {\n              this.aw = this.widgetManager.getWidgetById(widgets[ii].id);\n              this.aw._switchNodeToClose(this.id);\n              this.aw._closeDropMenu();\n              break;\n            }\n          }\n        } else {\n          this.aw._switchNodeToClose(this.id);\n          this.aw._closeDropMenu();\n        }\n      }\n    },\n\n    inPanelOverrides: function inPanelOverrides(themeName) {\n      if (typeof this.iconClickHandler !== 'undefined') {\n        this.iconClickHandler.remove();\n        this.iconClickHandler = undefined;\n      }\n\n      var p = this.getPanel();\n\n      if (this.config.hidePanel) {\n        var iconNodeThemes = ['DartTheme', 'BoxTheme', 'FoldableTheme', 'JewelryBoxTheme', 'PlateauTheme'];\n\n        var iconNodes;\n        if (themeName === 'LaunchpadTheme') {\n          this._forceClose();\n          iconNodes = query('.selected');\n          if (iconNodes.length > 0) {\n            if (iconNodes[0].parentNode.outerHTML.indexOf(this.id) > -1) {\n              this.iconClickHandler = on(iconNodes[0], 'click', lang.hitch(this, this._forceClose));\n            }\n          }\n        } else if (iconNodeThemes.indexOf(themeName) > -1) {\n          if (themeName === 'BoxTheme') {\n            this._forceClose(); //did this for box...make sure it doesn't jack others up\n          }\n          iconNodes = query('.icon-node');\n          for (var i = 0; i < iconNodes.length; i++) {\n            if (iconNodes[i].outerHTML.indexOf(this.id) > -1) {\n              this.iconClickHandler = on(iconNodes[i], 'click', lang.hitch(this, this._forceClose));\n            }\n          }\n        }\n      } else {\n        //TODO test if this has the class .jimu-widget-frame.jimu-container\n        if (p.containerNode && p.containerNode.firstChild && p.containerNode.firstChild.className) {\n          p.containerNode.firstChild.style.padding = '0px 0px 10px 0px';\n        }\n\n        //change associated with the tab theme...all others will show the background color behind refresh text and panel image\n        if (['TabTheme', 'BillboardTheme', 'PlateauTheme', 'DashboardTheme'].indexOf(themeName) === -1) {\n          this._updateBackgroundColors(true);\n        }\n\n        this.isDartTheme = themeName === \"DartTheme\";\n        this.isDashboardTheme = themeName === 'DashboardTheme';\n        if (domClass.contains(this.pageHeader, this.isDartTheme ? 'pageHeader-border' : 'pageHeader-border-dart')) {\n          domClass.remove(this.pageHeader, this.isDartTheme ? 'pageHeader-border' : 'pageHeader-border-dart');\n        }\n        domClass.add(this.pageHeader, this.isDartTheme ? 'pageHeader-border-dart' : 'pageHeader-border');\n\n        switch (themeName) {\n          case 'DartTheme':\n            this.updateForDartTheme(p);\n            break;\n          case 'BoxTheme':\n            this.updateForBoxTheme(p);\n            break;\n          case 'TabTheme':\n            this.updateForTabTheme(p);\n            break;\n          case 'LaunchpadTheme':\n            this.updateForLaunchpadTheme(p);\n            break;\n          case 'BillboardTheme':\n            this.updateForBillboardTheme(p);\n            break;\n          case 'PlateauTheme':\n            this.updateForPlateauTheme(p);\n            break;\n          case 'DashboardTheme':\n            this.updateForDashboardTheme(p);\n            break;\n        }\n      }\n    },\n\n    updateForLaunchpadTheme: function updateForLaunchpadTheme(p) {\n      p.containerNode.style.top = '30px';\n    },\n\n    updateForTabTheme: function updateForTabTheme(p) {\n      if (p.containerNode.children.length > 0) {\n        var fc = p.containerNode.children[0];\n        if (fc.children.length > 1) {\n          fc.children[1].style.padding = '14px 0px 14px 0px';\n        }\n      }\n      if (!p.config.isOnScreen) {\n        this._updateBackgroundColors(false);\n      }\n    },\n\n    updateForBoxTheme: function updateForBoxTheme(p) {\n      p.containerNode.parentNode.style.top = '140px';\n    },\n\n    updateForDartTheme: function updateForDartTheme(p) {\n      p.containerNode.style.right = '0px';\n      p.containerNode.style.left = '0px';\n    },\n\n    updateForBillboardTheme: function updateForBillboardTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    updateForPlateauTheme: function updateForPlateauTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    updateForDashboardTheme: function updateForDashboardTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    _updateBackgroundColors: function _updateBackgroundColors(add) {\n      //deal with text color\n      if (domClass.contains(this.lastUpdated, add ? 'lastUpdated-tab' : 'lastUpdated')) {\n        domClass.remove(this.lastUpdated, add ? 'lastUpdated-tab' : 'lastUpdated');\n      }\n      domClass.add(this.lastUpdated, add ? 'lastUpdated' : 'lastUpdated-tab');\n\n      add = add && this.appConfig.theme.name !== 'DashboardTheme';\n      this.useDarkText = !add;\n\n      //deal with background color for page header\n      if (domClass.contains(this.pageHeader, 'jimu-main-background') && !add) {\n        domClass.remove(this.pageHeader, 'jimu-main-background');\n      } else if (!domClass.contains(this.pageHeader, 'jimu-main-background') && add) {\n        domClass.add(this.pageHeader, 'jimu-main-background');\n      }\n      if (domClass.contains(this.pageHeader, 'dart-bgcolor') && !add) {\n        domClass.remove(this.pageHeader, 'dart-bgcolor');\n      } else if (!domClass.contains(this.pageHeader, 'dart-bgcolor') && add) {\n        domClass.add(this.pageHeader, 'dart-bgcolor');\n      }\n      if (domClass.contains(this.pageHeader, 'box-bgcolor') && !add) {\n        domClass.remove(this.pageHeader, 'box-bgcolor');\n      } else if (!domClass.contains(this.pageHeader, 'box-bgcolor') && add) {\n        domClass.add(this.pageHeader, 'box-bgcolor');\n      }\n    },\n\n    startup: function startup() {\n      this.inherited(arguments);\n      if (!this.hidePanel && !this.showAllFeatures) {\n        this.mapExtentChangedHandler = this.map.on(\"extent-change\", lang.hitch(this, this._mapExtentChange));\n        this._mapExtentChange();\n      } else if (this.showAllFeatures) {\n        this._mapExtentChange();\n      }\n      \n      document.getElementById(\"Departamentos\").click();\n      /* Pestaa que se activa \n        - 0. Activa la pestaa de ESPECIFICO\n        - 1. Activa la pestaa de GENERAL */\n      this._activeTabSearch(1); \n      \n    },\n\n    onOpen: function onOpen() {\n      this.widgetChange = false;\n\n      if (!this.hidePanel) {\n        this._updatePanelHeader();\n      } else {\n        if (this.appConfig.theme.name !== 'BoxTheme') {\n          this._forceClose();\n        }\n      }\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        this._updateStyleColor(this.appConfig.theme.styles[0]);\n      }\n\n      var visibleSubLayers = [];\n      //update the renderer for the layer in the layer list if a new one has been defined\n      for (var key in this.layerList) {\n        var layerListLayer = this.layerList[key];\n        var li = layerListLayer.li;\n        var lo = layerListLayer.layerObject;\n        if (li && li.orgRenderer) {\n          if (lo.setRenderer) {\n            lo.setRenderer(li.newRenderer);\n          } else if (lo.setLayerDrawingOptions) {\n            var optionsArray = [];\n            var drawingOptions = new LayerDrawingOptions();\n            drawingOptions.renderer = li.newRenderer;\n            optionsArray[li.subLayerId] = drawingOptions;\n            lo.setLayerDrawingOptions(optionsArray);\n          } else {\n            console.log(\"Error setting the new renderer...will use the default rendering of the layer\");\n          }\n          if (typeof lo.refresh === 'function') {\n            lo.refresh();\n          }\n        }\n\n        var _Pl;\n        if (lo && lo.layerInfos) {\n          _Pl = lo;\n        } else if (li && typeof li.parentLayerID !== 'undefined') {\n          _Pl = this.map.getLayer(li.parentLayerID);\n        }\n\n        var l;\n        if (_Pl && _Pl.visibleLayers) {\n          var _foundIt = false;\n          sub_layers_id_loop: for (var ii = 0; ii < visibleSubLayers.length; ii++) {\n            var subVizLyrId = visibleSubLayers[ii].id;\n            if (subVizLyrId === _Pl.id) {\n              _foundIt = true;\n              break sub_layers_id_loop;\n            }\n          }\n          if (visibleSubLayers.length === 0 || !_foundIt) {\n            visibleSubLayers.push({\n              id: _Pl.id,\n              layers: _Pl.visibleLayers\n            });\n          }\n          var x = 0;\n          subLayerLoop: for (x; x < visibleSubLayers.length; x++) {\n            var o = visibleSubLayers[x];\n            if (o.id === _Pl.id) {\n              break subLayerLoop;\n            }\n          }\n          var visLayers = visibleSubLayers[x].layers;\n          if (_Pl.layerInfos) {\n            //Handle MapService layers\n            if (_Pl.layerInfos.length > 0) {\n              if (li && typeof li.subLayerId !== 'undefined') {\n                var inVisLayers = visLayers.indexOf(li.subLayerId) > -1;\n                var plVis = layerListLayer.parentLayerVisible;\n                var loPlVis = layerListLayer.layerObject.parentLayerVisible;\n                if (layerListLayer.type === \"ClusterLayer\" && (inVisLayers || plVis || loPlVis)) {\n                  layerListLayer.parentLayerVisible = true;\n                  layerListLayer.layerObject.parentLayerVisible = true;\n                  layerListLayer.visible = true;\n                  if (inVisLayers) {\n                    visLayers.splice(visLayers.indexOf(li.subLayerId), 1);\n                  }\n                } else if (inVisLayers || plVis) {\n                  layerListLayer.parentLayerVisible = true;\n                  layerListLayer.visible = true;\n                  if (visLayers.indexOf(li.subLayerId) === -1) {\n                    visLayers.push(li.subLayerId);\n                  }\n                } else {\n                  layerListLayer.parentLayerVisible = false;\n                  layerListLayer.visible = false;\n                  if (inVisLayers) {\n                    visLayers.splice(visLayers.indexOf(li.subLayerId), 1);\n                  }\n                  if (layerListLayer.type === \"ClusterLayer\") {\n                    layerListLayer.layerObject.parentLayerVisible = false;\n                    if (this.map.graphicsLayerIds.indexOf(layerListLayer.id) > -1) {\n                      l = this.map.getLayer(layerListLayer.id);\n                      l.setVisibility(false);\n                    }\n                  }\n                }\n              }\n            }\n            visibleSubLayers[x].layers = visLayers;\n          }\n          this.updatePanelVisibility(layerListLayer, key, layerListLayer);\n        } else if (lo) {\n          //Handle non MapService layers\n          if (layerListLayer.type === \"ClusterLayer\") {\n            if (lo._parentLayer) {\n              if (this.map.graphicsLayerIds.indexOf(layerListLayer.id) > -1) {\n                l = this.map.getLayer(layerListLayer.id);\n                if (typeof layerListLayer.layerObject.parentLayerVisible === 'undefined') {\n                  layerListLayer.parentLayerVisible = lo._parentLayer.visible;\n                  layerListLayer.layerObject.parentLayerVisible = lo._parentLayer.visible;\n                }\n                l.setVisibility(layerListLayer.layerObject.parentLayerVisible);\n              }\n              if (lo._parentLayer.setVisibility) {\n                lo._parentLayer.setVisibility(false);\n              }\n            }\n          }\n          this.updatePanelVisibility(lo, key, layerListLayer);\n        }\n\n        if (this.showAllFeatures && this.config.expandList && layerListLayer.legendOpen && !layerListLayer.isLoaded) {\n          var visScaleRange = layerListLayer.visScaleRange;\n          if (typeof visScaleRange !== 'undefined') {\n            visScaleRange = this._inVisibleRange(layerListLayer, key);\n          }\n          if (layerListLayer.visible && visScaleRange) {\n            layerListLayer.updateList = true;\n          }\n        }\n      }\n\n      for (var i = 0; i < visibleSubLayers.length; i++) {\n        var parentLayer = this.map.getLayer(visibleSubLayers[i].id);\n        if (parentLayer) {\n          parentLayer.setVisibleLayers(visibleSubLayers[i].layers);\n        }\n      }\n\n      if (!this.hidePanel && !this.showAllFeatures) {\n        if (typeof this.mapExtentChangedHandler === 'undefined') {\n          this.mapExtentChangedHandler = this.map.on(\"extent-change\", lang.hitch(this, this._mapExtentChange));\n          this._mapExtentChange();\n        }\n      }\n\n      //if refresh is enabled set refereshInterval on any widget source layers with refresh set to true\n      //and call setInterval to refresh the static graphics\n      if (this.config.refreshEnabled) {\n        this.enableRefresh();\n      }\n\n      if (this.map.infoWindow) {\n        this.map.infoWindow.highlight = true;\n      }\n    },\n\n    updatePanelVisibility: function updatePanelVisibility(lo, key, layerListLayer) {\n      if (!this.hidePanel) {\n        if (typeof lo.visible !== 'undefined') {\n          //var visScaleRange = this._inVisibleRange(layerListLayer, key);\n          var visScaleRange = layerListLayer.visScaleRange;\n          var c = dom.byId(\"recLabel_\" + key);\n          if (!lo.visible) {\n            if (domClass.contains(\"recIcon_\" + key, \"active\")) {\n              domClass.remove(\"recIcon_\" + key, \"active\");\n            }\n            if (this.config.countEnabled) {\n              if (domClass.contains(\"recNum_\" + key, \"recNum\")) {\n                domClass.remove(\"recNum_\" + key, \"recNum\");\n                domClass.add(\"recNum_\" + key, \"recNumInActive\");\n              }\n            }\n            if (c && c.firstChild) {\n              domClass.add(c.firstChild, \"inActive\");\n            }\n            if (!layerListLayer.listDisabled) {\n              if (!domClass.contains(\"exp_\" + key, \"expandInActive\")) {\n                domClass.add(\"exp_\" + key, \"expandInActive\");\n              }\n              layerListLayer.toggleLegend.remove();\n            }\n            if (domClass.contains(\"rec_\" + key, \"rec\")) {\n              domClass.add(\"rec_\" + key, \"recDefault\");\n            }\n          } else {\n            if (!domClass.contains(\"recIcon_\" + key, \"active\")) {\n              domClass.add(\"recIcon_\" + key, \"active\");\n            }\n            if (this.config.countEnabled) {\n              if (domClass.contains(\"recNum_\" + key, \"recNumInActive\")) {\n                domClass.remove(\"recNum_\" + key, \"recNumInActive\");\n                domClass.add(\"recNum_\" + key, \"recNum\");\n              }\n            }\n            if (c && c.firstChild) {\n              domClass.remove(c.firstChild, \"inActive\");\n            }\n            if (!layerListLayer.listDisabled) {\n              if (typeof visScaleRange === 'undefined' || visScaleRange) {\n                if (domClass.contains(\"exp_\" + key, \"expandInActive\")) {\n                  domClass.remove(\"exp_\" + key, \"expandInActive\");\n                }\n              }\n            }\n            if (domClass.contains(\"rec_\" + key, \"recDefault\")) {\n              domClass.remove(\"rec_\" + key, \"recDefault\");\n            }\n          }\n        }\n      }\n    },\n\n    enableRefresh: function enableRefresh() {\n      //set refreshItereval on all widget source layers that support it\n      var layerListLayer = null;\n      var checkedTime = false;\n      for (var key in this.layerList) {\n        var id;\n        layerListLayer = this.layerList[key];\n        if (layerListLayer.li) {\n          id = layerListLayer.li.itemId;\n        }\n        if (layerListLayer.type !== \"ClusterLayer\") {\n          layerListLayer = layerListLayer.layerObject;\n        } else {\n          for (var i = 0; i < this.layerInfos.length; i++) {\n            var l = this.layerInfos[i];\n            if (l.layerObject) {\n              layerListLayer = l.layerObject;\n              break;\n            }\n          }\n        }\n        if (!checkedTime && id) {\n          this.getItem(id);\n          checkedTime = true;\n        }\n        if (layerListLayer) {\n          layerListLayer.refreshInterval = this.config.refreshInterval;\n        }\n      }\n\n      var tempVal = this.config.refreshInterval * 60000;\n      if (this.refreshInterval === 0 && this.refreshIntervalValue === 0) {\n        //set the refresh interval based on the configs interval value\n        this.refreshIntervalValue = tempVal;\n        this.refreshInterval = setInterval(lang.hitch(this, this.refreshLayers), this.refreshIntervalValue);\n      } else if (this.refreshIntervalValue !== 0 && this.refreshIntervalValue !== tempVal) {\n        //clear and update the refresh interval if the configs refresh interval has changed\n        this.refreshIntervalValue = tempVal;\n        clearInterval(this.refreshInterval);\n        this.refreshInterval = 0;\n        this.refreshInterval = setInterval(lang.hitch(this, this.refreshLayers), this.refreshIntervalValue);\n      }\n    },\n\n    getItem: function getItem(id) {\n      var portalUrl = window.portalUrl.substr(-1) !== '/' ? window.portalUrl += '/' : window.portalUrl;\n      var url = portalUrl + \"sharing/rest/content/items/\" + id;\n      esriRequest({\n        url: url,\n        content: {\n          f: \"json\",\n          requestTime: Date.now()\n        }\n      }).then(lang.hitch(this, function (response) {\n        if (response) {\n          var itemModified = response.modified;\n          var update = true;\n          if (this.lastModifiedTime) {\n            update = this.lastModifiedTime < itemModified;\n          }\n          if (this.currentQueryList.indexOf(id) > -1) {\n            this.currentQueryList.splice(this.currentQueryList.indexOf(id), 1);\n          }\n          if (update) {\n            this.lastModifiedTime = itemModified;\n            this._updatePanelTime(itemModified);\n            esriRequest({\n              url: url + '/data',\n              content: {\n                f: \"json\",\n                requestTime: Date.now()\n              }\n            }).then(lang.hitch(this, this._updateItem, id));\n          }\n        }\n      }));\n    },\n\n    _updatePanelTime: function _updatePanelTime(modifiedTime) {\n      if (!this.hidePanel) {\n        this.lastUpdated.innerHTML = \"<div></div>\";\n        var _d = new Date(modifiedTime);\n        var _f = { dateFormat: 'shortDateShortTime' };\n        this.lastUpdated.innerHTML = utils.fieldFormatter.getFormattedDate(_d, _f);\n      }\n    },\n\n    refreshLayers: function refreshLayers() {\n      for (var key in this.layerList) {\n        var lyr = this.layerList[key];\n        var id;\n        if (lyr.li && lyr.li.itemId) {\n          id = lyr.li.itemId;\n        } else if (lyr.layerObject.itemId) {\n          id = lyr.layerObject.itemId;\n        }\n\n        if (id) {\n          if (this.currentQueryList.indexOf(id) === -1) {\n            this.currentQueryList.push(id);\n            this.getItem(id);\n          }\n        }\n      }\n    },\n\n    _updateItem: function _updateItem(id, response) {\n      var featureCollection = response;\n      for (var i = 0; i < featureCollection.layers.length; i++) {\n        this._updateLayerItem(featureCollection.layers[i], this.lastModifiedTime);\n      }\n      this.currentQueryList.splice(this.currentQueryList.indexOf(id), 1);\n    },\n\n    //TDOO ensure this functions as expected when filter by map extent id disabled\n    _updateLayerItem: function _updateLayerItem(responseLayer) {\n      var layerListLayer;\n      var parentLayer;\n      var list, fields;\n      for (var k in this.layerList) {\n        var lyr = this.layerList[k];\n        if (lyr.pl && lyr.pl.layerDefinition) {\n          if (lyr.pl.layerDefinition.name === responseLayer.layerDefinition.name) {\n            layerListLayer = lyr;\n            parentLayer = lyr.pl;\n            break;\n          }\n        } else if (lyr.layerObject._parentLayer) {\n          if (lyr.layerObject._parentLayer.name === responseLayer.layerDefinition.name) {\n            list = typeof lyr.listDisabled !== 'undefined' ? lyr.listDisabled : false;\n            fields = lyr.li.symbolData.featureDisplayOptions.fields && lyr.li.symbolData.featureDisplayOptions.fields.length > 0;\n            if (!list && fields) {\n              lyr.isLoaded = false;\n            }\n            lyr.layerObject.refreshFeatures(responseLayer);\n            if (lyr.layerObject) {\n              this._loadList(lyr, true);\n            }\n          }\n        } else if (lyr.pl && lyr.pl.name) {\n          if (lyr.pl.name === responseLayer.layerDefinition.name) {\n            layerListLayer = lyr;\n            parentLayer = lyr.pl;\n            break;\n          }\n        }\n      }\n\n      if (responseLayer && layerListLayer && parentLayer && (parentLayer.featureSet || parentLayer.graphics)) {\n        var responseFeatureSetFeatures = responseLayer.featureSet.features;\n\n        var mapFeatureSetFeatures;\n        if (parentLayer.featureSet) {\n          mapFeatureSetFeatures = parentLayer.featureSet.features;\n        } else {\n          mapFeatureSetFeatures = [];\n          var responseSR = this._getSpatialReference(responseFeatureSetFeatures);\n          var mapSR = this._getSpatialReference(parentLayer.graphics);\n          array.forEach(parentLayer.graphics, function (gra) {\n            var g = gra.geometry;\n            var geom = g.rings ? { rings: g.rings } : g.paths ? { paths: g.paths } : g.points ? { points: g.points } : g.x && g.y ? { x: g.x, y: g.y } : {};\n            if (geom !== {}) {\n              mapFeatureSetFeatures.push({\n                attributes: gra.attributes,\n                geometry: lang.mixin({\n                  spatialReference: responseSR && mapSR && responseSR.wkid === mapSR.wkid ? responseSR : mapSR\n                }, geom)\n              });\n            }\n          });\n        }\n\n        if (responseLayer.featureSet.transform) {\n          var fs = new FeatureSet(responseLayer.featureSet);\n          responseFeatureSetFeatures = fs.features;\n        }\n\n        var shouldUpdate = true;\n        //TODO Figure out a better test for larger responses\n        if (responseFeatureSetFeatures.length < 10000) {\n          shouldUpdate = JSON.stringify(mapFeatureSetFeatures) !== JSON.stringify(responseFeatureSetFeatures);\n        }\n\n        if (shouldUpdate) {\n          list = typeof layerListLayer.listDisabled !== 'undefined' ? layerListLayer.listDisabled : false;\n          fields = layerListLayer.li.symbolData.featureDisplayOptions.fields && layerListLayer.li.symbolData.featureDisplayOptions.fields.length > 0;\n          if (!list && fields) {\n            layerListLayer.isLoaded = false;\n            layerListLayer.requiresReload = true;\n          }\n          if (list) {\n            layerListLayer.li.layerListExtentChanged = true;\n          }\n          layerListLayer.layerObject.clear();\n          var sr = layerListLayer.layerObject.spatialReference;\n          for (var j = 0; j < responseFeatureSetFeatures.length; j++) {\n            var item = responseFeatureSetFeatures[j];\n            if (item.geometry) {\n              //check li for renderer also\n              var go = this.getGraphicOptions(item, sr);\n              var gra = new Graphic(go);\n              //removed for https://devtopia.esri.com/WebGIS/arcgis-webappbuilder/issues/11551\n              //gra.setSymbol(go.symbol);\n              gra.setAttributes(item.attributes);\n              if (this._infoTemplate) {\n                gra.setInfoTemplate(this._infoTemplate);\n              }\n              layerListLayer.layerObject.add(gra);\n            } else {\n              console.log(\"Null geometry skipped\");\n            }\n          }\n          layerListLayer.layerObject.refresh();\n          if (parentLayer.featureSet) {\n            parentLayer.featureSet.features = responseFeatureSetFeatures;\n          }\n          this.countFeatures(layerListLayer);\n          if (layerListLayer.layerObject && layerListLayer.layerObject.visible) {\n            this._loadList(layerListLayer, true);\n          }\n        }\n      }\n    },\n\n    _getSpatialReference: function _getSpatialReference(features) {\n      var sr;\n      if (features && features.hasOwnProperty('length') && features.length > 0) {\n        var firstFeature = features[0];\n        if (firstFeature.geometry && firstFeature.geometry.spatialReference) {\n          sr = firstFeature.geometry.spatialReference;\n        }\n      }\n      return sr;\n    },\n\n    getGraphicOptions: function getGraphicOptions(item, sr) {\n      var graphicOptions;\n      if (typeof item.geometry.rings !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            rings: item.geometry.rings,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else if (typeof item.geometry.paths !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            paths: item.geometry.paths,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else if (typeof item.geometry.points !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            points: item.geometry.points,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else {\n        graphicOptions = {\n          geometry: new Point(item.geometry.x, item.geometry.y, item.geometry.spatialReference)\n        };\n      }\n      return graphicOptions;\n    },\n\n    _initWidget: function _initWidget() {\n      this.hidePanel = typeof this.config.hidePanel !== 'undefined' ? this.config.hidePanel : false;\n      this.showAllFeatures = typeof this.config.showAllFeatures !== 'undefined' ? this.config.showAllFeatures : false;\n      if (this.map.itemId) {\n        LayerInfos.getInstance(this.map, this.map.itemInfo).then(lang.hitch(this, function (operLayerInfos) {\n          this.wmLayerInfos = operLayerInfos.getLayerInfoArrayOfWebmap();\n          this.layerInfos = operLayerInfos.getLayerInfoArray();\n          this.operLayerInfos = operLayerInfos;\n          this._updateLayerIDs();\n          if (this.config.upgradeFields) {\n            this._upgradeFields();\n          }\n          this._createPanelUI(this.configLayerInfos, operLayerInfos);\n          this._addFilterChanged(operLayerInfos);\n          this._addVisibleChanged(operLayerInfos);\n          this._addZoomChanged(operLayerInfos);\n        }));\n      }\n    },\n\n    _updateLayerIDs: function _updateLayerIDs() {\n      var removeIDs = [];\n\n      //added to make sure the url we have uses the proxy url\n      //issue: https://devtopia.esri.com/WebGIS/arcgis-webappbuilder/issues/11551\n      var getUrl = function getUrl(configLayer, jimuLayerInfo) {\n        return jimuLayerInfo.layerObject && jimuLayerInfo.layerObject.url ? jimuLayerInfo.layerObject.url : configLayer.url;\n      };\n\n      config_layer_loop: for (var i = 0; i < this.configLayerInfos.length; i++) {\n        var configLayer = this.configLayerInfos[i];\n        var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(configLayer.id);\n\n        //If we cannot find the jimu layer info based on the stored ID we need to determine it\n        if (!jimuLayerInfo) {\n          var updated = false;\n          wm_layer_loop: for (var ii = 0; ii < this.wmLayerInfos.length; ii++) {\n            var _opLayer = this.wmLayerInfos[ii];\n            var originOpLayer = _opLayer ? _opLayer.originOperLayer : undefined;\n\n            var urlId = this._compareURL(originOpLayer, configLayer);\n            var itemId = this._compareItemID(originOpLayer, configLayer);\n            var subId = this._compareSubId(_opLayer, configLayer);\n\n            var id = urlId ? urlId : itemId ? itemId : subId ? subId : undefined;\n            jimuLayerInfo = id ? this.operLayerInfos.getLayerInfoById(id) : jimuLayerInfo;\n\n            if (jimuLayerInfo) {\n              this.configLayerInfos[i].id = jimuLayerInfo.id;\n              this.configLayerInfos[i].layer = jimuLayerInfo.id;\n              this.configLayerInfos[i].url = getUrl(this.configLayerInfos[i], jimuLayerInfo);\n              updated = true;\n              break wm_layer_loop;\n            }\n          }\n\n          if (!updated && !jimuLayerInfo) {\n            removeIDs.push(i);\n          }\n        } else {\n          configLayer.url = getUrl(configLayer, jimuLayerInfo);\n        }\n      }\n\n      //This needs to occur largest to smallest\n      if (removeIDs.length > 0) {\n        //removeIDs.sort((a, b) => (b - a));\n        removeIDs.sort(function (a, b) {\n          return b - a;\n        });\n        array.forEach(removeIDs, lang.hitch(this, function (id) {\n          this.configLayerInfos.splice(id, 1);\n        }));\n      }\n    },\n\n    _compareSubId: function _compareSubId(opLayer, configLayer) {\n      if (opLayer && opLayer.subId && opLayer.subId.indexOf(configLayer.id) > -1) {\n        if (opLayer.layerObject) {\n          var geomMatch = this._compareGeom(opLayer.layerObject, configLayer);\n          var fieldMatch = this._compareFields(opLayer.layerObject, configLayer);\n          if (geomMatch && fieldMatch) {\n            return opLayer.subId;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    _compareItemID: function _compareItemID(originOpLayer, configLayer) {\n      if (originOpLayer && originOpLayer.itemId && originOpLayer.itemId === configLayer.itemId) {\n        if (originOpLayer.featureCollection && originOpLayer.featureCollection.layers && originOpLayer.featureCollection.layers.hasOwnProperty('length')) {\n          var fcLayers = originOpLayer.featureCollection.layers;\n          for (var i = 0; i < fcLayers.length; i++) {\n            var fcLayer = fcLayers[i];\n            if (this._compareGeom(fcLayer, configLayer)) {\n              if (this._compareFields(fcLayer, configLayer)) {\n                return fcLayer.id;\n              }\n            }\n          }\n          return undefined;\n        } else {\n          console.log('error in checking item by itemID');\n        }\n      }\n    },\n\n    _compareURL: function _compareURL(originOpLayer, configLayer) {\n      return originOpLayer && originOpLayer.url && configLayer.url && originOpLayer.url === configLayer.url ? originOpLayer.id : undefined;\n    },\n\n    _compareGeom: function _compareGeom(layerObject, configLayer) {\n      return layerObject && layerObject.geometryType && configLayer.geometryType ? layerObject.geometryType === configLayer.geometryType : undefined;\n    },\n\n    _compareFields: function _compareFields(layerObject, configLayer) {\n      var fieldMatch;\n      if (layerObject && layerObject.fields && configLayer.fields && layerObject.fields.length === configLayer.fields.length) {\n        //test if Names match\n        var matchingFields = layerObject.fields.filter(function (f) {\n          for (var fn = 0; fn < configLayer.fields.length; fn++) {\n            var configField = configLayer.fields[fn];\n            if (f.name === configField.name) {\n              return f;\n            }\n          }\n        });\n        fieldMatch = matchingFields.length === layerObject.fields.length;\n      }\n      return fieldMatch;\n    },\n\n    //added for backwards compatability\n    //could not handle directly in VersionManager as some stored layerInfos\n    // do not have a valid infoTemplate saved\n    _upgradeFields: function _upgradeFields() {\n      if (this.configLayerInfos) {\n        for (var i = 0; i < this.configLayerInfos.length; i++) {\n          var li = this.configLayerInfos[i];\n          if (li && li.symbolData && li.symbolData.featureDisplayOptions) {\n            var lyrInfo = this.operLayerInfos.getLayerInfoById(li.id);\n            if (lyrInfo) {\n              var fields = li.symbolData.featureDisplayOptions.fields;\n              //At previous releases we would use the first field from the infoTemplate or\n              //the first non-OID field from the layer if no fields were selected by the user\n              if (typeof fields === 'undefined' || fields.hasOwnProperty('length') && fields.length === 0) {\n                //check layer fields\n                var layerObject = lyrInfo && lyrInfo.layerObject ? lyrInfo.layerObject : undefined;\n                var oidFieldName = layerObject && layerObject.objectIdField ? layerObject.objectIdField : undefined;\n                var firstLayerFieldName = \"\";\n                var firstLayerFieldAlias = \"\";\n                var layerFields = li.fields ? li.fields : layerObject ? layerObject.fields : undefined;\n                if (layerFields && layerFields.length > 0) {\n                  layer_field_loop: for (var _i = 0; _i < layerFields.length; _i++) {\n                    var f = layerFields[_i];\n                    if (firstLayerFieldName === \"\" && f.type !== \"esriFieldTypeOID\" && f.type !== \"esriFieldTypeGeometry\" && f.name !== oidFieldName) {\n                      firstLayerFieldName = f.name;\n                      firstLayerFieldAlias = f.alias || f.name;\n                    }\n                    if (!oidFieldName) {\n                      oidFieldName = f.type === \"esriFieldTypeOID\" ? f.name : oidFieldName;\n                    }\n                    if (oidFieldName && firstLayerFieldName !== \"\") {\n                      break layer_field_loop;\n                    }\n                  }\n                }\n\n                //check popup fields\n                var keyFieldName = \"\";\n                var keyFieldAlias = \"\";\n                var infoTemplate = li.infoTemplate && li.infoTemplate.info && li.infoTemplate.info.fieldInfos ? li.infoTemplate : lyrInfo ? lyrInfo.getInfoTemplate() : undefined;\n                if (!infoTemplate) {\n                  var subLayers = lyrInfo.getSubLayers();\n                  sub_layers_loop: for (var sli = 0; sli < subLayers.length; sli++) {\n                    var sl = subLayers[sli];\n                    if (sl.title && sl.layerObject && sl.layerObject.name && sl.title === sl.layerObject.name) {\n                      infoTemplate = sl.getInfoTemplate ? sl.getInfoTemplate() : infoTemplate;\n                      break sub_layers_loop;\n                    }\n                  }\n                }\n                var popupFields = infoTemplate ? infoTemplate.info.fieldInfos : [];\n                popup_field_loop: for (var j = 0; j < popupFields.length; j++) {\n                  var popupField = popupFields[j];\n                  if (popupField && popupField.visible) {\n                    if (!oidFieldName || oidFieldName !== popupField.fieldName) {\n                      keyFieldName = popupField.fieldName;\n                      keyFieldAlias = popupField.label || popupField.fieldName;\n                      break popup_field_loop;\n                    }\n                  }\n                }\n\n                //update the config\n                this.configLayerInfos[i].symbolData.featureDisplayOptions.fields = [{\n                  name: keyFieldName ? keyFieldName : firstLayerFieldName,\n                  label: keyFieldName ? keyFieldAlias : firstLayerFieldAlias\n                }];\n              }\n            }\n          }\n        }\n      }\n    },\n\n    _addFilterChanged: function _addFilterChanged(layerInfos) {\n      if (parseFloat(this.appConfig.wabVersion) >= 2.1) {\n        this.own(layerInfos.on('layerInfosFilterChanged', lang.hitch(this, function (changedLayerInfoArray) {\n          array.forEach(changedLayerInfoArray, lang.hitch(this, function (layerInfo) {\n            var id = layerInfo.id;\n            var clId = layerInfo.id + this.UNIQUE_APPEND_VAL_CL;\n            if (this.layerList.hasOwnProperty(id)) {\n              this.layerList[id].filter = layerInfo.getFilter();\n            } else if (this.layerList.hasOwnProperty(clId)) {\n              this.layerList[clId].layerObject.filter = layerInfo.getFilter();\n              this.layerList[clId].layerObject._initFeatures();\n            }\n          }));\n        })));\n      }\n    },\n\n    _updateVisibility: function _updateVisibility(layerInfo) {\n      if (layerInfo) {\n        var id = layerInfo.id;\n        var vis = layerInfo.isShowInMap();\n        if (this.layerList.hasOwnProperty(id)) {\n          var lyr = this.layerList[id];\n          if (id === lyr.li.id && lyr.visible !== vis) {\n            this._toggleLayerUI(lyr.li, vis);\n          } else if (id === lyr.id && lyr.visible !== vis) {\n            this._toggleLayerUI(layerInfo, vis);\n          }\n        }\n      }\n    },\n\n    _addVisibleChanged: function _addVisibleChanged(layerInfos) {\n      this.own(layerInfos.on('layerInfosIsVisibleChanged', lang.hitch(this, function (changedLayerInfos) {\n        array.forEach(changedLayerInfos, function (layerInfo) {\n          this._updateVisibility(layerInfo);\n        }, this);\n      })));\n    },\n\n    _addZoomChanged: function _addZoomChanged(layerInfos) {\n      this.own(on(this.map, 'zoom-end', lang.hitch(this, function () {\n        layerInfos.traversal(lang.hitch(this, function (layerInfo) {\n          this._updateVisibility(layerInfo);\n        }));\n      })));\n    },\n\n    _updatePanelHeader: function _updatePanelHeader() {\n      var panelTitle;\n      var w = this.map.width;\n      if (this.config.displayPanelIcon && w > 750) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n\n          if (this.config.refreshEnabled) {\n            if (this.config.mainPanelText !== \"\") {\n              html.addClass(this.pageHeader, \"pageHeaderRefresh\");\n            } else {\n              html.addClass(this.pageHeader, \"pageHeaderRefreshNoText\");\n            }\n          } else {\n            html.addClass(this.pageHeader, \"pageHeader\");\n          }\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          if (this.config.refreshEnabled) {\n            if (this.config.mainPanelText !== \"\") {\n              html.addClass(this.pageBody, \"pageBodyRefresh\");\n            } else {\n              html.addClass(this.pageBody, \"pageBodyRefreshNoText\");\n            }\n          } else {\n            html.addClass(this.pageBody, \"pageBody\");\n          }\n        }\n\n        if (this.pageTitle) {\n          html.addClass(this.pageTitle, \"pageTitleWidth\");\n          if (this.config.refreshEnabled) {\n            html.removeClass(this.pageTitle, \"pageTitle\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh-tab\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh\");\n            html.addClass(this.pageTitle, this.useDarkText ? \"pageTitleRefresh-tab\" : \"pageTitleRefresh\");\n          } else {\n            html.removeClass(this.pageTitle, \"pageTitleRefresh\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh-tab\");\n            html.addClass(this.pageTitle, \"pageTitle\");\n          }\n        }\n\n        panelTitle = this.config.mainPanelText;\n        if (typeof panelTitle === 'undefined') {\n          panelTitle = \"\";\n        }\n        this.pageTitle.innerHTML = panelTitle;\n        this.panelMainIcon.innerHTML = this.config.mainPanelIcon;\n      } else if (!this.config.displayPanelIcon && !this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n          html.addClass(this.pageHeader, \"pageHeaderNoIcon\");\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBody\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          html.addClass(this.pageBody, \"pageBodyNoIcon\");\n        }\n        this.pageTitle.innerHTML = \"<div></div>\";\n        this.panelMainIcon.innerHTML = \"<div></div>\";\n      } else if (!this.config.displayPanelIcon && this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.addClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBody\");\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.addClass(this.pageBody, \"pageBodyNoIconRefresh\");\n        }\n\n        if (this.pageTitle) {\n          html.removeClass(this.pageTitle, \"pageTitleWidth\");\n        }\n        this.pageTitle.innerHTML = \"<div></div>\";\n        this.panelMainIcon.innerHTML = \"<div></div>\";\n      } else if (this.config.displayPanelIcon && w <= 750 && this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          if (this.config.mainPanelText !== \"\") {\n            html.addClass(this.pageHeader, \"pageHeaderRefresh\");\n          } else {\n            html.addClass(this.pageHeader, \"pageHeaderRefreshNoText\");\n          }\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          html.removeClass(this.pageBody, \"pageBody\");\n          if (this.config.mainPanelText !== \"\") {\n            html.addClass(this.pageBody, \"pageBodyRefresh\");\n          } else {\n            html.addClass(this.pageBody, \"pageBodyRefreshNoText\");\n          }\n        }\n\n        if (this.pageTitle) {\n          html.addClass(this.pageTitle, \"pageTitleWidth\");\n        }\n\n        panelTitle = this.config.mainPanelText;\n        if (typeof panelTitle === 'undefined') {\n          panelTitle = \"\";\n        }\n        this.pageTitle.innerHTML = panelTitle;\n      }\n    },\n\n    _createPanelUI: function _createPanelUI(configLayerInfos, jimuLayerInfos) {\n      this.numClusterLayers = 0;\n\n      if (!this.hidePanel) {\n        this._updatePanelHeader();\n        this._updateUI(null);\n        this._clearChildNodes(this.pageMain);\n        this.updateEnd = [];\n      }\n\n      for (var i = 0; i < configLayerInfos.length; i++) {\n        var lyrInfo = configLayerInfos[i];\n        if (lyrInfo.symbolData.clusterType === 'ThemeCluster') {\n          this.updateThemeClusterSymbol(lyrInfo, i);\n        }\n\n        var jimuLayerInfo = jimuLayerInfos.getLayerInfoById(lyrInfo.id);\n        if (jimuLayerInfo) {\n          jimuLayerInfo.getLayerType().then(lang.hitch(this, function (layerType) {\n            jimuLayerInfo.getLayerObject().then(lang.hitch(this, function (layerObject) {\n              this.updateLayerList(layerObject, lyrInfo, layerType, jimuLayerInfo);\n            }));\n          }));\n        }\n      }\n\n      if (!this.hidePanel) {\n        for (var k in this.layerList) {\n          var lyr = this.layerList[k];\n          if (lyr.type !== \"ClusterLayer\") {\n            if (lyr && lyr.layerObject) {\n              if (lyr.layerObject.hasOwnProperty('refreshInterval') && lyr.layerObject.refreshInterval > 0) {\n                this.updateEnd.push(this.own(on(lyr.layerObject, \"update-end\", lang.hitch(this, this._updateEnd))));\n              }\n            }\n          }\n        }\n      }\n      this.addMapLayers();\n    },\n\n    _updateEnd: function _updateEnd(results) {\n      var lid = this.layerList.hasOwnProperty(results.target.id) ? results.target.id : this.layerList.hasOwnProperty(results.target.id + \"_CL\") ? results.target.id + \"_CL\" : \"\";\n\n      //For map service with sub layers...the results ID is for the parent layer\n      if (lid === \"\") {\n        for (var i in this.layerList) {\n          var l = this.layerList[i];\n          if (l && l.layerObject && l.layerObject.id === results.target.id) {\n            lid = l.li.id;\n            break;\n          }\n        }\n      }\n      if (this.layerList.hasOwnProperty(lid)) {\n        var lyr = this.layerList[lid];\n        lyr.isLoaded = false;\n        lyr.updating = false;\n        lyr.requiresReload = true;\n        if (lyr) {\n          if (lyr.legendOpen) {\n            this._loadList(lyr, this.config.countEnabled);\n          } else if (this.config.countEnabled) {\n            this.countFeatures(lyr);\n          }\n        }\n      }\n    },\n\n    updateThemeClusterSymbol: function updateThemeClusterSymbol(lyrInfo, i) {\n      var sd = lyrInfo.symbolData;\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        if (typeof this._styleColor === 'undefined') {\n          this._updateStyleColor(this.appConfig.theme.styles[0]);\n        }\n      }\n      if (this._styleColor) {\n        var _rgb = dojoColor.fromHex(this._styleColor);\n        var x = i + 1;\n        var xx = x > 0 ? x * 30 : 30;\n        var evenOdd = x % 2 === 0;\n        var r = _rgb.r;\n        var g = _rgb.g;\n        var b = _rgb.b;\n\n        var rr = r - xx;\n        if (evenOdd) {\n          if (rr > 255) {\n            rr = rr - 255;\n          } else if (rr < 0) {\n            rr = rr + 255;\n          }\n        }\n\n        var bb = b - xx;\n        if (x % 3 === 0) {\n          if (evenOdd) {\n            if (bb > 255) {\n              bb = bb - 255;\n            } else if (bb < 0) {\n              bb = bb + 255;\n            }\n          }\n        }\n\n        var gg = g - xx;\n        if (x % 5 === 0) {\n          if (evenOdd) {\n            if (gg > 255) {\n              gg = gg - 255;\n            } else if (gg < 0) {\n              gg = gg + 255;\n            }\n          }\n        }\n        sd.clusterType = 'CustomCluster';\n        sd.clusterSymbol = {\n          color: [rr, gg, bb, 1],\n          outline: {\n            color: [0, 0, 0, 0],\n            width: 0,\n            type: \"esriSLS\",\n            style: \"esriSLSNull\"\n          },\n          type: \"esriSFS\",\n          style: \"esriSFSSolid\"\n        };\n      }\n    },\n\n    removeOldClusterLayers: function removeOldClusterLayers(lInfos) {\n      //check if the widget was previously configured\n      // with a layer that it no longer consumes...if so remove it\n      var deleteLayers = [];\n      for (var id in this.layerList) {\n        var l = this.layerList[id];\n        if (l.type === \"ClusterLayer\") {\n          layer_info_loop: for (var i = 0; i < lInfos.length; i++) {\n            var lo = lInfos[i];\n            var potentialNewClusterID = lo.id + this.UNIQUE_APPEND_VAL_CL;\n            if (potentialNewClusterID === id) {\n              if (lo.symbolData && !lo.symbolData.clusteringEnabled) {\n                deleteLayers.push(id);\n              }\n              break layer_info_loop;\n            }\n          }\n        }\n      }\n      if (deleteLayers.length > 0) {\n        for (var dl in deleteLayers) {\n          if (this.layerList.hasOwnProperty(deleteLayers[dl])) {\n            if (this.map.graphicsLayerIds.indexOf(deleteLayers[dl]) > -1) {\n              var _dl = this.layerList[deleteLayers[dl]];\n              if (_dl && _dl.li) {\n                var jimuLayerInfo;\n                if (_dl.li.parentLayerID) {\n                  jimuLayerInfo = this.operLayerInfos.getLayerInfoById(_dl.li.parentLayerID);\n                }\n                if (!jimuLayerInfo && _dl.li.layer) {\n                  jimuLayerInfo = this.operLayerInfos.getLayerInfoById(_dl.li.layer);\n                }\n                if (jimuLayerInfo && _dl.hasOwnProperty('parentLayerVisible')) {\n                  jimuLayerInfo.setTopLayerVisible(_dl.parentLayerVisible);\n                }\n              }\n              this.map.removeLayer(this.layerList[deleteLayers[dl]].layerObject);\n            }\n            this.layerList[deleteLayers[dl]].layerObject.destroy();\n            delete this.layerList[deleteLayers[dl]];\n          }\n        }\n      }\n    },\n\n    addMapLayers: function addMapLayers() {\n      var ids = Object.keys(this.layerList).reverse();\n      for (var i = 0; i < ids.length; i++) {\n        var id = ids[i];\n        var l = this.layerList[id];\n        if (l.type && l.type === \"ClusterLayer\") {\n          if (this.map.graphicsLayerIds.indexOf(id) === -1) {\n            this.map.addLayer(l.layerObject);\n          }\n        }\n      }\n    },\n\n    updateLayerList: function updateLayerList(lyr, lyrInfo, lyrType, jimuLayerInfo) {\n      var l,\n          ll = null;\n      var type, id, layerObject, pl;\n\n      jimuLayerInfo = jimuLayerInfo || this.operLayerInfos.getLayerInfoById(lyr.id);\n\n      var selfType = this._checkSelfType(jimuLayerInfo, lyrInfo, lyrType, lyr);\n      var listDisabled = this._checkListDisabled(lyrInfo);\n\n      //Handle cluster layers\n      if (lyrInfo.symbolData.clusteringEnabled) {\n        l = this._getClusterLayer(lyrInfo, lyr, jimuLayerInfo, lyrType);\n        type = \"ClusterLayer\";\n        layerObject = l;\n        id = l.id;\n        if (!this.hidePanel) {\n          this.own(on(l, \"update-end\", lang.hitch(this, function () {\n            this._loadList(this.layerList[l.id], true);\n          })));\n        }\n        this.numClusterLayers += 1;\n      } else {\n        if (lyr.layerType === \"ArcGISStreamLayer\") {\n          type = \"StreamLayer\";\n          id = lyr.layerObject.id;\n          layerObject = lyr.layerObject;\n          pl = lyr;\n        } else {\n          id = lyrType === \"FeatureLayer\" ? lyrInfo.id : lyr.id;\n          var parentLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.parentLayerID) || lyr.parentLayerInfo;\n          if (parentLayerInfo) {\n            if (parentLayerInfo.layerObject) {\n              ll = parentLayerInfo.layerObject;\n              type = ll.type;\n              if (parentLayerInfo.originOperLayer && parentLayerInfo.originOperLayer.featureCollection) {\n                var layers = parentLayerInfo.originOperLayer.featureCollection.layers;\n                if (layers) {\n                  for (var j = 0; j < layers.length; j++) {\n                    var _lyr = layers[j];\n                    if (_lyr.id === id) {\n                      pl = _lyr;\n                    }\n                  }\n                }\n              }\n            }\n          }\n          l = lyr.layerObject ? lyr.layerObject : lyr;\n          type = lyrType;\n          layerObject = ll && !ll.empty ? ll : l ? l : lyr;\n          if (selfType === 'geo_rss' && layerObject && layerObject.getFeatureLayers) {\n            var featureLayers = layerObject.getFeatureLayers();\n            for (var i = 0; i < featureLayers.length; i++) {\n              var fl = featureLayers[i];\n              if (fl.id === lyrInfo.id) {\n                layerObject = fl;\n              }\n            }\n          }\n          pl = pl ? pl : lyr;\n        }\n      }\n\n      this.layerList[id] = {\n        type: type,\n        layerObject: layerObject,\n        pl: pl,\n        id: id,\n        visible: jimuLayerInfo && jimuLayerInfo.isShowInMap ? jimuLayerInfo.isShowInMap() : true,\n        li: lyrInfo,\n        filter: jimuLayerInfo ? jimuLayerInfo.getFilter() : \"1=1\",\n        infoTemplate: jimuLayerInfo.getInfoTemplate() || lyrInfo.infoTemplate,\n        selfType: selfType,\n        listDisabled: listDisabled,\n        showAllFeatures: this.showAllFeatures\n      };\n\n      if (lyr.layerType !== \"ArcGISStreamLayer\") {\n        this.updateRenderer(id);\n      }\n\n      if (!this.hidePanel) {\n        this._addPanelItem(ll ? ll : l ? l : lyr, lyrInfo, listDisabled, jimuLayerInfo);\n      }\n    },\n\n    _checkListDisabled: function _checkListDisabled(lyrInfo) {\n      return lyrInfo.symbolData.featureDisplayOptions.listDisabled ? lyrInfo.symbolData.featureDisplayOptions.listDisabled : lyrInfo.symbolData.featureDisplayOptions.fields ? lyrInfo.symbolData.featureDisplayOptions.fields.length === 0 : true;\n    },\n\n    _checkSelfType: function _checkSelfType(jimuLayerInfo, lyrInfo, lyrType, lyr) {\n      var _lo = lyrInfo.layerObject && !lyrInfo.layerObject.empty ? lyrInfo.layerObject : lyr;\n      var originOpLayer = _lo && _lo.originOperLayer ? _lo.originOperLayer : lyr;\n\n      var selfType = jimuLayerInfo.originOperLayer && jimuLayerInfo.originOperLayer.selfType ? jimuLayerInfo.originOperLayer.selfType : originOpLayer && originOpLayer.selfType ? originOpLayer.selfType : '';\n\n      selfType = selfType && selfType !== '' ? selfType : originOpLayer && originOpLayer.layerType && originOpLayer.layerType === \"CSV\" ? \"collection\" : lyrType === \"Feature Collection\" ? \"collection\" : '';\n      if (!selfType && lyrType && lyrType === \"KML\") {\n        selfType = \"kml\";\n      }\n      return selfType;\n    },\n\n    updateRenderer: function updateRenderer(id) {\n      var l = this.layerList[id];\n      if (l.li.symbolData.symbolType !== 'LayerSymbol') {\n        if (typeof l.li.orgRenderer === 'undefined') {\n          if (l.layerObject.renderer) {\n            l.li.orgRenderer = l.layerObject.renderer;\n          } else {\n            l.li.orgRenderer = l.li.renderer;\n          }\n        }\n        var renderer = new SimpleRenderer(jsonUtils.fromJson(l.li.symbolData.symbol));\n        l.li.newRenderer = renderer;\n        if (l.layerObject.setRenderer) {\n          l.layerObject.setRenderer(renderer);\n        } else if (l.layerObject.setLayerDrawingOptions) {\n          var optionsArray = [];\n          var drawingOptions = new LayerDrawingOptions();\n          drawingOptions.renderer = renderer;\n          optionsArray[l.li.subLayerId] = drawingOptions;\n          l.layerObject.setLayerDrawingOptions(optionsArray);\n        } else {\n          console.log(\"Error setting the new renderer...will use the default rendering of the layer\");\n        }\n\n        if (typeof l.layerObject.refresh === 'function') {\n          l.layerObject.refresh();\n        }\n      }\n    },\n\n    _onRecNodeMouseover: function _onRecNodeMouseover(rec) {\n      domClass.add(rec, this.isDartTheme ? \"layer-row-mouseover-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"layer-row-mouseover-dashboard\" : \"layer-row-mouseover\");\n    },\n\n    _onRecNodeMouseout: function _onRecNodeMouseout(rec) {\n      domClass.remove(rec, this.isDartTheme ? \"layer-row-mouseover-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"layer-row-mouseover-dashboard\" : \"layer-row-mouseover\");\n    },\n\n    _addPanelItem: function _addPanelItem(layer, lyrInfo, listDisabled, jimuLayerInfo) {\n      var potentialNewID = lyrInfo.id + this.UNIQUE_APPEND_VAL_CL;\n      var id = lyrInfo.id in this.layerList ? lyrInfo.id : potentialNewID in this.layerList ? potentialNewID : '';\n      var lyr = this.layerList[id];\n      if (lyr) {\n        var lyrType = lyr.type;\n        var cssAry;\n        if (this.isDashboardTheme) {\n          cssAry = ['rec', 'expand', 'expandDown-dashboard', 'solidBorder'];\n        } else if (this.isDartTheme) {\n          cssAry = ['rec-dart', 'expand-dart', 'expandDown-dart', 'solidBorder-dart'];\n        } else {\n          cssAry = ['rec', 'expand', 'expandDown', 'solidBorder'];\n        }\n        var rec = domConstruct.create(\"div\", {\n          'class': cssAry[0] + \" \" + cssAry[3],\n          id: 'rec_' + id\n        }, this.pageMain);\n\n        var expandClass;\n        if (!listDisabled) {\n          this.own(on(rec, 'mouseover', lang.hitch(this, this._onRecNodeMouseover, rec)));\n          this.own(on(rec, 'mouseout', lang.hitch(this, this._onRecNodeMouseout, rec)));\n          expandClass = cssAry[1] + \" \" + cssAry[2];\n          if (jimuLayerInfo && jimuLayerInfo.isInScale) {\n            expandClass += jimuLayerInfo.isInScale() ? \"\" : \" expandInActive\";\n          }\n        } else {\n          html.setStyle(rec, \"cursor\", \"default\");\n          expandClass = 'expand-empty';\n        }\n        domConstruct.create(\"div\", {\n          'class': expandClass,\n          id: \"exp_\" + id\n        }, rec);\n\n        var recIcon = domConstruct.create(\"div\", {\n          'class': \"recIcon active\",\n          id: \"recIcon_\" + id\n        }, rec);\n\n        if (lyrInfo.panelImageData && lyrInfo.panelImageData.toString().indexOf('<img') > -1) {\n          var img = document.createElement('div');\n          img.innerHTML = lyrInfo.panelImageData;\n          var icon = new PictureMarkerSymbol(img.children[0].src, 26, 26);\n          lyrInfo.panelImageData = this._createImageDataDiv(icon, 44, 44, undefined, true).innerHTML;\n        }\n        recIcon.innerHTML = lyrInfo.panelImageData;\n        domStyle.set(recIcon.firstChild, \"border-radius\", \"41px\");\n\n        var recLabel;\n        var recNum;\n        if (this.config.countEnabled) {\n          recLabel = domConstruct.create(\"div\", {\n            'class': \"recLabel\",\n            id: \"recLabel_\" + id,\n            innerHTML: \"<p>\" + lyrInfo.label + \"</p>\"\n          }, rec);\n          html.setStyle(recLabel, \"top\", \"20px\");\n          recNum = domConstruct.create(\"div\", {\n            'class': \"recNum\",\n            id: \"recNum_\" + id,\n            innerHTML: \"\"\n          }, rec);\n        } else {\n          recLabel = domConstruct.create(\"div\", {\n            'class': \"recLabelNoCount\",\n            id: \"recLabel_\" + id,\n            innerHTML: \"<p>\" + lyrInfo.label + \"</p>\"\n          }, rec);\n        }\n\n        if (lyrType === \"ClusterLayer\") {\n          layer.node = recNum;\n          if (!listDisabled) {\n            this._addLegend(id, lyr);\n          }\n          layer._updateNode(layer.nodeCount);\n        } else if (lyrType === \"StreamLayer\") {\n          lyr.node = recNum;\n          this.countFeatures(lyr);\n          if (!listDisabled) {\n            this._addLegend(id, lyr);\n          }\n        } else {\n          lyr.node = recNum;\n          this._addLegend(id, lyr);\n        }\n\n        on(recIcon, \"click\", lang.hitch(this, this._toggleLayerVisibility, lyr));\n\n        if (!listDisabled) {\n          lyr.toggleLegend = on(rec, \"click\", lang.hitch(this, this._toggleLegend, lyr));\n        }\n      }\n    },\n\n    _addLegend: function _addLegend(id, layerListLayer) {\n      layerListLayer.legendOpen = this.row === null && this.config.expandList;\n      var _class = layerListLayer.legendOpen ? \"legendOn\" : \"legendOff\";\n      layerListLayer.legendNode = domConstruct.create(\"div\", {\n        \"class\": \"legendLayer \" + _class,\n        \"id\": \"legend_\" + id\n      }, this.pageMain);\n      if (layerListLayer.type === 'ClusterLayer') {\n        layerListLayer.layerObject.legendNode = layerListLayer.legendNode;\n      }\n      this.row = 'firstRowExpanded';\n    },\n\n    _getListFields: function _getListFields(lyr) {\n      var popupFields = [];\n      var infoTemp = this._getInfoTemplate(lyr);\n\n      var fieldInfos = infoTemp && infoTemp.info && infoTemp.info.fieldInfos ? infoTemp.info.fieldInfos : [];\n      array.forEach(fieldInfos, function (fieldInfo) {\n        if (fieldInfo.visible) {\n          popupFields.push(fieldInfo.fieldName);\n        }\n      });\n\n      var displayOptions = lyr.li.symbolData && lyr.li.symbolData.featureDisplayOptions ? lyr.li.symbolData.featureDisplayOptions : {};\n      var fields = displayOptions.fields || [];\n      array.forEach(fields, function (field) {\n        if (popupFields.indexOf(field.name) === -1) {\n          popupFields.push(field.name);\n        }\n      });\n      if (displayOptions.groupField) {\n        if (popupFields.indexOf(displayOptions.groupField.name) === -1) {\n          popupFields.push(displayOptions.groupField.name);\n        }\n      }\n\n      if (popupFields.length === 0 || typeof infoTemp === 'undefined') {\n        popupFields = ['*'];\n      }\n\n      if (popupFields[0] !== '*') {\n        if (lyr.layerObject && lyr.layerObject.objectIdField) {\n          if (popupFields.indexOf(lyr.layerObject.objectIdField) === -1) {\n            popupFields.push(lyr.layerObject.objectIdField);\n          }\n        }\n      }\n      return popupFields;\n    },\n\n    _loadList: function _loadList(lyr, updateCount) {\n      if (!this.hidePanel) {\n        var id = lyr.layerObject.id in this.layerList ? lyr.layerObject.id : lyr.li.id;\n        if (updateCount) {\n          this._addSearching(id);\n        }\n\n        var popupFields = this._getListFields(lyr);\n        if (lyr.type === \"ClusterLayer\") {\n          if (lyr.li.layerListExtentChanged) {\n            lyr.layerObject.clusterFeatures();\n            lyr.li.layerListExtentChanged = false;\n          }\n          var features = [];\n          if (lyr.layerObject.clusterGraphics || lyr.layerObject._features) {\n            if (this.showAllFeatures) {\n              features = lyr.layerObject._features;\n            } else {\n              var clusterGraphics = lyr.layerObject.clusterGraphics;\n              for (var z = 0; z < clusterGraphics.length; z++) {\n                var clusterGraphic = clusterGraphics[z];\n                if (clusterGraphic.graphics && clusterGraphic.graphics.length > 0) {\n                  for (var f = 0; f < clusterGraphic.graphics.length; f++) {\n                    var g = clusterGraphic.graphics[f];\n                    features.push(g);\n                  }\n                }\n              }\n            }\n            setTimeout(lang.hitch(this, function () {\n              this._updateList(features, lyr.legendNode, lyr.layerObject.node, popupFields, updateCount, lyr);\n            }), 100);\n          } else {\n            this._removeSearching(id, lyr.legendNode ? !domClass.contains(lyr.legendNode, 'legendOff') : true);\n          }\n        } else {\n          this.getFeatures(lyr, popupFields, updateCount);\n          return;\n        }\n      }\n    },\n\n    _addSearching: function _addSearching(id) {\n      var disabled = this.layerList[id].listDisabled;\n      var eD = disabled ? 'expand-empty' : this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n      var eU = disabled ? 'expand-empty' : this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n      var eS = disabled ? \"expandSearching-empty\" : \"expandSearching\";\n      if (domClass.contains(\"exp_\" + id, eD)) {\n        domClass.remove(\"exp_\" + id, eD);\n        domClass.add(\"exp_\" + id, eS);\n      }\n      if (domClass.contains(\"exp_\" + id, eU)) {\n        domClass.remove(\"exp_\" + id, eU);\n        domClass.add(\"exp_\" + id, eS);\n      }\n    },\n\n    _removeSearching: function _removeSearching(id, legendOpen) {\n      var disabled = this.layerList[id].listDisabled;\n      var eD = disabled ? 'expand-empty' : this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n      var eU = disabled ? 'expand-empty' : this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n      var eS = disabled ? \"expandSearching-empty\" : \"expandSearching\";\n      if (domClass.contains(\"exp_\" + id, eS)) {\n        domClass.remove(\"exp_\" + id, eS);\n        domClass.add(\"exp_\" + id, legendOpen ? eU : eD);\n      }\n    },\n\n    _getClusterLayer: function _getClusterLayer(lyrInfo, layer, jimuLayerInfo, lyrType) {\n      var lyr = layer.layerObject ? layer.layerObject : layer;\n      var infoTemplate = lyrInfo.infoTemplate;\n      var originOperLayer = lyr && lyr.originOperLayer ? lyr.originOperLayer : layer.parentLayerInfo ? layer.parentLayerInfo : jimuLayerInfo ? jimuLayerInfo.originOperLayer : undefined;\n      var clusterLayer = null;\n      var n;\n      var potentialNewID = lyrInfo.id + this.UNIQUE_APPEND_VAL_CL;\n      var configChange = true;\n      if (this.map.graphicsLayerIds.indexOf(potentialNewID) > -1 || this.map._layers.indexOf(potentialNewID) > -1) {\n        clusterLayer = this.map.getLayer(potentialNewID);\n\n        var reloadData = false;\n        var refreshData = false;\n\n        //update the symbol if it has changed\n        if (JSON.stringify(clusterLayer.symbolData) !== JSON.stringify(lyrInfo.symbolData)) {\n          clusterLayer.symbolData = lyrInfo.symbolData;\n          clusterLayer.countColor = lyrInfo.symbolData._highLightColor;\n          refreshData = true;\n        }\n\n        //update the icon if it has changed\n        n = domConstruct.toDom(lyrInfo.panelImageData);\n        if (JSON.stringify(clusterLayer.icon) !== JSON.stringify(n.src)) {\n          clusterLayer.icon = n.src;\n          refreshData = true;\n        }\n        domConstruct.destroy(n.id);\n\n        clusterLayer.displayFeatureCount = lyrInfo.symbolData.displayFeatureCount;\n\n        if (clusterLayer.refresh !== lyrInfo.refresh) {\n          clusterLayer.refresh = lyrInfo.refresh;\n          reloadData = true;\n        }\n\n        if (refreshData) {\n          clusterLayer._setupSymbols();\n        }\n\n        clusterLayer.countEnabled = this.config.countEnabled;\n        clusterLayer.hidePanel = this.hidePanel;\n\n        if (clusterLayer.showAllFeatures !== this.showAllFeatures) {\n          reloadData = true;\n          clusterLayer.showAllFeatures = this.showAllFeatures;\n        }\n        if (clusterLayer.listDisabled !== this.listDisabled) {\n          reloadData = true;\n          clusterLayer.listDisabled = this.listDisabled;\n        }\n\n        if (reloadData) {\n          if (clusterLayer.url) {\n            clusterLayer.refreshFeatures(clusterLayer.url);\n          }\n        } else if (refreshData) {\n          clusterLayer.clusterFeatures();\n        }\n      } else {\n        configChange = false;\n        clusterLayer = new ClusterLayer({\n          name: lyrInfo.label + this.UNIQUE_APPEND_VAL_CL,\n          id: potentialNewID,\n          map: this.map,\n          node: dom.byId(\"recNum_\" + potentialNewID),\n          legendNode: dom.byId(\"legend_\" + potentialNewID),\n          infoTemplate: typeof lyr.infoTemplate !== 'undefined' ? lyr.infoTemplate : infoTemplate,\n          refreshInterval: this.config.refreshInterval,\n          refreshEnabled: this.config.refreshEnabled,\n          parentLayer: lyr,\n          lyrInfo: lyrInfo,\n          lyrType: lyrType,\n          _styleColor: this._styleColor,\n          originOperLayer: originOperLayer,\n          countEnabled: this.config.countEnabled,\n          hidePanel: this.hidePanel,\n          filter: jimuLayerInfo ? jimuLayerInfo.getFilter() : \"1=1\",\n          showAllFeatures: this.showAllFeatures,\n          listDisabled: this.listDisabled\n        });\n      }\n      clusterLayer.setVisibility(configChange ? clusterLayer.visible : jimuLayerInfo.isShowInMap ? jimuLayerInfo.isShowInMap() : true);\n      return clusterLayer;\n    },\n\n    _createImageDataDiv: function _createImageDataDiv(sym, w, h, parent, isCustom) {\n      var a;\n      var symbol = sym;\n      if (symbol) {\n        //TODO are these switched??\n        var height = w;\n        var width = h;\n        if (symbol.height && symbol.width) {\n          var ar;\n          if (symbol.height > symbol.width) {\n            ar = symbol.width / symbol.height;\n            width = w * ar;\n          } else if (symbol.width === symbol.height || symbol.width > symbol.height) {\n            width = w;\n            ar = symbol.width / symbol.height;\n            height = ar > 0 ? h * ar : h;\n          }\n        }\n        if (typeof symbol.setWidth !== 'undefined') {\n          if (typeof symbol.setHeight !== 'undefined') {\n            symbol.setWidth(isCustom ? width - width * 0.25 : width);\n            symbol.setHeight(isCustom ? height - height * 0.25 : height);\n          } else {\n            symbol.setWidth(2);\n          }\n        } else if (typeof symbol.size !== 'undefined') {\n          if (symbol.size > 20) {\n            symbol.setSize(20);\n          }\n        }\n        a = domConstruct.create(\"div\", { 'class': \"imageDataGFX\" }, parent);\n        var mySurface = gfx.createSurface(a, w, h);\n        var descriptors = jsonUtils.getShapeDescriptors(symbol);\n        var shape = mySurface.createShape(descriptors.defaultShape).setFill(descriptors.fill).setStroke(descriptors.stroke);\n        shape.applyTransform({ dx: w / 2, dy: h / 2 });\n      }\n      return a;\n    },\n\n    _updateUI: function _updateUI(styleName) {\n      this.styleName = styleName;\n\n      if (this.isDashboardTheme) {\n        this.isLightTheme = styleName ? styleName === 'light' : this.isLightTheme;\n\n        var removeDownClass = this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n        var addDownClass = this.isLightTheme ? 'expandDown' : 'expandDown-dashboard';\n        this._updateNodes(removeDownClass, addDownClass);\n\n        var removeUpClass = this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n        var addUpClass = this.isLightTheme ? 'expandUp' : 'expandUp-dashboard';\n        this._updateNodes(removeUpClass, addUpClass);\n\n        var removeExpandClass = this.isLightTheme ? 'expand-dashboard' : 'expand';\n        var addExpandClass = this.isLightTheme ? 'expand' : 'expand-dashboard';\n        this._updateNodes(removeExpandClass, addExpandClass);\n\n        var removeGroupItemUpClass = this.isLightTheme ? 'groupItemImageUp-dashboard' : 'groupItemImageUp';\n        var addGroupItemUpClass = this.isLightTheme ? 'groupItemImageUp' : 'groupItemImageUp-dashboard';\n        this._updateNodes(removeGroupItemUpClass, addGroupItemUpClass);\n\n        var removeGroupItemDownClass = this.isLightTheme ? 'groupItemImageDown-dashboard' : 'groupItemImageDown';\n        var addGroupItemDownClass = this.isLightTheme ? 'groupItemImageDown' : 'groupItemImageDown-dashboard';\n        this._updateNodes(removeGroupItemDownClass, addGroupItemDownClass);\n\n        var removeGroupItemClass = this.isLightTheme ? 'groupItemImage-dashboard' : 'groupItemImage';\n        var addGroupItemClass = this.isLightTheme ? 'groupItemImage' : 'groupItemImage-dashboard';\n        this._updateNodes(removeGroupItemClass, addGroupItemClass);\n      }\n    },\n\n    _updateNodes: function _updateNodes(remove, add) {\n      var nodes = query('.' + remove);\n      array.forEach(nodes, function (node) {\n        domClass.remove(node, remove);\n        domClass.add(node, add);\n      });\n    },\n\n    _toggleLayerVisibility: function _toggleLayerVisibility(obj, e) {\n      e.stopPropagation();\n      this.map.infoWindow.hide();\n      var id = obj.id ? obj.id : obj.layerObject.id;\n      var lyr = this.layerList[id];\n      if (!lyr) {\n        if (obj.pl) {\n          id = obj.pl.id;\n        }\n        lyr = this.layerList[id];\n      }\n\n      if (lyr) {\n        var hasSubLayerId = lyr.li && lyr.li.hasOwnProperty(\"subLayerId\") ? typeof lyr.li.subLayerId !== 'undefined' && lyr.li.subLayerId.toString() !== \"-1\" : false;\n\n        var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n        var _vis = !domClass.contains(\"recIcon_\" + id, \"active\");\n\n        if (hasSubLayerId && lyr.type !== 'ClusterLayer') {\n          if (_vis) {\n            var currentLayerInfo = lyrInfo.parentLayerInfo;\n            while (currentLayerInfo) {\n              currentLayerInfo.setTopLayerVisible(true);\n              currentLayerInfo = currentLayerInfo.parentLayerInfo;\n            }\n          }\n          lyrInfo.setTopLayerVisible(_vis);\n        } else if (lyr) {\n          lyr.layerObject.setVisibility(_vis);\n          if (lyr.type === 'ClusterLayer' && _vis) {\n            lyr.layerObject.handleMapExtentChange({ levelChange: true });\n            lyr.layerObject.flashFeatures();\n          }\n          if (typeof lyr.pl !== 'undefined') {\n            lyr.pl.visibility = _vis;\n            if (this.map.graphicsLayerIds.indexOf(id) > -1) {\n              var l = this.map.getLayer(id);\n              l.setVisibility(_vis);\n            }\n          }\n        }\n      }\n    },\n\n    _toggleLayerUI: function _toggleLayerUI(obj, vis) {\n      var id = obj.id ? obj.id : obj.layerObject.id;\n      var lyr = this.layerList[id];\n      if (!lyr) {\n        if (obj.pl) {\n          id = obj.pl.id;\n        }\n        lyr = this.layerList[id];\n      }\n      if (lyr) {\n        var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n        var visScalRange = lyrInfo.isCurrentScaleInTheScaleRange ? lyrInfo.isCurrentScaleInTheScaleRange() : true;\n\n        var c = dom.byId(\"recLabel_\" + id);\n\n        this.layerList[id].visible = vis;\n        this.layerList[id].parentLayerVisible = vis;\n        if (this.layerList[id].type === 'ClusterLayer') {\n          this.layerList[id].layerObject.parentLayerVisible = vis;\n        }\n        if (this.config.countEnabled) {\n          if (domClass.contains(\"recNum_\" + id, !vis ? \"recNum\" : \"recNumInActive\")) {\n            var _append = this.isDartTheme ? ' darkThemeColor' : ' lightThemeColor';\n            domClass.remove(\"recNum_\" + id, !vis ? \"recNum\" : \"recNumInActive\");\n            domClass.add(\"recNum_\" + id, (!vis ? \"recNumInActive\" : \"recNum\") + _append);\n          }\n        }\n\n        var eD = this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n        var eU = this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n\n        if (!vis) {\n          domClass.remove(\"recIcon_\" + id, \"active\");\n          //this._clearList(this.layerList[id]);\n          if (c && c.firstChild) {\n            domClass.add(c.firstChild, \"inActive\");\n          }\n          if (!domClass.contains(\"exp_\" + id, \"expandInActive\")) {\n            domClass.add(\"exp_\" + id, \"expandInActive\");\n          }\n          if (lyr.legendOpen) {\n            if (domClass.contains(\"legend_\" + id, \"legendOn\")) {\n              //this.layerList[id].legendOpen = false;\n              domClass.remove(\"legend_\" + id, \"legendOn\");\n              domClass.add(\"legend_\" + id, \"legendOff\");\n              if (domClass.contains(\"exp_\" + id, eU)) {\n                domClass.remove(\"exp_\" + id, eU);\n                domClass.add(\"exp_\" + id, eD);\n              }\n            }\n          }\n          if (lyr.toggleLegend) {\n            lyr.toggleLegend.remove();\n          }\n          if (domClass.contains(\"rec_\" + id, \"rec\")) {\n            domClass.add(\"rec_\" + id, \"recDefault\");\n          }\n        } else {\n          domClass.add(\"recIcon_\" + id, \"active\");\n          if (c && c.firstChild) {\n            domClass.remove(c.firstChild, \"inActive\");\n          }\n          if (domClass.contains(\"exp_\" + id, \"expandInActive\") && visScalRange) {\n            domClass.remove(\"exp_\" + id, \"expandInActive\");\n          }\n          if (lyr.toggleLegend) {\n            lyr.toggleLegend.remove();\n          }\n          var rec = dom.byId('rec_' + id);\n          if (rec) {\n            lyr.toggleLegend = on(rec, \"click\", lang.hitch(this, this._toggleLegend, lyr));\n          }\n\n          if (domClass.contains(\"rec_\" + id, \"recDefault\")) {\n            domClass.remove(\"rec_\" + id, \"recDefault\");\n          }\n\n          if (!lyr.listDisabled) {\n            this._loadList(lyr, true);\n            if (lyr.legendOpen) {\n              domClass.add(\"legend_\" + id, \"legendOn\");\n              domClass.remove(\"legend_\" + id, \"legendOff\");\n              if (domClass.contains(\"exp_\" + id, eD)) {\n                domClass.remove(\"exp_\" + id, eD);\n                domClass.add(\"exp_\" + id, eU);\n              }\n            }\n          }\n        }\n      }\n      return false;\n    },\n\n    _toggleLegend: function _toggleLegend(obj, evt) {\n      if (evt.currentTarget.className !== 'thumb2' && evt.currentTarget.className !== 'recIcon') {\n        var id = obj.layerObject.id in this.layerList ? obj.layerObject.id : obj.li.id;\n        if (domClass.contains(\"legend_\" + id, \"legendOff\")) {\n          this._addSearching(id);\n          this.layerList[id].legendOpen = true;\n          if (typeof this.layerList[id].li.layerListExtentChanged === 'undefined' || this.layerList[id].requiresReload) {\n            this.layerList[id].li.layerListExtentChanged = true;\n            this.layerList[id].requiresReload = false;\n          }\n          if (this.layerList[id].li.layerListExtentChanged) {\n            setTimeout(lang.hitch(this, function () {\n              this._loadList(obj, false);\n            }), 500);\n          } else {\n            this._removeSearching(id, true);\n          }\n          domClass.remove(\"legend_\" + id, \"legendOff\");\n          domClass.add(\"legend_\" + id, \"legendOn\");\n        } else {\n          if (domClass.contains(\"legend_\" + id, \"legendOn\")) {\n            this.layerList[id].legendOpen = false;\n            var eD = this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n            var eU = this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n            if (domClass.contains(\"exp_\" + id, eU)) {\n              domClass.remove(\"exp_\" + id, eU);\n              domClass.add(\"exp_\" + id, eD);\n            }\n            domClass.remove(\"legend_\" + id, \"legendOn\");\n            domClass.add(\"legend_\" + id, \"legendOff\");\n          }\n        }\n      }\n      evt.stopPropagation();\n    },\n\n    _toggleGroup: function _toggleGroup(obj, e) {\n      var id = e.currentTarget.id.slice(0, -2);\n      var fI = this.isDartTheme ? 'featureItem-dart' : 'featureItem';\n\n      var toggle = true;\n      if (e.target.parentNode) {\n        if (e.target.parentNode.id !== \"\") {\n          if (domClass.contains(e.target.parentNode.id, fI)) {\n            toggle = false;\n          }\n        }\n        if (e.target.id !== \"\") {\n          if (domClass.contains(e.target.id, fI)) {\n            toggle = false;\n          }\n        }\n      }\n\n      var gII = this.isDartTheme ? \"groupItemImage-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImage-dashboard\" : \"groupItemImage\";\n      var gIIUp = this.isDartTheme ? \"groupItemImageUp-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageUp-dashboard\" : \"groupItemImageUp\";\n      var gIIDown = this.isDartTheme ? \"groupItemImageDown-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageDown-dashboard\" : \"groupItemImageDown\";\n      if (toggle) {\n        var lId = obj.layerObject.id in this.layerList ? obj.layerObject.id : obj.li.id;\n        var node = document.getElementById(e.currentTarget.id);\n        var _idx = node.childNodes[0].childNodes.length - 1;\n        if (domClass.contains(id, \"groupOff\")) {\n          if (this.layerList[lId].openGroups && this.layerList[lId].openGroups.length > 0) {\n            if (this.layerList[lId].openGroups.indexOf(id) === -1) {\n              this.layerList[lId].openGroups.push(id);\n            }\n          } else {\n            this.layerList[lId].openGroups = [id];\n          }\n          domClass.remove(id, \"groupOff\");\n          domClass.add(id, \"groupOn\");\n          this.layerList[lId].groupOpen = true;\n          if (node.childNodes[0].childNodes[_idx].childNodes[0].className.indexOf(gII) > -1) {\n            html.removeClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIDown);\n            html.addClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIUp);\n          }\n        } else {\n          if (domClass.contains(id, \"groupOn\")) {\n            domClass.remove(id, \"groupOn\");\n            domClass.add(id, \"groupOff\");\n\n            if (this.layerList[lId].openGroups && this.layerList[lId].openGroups.length > 0) {\n              var idx = this.layerList[lId].openGroups.indexOf(id);\n              if (idx > -1) {\n                this.layerList[lId].openGroups.splice(idx, 1);\n              }\n              if (this.layerList[lId].openGroups.length === 0) {\n                this.layerList[lId].groupOpen = false;\n              }\n            } else {\n              this.layerList[lId].groupOpen = false;\n            }\n            if (node.childNodes[0].childNodes[_idx].childNodes[0].className.indexOf(gII) > -1) {\n              html.removeClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIUp);\n              html.addClass(e.currentTarget.childNodes[0].childNodes[_idx].childNodes[0], gIIDown);\n            }\n          }\n        }\n      }\n    },\n\n    /*jshint unused:false*/\n    onAppConfigChanged: function onAppConfigChanged(appConfig, reason, changedData) {\n      switch (reason) {\n        case 'themeChange':\n          this.inPanelOverrides(changedData);\n          this.destroy();\n          break;\n        case 'layoutChange':\n          this.inPanelOverrides(changedData);\n          break;\n        case 'styleChange':\n          if (!this.hidePanel) {\n            this._updateUI(changedData);\n            this._updateStyleColor(changedData);\n          }\n          break;\n        case 'widgetChange':\n          this.widgetChange = true;\n          if (changedData && changedData.config && changedData.config.layerInfos) {\n            this.removeOldClusterLayers(changedData.config.layerInfos);\n          }\n          this.row = null;\n          break;\n        case 'mapChange':\n          this._clearMap();\n      }\n    },\n\n    _updateStyleColor: function _updateStyleColor(changedData) {\n      setTimeout(lang.hitch(this, function () {\n        var p = this.getPanel();\n        var node;\n        switch (this.appConfig.theme.name) {\n          case 'BoxTheme':\n            node = p.containerNode.parentNode.parentNode.children[0];\n            break;\n          case 'DartTheme':\n            node = p.containerNode.parentNode;\n            break;\n          case 'TabTheme':\n            node = p.containerNode;\n            break;\n          case 'BillboardTheme':\n            node = p.containerNode.parentNode;\n            break;\n          case 'FoldableTheme':\n            node = p.containerNode.parentNode.firstChild;\n            break;\n          default:\n            node = this.pageHeader;\n            break;\n        }\n        var bc = window.getComputedStyle(node, null).getPropertyValue('background-color');\n        this._styleColor = Color.fromRgb(bc).toHex();\n        for (var k in this.layerList) {\n          var l = this.layerList[k];\n          if (l.type === \"ClusterLayer\") {\n            l.layerObject.setStyleColor(this._styleColor);\n          }\n        }\n        this._updateUI(changedData);\n      }), 50);\n    },\n\n    _clearMap: function _clearMap() {\n      if (this.layerList) {\n        for (var k in this.layerList) {\n          var l = this.layerList[k];\n          if (l.type === \"ClusterLayer\") {\n            var _clear = true;\n            if (typeof this.continuousRefreshEnabled !== 'undefined') {\n              _clear = !this.continuousRefreshEnabled;\n            }\n            if (_clear) {\n              l.layerObject._clear();\n              this.map.removeLayer(l.layerObject);\n            }\n          }\n        }\n        this.layerList = {};\n      }\n    },\n\n    _close: function _close() {\n      this.widgetManager.closeWidget(this.id);\n    },\n\n    onClose: function onClose() {\n      this.inherited(arguments);\n\n      for (var key in this.layerList) {\n        var layerListLayer = this.layerList[key];\n        if (layerListLayer.li && layerListLayer.li.orgRenderer) {\n          if (layerListLayer.layerObject.setRenderer) {\n            layerListLayer.layerObject.setRenderer(layerListLayer.li.orgRenderer);\n          } else if (layerListLayer.layerObject.setLayerDrawingOptions) {\n            layerListLayer.layerObject.setLayerDrawingOptions([]);\n          } else {\n            console.log(\"Error re-setting the renderer\");\n          }\n          layerListLayer.layerObject.refresh();\n        }\n      }\n\n      var disableRefresh = true;\n      if (typeof this.config.continuousRefreshEnabled !== 'undefined') {\n        disableRefresh = !this.config.continuousRefreshEnabled;\n      }\n      if (disableRefresh) {\n        if (this.refreshInterval !== 0) {\n          this.refreshIntervalValue = 0;\n          clearInterval(this.refreshInterval);\n          this.refreshInterval = 0;\n        }\n      }\n\n      if (!this.hidePanel) {\n        if (typeof this.mapExtentChangedHandler !== 'undefined') {\n          this.mapExtentChangedHandler.remove();\n          this.mapExtentChangedHandler = undefined;\n        } else {\n          if (typeof this.iconClickHandler !== 'undefined') {\n            this.iconClickHandler.remove();\n            this.iconClickHandler = undefined;\n          }\n        }\n      }\n    },\n\n    _clearChildNodes: function _clearChildNodes(parentNode) {\n      while (parentNode.hasChildNodes()) {\n        parentNode.removeChild(parentNode.lastChild);\n      }\n    },\n\n    _inVisibleRange: function _inVisibleRange(lyr, id) {\n      var visScaleRange = true;\n      if (lyr.layerObject && lyr.layerObject.hasOwnProperty('visibleAtMapScale')) {\n        visScaleRange = lyr.layerObject.visibleAtMapScale;\n      }\n      var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n      if (lyrInfo && lyrInfo.isCurrentScaleInTheScaleRange) {\n        visScaleRange = lyrInfo.isCurrentScaleInTheScaleRange();\n      }\n      return visScaleRange;\n    },\n\n    _mapExtentChange: function _mapExtentChange() {\n      var countEnabled = this.config.countEnabled;\n      var queries = [];\n      for (var key in this.layerList) {\n        var lyr = this.layerList[key];\n        lyr.visScaleRange = this._inVisibleRange(lyr, key);\n        if (!this.showAllFeatures) {\n          this._clearList(lyr);\n        }\n        if (!lyr.legendOpen || lyr.groupEnabled && !lyr.groupOpen) {\n          if (lyr.li) {\n            lyr.li.layerListExtentChanged = true;\n          }\n          if (lyr.visible && lyr.visScaleRange) {\n            if (lyr.type === \"ClusterLayer\" && lyr.layerObject.initalLoad && this.config.countEnabled) {\n              lyr.layerObject._updateNode(lyr.layerObject.node.innerHTML);\n            }\n\n            if (lyr.type !== 'ClusterLayer') {\n              var uNode = this.config.countEnabled ? lyr.node : lyr.legendNode;\n              if (typeof lyr.layerObject === 'undefined') {\n                console.log(\"layer object not known\");\n              } else {\n                this.countFeatures(lyr);\n              }\n            }\n          } else if (!lyr.visScaleRange) {\n            this._updateList([], lyr.legendNode, lyr.node, [], true, lyr);\n          }\n        } else {\n          if (lyr.visible && lyr.visScaleRange) {\n            lyr.updateList = true;\n            this._loadList(lyr, lyr.updateList);\n          } else {\n            this._updateList([], lyr.legendNode, lyr.node, [], true, lyr);\n          }\n        }\n      }\n    },\n\n    getFeatures: function getFeatures(lyrInfo, fields, updateCount) {\n      var lyr = lyrInfo.layerObject;\n      var legendNode = lyrInfo.legendNode;\n      var node = lyrInfo.node;\n      var _needsGeom = !lyrInfo.listDisabled && lyrInfo.legendOpen ? true : false;\n      var visScaleRange = lyrInfo.visScaleRange;\n      var maxRecordCount = lyr && lyr.maxRecordCount ? lyr.maxRecordCount : undefined;\n      var url;\n      var queries = [];\n      var q = this._getQuery(lyrInfo, fields, _needsGeom);\n      if (lyrInfo.visible && visScaleRange) {\n        if (lyr.queryFeatures) {\n          //get the first set of features\n          if (!lyrInfo.listDisabled) {\n            queries.push(lyr.queryFeatures(q));\n          }\n          //query the ids incase we need more than maxRecordCount\n          queries.push(lyr.queryIds(q));\n        } else {\n          url = lyrInfo.li.url;\n          if (url.indexOf(\"MapServer\") > -1 || url.indexOf(\"FeatureServer\") > -1) {\n            var qt = new QueryTask(url);\n            //get the first set of features\n            if (!lyrInfo.listDisabled) {\n              queries.push(qt.execute(q));\n            }\n            //query the ids incase we need more than maxRecordCount\n            queries.push(qt.executeForIds(q));\n          }\n        }\n      } else {\n        //if it's not visible and not within the visible scale range\n        this._updateList([], lyrInfo.legendNode, lyrInfo.node, [], true, lyrInfo);\n      }\n      if (queries.length > 0) {\n        var featurePromises = all(queries);\n        featurePromises.then(lang.hitch(this, function (results) {\n          var s_id = lyrInfo.layerObject.id in this.layerList ? lyrInfo.layerObject.id : lyrInfo.li.id;\n          var updateNode;\n          if (node) {\n            updateNode = this.config.countEnabled ? node.parentNode : node.previousSibling;\n          }\n          if (results && results.length > 1) {\n            var _queries = [];\n            var queryIDs = results[1];\n            var count = 0;\n            //if IDs exceed max count we need to chunk\n            if (queryIDs && maxRecordCount && queryIDs.length > maxRecordCount) {\n              this._chunkRequest(lyr, url, queryIDs, maxRecordCount, fields, _needsGeom).then(lang.hitch(this, function (fullFeatures) {\n                this._updateList(fullFeatures, legendNode, node, fields, updateCount, lyrInfo);\n              }));\n            } else {\n              this._updateList(results[0].features, legendNode, node, fields, updateCount, lyrInfo);\n            }\n          } else if (results && results.length === 1) {\n            if (this.config.countEnabled) {\n              node.innerHTML = utils.localizeNumber(results[0].length);\n            }\n            this._removeSearching(s_id, false);\n          } else {\n            if (this.config.countEnabled) {\n              node.innerHTML = utils.localizeNumber(0);\n            }\n            this.updateExpand(updateNode, true);\n            this._removeSearching(s_id, lyrInfo.legendOpen);\n          }\n        }));\n      }\n    },\n\n    _chunkRequest: function _chunkRequest(lyr, url, IDs, max, fields, needsGeom) {\n      var def = new Deferred();\n      var queries = [];\n      var i, j;\n      for (i = 0, j = IDs.length; i < j; i += max) {\n        var ids = IDs.slice(i, i + max);\n\n        var q = new Query();\n        q.outFields = fields;\n        q.objectIds = ids;\n        q.returnGeometry = needsGeom;\n\n        if (lyr.queryFeatures) {\n          queries.push(lyr.queryFeatures(q));\n        } else if (url) {\n          var qt = new QueryTask(url);\n          queries.push(qt.execute(q));\n        }\n      }\n      var queryList = new DeferredList(queries);\n      queryList.then(lang.hitch(this, function (queryResults) {\n        if (queryResults) {\n          var allFeatures = [];\n          for (var i = 0; i < queryResults.length; i++) {\n            if (queryResults[i][1].features) {\n              allFeatures.push.apply(allFeatures, queryResults[i][1].features);\n            }\n          }\n          def.resolve(allFeatures);\n        }\n      }));\n      return def;\n    },\n\n    _clearList: function _clearList(lyrInfo) {\n      if (!lyrInfo.isLoaded && lyrInfo.legendNode) {\n        lyrInfo.isLoaded = false;\n        lyrInfo.legendNode.innerHTML = '';\n      }\n    },\n\n    _updateList: function _updateList(features, legendNode, node, fields, updateCount, lyrInfo, countOnly) {\n      var li = lyrInfo.li ? lyrInfo.li : lyrInfo;\n\n      if (lyrInfo.type === 'ClusterLayer') {\n        if (lyrInfo.layerObject.node) {\n          if (domClass.contains(lyrInfo.layerObject.node.id, 'searching')) {\n            domClass.remove(lyrInfo.layerObject.node.id, 'searching');\n          }\n        }\n      }\n\n      var visScaleRange = lyrInfo.visScaleRange;\n      var infoTemplate = lyrInfo.infoTemplate;\n      var displayOptions = lyrInfo.symbolData ? lyrInfo.symbolData.featureDisplayOptions : li && li.symbolData ? li.symbolData.featureDisplayOptions : {};\n\n      if (node || legendNode) {\n        if (legendNode && (lyrInfo.hasOwnProperty('isLoaded') ? !lyrInfo.isLoaded : true)) {\n          legendNode.innerHTML = '';\n        }\n        if (updateCount && node && this.config.countEnabled) {\n          if (visScaleRange) {\n            node.innerHTML = utils.localizeNumber(features.length);\n          } else {\n            this.countFeatures(lyrInfo, lyrInfo.id || li.id);\n          }\n        }\n        var updateNode = this.config.countEnabled ? node.parentNode : legendNode.previousSibling;\n        if (lyrInfo.type === 'ClusterLayer' && lyrInfo.visible || lyrInfo.type !== 'ClusterLayer') {\n          this.updateExpand(updateNode, visScaleRange ? features.length === 0 : true);\n        }\n      }\n      if (countOnly) {\n        return;\n      }\n\n      if (!lyrInfo.listDisabled && !lyrInfo.isLoaded) {\n        if (features.length > 0) {\n          var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.id);\n\n          var renderer = lyrInfo.type === \"ClusterLayer\" ? lyrInfo.layerObject.renderer : jimuLayerInfo && jimuLayerInfo.layerObject && jimuLayerInfo.layerObject.renderer ? jimuLayerInfo.layerObject.renderer : features[0]._graphicsLayer ? features[0]._graphicsLayer.renderer : lyrInfo.layerObject && lyrInfo.layerObject.renderer ? lyrInfo.layerObject.renderer : li && li.renderer ? jsonUtil.fromJson(li.renderer) || li.renderer : lyrInfo.renderer ? jsonUtil.fromJson(lyrInfo.renderer) || lyrInfo.renderer : undefined;\n          var _fields = lyrInfo.li && lyrInfo.li.fields ? lyrInfo.li.fields : lyrInfo.fields;\n\n          var groupNodes = [];\n          var finalGroupNodes = [];\n          var finalDomNodes = [];\n          for (var i = 0; i < features.length; i++) {\n            var groupAdded = false;\n            var feature = features[i];\n            if (typeof feature.infoTemplate === 'undefined' && infoTemplate) {\n              feature.infoTemplate = infoTemplate;\n            }\n\n            var symbol = renderer && renderer.getSymbol ? renderer.getSymbol(feature) : feature.symbol ? jsonUtils.fromJson(feature.symbol) : undefined;\n\n            var oidName = feature._layer && feature._layer.objectIdField ? feature._layer.objectIdField : li && li.oidFieldName && li.oidFieldName.name ? li.oidFieldName.name : lyrInfo.layerObject && lyrInfo.layerObject.objectIdField ? lyrInfo.layerObject.objectIdField : lyrInfo && lyrInfo.oidFieldName ? lyrInfo.oidFieldName : undefined;\n\n            var id = oidName ? feature.attributes[oidName] : legendNode.id + i;\n\n            var flds = fields[0] === '*' ? feature.attributes : fields;\n            var isNames = fields[0] === '*' ? false : true;\n\n            var displayStringObj = this.getDisplayString(feature, lyrInfo, flds, displayOptions, oidName, isNames);\n            var displayString = displayStringObj.displayString;\n            var aliasNames = displayStringObj.aliasNames;\n            var firstValue = displayStringObj.firstValue;\n            var groupField, groupNode, groupContainer, displayValue, groupType;\n            if (displayOptions.groupEnabled) {\n              var featureValue;\n              var _value;\n              var appendVal = undefined; // jshint ignore:line\n              if (typeof displayOptions.groupByField === 'undefined' || displayOptions.groupByField) {\n                groupField = displayOptions.groupField;\n                featureValue = feature.attributes[groupField.name];\n                groupType = 'byField';\n                appendVal = featureValue;\n              } else {\n                groupField = displayOptions.groupByRendererOptions.fields[0];\n                featureValue = feature.attributes[groupField.name];\n                var groubByFields = displayOptions.groupByRendererOptions.fields;\n                var groupByValues = displayOptions.groupByRendererOptions.values;\n                groupType = 'byRenderer';\n\n                if (featureValue !== null && featureValue !== \"\") {\n                  expression_loop: for (var ii = 0; ii < groupByValues.length; ii++) {\n                    var _val = groupByValues[ii];\n                    var exp = _val.value;\n                    var expParts = exp.split(\"&&\");\n                    if (expParts && expParts.length > 1) {\n                      exp = featureValue + expParts[0] + \"&& \" + featureValue + expParts[1];\n                    } else {\n                      exp = isNaN(featureValue) ? \"'\" + featureValue + \"'\" + _val.value : featureValue + _val.value;\n                    }\n                    if (eval(exp)) {\n                      // jshint ignore:line\n                      _value = _val;\n                      break expression_loop;\n                    }\n                  }\n                  if (typeof _value !== 'undefined' && _value !== null) {\n                    appendVal = _value.label.replace(/ /g, '');\n                  }\n                }\n              }\n              var gId = 'group_' + li.id + \"_\" + groupField.name + \"_\" + appendVal;\n              var addGroup = true;\n              var n;\n              if (groupNodes.length > 0) {\n                node_loop: for (var iii = 0; iii < groupNodes.length; iii++) {\n                  var gNode = groupNodes[iii];\n                  if (gId === gNode.id) {\n                    if (groupType === 'byField' && featureValue === gNode.value || groupType === 'byRenderer') {\n                      addGroup = false;\n                      n = gNode.node;\n                      groupContainer = gNode.parent;\n                      break node_loop;\n                    }\n                  }\n                }\n              }\n              if (addGroup) {\n                groupAdded = true;\n                groupContainer = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupItem-dart' : 'groupItem',\n                  id: gId + \"_c\"\n                });\n                var groupTitle = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupItemTitle-dart' : 'groupItemTitle',\n                  id: gId + \"_t\"\n                }, groupContainer);\n                var label = \"\";\n                var title = groupType === 'byRenderer' ? \"\" : groupField.name + \": \";\n                if (typeof aliasNames !== 'undefined') {\n                  if (aliasNames.hasOwnProperty(groupField.name) && aliasNames[groupField.name] !== '') {\n                    if (groupType === 'byField') {\n                      title = aliasNames[groupField.name] + \": \";\n                    } else {\n                      title = \"\";\n                    }\n                  }\n                }\n                if (groupType === 'byField') {\n                  if (typeof groupField.label !== 'undefined' && groupField.label !== \"\") {\n                    label = groupField.label + \": \";\n                    title = label;\n                  }\n                  if (label === \": \") {\n                    label = \"\";\n                    title = \"\";\n                  }\n                } else {\n                  if (typeof _value !== 'undefined') {\n                    if (typeof _value.label !== 'undefined' && _value.label !== \"\") {\n                      label = title + _value.label;\n                      title = label;\n                    }\n                  } else {\n                    label = title + featureValue;\n                    title = label;\n                  }\n                  if (label === \": \") {\n                    label = \"\";\n                    title = \"\";\n                  }\n                }\n\n                displayValue = this._getFormattedValue(feature, groupField.name, lyrInfo, _fields);\n\n                if (groupType === 'byRenderer' && symbol) {\n                  this._createImageDataDiv(lang.clone(symbol), 30, 30, groupTitle, isCustom);\n                }\n\n                domConstruct.create('div', {\n                  'class': groupType === 'byField' ? 'groupField' : 'groupFieldImage',\n                  innerHTML: groupType === 'byField' ? label + displayValue : label,\n                  title: groupType === 'byField' ? title + displayValue : title\n                }, groupTitle);\n\n                var inGrpList = false;\n                if (lyrInfo.openGroups && lyrInfo.openGroups.length > 0) {\n                  inGrpList = lyrInfo.openGroups.indexOf(gId) > -1;\n                }\n                var _append = this.isDartTheme ? ' darkThemeColor' : ' lightThemeColor';\n                var groupCountNode = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupCountLabel' : 'groupCountLabel' + _append\n                }, groupTitle);\n\n                var imageContainer = domConstruct.create('div', {\n                  'class': this.isDartTheme || this.isDashboardTheme && !this.isLightTheme ? 'expandImageContainer-dart' : 'expandImageContainer'\n                }, groupTitle);\n\n                var gIIUp = this.isDartTheme ? \"groupItemImageUp-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageUp-dashboard\" : \"groupItemImageUp\";\n                var gIIDown = this.isDartTheme ? \"groupItemImageDown-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageDown-dashboard\" : \"groupItemImageDown\";\n                var cNames = this.isDartTheme ? 'groupItemImage-dart' : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImage-dashboard\" : 'groupItemImage';\n                cNames += inGrpList ? ' ' + gIIUp : ' ' + gIIDown;\n                domConstruct.create('div', {\n                  'class': cNames\n                }, imageContainer);\n\n                cNames = this.isDartTheme ? 'groupItem-dart' : 'groupItem';\n                cNames += lyrInfo.groupOpen && inGrpList ? ' groupOn' : ' groupOff';\n                groupNode = domConstruct.create('div', {\n                  'class': cNames,\n                  id: gId\n                }, groupContainer);\n\n                groupNodes.push({\n                  id: 'group_' + li.id + \"_\" + groupField.name + \"_\" + appendVal,\n                  node: groupNode,\n                  parent: groupContainer,\n                  value: featureValue\n                });\n\n                finalGroupNodes.push({\n                  value: featureValue,\n                  node: groupContainer,\n                  countNode: groupCountNode,\n                  count: 1\n                });\n\n                on(groupContainer, \"click\", lang.hitch(this, this._toggleGroup, lyrInfo));\n              } else {\n                var result = finalGroupNodes.filter(function (o) {\n                  if (o.node.id === n.id + \"_c\") {\n                    return o;\n                  }\n                });\n\n                result[0].count += 1;\n                groupNode = n;\n              }\n            }\n            var featureItem = domConstruct.create('div', {\n              'class': this.isDartTheme ? 'featureItem-dart' : 'featureItem',\n              id: 'feature_' + li.id + \"_\" + id\n            });\n\n            var isCustom = false;\n            if (li && li.symbolData) {\n              isCustom = li.symbolData.symbolType === \"CustomSymbol\";\n            }\n            if (symbol) {\n              if (displayOptions.groupEnabled && groupType === 'byRenderer') {\n                //this._createImageDataDiv(lang.clone(symbol), 30, 30, groupTitle, isCustom);\n              } else {\n                this._createImageDataDiv(lang.clone(symbol), 30, 30, featureItem, isCustom);\n              }\n            }\n\n            on(featureItem, \"click\", lang.hitch(this, this._panToFeature, feature));\n\n            if (displayString.indexOf(\" - \") > -1) {\n              displayString = displayString.slice(0, -3);\n            }\n            var _margin = displayOptions.groupEnabled && groupType === 'byRenderer' ? \"15px\" : \"50px\";\n            var _txtAlign = window.isRTL ? \"right\" : \"left\";\n            domConstruct.create('div', {\n              style: \"padding: 7px 5px 5px \" + _margin + \"; text-align: \" + _txtAlign + \";\",\n              innerHTML: displayString,\n              title: displayString\n            }, featureItem);\n\n            finalDomNodes.push({\n              node: featureItem,\n              updateNode: groupNode ? groupNode : legendNode,\n              firstValue: firstValue\n            });\n          }\n\n          if (finalGroupNodes.length > 0) {\n            //sort and place at legendNode\n            var nodes = finalGroupNodes.sort(function (a, b) {\n              if (typeof a.value === 'undefined') {\n                return b.value;\n              } else if (typeof b.value === 'undefined') {\n                return a.value;\n              }\n              if (isNaN(a.value)) {\n                return a.value.localeCompare(b.value);\n              } else {\n                return parseFloat(a.value) - parseFloat(b.value);\n              }\n            });\n            var cE = this.config.countEnabled;\n            array.forEach(nodes, function (n) {\n              if (cE) {\n                n.countNode.innerHTML = utils.localizeNumber(n.count);\n              }\n              legendNode.appendChild(n.node);\n            });\n          }\n\n          if (finalDomNodes.length > 0) {\n            var sortedNodes = finalDomNodes.sort(function (a, b) {\n              var _a = a.firstValue;\n              var _b = b.firstValue;\n              if (typeof _a === 'undefined' || _a === null || _a === \"\") {\n                return 1;\n              } else if (typeof _b === 'undefined' || _b === null || _b === \"\") {\n                return -1;\n              } else if (_a === _b) {\n                return 0;\n              }\n              return _a.toString().localeCompare(_b.toString());\n            });\n            array.forEach(sortedNodes, function (fdn) {\n              domConstruct.place(fdn.node, fdn.updateNode);\n            });\n          }\n        }\n      }\n      li.layerListExtentChanged = false;\n\n      var s_id = lyrInfo.layerObject && lyrInfo.layerObject.id && lyrInfo.layerObject.id in this.layerList ? lyrInfo.layerObject.id : li.id;\n      if (this.showAllFeatures && lyrInfo.visible) {\n        var loaded = true;\n        if (lyrInfo.layerObject && lyrInfo.type === 'ClusterLayer') {\n          loaded = !lyrInfo.layerObject.queryPending;\n          if (lyrInfo.layerObject.hasOwnProperty('requiresReload')) {\n            loaded = loaded && !lyrInfo.layerObject.requiresReload;\n            lyrInfo.layerObject.requiresReload = false;\n          }\n        }\n        lyrInfo.isLoaded = loaded;\n      }\n\n      this._removeSearching(s_id, lyrInfo.legendOpen);\n    },\n\n    updateExpand: function updateExpand(node, hide) {\n      if (typeof node !== 'undefined') {\n        var id;\n        var en;\n        if (node.id.indexOf('rec_') > -1) {\n          id = node.id.replace('rec_', '');\n          en = dom.byId(\"exp_\" + id);\n        }\n\n        if (hide) {\n          if (node) {\n            html.addClass(node, \"recDefault\");\n            html.addClass(node, \"inActive\");\n          }\n          if (en) {\n            if (!domClass.contains(en, 'expand-empty')) {\n              html.addClass(en, \"expandInActive\");\n            }\n          }\n        } else {\n          if (node) {\n            html.removeClass(node, \"recDefault\");\n            html.removeClass(node, \"inActive\");\n          }\n          if (en) {\n            if (!domClass.contains(en, 'expand-empty')) {\n              html.removeClass(en, \"expandInActive\");\n            }\n          }\n        }\n      }\n    },\n\n    getDisplayString: function getDisplayString(feature, lyrInfo, fields, displayOptions, oidName, isNames) {\n      var displayString = \"\";\n      var aliasNames = {};\n      var firstValue = \"\";\n      if (displayOptions.fields.length > 0) {\n        //get the layer fields\n        var _fields = lyrInfo.li && lyrInfo.li.fields ? lyrInfo.li.fields : lyrInfo.fields;\n        array.forEach(displayOptions.fields, lang.hitch(this, function (displayField) {\n          for (var a in fields) {\n            var fieldName = isNames ? fields[a] : a;\n            if (fieldName === displayField.name) {\n\n              //get the value with proper formatting\n              var featureValue = this._getFormattedValue(feature, fieldName, lyrInfo, _fields);\n              //set the alias name\n              aliasNames[fieldName] = this._checkAliasName(_fields, fieldName);\n\n              firstValue = firstValue === \"\" ? featureValue : firstValue;\n              var hasLabel = typeof displayField.label !== 'undefined';\n              var append = hasLabel ? displayField.label.trim() === \"\" ? \"\" : \": \" : \"\";\n              var label = hasLabel ? displayField.label : \"\";\n\n              displayString += label + append + featureValue + \" - \";\n              break;\n            }\n          }\n        }));\n      }\n      return {\n        displayString: displayString,\n        aliasNames: aliasNames,\n        firstValue: firstValue\n      };\n    },\n\n    _getFormattedValue: function _getFormattedValue(feature, fieldName, lyrInfo, fields) {\n      //get raw feature value\n      var featureValue = feature.attributes[fieldName] || \"\";\n\n      //get the fieldInfos\n      var fieldInfos;\n      var infoTemplate = this._getInfoTemplate(lyrInfo);\n      if (infoTemplate) {\n        if (infoTemplate.info && infoTemplate.info.fieldInfos) {\n          fieldInfos = infoTemplate.info.fieldInfos;\n        } else if (infoTemplate._fieldsMap) {\n          fieldInfos = infoTemplate._fieldsMap;\n        }\n      }\n      //get fieldInfo and field\n      var fieldInfo;\n      if (fieldInfos && Array.isArray(fieldInfos) && fieldInfos.hasOwnProperty('length')) {\n        fieldInfo = this._getFieldByName(fieldInfos, fieldName);\n      }\n      var field = this._getFieldByName(fields, fieldName);\n      if (field) {\n        var intField = this._checkIntField(field);\n        var domainField = this._checkDomainField(field);\n        var dateField = this._checkDateField(field);\n\n        featureValue = dateField ? this.formatDateValue(featureValue, fieldInfo) : domainField ? this.formatDomainValue(featureValue, domainField) : intField ? this.formatNumberValue(featureValue, fieldInfo) : featureValue;\n      }\n      return featureValue;\n    },\n\n    _getFieldByName: function _getFieldByName(fields, fieldName) {\n      if (fields) {\n        var _fields = fields.filter(function (f) {\n          return f.name === fieldName || f.fieldName === fieldName || fields.hasOwnProperty(f) && fields[f].fieldName === fieldName;\n        });\n        if (_fields && _fields.length > 0) {\n          return _fields[0];\n        }\n      }\n      return undefined;\n    },\n\n    _getInfoTemplate: function _getInfoTemplate(lyrInfo) {\n      var infoTemplate = lyrInfo.infoTemplate;\n      if (!infoTemplate) {\n        if (lyrInfo.layerObject && lyrInfo.layerObject.infoTemplate) {\n          infoTemplate = lyrInfo.layerObject.infoTemplate;\n        } else if (lyrInfo.li && lyrInfo.li.infoTemplate) {\n          infoTemplate = lyrInfo.li.infoTemplate;\n        }\n      }\n      if (!infoTemplate) {\n        if (typeof lyrInfo.li.subLayerId !== 'undefined') {\n          var infoTemplates = lyrInfo.layerObject.infoTemplates;\n          if (infoTemplates && infoTemplates.hasOwnProperty(lyrInfo.li.subLayerId)) {\n            infoTemplate = infoTemplates[lyrInfo.li.subLayerId].infoTemplate;\n          }\n        }\n      }\n      return infoTemplate;\n    },\n\n    formatNumberValue: function formatNumberValue(v, fieldInfo) {\n      var num = v;\n      if (!isNaN(v)) {\n        var options = fieldInfo && fieldInfo.format ? fieldInfo : undefined;\n        num = utils.localizeNumberByFieldInfo(v, options);\n      }\n      return num || \"\";\n    },\n\n    formatDomainValue: function formatDomainValue(v, domain) {\n      if (domain && domain.codedValues) {\n        var cvs = domain.codedValues;\n        for (var i = 0; i < cvs.length; i++) {\n          var cv = cvs[i];\n          if (cv.code === v) {\n            return cv.name;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    formatDateValue: function formatDateValue(v, fieldInfo) {\n      if (v) {\n        var options = fieldInfo && fieldInfo.format ? fieldInfo : undefined;\n        var d = new Date(parseInt(v, 10));\n        return options ? utils.localizeDateByFieldInfo(d, options) : utils.localizeDate(d);\n      } else {\n        return \"\";\n      }\n    },\n\n    _checkAliasName: function _checkAliasName(field) {\n      return typeof field.alias !== 'undefined' ? field.alias : false;\n    },\n\n    _checkDomainField: function _checkDomainField(field) {\n      return typeof field.domain !== 'undefined' ? field.domain : false;\n    },\n\n    _checkDateField: function _checkDateField(field) {\n      return field.type === 'esriFieldTypeDate';\n    },\n\n    _checkIntField: function _checkIntField(field) {\n      var testTypes = ['esriFieldTypeSmallInteger', 'esriFieldTypeInteger', 'esriFieldTypeSingle', 'esriFieldTypeDouble'];\n      return testTypes.indexOf(field.type) > -1;\n    },\n\n    _checkDisplayField: function _checkDisplayField(displayFields, featureField) {\n      var includeField = true;\n      if (displayFields) {\n        for (var j = 0; j < displayFields.length; j++) {\n          if (displayFields[j].name === featureField) {\n            return displayFields[j];\n          } else {\n            includeField = false;\n          }\n        }\n      }\n      return includeField;\n    },\n\n    flashGraphics: function flashGraphics(graphics) {\n      for (var i = 0; i < graphics.length; i++) {\n        var g = graphics[i];\n        this._flashFeature(g);\n      }\n    },\n\n    _flashFeature: function _flashFeature(feature) {\n      var symbol;\n      if (feature.geometry) {\n        var color = Color.fromHex(this._styleColor);\n        var color2 = lang.clone(color);\n        color2.a = 0.4;\n        switch (feature.geometry.type) {\n          case 'point':\n            symbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CIRCLE, 15, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 1), color2);\n            break;\n          case 'polyline':\n            symbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 3);\n            break;\n          case 'polygon':\n            symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_DIAGONAL_CROSS, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 2), color2);\n            break;\n        }\n      }\n\n      var g = new Graphic(feature.geometry, symbol);\n      this.map.graphics.add(g);\n      var dShape = g.getDojoShape();\n      if (dShape) {\n        fx.animateStroke({\n          shape: dShape,\n          duration: 900,\n          color: {\n            start: dShape.strokeStyle.color,\n            end: dShape.strokeStyle.color\n          },\n          width: {\n            start: 25,\n            end: 0\n          }\n        }).play();\n        setTimeout(this._clearFeature, 1075, g);\n      }\n    },\n\n    _clearFeature: function _clearFeature(f) {\n      var gl = f.getLayer();\n      gl.remove(f);\n    },\n\n    _panToFeature: function _panToFeature(feature) {\n      if (feature.geometry) {\n        var geom = feature.geometry;\n        if (geom.type === 'polyline') {\n          var path = geom.paths[Math.ceil(geom.paths.length / 2) - 1];\n          var g = path[Math.ceil((path.length - 1) / 2)];\n          geom = new Point(g[0], g[1], geom.spatialReference);\n        }\n        if (geom.type !== 'point') {\n          geom = geom.getExtent().getCenter();\n        }\n        this._pan(feature, geom).then(lang.hitch(this, function () {\n          this._flashFeature(feature);\n          if (feature._layer && feature._layer.infoTemplate || feature.infoTemplate) {\n            this.map.infoWindow.setFeatures([feature]);\n            this.map.infoWindow.select(0);\n            this.map.infoWindow.show(geom);\n          }\n        }));\n      }\n    },\n\n    _pan: function _pan(feature, centerPoint) {\n      var def = new Deferred();\n      if (this.showAllFeatures && !this.map.extent.contains(feature.geometry)) {\n        this.map.centerAt(centerPoint).then(function (ext) {\n          def.resolve(ext);\n        });\n      } else {\n        def.resolve(undefined);\n      }\n      return def;\n    },\n\n    _getQuery: function _getQuery(layerListLayer, fields, needsGeom) {\n      var layerObject = layerListLayer.layerObject;\n      var q = new Query();\n      q.geometry = !this.showAllFeatures ? this.map.extent : null;\n      q.outFields = fields;\n      q.returnGeometry = needsGeom;\n      var collectionTypes = ['collection', 'kml', 'geo_rss'];\n      var isCollection = layerListLayer.selfType ? collectionTypes.indexOf(layerListLayer.selfType) > -1 : false;\n      //layer types from feature collection don't support where\n      if (!isCollection && layerObject.url) {\n        q.where = layerListLayer.filter ? layerListLayer.filter : \"1=1\";\n      } else if (this.showAllFeatures && layerObject && layerObject.fullExtent) {\n        //still need a way to support showing of all features\n        q.geometry = layerObject.fullExtent;\n      }\n      return q;\n    },\n\n    countFeatures: function countFeatures(layerListLayer) {\n      if (!this.hidePanel) {\n        var lyr = layerListLayer.layerObject;\n        var visible = typeof layerListLayer.visible !== 'undefined' ? layerListLayer.visible : lyr.visible;\n        var visScaleRange = layerListLayer.visScaleRange;\n        var node = this.config.countEnabled ? layerListLayer.node : layerListLayer.legendNode;\n        var q = this._getQuery(layerListLayer);\n        if (lyr.queryCount && lyr.visible) {\n          lyr.queryCount(q, lang.hitch(this, function (r) {\n            if (node) {\n              var updateNode;\n              if (this.config.countEnabled) {\n                node.innerHTML = utils.localizeNumber(r);\n                updateNode = node.parentNode;\n              } else {\n                updateNode = node.previousSibling;\n              }\n              this.updateExpand(updateNode, visScaleRange ? r === 0 : true);\n            }\n          }));\n        } else if (layerListLayer && layerListLayer.li && layerListLayer.li.url && visible) {\n          var url = layerListLayer.li.url;\n          if (url.indexOf(\"MapServer\") > -1 || url.indexOf(\"FeatureServer\") > -1) {\n            var qt = new QueryTask(url);\n            qt.executeForIds(q).then(lang.hitch(this, function (ids) {\n              if (node) {\n                var updateNode;\n                var length = ids ? ids.length : 0;\n                if (this.config.countEnabled) {\n                  node.innerHTML = utils.localizeNumber(length);\n                  updateNode = node.parentNode;\n                } else {\n                  updateNode = node.previousSibling;\n                }\n                this.updateExpand(updateNode, visScaleRange ? length === 0 : true);\n              }\n            }));\n          }\n        }\n      }\n    }\n  });\n});\n//# sourceMappingURL=Widget.js.map\n"]}
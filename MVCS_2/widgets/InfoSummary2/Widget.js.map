{"version":3,"sources":["../../../widgets/InfoSummary2/Widget.js"],"names":["define","BaseWidget","LayerInfos","utils","dom","domClass","domConstruct","on","domStyle","declare","lang","html","dojoColor","all","array","DeferredList","Deferred","query","fx","gfx","xhr","_WidgetsInTemplateMixin","Graphic","Point","FeatureLayer","SimpleMarkerSymbol","PictureMarkerSymbol","SimpleLineSymbol","SimpleFillSymbol","Color","Query","QueryTask","FeatureSet","arcgisUtils","jsonUtils","esriRequest","SimpleRenderer","jsonUtil","ClusterLayer","LayerDrawingOptions","baseClass","name","opLayerInfos","layerList","UNIQUE_APPEND_VAL_CL","widgetChange","refreshInterval","refreshIntervalValue","configLayerInfos","legendNodes","currentQueryList","symbols","row","departamento","provincia","distrito","selectedColor","queryDepartamento","queryTaskDepartamento","featureLayerDepartamento","id","outFields","mode","MODE_SELECTION","showLabels","queryProvincia","queryTaskProvincia","featureLayerProvincia","queryDistrito","queryTaskDistrito","featureLayerDistrito","_settingDepartamento","window","paramDepartamento","returnGeometry","OBJECTID","IDDEPARTAMENTO","NAME_DEPARTAMENTO","setScaleRange","setObject","map","addLayer","_settingProvincia","paramProvincia","orderByFields","IDPROVINCIA","NAME_PROVINCIA","_settingDistrito","paramDistrito","IDDISTRITO","NAME_DISTRITO","_lineColor","color","_fillLineColor","fill1","line1","line2","line3","_clearNodes","item","i","length","nodeName","style","error","console","log","message","_countProject","queryString","substring","trim","getLayer","setDefinitionExpression","_zoomDistrito","objectId","objectIds","selectFeatures","SELECTION_NEW","features","setExtent","geometry","getExtent","expand","bind","_onClickDistrito","thisValue","event","target","attributes","value","parentNode","childNodes","innerText","_errorDistrito","tagHtml","push","clearSelection","CboDistrito","innerHTML","join","_callDistrito","featuresLength","featureAttributes","_zoomProvincia","_onClickProvincia","where","execute","_errorProvincia","CboProvincia","_callProvincia","_zoomDepartamento","erro","_onClickDepartamento","nameDepartamento","_errorDepartamento","_stringToHTML","str","doc","DOMParser","parser","parseFromString","body","_callDepartamento","CboDepartamento","_onClickAmbito","_homeNode","click","_activeTabSearch","positionTab","tabs4","document","querySelectorAll","tabsContent4","deactvateAllTabs","forEach","tab","classList","remove","hideTabsContent","tabContent","activateTabsContent","getIndex","add","el","parentElement","children","indexOf","currentValue","index","addEventListener","_getPanel","paramWidget","paramHeight","panel","getPanel","pos","position","width","height","setPosition","_onLoadDepartamento","postCreate","inherited","arguments","inPanelOverrides","appConfig","theme","config","layerInfos","_initWidget","_forceClose","themeName","dcThemes","p","containerNode","display","widgetManager","closeWidget","getParent","_toggleBox","ss","outerHTML","aw","widgets","widgetOnScreen","ii","isThemeWidget","getWidgetById","_switchNodeToClose","_closeDropMenu","iconClickHandler","undefined","hidePanel","iconNodeThemes","iconNodes","hitch","firstChild","className","padding","_updateBackgroundColors","isDartTheme","isDashboardTheme","contains","pageHeader","updateForDartTheme","updateForBoxTheme","updateForTabTheme","updateForLaunchpadTheme","updateForBillboardTheme","updateForPlateauTheme","updateForDashboardTheme","top","fc","isOnScreen","right","left","lastUpdated","useDarkText","startup","showAllFeatures","mapExtentChangedHandler","_mapExtentChange","getElementById","onOpen","_updatePanelHeader","styles","_updateStyleColor","visibleSubLayers","key","layerListLayer","li","lo","layerObject","orgRenderer","setRenderer","newRenderer","setLayerDrawingOptions","optionsArray","drawingOptions","renderer","subLayerId","refresh","_Pl","parentLayerID","l","visibleLayers","_foundIt","sub_layers_id_loop","subVizLyrId","layers","x","subLayerLoop","o","visLayers","inVisLayers","plVis","parentLayerVisible","loPlVis","type","visible","splice","graphicsLayerIds","setVisibility","updatePanelVisibility","_parentLayer","expandList","legendOpen","isLoaded","visScaleRange","_inVisibleRange","updateList","parentLayer","setVisibleLayers","refreshEnabled","enableRefresh","infoWindow","highlight","c","byId","countEnabled","listDisabled","toggleLegend","checkedTime","itemId","getItem","tempVal","setInterval","refreshLayers","clearInterval","portalUrl","substr","url","content","f","requestTime","Date","now","then","response","itemModified","modified","update","lastModifiedTime","_updatePanelTime","_updateItem","modifiedTime","_d","_f","dateFormat","fieldFormatter","getFormattedDate","lyr","featureCollection","_updateLayerItem","responseLayer","list","fields","k","pl","layerDefinition","symbolData","featureDisplayOptions","refreshFeatures","_loadList","featureSet","graphics","responseFeatureSetFeatures","mapFeatureSetFeatures","responseSR","_getSpatialReference","mapSR","gra","g","geom","rings","paths","points","y","mixin","spatialReference","wkid","transform","fs","shouldUpdate","JSON","stringify","requiresReload","layerListExtentChanged","clear","sr","j","go","getGraphicOptions","setAttributes","_infoTemplate","setInfoTemplate","countFeatures","hasOwnProperty","firstFeature","graphicOptions","getInstance","itemInfo","operLayerInfos","wmLayerInfos","getLayerInfoArrayOfWebmap","getLayerInfoArray","_updateLayerIDs","upgradeFields","_upgradeFields","_createPanelUI","_addFilterChanged","_addVisibleChanged","_addZoomChanged","removeIDs","getUrl","configLayer","jimuLayerInfo","config_layer_loop","getLayerInfoById","updated","wm_layer_loop","_opLayer","originOpLayer","originOperLayer","urlId","_compareURL","_compareItemID","subId","_compareSubId","layer","sort","a","b","opLayer","geomMatch","_compareGeom","fieldMatch","_compareFields","fcLayers","fcLayer","geometryType","matchingFields","filter","fn","configField","lyrInfo","oidFieldName","objectIdField","firstLayerFieldName","firstLayerFieldAlias","layerFields","layer_field_loop","_i","alias","keyFieldName","keyFieldAlias","infoTemplate","info","fieldInfos","getInfoTemplate","subLayers","getSubLayers","sub_layers_loop","sli","sl","title","popupFields","popup_field_loop","popupField","fieldName","label","parseFloat","wabVersion","own","changedLayerInfoArray","layerInfo","clId","getFilter","_initFeatures","_updateVisibility","vis","isShowInMap","_toggleLayerUI","changedLayerInfos","traversal","panelTitle","w","displayPanelIcon","removeClass","mainPanelText","addClass","pageBody","pageTitle","panelMainIcon","mainPanelIcon","jimuLayerInfos","numClusterLayers","_updateUI","_clearChildNodes","pageMain","updateEnd","clusterType","updateThemeClusterSymbol","getLayerType","layerType","getLayerObject","updateLayerList","_updateEnd","addMapLayers","results","lid","updating","sd","_styleColor","_rgb","fromHex","xx","evenOdd","r","rr","bb","gg","clusterSymbol","outline","removeOldClusterLayers","lInfos","deleteLayers","layer_info_loop","potentialNewClusterID","clusteringEnabled","dl","_dl","setTopLayerVisible","removeLayer","destroy","ids","Object","keys","reverse","lyrType","ll","selfType","_checkSelfType","_checkListDisabled","_getClusterLayer","parentLayerInfo","_lyr","empty","getFeatureLayers","featureLayers","fl","updateRenderer","_addPanelItem","_lo","symbolType","fromJson","symbol","_onRecNodeMouseover","rec","isLightTheme","_onRecNodeMouseout","potentialNewID","cssAry","create","expandClass","isInScale","setStyle","recIcon","panelImageData","toString","img","createElement","icon","src","_createImageDataDiv","set","recLabel","recNum","node","_addLegend","_updateNode","nodeCount","_toggleLayerVisibility","_toggleLegend","_class","legendNode","_getListFields","infoTemp","_getInfoTemplate","fieldInfo","displayOptions","field","groupField","updateCount","_addSearching","clusterFeatures","clusterGraphics","_features","z","clusterGraphic","setTimeout","_updateList","_removeSearching","getFeatures","disabled","eD","eU","eS","clusterLayer","n","configChange","_layers","reloadData","refreshData","countColor","_highLightColor","toDom","displayFeatureCount","_setupSymbols","sym","h","parent","isCustom","ar","setWidth","setHeight","size","setSize","mySurface","createSurface","descriptors","getShapeDescriptors","shape","createShape","defaultShape","setFill","fill","setStroke","stroke","applyTransform","dx","dy","styleName","removeDownClass","addDownClass","_updateNodes","removeUpClass","addUpClass","removeExpandClass","addExpandClass","removeGroupItemUpClass","addGroupItemUpClass","removeGroupItemDownClass","addGroupItemDownClass","removeGroupItemClass","addGroupItemClass","nodes","obj","e","stopPropagation","hide","hasSubLayerId","_vis","currentLayerInfo","handleMapExtentChange","levelChange","flashFeatures","visibility","visScalRange","isCurrentScaleInTheScaleRange","_append","evt","currentTarget","_toggleGroup","slice","fI","toggle","gII","gIIUp","gIIDown","lId","_idx","openGroups","groupOpen","idx","onAppConfigChanged","reason","changedData","_clearMap","bc","getComputedStyle","getPropertyValue","fromRgb","toHex","setStyleColor","_clear","continuousRefreshEnabled","_close","onClose","disableRefresh","hasChildNodes","removeChild","lastChild","visibleAtMapScale","queries","_clearList","groupEnabled","initalLoad","uNode","_needsGeom","maxRecordCount","q","_getQuery","queryFeatures","queryIds","qt","executeForIds","featurePromises","s_id","updateNode","previousSibling","_queries","queryIDs","count","_chunkRequest","fullFeatures","localizeNumber","updateExpand","IDs","max","needsGeom","def","queryList","queryResults","allFeatures","apply","resolve","countOnly","_graphicsLayer","_fields","groupNodes","finalGroupNodes","finalDomNodes","groupAdded","feature","getSymbol","oidName","_layer","flds","isNames","displayStringObj","getDisplayString","displayString","aliasNames","firstValue","groupNode","groupContainer","displayValue","groupType","featureValue","_value","appendVal","groupByField","groupByRendererOptions","groubByFields","groupByValues","values","expression_loop","_val","exp","expParts","split","isNaN","eval","replace","gId","addGroup","node_loop","iii","gNode","groupTitle","_getFormattedValue","clone","inGrpList","groupCountNode","imageContainer","cNames","countNode","result","featureItem","_panToFeature","_margin","_txtAlign","isRTL","localeCompare","cE","appendChild","sortedNodes","_a","_b","fdn","place","loaded","queryPending","en","displayField","_checkAliasName","hasLabel","append","_fieldsMap","Array","isArray","_getFieldByName","intField","_checkIntField","domainField","_checkDomainField","dateField","_checkDateField","formatDateValue","formatDomainValue","formatNumberValue","infoTemplates","v","num","options","format","localizeNumberByFieldInfo","domain","codedValues","cvs","cv","code","d","parseInt","localizeDateByFieldInfo","localizeDate","testTypes","_checkDisplayField","displayFields","featureField","includeField","flashGraphics","_flashFeature","color2","STYLE_CIRCLE","STYLE_SOLID","STYLE_DIAGONAL_CROSS","dShape","getDojoShape","animateStroke","duration","start","strokeStyle","end","play","_clearFeature","gl","path","Math","ceil","getCenter","_pan","setFeatures","select","show","centerPoint","extent","centerAt","ext","collectionTypes","isCollection","fullExtent","queryCount"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright © 2014 - 2018 Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n/*jshint loopfunc: true */\ndefine([\n  'jimu/BaseWidget',\n  'jimu/LayerInfos/LayerInfos',\n  'jimu/utils',\n  'dojo/dom',\n  'dojo/dom-class',\n  'dojo/dom-construct',\n  'dojo/on',\n  'dojo/dom-style',\n  'dojo/_base/declare',\n  'dojo/_base/lang',\n  'dojo/_base/html',\n  'dojo/_base/Color',\n  'dojo/promise/all',\n  'dojo/_base/array',\n  'dojo/DeferredList',\n  'dojo/Deferred',\n  'dojo/query',\n  \"dojox/gfx/fx\",\n  'dojox/gfx',\n  'dojo/_base/xhr',\n  'dijit/_WidgetsInTemplateMixin',\n  'esri/graphic',\n  'esri/geometry/Point',\n  'esri/layers/FeatureLayer',/**/\n  'esri/symbols/SimpleMarkerSymbol',\n  'esri/symbols/PictureMarkerSymbol',\n  'esri/symbols/SimpleLineSymbol',\n  'esri/symbols/SimpleFillSymbol',\n  'esri/Color',\n  'esri/tasks/query',\n  'esri/tasks/QueryTask',\n  \"esri/tasks/FeatureSet\",\n  \"esri/arcgis/utils\",\n  'esri/symbols/jsonUtils',\n  'esri/request',\n  \"esri/renderers/SimpleRenderer\",\n  \"esri/renderers/jsonUtils\",\n  './js/ClusterLayer', 'esri/layers/LayerDrawingOptions'\n  ], \n  function (\n    BaseWidget,\n    LayerInfos,\n    utils,\n    dom,\n    domClass,\n    domConstruct,\n    on,\n    domStyle,\n    declare,\n    lang,\n    html,\n    dojoColor,\n    all,\n    array,\n    DeferredList,\n    Deferred,\n    query,\n    fx,\n    gfx,\n    xhr,\n    _WidgetsInTemplateMixin,\n    Graphic,\n    Point,\n    FeatureLayer,/**/\n    SimpleMarkerSymbol,\n    PictureMarkerSymbol,\n    SimpleLineSymbol,\n    SimpleFillSymbol,\n    Color,\n    Query,\n    QueryTask,\n    FeatureSet,\n    arcgisUtils,\n    jsonUtils,\n    esriRequest,\n    SimpleRenderer,\n    jsonUtil,\n    ClusterLayer,\n    LayerDrawingOptions\n  ) {\n  return declare([BaseWidget, _WidgetsInTemplateMixin], {\n    baseClass: 'jimu-widget-InfoSummary',\n\n    name: \"InfoSummary2\",\n    opLayerInfos: null,\n    layerList: {},\n    UNIQUE_APPEND_VAL_CL: \"_CL\",\n    widgetChange: false,\n    refreshInterval: 0,\n    refreshIntervalValue: 0,\n    configLayerInfos: [],\n    legendNodes: [],\n    currentQueryList: [],\n    symbols: [],\n    row: null,\n    \n    // FIELD Departamento\n    departamento: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dpto\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\"\n    },\n    // FIELD Provincia\n    provincia: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dpto\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\",\n      \"IDPROVINCIA\":\"id_prov\",\n      \"NAME_PROVINCIA\":\"nom_prov\",\n    },\n    // FIELD Distrito\n    distrito: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dep\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\",\n      \"IDPROVINCIA\":\"id_prov\",\n      \"NAME_PROVINCIA\":\"nom_prov\",\n      \"IDDISTRITO\":\"id_dist\",\n      \"NAME_DISTRITO\":\"nom_dist\"\n    },\n\n    selectedColor: \"#D6DDEB\",\n    \n    // ************** DEPARTAMENTO //\n    // Query\n    queryDepartamento: new Query(),\n    // Query Task\n    queryTaskDepartamento: new QueryTask (\n      \"https://dportalgis.vivienda.gob.pe/dfdserver/rest/services/OGEI/limites_peru/MapServer/6\"\n    ),\n    // Feature Layer\n    featureLayerDepartamento: new FeatureLayer(\n      \"https://dportalgis.vivienda.gob.pe/dfdserver/rest/services/OGEI/limites_peru/MapServer/6\",\n      {\n        id:\"Departamento1\", outFields: [\"*\"],\n        mode: FeatureLayer.MODE_SELECTION,\n        showLabels: true\n      }\n    ),\n    // ************** DEPARTAMENTO //\n\n    // ************** PROVINCIA //\n    // Query\n    queryProvincia: new Query(),\n    // Query Task\n    queryTaskProvincia: new QueryTask (\n      \"https://dportalgis.vivienda.gob.pe/dfdserver/rest/services/OGEI/limites_peru/MapServer/8\"\n    ),\n    // Feature Layer\n    featureLayerProvincia: new FeatureLayer(\n      \"https://dportalgis.vivienda.gob.pe/dfdserver/rest/services/OGEI/limites_peru/MapServer/8\",\n      {\n        id:\"Provincia1\", outFields: [\"OBJECTID\"],\n        mode: FeatureLayer.MODE_SELECTION,\n        showLabels: true\n      }\n    ),\n    // ************** PROVINCIA //\n\n    // ************** DISTRITO //\n    queryDistrito: new Query(),\n    // Query Task\n    queryTaskDistrito: new QueryTask (\n      \"https://dportalgis.vivienda.gob.pe/dfdserver/rest/services/OGEI/limites_peru/MapServer/7\"\n    ),\n    // Feature Layer\n    featureLayerDistrito: new FeatureLayer(\n      \"https://dportalgis.vivienda.gob.pe/dfdserver/rest/services/OGEI/limites_peru/MapServer/7\",\n      {\n        id:\"Distrito1\", outFields: [\"OBJECTID\"],\n        mode: FeatureLayer.MODE_SELECTION,\n        showLabels: true\n      }\n    ),\n    // ************** DISTRITO //\n\n    /* Configurar departamentos */\n    _settingDepartamento: function() {\n      window.paramDepartamento = \"\";\n      this.queryDepartamento.returnGeometry = true;\n      this.queryDepartamento.outFields = [\n        this.departamento.OBJECTID,\n        this.departamento.IDDEPARTAMENTO,\n        this.departamento.NAME_DEPARTAMENTO\n      ];      \n      this.featureLayerDepartamento.setScaleRange(0,0);\n      /*this.featureLayerDepartamento.setRenderer(\n        this._fillLineColor(\"solid\",\"solid\",\"#D10202\",1.5,[209,2,2,0])\n      );\n      */\n      // Se elimina de la lista de capas\n      lang.setObject('_wabProperties.isTemporaryLayer', true, this.featureLayerDepartamento);\n      // Se adiciona al mapa\n      this.map.addLayer(this.featureLayerDepartamento);\n    },\n\n    /* Configurar provincias */\n    _settingProvincia: function() {\n      window.paramProvincia = \"\";\n      this.queryProvincia.orderByFields =  [\"nom_prov ASC\"];\n      this.queryProvincia.returnGeometry = true;\n      this.queryProvincia.outFields = [\n        this.provincia.OBJECTID,\n        this.provincia.IDDEPARTAMENTO,\n        this.provincia.NAME_DEPARTAMENTO,\n        this.provincia.IDPROVINCIA,\n        this.provincia.NAME_PROVINCIA,\n      ];\n      this.featureLayerProvincia.setScaleRange(0,0);\n      /*this.featureLayerProvincia.setRenderer(\n        this._fillLineColor(\"solid\",\"solid\",\"#FF0202\",1.5,[255,2,2,0])\n      );\n      */\n      lang.setObject('_wabProperties.isTemporaryLayer', true, this.featureLayerProvincia);\n      // Se adiciona al mapa\n      this.map.addLayer(this.featureLayerProvincia);\n    },\n\n    /* Configurar provincias */\n    _settingDistrito: function() {\n      window.paramDistrito = \"\";\n      this.queryDistrito.orderByFields =  [\"nom_dist ASC\"];\n      this.queryDistrito.returnGeometry = true;\n      this.queryDistrito.outFields = [\n        this.distrito.OBJECTID,\n        this.distrito.IDDEPARTAMENTO,\n        this.distrito.NAME_DEPARTAMENTO,\n        this.distrito.IDPROVINCIA,\n        this.distrito.NAME_PROVINCIA,\n        this.distrito.IDDISTRITO,\n        this.distrito.NAME_DISTRITO,\n      ];      \n      this.featureLayerDistrito.setScaleRange(0,0);      \n      /*this.featureLayerDistrito.setRenderer (\n        this._fillLineColor(\"solid\",\"solid\",\"#FF7575\",1.5,[255,117,117,0.1])\n      );*/\n      lang.setObject('_wabProperties.isTemporaryLayer', true, this.featureLayerDistrito);\n      //Se adiciona al mapa\n      this.map.addLayer(this.featureLayerDistrito);\n    },\n\n    // Color de línea\n    _lineColor: function(color){\n      if(color == null){\n        return color;\n      }else{\n        return (color = new Color(color));\n      }\n    },\n\n    // Contornos de colores\n    _fillLineColor: function(fill1, line1, line2, line3, color) {\n      return (\n        new SimpleRenderer(\n          new SimpleFillSymbol(\n            fill1, \n            new SimpleLineSymbol(\n              line1,this._lineColor(line2), line3\n            ), \n            this._lineColor(color)\n          )\n        )\n      );\n    }, \n\n    // Limpia la selección del departamento\n    _clearNodes: function(item) {\n      try {\n        for(let i = 0; i<item.length; i++) {\n          if(item[i].nodeName == \"LI\") {\n            item[i].style[\"background-color\"] = \"#FFFFFF\";\n          }          \n        }\n      } catch (error) {\n        console.log(`Error: _clearNodes ${error.name} - ${error.message}`);\n      }\n    },\n\n    _countProject: function() {\n      let queryString = \"\";\n      try {\n        console.log(\" * * * * * \");\n        // QueryString\n        queryString += window.paramDepartamento == \"\"? ``: `departamento = '${window.paramDepartamento}' AND `;\n        queryString += window.paramProvincia ==\"\"? ``: `provincia = '${window.paramProvincia}' AND `;\n        queryString += window.paramDistrito ==\"\"? ``: `distrito = '${window.paramDistrito}' AND`;\n        queryString = queryString.substring(0, queryString.length - 4);\n        console.log(queryString);\n        // Valida si no tiene consultas se debe de llamar tosos los\n        queryString = queryString.trim().length == \"\"? `1=1`: queryString;\n        console.log(queryString);\n        /* Filtrado de capas */\n        this.map.getLayer(`VMVU_VISOR_DECRETO_DE_URGENCIA_9093`)\n          .setDefinitionExpression(`${queryString}`);\n        this.map.getLayer(`VMCS_VISOR_DECRETO_DE_URGENCIA_5572`)\n          .setDefinitionExpression(`${queryString}`);\n      } catch (error) {\n        console.log(`Error: _countProject ${error.name} - ${error.message}`);\n      }\n    },\n\n    _zoomDistrito: function (objectId) {\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerDistrito.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            this.map.setExtent (features[0].geometry.getExtent().expand(1.6));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onClickDistrito: function() {\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[\"data-distritoId\"].value != \"\") {\n          // Limpiar selección\n          this._clearNodes(thisValue.parentNode.childNodes);\n          // Pinta la selección\n          thisValue.style[\"background-color\"] = this.selectedColor;\n          // Asigna nombre de DISTRITO\n          window.paramDistrito = thisValue.innerText.trim();\n          this._zoomDistrito(thisValue.attributes[\"data-objectId\"].value);\n          // Contador de proyectos\n          this._countProject();\n        }\n      } catch (error) {\n        console.log(`Error: _onClickDistrito ${error.name} - ${error.message}`);\n      } \n    },\n\n    // Error - Select PROVINCIA\n    _errorDistrito: function(item) {\n      try {\n        let tagHtml = [];\n        tagHtml.push(`\n          <li class=\"list-group-item\" \n            data-objectId=\"\" \n            data-provinciaId=\"\">\n            Error al cargar\n          </li>`);\n        this.featureLayerDistrito.clearSelection();\n        this.CboDistrito.innerHTML = tagHtml.join(\"\");\n      } catch (error) {\n          console.log(`Error: _errorDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callDistrito: function(item) {\n      try {\n        let tagHtml = [];\n        if(item != null) { \n          featuresLength = item.features.length;\n          for(let i = 0; i < featuresLength; i++) {\n            featureAttributes = item.features[i].attributes;\n            tagHtml.push(`\n              <li class=\"list-group-item\" \n                data-objectId=\"${featureAttributes[this.distrito.OBJECTID]}\" \n                data-distritoId=\"${featureAttributes[this.distrito.IDDISTRITO]}\">\n                ${featureAttributes[this.distrito.NAME_DISTRITO]}\n              </li>`);\n          }\n        } else {\n          tagHtml.push(`\n            <li class=\"list-group-item\">\n              <p class=\"font-italic\">Seleccione Provincia</p>\n            </li>`);\n        }\n        this.featureLayerDistrito.clearSelection();\n        this.CboDistrito.innerHTML = tagHtml.join(\"\");\n      } catch (error) {\n          console.log(`Error: _callDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _zoomProvincia: function (objectId) {\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerProvincia.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            this.map.setExtent(features[0].geometry.getExtent().expand(1.6));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onClickProvincia: function(){\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[`data-provinciaId`].value != \"\") {\n          // Limpiar selección\n          this._clearNodes(thisValue.parentNode.childNodes);\n          // Departamento seleccionado\n          thisValue.style[`background-color`] = this.selectedColor;\n          // Asigna valor el nombre PROVINCIA\n          window.paramProvincia = thisValue.innerText.trim();\n          window.paramDistrito = \"\";\n          // Acercamiento a PROVINCIA\n          this._zoomProvincia(thisValue.attributes[`data-objectId`].value);\n          // Contador proyectos\n          this._countProject();\n          // Consulta de PROVINCIA\n          this.queryDistrito.where = `\n            ${this.distrito.IDDEPARTAMENTO} = '${thisValue.attributes[\"data-departamentoId\"].value.trim()}' AND \n            ${this.distrito.IDPROVINCIA} = '${thisValue.attributes[\"data-provinciaId\"].value.trim()}'`;\n          // Executa consulta de DISTRITOS\n          this.queryTaskDistrito.execute(\n            this.queryDistrito,\n            this._callDistrito.bind(this),\n            this._errorDistrito.bind(this)\n          );          \n        }\n      } catch (error) {\n        console.log(`Error: _onClickProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Error - Select PROVINCIA\n    _errorProvincia: function(item) {\n      try {\n        let tagHtml = [];\n          tagHtml.push(`\n            <li class=\"list-group-item\" \n              data-objectId=\"\" \n              data-provinciaId=\"\">\n              Error al cargar\n            </li>`);\n        this.featureLayerProvincia.clearSelection();\n        this.CboProvincia.innerHTML = tagHtml.join(\"\");\n      } catch (error) {\n        console.log(`Error: _errorProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Carga de PROVINCIAS\n    _callProvincia: function(item) {\n      try {\n        let tagHtml = [];\n        if(item != null) {\n          featuresLength = item.features.length;\n          for(let i = 0; i < featuresLength; i++) {\n            this.featureAttributes = item.features[i].attributes;\n            tagHtml.push(`\n              <li class=\"list-group-item\" \n                data-objectId=\"${this.featureAttributes[this.provincia.OBJECTID]}\"  \n                data-departamentoId=\"${this.featureAttributes[this.provincia.IDDEPARTAMENTO]}\"  \n                data-provinciaId=\"${this.featureAttributes[this.provincia.IDPROVINCIA]}\">\n                ${this.featureAttributes[this.provincia.NAME_PROVINCIA]}\n              </li>`\n            );\n          }\n        } else {\n          tagHtml.push(`\n            <li class=\"list-group-item\">\n              <p class=\"font-italic\">Seleccione Departamento</p>\n            </li>`\n          );\n        }\n        this._callDistrito(null);\n        this.featureLayerProvincia.clearSelection();\n        this.CboProvincia.innerHTML = tagHtml.join(\"\");\n      } catch (error) {\n        console.log(`Error: _callProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    /* Realiza un acercameinto al departamento */\n    _zoomDepartamento: function (objectId) {\n      // objectId. Es del departamento.\n      // booleanZoom. Es del INPUT CHECKBOX.\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerDepartamento.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            // Valida si el zoom se activa o no\n            this.map.setExtent(features[0].geometry.getExtent().expand(2));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomDepartamento ${erro.name} - ${error.message}`);\n      }\n    },\n\n    _onClickDepartamento: function() {\n      let nameDepartamento;\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[`data-objectId`].value != \"\") {\n          // Limpiar selección\n          this._clearNodes(thisValue.parentNode.childNodes);          \n          // Departamento seleccionado\n          thisValue.style[`background-color`] = this.selectedColor;\n          // Asigna el nombre de DEPARTAMENTO\n          window.paramDepartamento = thisValue.innerText.trim();\n          window.paramProvincia = \"\";\n          window.paramDistrito = \"\";\n          // Acercamiento DEPARTAMENTO\n          this._zoomDepartamento (thisValue.attributes[\"data-objectId\"].value);\n          this._countProject();\n          // Ejecutar llamado de PROVINCIAS\n          this.queryProvincia.where = this.provincia.IDDEPARTAMENTO + \" = '\" + thisValue.attributes[\"data-departamentoId\"].value +\"'\";\n          this.queryTaskProvincia.execute(\n            this.queryProvincia,\n            this._callProvincia.bind(this),\n            this._errorProvincia.bind(this)\n          );\n        }\n      } catch (error) {\n        console.log(`Error: _onClickDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n  \n    // Error - Select DEPARTAMENTAL\n    _errorDepartamento: function(item) {\n      try {\n        let tagHtml = [];\n        tagHtml.push(`\n          <li class=\"list-group-item\" data-objectId=\"\">\n            Error al cargar\n          </li>`\n        );\n      } catch (error) {\n          console.log(`Error: _errorDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n\n    _stringToHTML: function () {\n      var str = `<li class=\"list-group-item\" data-objectId=\"\" name=\"\"></li>`;\n      var doc = new DOMParser().parser.parseFromString(str, 'text/html');\n      return doc.body;\n    },\n\n    _callDepartamento: function(item) {\n      try {\n        let tagHtml = [];\n        this.featureLayerDepartamento.clearSelection();\n        if(item != null) {\n          this.featuresLength = item.features.length;\n          for(let i = 0; i < this.featuresLength; i++) {\n            this.featureAttributes = item.features[i].attributes;\n            tagHtml.push(`<li class=\"list-group-item\"\n                data-objectId=\"${this.featureAttributes[this.departamento.OBJECTID]}\" \n                data-departamentoId=\"${this.featureAttributes[this.departamento.IDDEPARTAMENTO]}\">\n                ${this.featureAttributes[this.departamento.NAME_DEPARTAMENTO]}\n              </li>`\n            );\n          }\n          this.CboDepartamento.innerHTML = tagHtml.join(\"\");\n        } else {\n          /* Se limpia la selección del departamento */\n          this._clearNodes(this.CboDepartamento.childNodes);\n        }\n      } catch (error) {\n        console.log(\"Error: _callDepartamento \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _onClickAmbito: function(){\n      try {\n        /* Limpia DEPARTAMENTO */\n        this._callDepartamento(null);\n        /* Limpia PROVINCIA */\n        this._callProvincia(null);\n        /* Limpia DISTRITO */\n        this._callDistrito(null);\n        /* Limpiar los proyectos */\n        window.paramDepartamento = \"\";\n        window.paramProvincia = \"\";\n        window.paramDistrito = \"\";\n        this._countProject();\n        // Extent default\n        this._homeNode.click();\n      } catch (error) {\n        console.log(\"Error: _onClickAmbito \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _activeTabSearch: function(positionTab) {\n      try {\n        let tabs4 = document.querySelectorAll('.jimu-widget-InfoSummary .tabs .tab');\n        let tabsContent4 = document.querySelectorAll('.jimu-widget-InfoSummary .tab-content');\n\n        let deactvateAllTabs = function () {\n          tabs4.forEach(function (tab) {\n            tab.classList.remove('jimu-state-selected');\n          });\n        };\n\n        let hideTabsContent = function () {\n          tabsContent4.forEach(function (tabContent) {\n            tabContent.classList.remove('jimu-state-selected');\n          });\n        };\n\n        let activateTabsContent = function (tab) {\n          tabsContent4[getIndex(tab)].classList.add('jimu-state-selected');\n        };\n\n        let getIndex = function (el) {\n          return [...el.parentElement.children].indexOf(el);\n        };\n\n        tabs4.forEach(function (currentValue, index, array) {\n          currentValue.addEventListener('click', function () {\n              deactvateAllTabs();\n              hideTabsContent();\n              currentValue.classList.add('jimu-state-selected');\n              activateTabsContent(currentValue);\n          }.bind(this));\n        }.bind(this));\n\n        tabs4[positionTab].click();\n      } catch (error) {\n        console.log(\"Error: _activeTabSearch \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    /* Cambiar el tamaño del widget */\n    _getPanel: function(paramWidget, paramHeight) {  \n      try {\n        let panel = this.getPanel();\n        let pos = panel.position;\n        pos.width = paramWidget;\n        pos.height = paramHeight;\n        panel.setPosition(pos);\n      } catch (error) {\n        console.log(\"_getPanel: \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _onLoadDepartamento: function() {\n      this.queryDepartamento.where = \"1=1\";\n      this.queryTaskDepartamento.execute(\n        this.queryDepartamento,\n        this._callDepartamento.bind(this),\n        this._errorDepartamento.bind(this)\n      );\n    },\n\n    postCreate: function postCreate() {\n      this.inherited(arguments);\n      this.inPanelOverrides(this.appConfig.theme.name);\n      this.configLayerInfos = this.config.layerInfos;\n      this.layerList = {};\n      /* Configuracion departamento */\n      this._settingDepartamento();\n      /* Configuracion provincia */\n      this._settingProvincia();\n      /* Configuracion distrito */\n      this._settingDistrito();\n      /* Cargar los departamentos */\n      this._onLoadDepartamento();\n      //populates this.layerInfos and creates the panel\n      this._initWidget();\n      /* Cambiar el tamaño del widget */\n      this._getPanel(320, 650);\n    },\n\n    _forceClose: function _forceClose() {\n      var themeName = this.appConfig.theme.name;\n      var dcThemes = ['LaunchpadTheme', 'DartTheme', 'FoldableTheme', 'JewelryBoxTheme', 'BillboardTheme', 'TabTheme', 'DashboardTheme'];\n      var p = this.getPanel();\n      if (dcThemes.indexOf(themeName) > -1) {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        this.widgetManager.closeWidget(this.id);\n      } else if (themeName === 'BoxTheme') {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        if (p.getParent && p.getParent()._toggleBox) {\n          var ss = query('.icon-node-active');\n          for (var i = 0; i < ss.length; i++) {\n            if (ss[i].outerHTML.indexOf(this.id) > -1) {\n              p.getParent()._toggleBox();\n            }\n          }\n        }\n      } else if (themeName === 'PlateauTheme') {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        this.widgetManager.closeWidget(this.id);\n        if (!this.aw) {\n          var widgets = this.widgetManager.appConfig.widgetOnScreen.widgets;\n          for (var ii = 0; ii < this.widgetManager.appConfig.widgetOnScreen.widgets.length; ii++) {\n            if (widgets[ii].isThemeWidget) {\n              this.aw = this.widgetManager.getWidgetById(widgets[ii].id);\n              this.aw._switchNodeToClose(this.id);\n              this.aw._closeDropMenu();\n              break;\n            }\n          }\n        } else {\n          this.aw._switchNodeToClose(this.id);\n          this.aw._closeDropMenu();\n        }\n      }\n    },\n\n    inPanelOverrides: function inPanelOverrides(themeName) {\n      if (typeof this.iconClickHandler !== 'undefined') {\n        this.iconClickHandler.remove();\n        this.iconClickHandler = undefined;\n      }\n\n      var p = this.getPanel();\n\n      if (this.config.hidePanel) {\n        var iconNodeThemes = ['DartTheme', 'BoxTheme', 'FoldableTheme', 'JewelryBoxTheme', 'PlateauTheme'];\n\n        var iconNodes;\n        if (themeName === 'LaunchpadTheme') {\n          this._forceClose();\n          iconNodes = query('.selected');\n          if (iconNodes.length > 0) {\n            if (iconNodes[0].parentNode.outerHTML.indexOf(this.id) > -1) {\n              this.iconClickHandler = on(iconNodes[0], 'click', lang.hitch(this, this._forceClose));\n            }\n          }\n        } else if (iconNodeThemes.indexOf(themeName) > -1) {\n          if (themeName === 'BoxTheme') {\n            this._forceClose(); //did this for box...make sure it doesn't jack others up\n          }\n          iconNodes = query('.icon-node');\n          for (var i = 0; i < iconNodes.length; i++) {\n            if (iconNodes[i].outerHTML.indexOf(this.id) > -1) {\n              this.iconClickHandler = on(iconNodes[i], 'click', lang.hitch(this, this._forceClose));\n            }\n          }\n        }\n      } else {\n        //TODO test if this has the class .jimu-widget-frame.jimu-container\n        if (p.containerNode && p.containerNode.firstChild && p.containerNode.firstChild.className) {\n          p.containerNode.firstChild.style.padding = '0px 0px 10px 0px';\n        }\n\n        //change associated with the tab theme...all others will show the background color behind refresh text and panel image\n        if (['TabTheme', 'BillboardTheme', 'PlateauTheme', 'DashboardTheme'].indexOf(themeName) === -1) {\n          this._updateBackgroundColors(true);\n        }\n\n        this.isDartTheme = themeName === \"DartTheme\";\n        this.isDashboardTheme = themeName === 'DashboardTheme';\n        if (domClass.contains(this.pageHeader, this.isDartTheme ? 'pageHeader-border' : 'pageHeader-border-dart')) {\n          domClass.remove(this.pageHeader, this.isDartTheme ? 'pageHeader-border' : 'pageHeader-border-dart');\n        }\n        domClass.add(this.pageHeader, this.isDartTheme ? 'pageHeader-border-dart' : 'pageHeader-border');\n\n        switch (themeName) {\n          case 'DartTheme':\n            this.updateForDartTheme(p);\n            break;\n          case 'BoxTheme':\n            this.updateForBoxTheme(p);\n            break;\n          case 'TabTheme':\n            this.updateForTabTheme(p);\n            break;\n          case 'LaunchpadTheme':\n            this.updateForLaunchpadTheme(p);\n            break;\n          case 'BillboardTheme':\n            this.updateForBillboardTheme(p);\n            break;\n          case 'PlateauTheme':\n            this.updateForPlateauTheme(p);\n            break;\n          case 'DashboardTheme':\n            this.updateForDashboardTheme(p);\n            break;\n        }\n      }\n    },\n\n    updateForLaunchpadTheme: function updateForLaunchpadTheme(p) {\n      p.containerNode.style.top = '30px';\n    },\n\n    updateForTabTheme: function updateForTabTheme(p) {\n      if (p.containerNode.children.length > 0) {\n        var fc = p.containerNode.children[0];\n        if (fc.children.length > 1) {\n          fc.children[1].style.padding = '14px 0px 14px 0px';\n        }\n      }\n      if (!p.config.isOnScreen) {\n        this._updateBackgroundColors(false);\n      }\n    },\n\n    updateForBoxTheme: function updateForBoxTheme(p) {\n      p.containerNode.parentNode.style.top = '140px';\n    },\n\n    updateForDartTheme: function updateForDartTheme(p) {\n      p.containerNode.style.right = '0px';\n      p.containerNode.style.left = '0px';\n    },\n\n    updateForBillboardTheme: function updateForBillboardTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    updateForPlateauTheme: function updateForPlateauTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    updateForDashboardTheme: function updateForDashboardTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    _updateBackgroundColors: function _updateBackgroundColors(add) {\n      //deal with text color\n      if (domClass.contains(this.lastUpdated, add ? 'lastUpdated-tab' : 'lastUpdated')) {\n        domClass.remove(this.lastUpdated, add ? 'lastUpdated-tab' : 'lastUpdated');\n      }\n      domClass.add(this.lastUpdated, add ? 'lastUpdated' : 'lastUpdated-tab');\n\n      add = add && this.appConfig.theme.name !== 'DashboardTheme';\n      this.useDarkText = !add;\n\n      //deal with background color for page header\n      if (domClass.contains(this.pageHeader, 'jimu-main-background') && !add) {\n        domClass.remove(this.pageHeader, 'jimu-main-background');\n      } else if (!domClass.contains(this.pageHeader, 'jimu-main-background') && add) {\n        domClass.add(this.pageHeader, 'jimu-main-background');\n      }\n      if (domClass.contains(this.pageHeader, 'dart-bgcolor') && !add) {\n        domClass.remove(this.pageHeader, 'dart-bgcolor');\n      } else if (!domClass.contains(this.pageHeader, 'dart-bgcolor') && add) {\n        domClass.add(this.pageHeader, 'dart-bgcolor');\n      }\n      if (domClass.contains(this.pageHeader, 'box-bgcolor') && !add) {\n        domClass.remove(this.pageHeader, 'box-bgcolor');\n      } else if (!domClass.contains(this.pageHeader, 'box-bgcolor') && add) {\n        domClass.add(this.pageHeader, 'box-bgcolor');\n      }\n    },\n\n    startup: function startup() {\n      this.inherited(arguments);\n      if (!this.hidePanel && !this.showAllFeatures) {\n        this.mapExtentChangedHandler = this.map.on(\"extent-change\", lang.hitch(this, this._mapExtentChange));\n        this._mapExtentChange();\n      } else if (this.showAllFeatures) {\n        this._mapExtentChange();\n      }\n      \n      document.getElementById(\"Departamentos\").click();\n      /* Pestaña que se activa \n        - 0. Activa la pestaña de ESPECIFICO\n        - 1. Activa la pestaña de GENERAL */\n      this._activeTabSearch(1); \n      \n    },\n\n    onOpen: function onOpen() {\n      this.widgetChange = false;\n\n      if (!this.hidePanel) {\n        this._updatePanelHeader();\n      } else {\n        if (this.appConfig.theme.name !== 'BoxTheme') {\n          this._forceClose();\n        }\n      }\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        this._updateStyleColor(this.appConfig.theme.styles[0]);\n      }\n\n      var visibleSubLayers = [];\n      //update the renderer for the layer in the layer list if a new one has been defined\n      for (var key in this.layerList) {\n        var layerListLayer = this.layerList[key];\n        var li = layerListLayer.li;\n        var lo = layerListLayer.layerObject;\n        if (li && li.orgRenderer) {\n          if (lo.setRenderer) {\n            lo.setRenderer(li.newRenderer);\n          } else if (lo.setLayerDrawingOptions) {\n            var optionsArray = [];\n            var drawingOptions = new LayerDrawingOptions();\n            drawingOptions.renderer = li.newRenderer;\n            optionsArray[li.subLayerId] = drawingOptions;\n            lo.setLayerDrawingOptions(optionsArray);\n          } else {\n            console.log(\"Error setting the new renderer...will use the default rendering of the layer\");\n          }\n          if (typeof lo.refresh === 'function') {\n            lo.refresh();\n          }\n        }\n\n        var _Pl;\n        if (lo && lo.layerInfos) {\n          _Pl = lo;\n        } else if (li && typeof li.parentLayerID !== 'undefined') {\n          _Pl = this.map.getLayer(li.parentLayerID);\n        }\n\n        var l;\n        if (_Pl && _Pl.visibleLayers) {\n          var _foundIt = false;\n          sub_layers_id_loop: for (var ii = 0; ii < visibleSubLayers.length; ii++) {\n            var subVizLyrId = visibleSubLayers[ii].id;\n            if (subVizLyrId === _Pl.id) {\n              _foundIt = true;\n              break sub_layers_id_loop;\n            }\n          }\n          if (visibleSubLayers.length === 0 || !_foundIt) {\n            visibleSubLayers.push({\n              id: _Pl.id,\n              layers: _Pl.visibleLayers\n            });\n          }\n          var x = 0;\n          subLayerLoop: for (x; x < visibleSubLayers.length; x++) {\n            var o = visibleSubLayers[x];\n            if (o.id === _Pl.id) {\n              break subLayerLoop;\n            }\n          }\n          var visLayers = visibleSubLayers[x].layers;\n          if (_Pl.layerInfos) {\n            //Handle MapService layers\n            if (_Pl.layerInfos.length > 0) {\n              if (li && typeof li.subLayerId !== 'undefined') {\n                var inVisLayers = visLayers.indexOf(li.subLayerId) > -1;\n                var plVis = layerListLayer.parentLayerVisible;\n                var loPlVis = layerListLayer.layerObject.parentLayerVisible;\n                if (layerListLayer.type === \"ClusterLayer\" && (inVisLayers || plVis || loPlVis)) {\n                  layerListLayer.parentLayerVisible = true;\n                  layerListLayer.layerObject.parentLayerVisible = true;\n                  layerListLayer.visible = true;\n                  if (inVisLayers) {\n                    visLayers.splice(visLayers.indexOf(li.subLayerId), 1);\n                  }\n                } else if (inVisLayers || plVis) {\n                  layerListLayer.parentLayerVisible = true;\n                  layerListLayer.visible = true;\n                  if (visLayers.indexOf(li.subLayerId) === -1) {\n                    visLayers.push(li.subLayerId);\n                  }\n                } else {\n                  layerListLayer.parentLayerVisible = false;\n                  layerListLayer.visible = false;\n                  if (inVisLayers) {\n                    visLayers.splice(visLayers.indexOf(li.subLayerId), 1);\n                  }\n                  if (layerListLayer.type === \"ClusterLayer\") {\n                    layerListLayer.layerObject.parentLayerVisible = false;\n                    if (this.map.graphicsLayerIds.indexOf(layerListLayer.id) > -1) {\n                      l = this.map.getLayer(layerListLayer.id);\n                      l.setVisibility(false);\n                    }\n                  }\n                }\n              }\n            }\n            visibleSubLayers[x].layers = visLayers;\n          }\n          this.updatePanelVisibility(layerListLayer, key, layerListLayer);\n        } else if (lo) {\n          //Handle non MapService layers\n          if (layerListLayer.type === \"ClusterLayer\") {\n            if (lo._parentLayer) {\n              if (this.map.graphicsLayerIds.indexOf(layerListLayer.id) > -1) {\n                l = this.map.getLayer(layerListLayer.id);\n                if (typeof layerListLayer.layerObject.parentLayerVisible === 'undefined') {\n                  layerListLayer.parentLayerVisible = lo._parentLayer.visible;\n                  layerListLayer.layerObject.parentLayerVisible = lo._parentLayer.visible;\n                }\n                l.setVisibility(layerListLayer.layerObject.parentLayerVisible);\n              }\n              if (lo._parentLayer.setVisibility) {\n                lo._parentLayer.setVisibility(false);\n              }\n            }\n          }\n          this.updatePanelVisibility(lo, key, layerListLayer);\n        }\n\n        if (this.showAllFeatures && this.config.expandList && layerListLayer.legendOpen && !layerListLayer.isLoaded) {\n          var visScaleRange = layerListLayer.visScaleRange;\n          if (typeof visScaleRange !== 'undefined') {\n            visScaleRange = this._inVisibleRange(layerListLayer, key);\n          }\n          if (layerListLayer.visible && visScaleRange) {\n            layerListLayer.updateList = true;\n          }\n        }\n      }\n\n      for (var i = 0; i < visibleSubLayers.length; i++) {\n        var parentLayer = this.map.getLayer(visibleSubLayers[i].id);\n        if (parentLayer) {\n          parentLayer.setVisibleLayers(visibleSubLayers[i].layers);\n        }\n      }\n\n      if (!this.hidePanel && !this.showAllFeatures) {\n        if (typeof this.mapExtentChangedHandler === 'undefined') {\n          this.mapExtentChangedHandler = this.map.on(\"extent-change\", lang.hitch(this, this._mapExtentChange));\n          this._mapExtentChange();\n        }\n      }\n\n      //if refresh is enabled set refereshInterval on any widget source layers with refresh set to true\n      //and call setInterval to refresh the static graphics\n      if (this.config.refreshEnabled) {\n        this.enableRefresh();\n      }\n\n      if (this.map.infoWindow) {\n        this.map.infoWindow.highlight = true;\n      }\n    },\n\n    updatePanelVisibility: function updatePanelVisibility(lo, key, layerListLayer) {\n      if (!this.hidePanel) {\n        if (typeof lo.visible !== 'undefined') {\n          //var visScaleRange = this._inVisibleRange(layerListLayer, key);\n          var visScaleRange = layerListLayer.visScaleRange;\n          var c = dom.byId(\"recLabel_\" + key);\n          if (!lo.visible) {\n            if (domClass.contains(\"recIcon_\" + key, \"active\")) {\n              domClass.remove(\"recIcon_\" + key, \"active\");\n            }\n            if (this.config.countEnabled) {\n              if (domClass.contains(\"recNum_\" + key, \"recNum\")) {\n                domClass.remove(\"recNum_\" + key, \"recNum\");\n                domClass.add(\"recNum_\" + key, \"recNumInActive\");\n              }\n            }\n            if (c && c.firstChild) {\n              domClass.add(c.firstChild, \"inActive\");\n            }\n            if (!layerListLayer.listDisabled) {\n              if (!domClass.contains(\"exp_\" + key, \"expandInActive\")) {\n                domClass.add(\"exp_\" + key, \"expandInActive\");\n              }\n              layerListLayer.toggleLegend.remove();\n            }\n            if (domClass.contains(\"rec_\" + key, \"rec\")) {\n              domClass.add(\"rec_\" + key, \"recDefault\");\n            }\n          } else {\n            if (!domClass.contains(\"recIcon_\" + key, \"active\")) {\n              domClass.add(\"recIcon_\" + key, \"active\");\n            }\n            if (this.config.countEnabled) {\n              if (domClass.contains(\"recNum_\" + key, \"recNumInActive\")) {\n                domClass.remove(\"recNum_\" + key, \"recNumInActive\");\n                domClass.add(\"recNum_\" + key, \"recNum\");\n              }\n            }\n            if (c && c.firstChild) {\n              domClass.remove(c.firstChild, \"inActive\");\n            }\n            if (!layerListLayer.listDisabled) {\n              if (typeof visScaleRange === 'undefined' || visScaleRange) {\n                if (domClass.contains(\"exp_\" + key, \"expandInActive\")) {\n                  domClass.remove(\"exp_\" + key, \"expandInActive\");\n                }\n              }\n            }\n            if (domClass.contains(\"rec_\" + key, \"recDefault\")) {\n              domClass.remove(\"rec_\" + key, \"recDefault\");\n            }\n          }\n        }\n      }\n    },\n\n    enableRefresh: function enableRefresh() {\n      //set refreshItereval on all widget source layers that support it\n      var layerListLayer = null;\n      var checkedTime = false;\n      for (var key in this.layerList) {\n        var id;\n        layerListLayer = this.layerList[key];\n        if (layerListLayer.li) {\n          id = layerListLayer.li.itemId;\n        }\n        if (layerListLayer.type !== \"ClusterLayer\") {\n          layerListLayer = layerListLayer.layerObject;\n        } else {\n          for (var i = 0; i < this.layerInfos.length; i++) {\n            var l = this.layerInfos[i];\n            if (l.layerObject) {\n              layerListLayer = l.layerObject;\n              break;\n            }\n          }\n        }\n        if (!checkedTime && id) {\n          this.getItem(id);\n          checkedTime = true;\n        }\n        if (layerListLayer) {\n          layerListLayer.refreshInterval = this.config.refreshInterval;\n        }\n      }\n\n      var tempVal = this.config.refreshInterval * 60000;\n      if (this.refreshInterval === 0 && this.refreshIntervalValue === 0) {\n        //set the refresh interval based on the configs interval value\n        this.refreshIntervalValue = tempVal;\n        this.refreshInterval = setInterval(lang.hitch(this, this.refreshLayers), this.refreshIntervalValue);\n      } else if (this.refreshIntervalValue !== 0 && this.refreshIntervalValue !== tempVal) {\n        //clear and update the refresh interval if the configs refresh interval has changed\n        this.refreshIntervalValue = tempVal;\n        clearInterval(this.refreshInterval);\n        this.refreshInterval = 0;\n        this.refreshInterval = setInterval(lang.hitch(this, this.refreshLayers), this.refreshIntervalValue);\n      }\n    },\n\n    getItem: function getItem(id) {\n      var portalUrl = window.portalUrl.substr(-1) !== '/' ? window.portalUrl += '/' : window.portalUrl;\n      var url = portalUrl + \"sharing/rest/content/items/\" + id;\n      esriRequest({\n        url: url,\n        content: {\n          f: \"json\",\n          requestTime: Date.now()\n        }\n      }).then(lang.hitch(this, function (response) {\n        if (response) {\n          var itemModified = response.modified;\n          var update = true;\n          if (this.lastModifiedTime) {\n            update = this.lastModifiedTime < itemModified;\n          }\n          if (this.currentQueryList.indexOf(id) > -1) {\n            this.currentQueryList.splice(this.currentQueryList.indexOf(id), 1);\n          }\n          if (update) {\n            this.lastModifiedTime = itemModified;\n            this._updatePanelTime(itemModified);\n            esriRequest({\n              url: url + '/data',\n              content: {\n                f: \"json\",\n                requestTime: Date.now()\n              }\n            }).then(lang.hitch(this, this._updateItem, id));\n          }\n        }\n      }));\n    },\n\n    _updatePanelTime: function _updatePanelTime(modifiedTime) {\n      if (!this.hidePanel) {\n        this.lastUpdated.innerHTML = \"<div></div>\";\n        var _d = new Date(modifiedTime);\n        var _f = { dateFormat: 'shortDateShortTime' };\n        this.lastUpdated.innerHTML = utils.fieldFormatter.getFormattedDate(_d, _f);\n      }\n    },\n\n    refreshLayers: function refreshLayers() {\n      for (var key in this.layerList) {\n        var lyr = this.layerList[key];\n        var id;\n        if (lyr.li && lyr.li.itemId) {\n          id = lyr.li.itemId;\n        } else if (lyr.layerObject.itemId) {\n          id = lyr.layerObject.itemId;\n        }\n\n        if (id) {\n          if (this.currentQueryList.indexOf(id) === -1) {\n            this.currentQueryList.push(id);\n            this.getItem(id);\n          }\n        }\n      }\n    },\n\n    _updateItem: function _updateItem(id, response) {\n      var featureCollection = response;\n      for (var i = 0; i < featureCollection.layers.length; i++) {\n        this._updateLayerItem(featureCollection.layers[i], this.lastModifiedTime);\n      }\n      this.currentQueryList.splice(this.currentQueryList.indexOf(id), 1);\n    },\n\n    //TDOO ensure this functions as expected when filter by map extent id disabled\n    _updateLayerItem: function _updateLayerItem(responseLayer) {\n      var layerListLayer;\n      var parentLayer;\n      var list, fields;\n      for (var k in this.layerList) {\n        var lyr = this.layerList[k];\n        if (lyr.pl && lyr.pl.layerDefinition) {\n          if (lyr.pl.layerDefinition.name === responseLayer.layerDefinition.name) {\n            layerListLayer = lyr;\n            parentLayer = lyr.pl;\n            break;\n          }\n        } else if (lyr.layerObject._parentLayer) {\n          if (lyr.layerObject._parentLayer.name === responseLayer.layerDefinition.name) {\n            list = typeof lyr.listDisabled !== 'undefined' ? lyr.listDisabled : false;\n            fields = lyr.li.symbolData.featureDisplayOptions.fields && lyr.li.symbolData.featureDisplayOptions.fields.length > 0;\n            if (!list && fields) {\n              lyr.isLoaded = false;\n            }\n            lyr.layerObject.refreshFeatures(responseLayer);\n            if (lyr.layerObject) {\n              this._loadList(lyr, true);\n            }\n          }\n        } else if (lyr.pl && lyr.pl.name) {\n          if (lyr.pl.name === responseLayer.layerDefinition.name) {\n            layerListLayer = lyr;\n            parentLayer = lyr.pl;\n            break;\n          }\n        }\n      }\n\n      if (responseLayer && layerListLayer && parentLayer && (parentLayer.featureSet || parentLayer.graphics)) {\n        var responseFeatureSetFeatures = responseLayer.featureSet.features;\n\n        var mapFeatureSetFeatures;\n        if (parentLayer.featureSet) {\n          mapFeatureSetFeatures = parentLayer.featureSet.features;\n        } else {\n          mapFeatureSetFeatures = [];\n          var responseSR = this._getSpatialReference(responseFeatureSetFeatures);\n          var mapSR = this._getSpatialReference(parentLayer.graphics);\n          array.forEach(parentLayer.graphics, function (gra) {\n            var g = gra.geometry;\n            var geom = g.rings ? { rings: g.rings } : g.paths ? { paths: g.paths } : g.points ? { points: g.points } : g.x && g.y ? { x: g.x, y: g.y } : {};\n            if (geom !== {}) {\n              mapFeatureSetFeatures.push({\n                attributes: gra.attributes,\n                geometry: lang.mixin({\n                  spatialReference: responseSR && mapSR && responseSR.wkid === mapSR.wkid ? responseSR : mapSR\n                }, geom)\n              });\n            }\n          });\n        }\n\n        if (responseLayer.featureSet.transform) {\n          var fs = new FeatureSet(responseLayer.featureSet);\n          responseFeatureSetFeatures = fs.features;\n        }\n\n        var shouldUpdate = true;\n        //TODO Figure out a better test for larger responses\n        if (responseFeatureSetFeatures.length < 10000) {\n          shouldUpdate = JSON.stringify(mapFeatureSetFeatures) !== JSON.stringify(responseFeatureSetFeatures);\n        }\n\n        if (shouldUpdate) {\n          list = typeof layerListLayer.listDisabled !== 'undefined' ? layerListLayer.listDisabled : false;\n          fields = layerListLayer.li.symbolData.featureDisplayOptions.fields && layerListLayer.li.symbolData.featureDisplayOptions.fields.length > 0;\n          if (!list && fields) {\n            layerListLayer.isLoaded = false;\n            layerListLayer.requiresReload = true;\n          }\n          if (list) {\n            layerListLayer.li.layerListExtentChanged = true;\n          }\n          layerListLayer.layerObject.clear();\n          var sr = layerListLayer.layerObject.spatialReference;\n          for (var j = 0; j < responseFeatureSetFeatures.length; j++) {\n            var item = responseFeatureSetFeatures[j];\n            if (item.geometry) {\n              //check li for renderer also\n              var go = this.getGraphicOptions(item, sr);\n              var gra = new Graphic(go);\n              //removed for https://devtopia.esri.com/WebGIS/arcgis-webappbuilder/issues/11551\n              //gra.setSymbol(go.symbol);\n              gra.setAttributes(item.attributes);\n              if (this._infoTemplate) {\n                gra.setInfoTemplate(this._infoTemplate);\n              }\n              layerListLayer.layerObject.add(gra);\n            } else {\n              console.log(\"Null geometry skipped\");\n            }\n          }\n          layerListLayer.layerObject.refresh();\n          if (parentLayer.featureSet) {\n            parentLayer.featureSet.features = responseFeatureSetFeatures;\n          }\n          this.countFeatures(layerListLayer);\n          if (layerListLayer.layerObject && layerListLayer.layerObject.visible) {\n            this._loadList(layerListLayer, true);\n          }\n        }\n      }\n    },\n\n    _getSpatialReference: function _getSpatialReference(features) {\n      var sr;\n      if (features && features.hasOwnProperty('length') && features.length > 0) {\n        var firstFeature = features[0];\n        if (firstFeature.geometry && firstFeature.geometry.spatialReference) {\n          sr = firstFeature.geometry.spatialReference;\n        }\n      }\n      return sr;\n    },\n\n    getGraphicOptions: function getGraphicOptions(item, sr) {\n      var graphicOptions;\n      if (typeof item.geometry.rings !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            rings: item.geometry.rings,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else if (typeof item.geometry.paths !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            paths: item.geometry.paths,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else if (typeof item.geometry.points !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            points: item.geometry.points,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else {\n        graphicOptions = {\n          geometry: new Point(item.geometry.x, item.geometry.y, item.geometry.spatialReference)\n        };\n      }\n      return graphicOptions;\n    },\n\n    _initWidget: function _initWidget() {\n      this.hidePanel = typeof this.config.hidePanel !== 'undefined' ? this.config.hidePanel : false;\n      this.showAllFeatures = typeof this.config.showAllFeatures !== 'undefined' ? this.config.showAllFeatures : false;\n      if (this.map.itemId) {\n        LayerInfos.getInstance(this.map, this.map.itemInfo).then(lang.hitch(this, function (operLayerInfos) {\n          this.wmLayerInfos = operLayerInfos.getLayerInfoArrayOfWebmap();\n          this.layerInfos = operLayerInfos.getLayerInfoArray();\n          this.operLayerInfos = operLayerInfos;\n          this._updateLayerIDs();\n          if (this.config.upgradeFields) {\n            this._upgradeFields();\n          }\n          this._createPanelUI(this.configLayerInfos, operLayerInfos);\n          this._addFilterChanged(operLayerInfos);\n          this._addVisibleChanged(operLayerInfos);\n          this._addZoomChanged(operLayerInfos);\n        }));\n      }\n    },\n\n    _updateLayerIDs: function _updateLayerIDs() {\n      var removeIDs = [];\n\n      //added to make sure the url we have uses the proxy url\n      //issue: https://devtopia.esri.com/WebGIS/arcgis-webappbuilder/issues/11551\n      var getUrl = function getUrl(configLayer, jimuLayerInfo) {\n        return jimuLayerInfo.layerObject && jimuLayerInfo.layerObject.url ? jimuLayerInfo.layerObject.url : configLayer.url;\n      };\n\n      config_layer_loop: for (var i = 0; i < this.configLayerInfos.length; i++) {\n        var configLayer = this.configLayerInfos[i];\n        var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(configLayer.id);\n\n        //If we cannot find the jimu layer info based on the stored ID we need to determine it\n        if (!jimuLayerInfo) {\n          var updated = false;\n          wm_layer_loop: for (var ii = 0; ii < this.wmLayerInfos.length; ii++) {\n            var _opLayer = this.wmLayerInfos[ii];\n            var originOpLayer = _opLayer ? _opLayer.originOperLayer : undefined;\n\n            var urlId = this._compareURL(originOpLayer, configLayer);\n            var itemId = this._compareItemID(originOpLayer, configLayer);\n            var subId = this._compareSubId(_opLayer, configLayer);\n\n            var id = urlId ? urlId : itemId ? itemId : subId ? subId : undefined;\n            jimuLayerInfo = id ? this.operLayerInfos.getLayerInfoById(id) : jimuLayerInfo;\n\n            if (jimuLayerInfo) {\n              this.configLayerInfos[i].id = jimuLayerInfo.id;\n              this.configLayerInfos[i].layer = jimuLayerInfo.id;\n              this.configLayerInfos[i].url = getUrl(this.configLayerInfos[i], jimuLayerInfo);\n              updated = true;\n              break wm_layer_loop;\n            }\n          }\n\n          if (!updated && !jimuLayerInfo) {\n            removeIDs.push(i);\n          }\n        } else {\n          configLayer.url = getUrl(configLayer, jimuLayerInfo);\n        }\n      }\n\n      //This needs to occur largest to smallest\n      if (removeIDs.length > 0) {\n        //removeIDs.sort((a, b) => (b - a));\n        removeIDs.sort(function (a, b) {\n          return b - a;\n        });\n        array.forEach(removeIDs, lang.hitch(this, function (id) {\n          this.configLayerInfos.splice(id, 1);\n        }));\n      }\n    },\n\n    _compareSubId: function _compareSubId(opLayer, configLayer) {\n      if (opLayer && opLayer.subId && opLayer.subId.indexOf(configLayer.id) > -1) {\n        if (opLayer.layerObject) {\n          var geomMatch = this._compareGeom(opLayer.layerObject, configLayer);\n          var fieldMatch = this._compareFields(opLayer.layerObject, configLayer);\n          if (geomMatch && fieldMatch) {\n            return opLayer.subId;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    _compareItemID: function _compareItemID(originOpLayer, configLayer) {\n      if (originOpLayer && originOpLayer.itemId && originOpLayer.itemId === configLayer.itemId) {\n        if (originOpLayer.featureCollection && originOpLayer.featureCollection.layers && originOpLayer.featureCollection.layers.hasOwnProperty('length')) {\n          var fcLayers = originOpLayer.featureCollection.layers;\n          for (var i = 0; i < fcLayers.length; i++) {\n            var fcLayer = fcLayers[i];\n            if (this._compareGeom(fcLayer, configLayer)) {\n              if (this._compareFields(fcLayer, configLayer)) {\n                return fcLayer.id;\n              }\n            }\n          }\n          return undefined;\n        } else {\n          console.log('error in checking item by itemID');\n        }\n      }\n    },\n\n    _compareURL: function _compareURL(originOpLayer, configLayer) {\n      return originOpLayer && originOpLayer.url && configLayer.url && originOpLayer.url === configLayer.url ? originOpLayer.id : undefined;\n    },\n\n    _compareGeom: function _compareGeom(layerObject, configLayer) {\n      return layerObject && layerObject.geometryType && configLayer.geometryType ? layerObject.geometryType === configLayer.geometryType : undefined;\n    },\n\n    _compareFields: function _compareFields(layerObject, configLayer) {\n      var fieldMatch;\n      if (layerObject && layerObject.fields && configLayer.fields && layerObject.fields.length === configLayer.fields.length) {\n        //test if Names match\n        var matchingFields = layerObject.fields.filter(function (f) {\n          for (var fn = 0; fn < configLayer.fields.length; fn++) {\n            var configField = configLayer.fields[fn];\n            if (f.name === configField.name) {\n              return f;\n            }\n          }\n        });\n        fieldMatch = matchingFields.length === layerObject.fields.length;\n      }\n      return fieldMatch;\n    },\n\n    //added for backwards compatability\n    //could not handle directly in VersionManager as some stored layerInfos\n    // do not have a valid infoTemplate saved\n    _upgradeFields: function _upgradeFields() {\n      if (this.configLayerInfos) {\n        for (var i = 0; i < this.configLayerInfos.length; i++) {\n          var li = this.configLayerInfos[i];\n          if (li && li.symbolData && li.symbolData.featureDisplayOptions) {\n            var lyrInfo = this.operLayerInfos.getLayerInfoById(li.id);\n            if (lyrInfo) {\n              var fields = li.symbolData.featureDisplayOptions.fields;\n              //At previous releases we would use the first field from the infoTemplate or\n              //the first non-OID field from the layer if no fields were selected by the user\n              if (typeof fields === 'undefined' || fields.hasOwnProperty('length') && fields.length === 0) {\n                //check layer fields\n                var layerObject = lyrInfo && lyrInfo.layerObject ? lyrInfo.layerObject : undefined;\n                var oidFieldName = layerObject && layerObject.objectIdField ? layerObject.objectIdField : undefined;\n                var firstLayerFieldName = \"\";\n                var firstLayerFieldAlias = \"\";\n                var layerFields = li.fields ? li.fields : layerObject ? layerObject.fields : undefined;\n                if (layerFields && layerFields.length > 0) {\n                  layer_field_loop: for (var _i = 0; _i < layerFields.length; _i++) {\n                    var f = layerFields[_i];\n                    if (firstLayerFieldName === \"\" && f.type !== \"esriFieldTypeOID\" && f.type !== \"esriFieldTypeGeometry\" && f.name !== oidFieldName) {\n                      firstLayerFieldName = f.name;\n                      firstLayerFieldAlias = f.alias || f.name;\n                    }\n                    if (!oidFieldName) {\n                      oidFieldName = f.type === \"esriFieldTypeOID\" ? f.name : oidFieldName;\n                    }\n                    if (oidFieldName && firstLayerFieldName !== \"\") {\n                      break layer_field_loop;\n                    }\n                  }\n                }\n\n                //check popup fields\n                var keyFieldName = \"\";\n                var keyFieldAlias = \"\";\n                var infoTemplate = li.infoTemplate && li.infoTemplate.info && li.infoTemplate.info.fieldInfos ? li.infoTemplate : lyrInfo ? lyrInfo.getInfoTemplate() : undefined;\n                if (!infoTemplate) {\n                  var subLayers = lyrInfo.getSubLayers();\n                  sub_layers_loop: for (var sli = 0; sli < subLayers.length; sli++) {\n                    var sl = subLayers[sli];\n                    if (sl.title && sl.layerObject && sl.layerObject.name && sl.title === sl.layerObject.name) {\n                      infoTemplate = sl.getInfoTemplate ? sl.getInfoTemplate() : infoTemplate;\n                      break sub_layers_loop;\n                    }\n                  }\n                }\n                var popupFields = infoTemplate ? infoTemplate.info.fieldInfos : [];\n                popup_field_loop: for (var j = 0; j < popupFields.length; j++) {\n                  var popupField = popupFields[j];\n                  if (popupField && popupField.visible) {\n                    if (!oidFieldName || oidFieldName !== popupField.fieldName) {\n                      keyFieldName = popupField.fieldName;\n                      keyFieldAlias = popupField.label || popupField.fieldName;\n                      break popup_field_loop;\n                    }\n                  }\n                }\n\n                //update the config\n                this.configLayerInfos[i].symbolData.featureDisplayOptions.fields = [{\n                  name: keyFieldName ? keyFieldName : firstLayerFieldName,\n                  label: keyFieldName ? keyFieldAlias : firstLayerFieldAlias\n                }];\n              }\n            }\n          }\n        }\n      }\n    },\n\n    _addFilterChanged: function _addFilterChanged(layerInfos) {\n      if (parseFloat(this.appConfig.wabVersion) >= 2.1) {\n        this.own(layerInfos.on('layerInfosFilterChanged', lang.hitch(this, function (changedLayerInfoArray) {\n          array.forEach(changedLayerInfoArray, lang.hitch(this, function (layerInfo) {\n            var id = layerInfo.id;\n            var clId = layerInfo.id + this.UNIQUE_APPEND_VAL_CL;\n            if (this.layerList.hasOwnProperty(id)) {\n              this.layerList[id].filter = layerInfo.getFilter();\n            } else if (this.layerList.hasOwnProperty(clId)) {\n              this.layerList[clId].layerObject.filter = layerInfo.getFilter();\n              this.layerList[clId].layerObject._initFeatures();\n            }\n          }));\n        })));\n      }\n    },\n\n    _updateVisibility: function _updateVisibility(layerInfo) {\n      if (layerInfo) {\n        var id = layerInfo.id;\n        var vis = layerInfo.isShowInMap();\n        if (this.layerList.hasOwnProperty(id)) {\n          var lyr = this.layerList[id];\n          if (id === lyr.li.id && lyr.visible !== vis) {\n            this._toggleLayerUI(lyr.li, vis);\n          } else if (id === lyr.id && lyr.visible !== vis) {\n            this._toggleLayerUI(layerInfo, vis);\n          }\n        }\n      }\n    },\n\n    _addVisibleChanged: function _addVisibleChanged(layerInfos) {\n      this.own(layerInfos.on('layerInfosIsVisibleChanged', lang.hitch(this, function (changedLayerInfos) {\n        array.forEach(changedLayerInfos, function (layerInfo) {\n          this._updateVisibility(layerInfo);\n        }, this);\n      })));\n    },\n\n    _addZoomChanged: function _addZoomChanged(layerInfos) {\n      this.own(on(this.map, 'zoom-end', lang.hitch(this, function () {\n        layerInfos.traversal(lang.hitch(this, function (layerInfo) {\n          this._updateVisibility(layerInfo);\n        }));\n      })));\n    },\n\n    _updatePanelHeader: function _updatePanelHeader() {\n      var panelTitle;\n      var w = this.map.width;\n      if (this.config.displayPanelIcon && w > 750) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n\n          if (this.config.refreshEnabled) {\n            if (this.config.mainPanelText !== \"\") {\n              html.addClass(this.pageHeader, \"pageHeaderRefresh\");\n            } else {\n              html.addClass(this.pageHeader, \"pageHeaderRefreshNoText\");\n            }\n          } else {\n            html.addClass(this.pageHeader, \"pageHeader\");\n          }\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          if (this.config.refreshEnabled) {\n            if (this.config.mainPanelText !== \"\") {\n              html.addClass(this.pageBody, \"pageBodyRefresh\");\n            } else {\n              html.addClass(this.pageBody, \"pageBodyRefreshNoText\");\n            }\n          } else {\n            html.addClass(this.pageBody, \"pageBody\");\n          }\n        }\n\n        if (this.pageTitle) {\n          html.addClass(this.pageTitle, \"pageTitleWidth\");\n          if (this.config.refreshEnabled) {\n            html.removeClass(this.pageTitle, \"pageTitle\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh-tab\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh\");\n            html.addClass(this.pageTitle, this.useDarkText ? \"pageTitleRefresh-tab\" : \"pageTitleRefresh\");\n          } else {\n            html.removeClass(this.pageTitle, \"pageTitleRefresh\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh-tab\");\n            html.addClass(this.pageTitle, \"pageTitle\");\n          }\n        }\n\n        panelTitle = this.config.mainPanelText;\n        if (typeof panelTitle === 'undefined') {\n          panelTitle = \"\";\n        }\n        this.pageTitle.innerHTML = panelTitle;\n        this.panelMainIcon.innerHTML = this.config.mainPanelIcon;\n      } else if (!this.config.displayPanelIcon && !this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n          html.addClass(this.pageHeader, \"pageHeaderNoIcon\");\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBody\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          html.addClass(this.pageBody, \"pageBodyNoIcon\");\n        }\n        this.pageTitle.innerHTML = \"<div></div>\";\n        this.panelMainIcon.innerHTML = \"<div></div>\";\n      } else if (!this.config.displayPanelIcon && this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.addClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBody\");\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.addClass(this.pageBody, \"pageBodyNoIconRefresh\");\n        }\n\n        if (this.pageTitle) {\n          html.removeClass(this.pageTitle, \"pageTitleWidth\");\n        }\n        this.pageTitle.innerHTML = \"<div></div>\";\n        this.panelMainIcon.innerHTML = \"<div></div>\";\n      } else if (this.config.displayPanelIcon && w <= 750 && this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          if (this.config.mainPanelText !== \"\") {\n            html.addClass(this.pageHeader, \"pageHeaderRefresh\");\n          } else {\n            html.addClass(this.pageHeader, \"pageHeaderRefreshNoText\");\n          }\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          html.removeClass(this.pageBody, \"pageBody\");\n          if (this.config.mainPanelText !== \"\") {\n            html.addClass(this.pageBody, \"pageBodyRefresh\");\n          } else {\n            html.addClass(this.pageBody, \"pageBodyRefreshNoText\");\n          }\n        }\n\n        if (this.pageTitle) {\n          html.addClass(this.pageTitle, \"pageTitleWidth\");\n        }\n\n        panelTitle = this.config.mainPanelText;\n        if (typeof panelTitle === 'undefined') {\n          panelTitle = \"\";\n        }\n        this.pageTitle.innerHTML = panelTitle;\n      }\n    },\n\n    _createPanelUI: function _createPanelUI(configLayerInfos, jimuLayerInfos) {\n      this.numClusterLayers = 0;\n\n      if (!this.hidePanel) {\n        this._updatePanelHeader();\n        this._updateUI(null);\n        this._clearChildNodes(this.pageMain);\n        this.updateEnd = [];\n      }\n\n      for (var i = 0; i < configLayerInfos.length; i++) {\n        var lyrInfo = configLayerInfos[i];\n        if (lyrInfo.symbolData.clusterType === 'ThemeCluster') {\n          this.updateThemeClusterSymbol(lyrInfo, i);\n        }\n\n        var jimuLayerInfo = jimuLayerInfos.getLayerInfoById(lyrInfo.id);\n        if (jimuLayerInfo) {\n          jimuLayerInfo.getLayerType().then(lang.hitch(this, function (layerType) {\n            jimuLayerInfo.getLayerObject().then(lang.hitch(this, function (layerObject) {\n              this.updateLayerList(layerObject, lyrInfo, layerType, jimuLayerInfo);\n            }));\n          }));\n        }\n      }\n\n      if (!this.hidePanel) {\n        for (var k in this.layerList) {\n          var lyr = this.layerList[k];\n          if (lyr.type !== \"ClusterLayer\") {\n            if (lyr && lyr.layerObject) {\n              if (lyr.layerObject.hasOwnProperty('refreshInterval') && lyr.layerObject.refreshInterval > 0) {\n                this.updateEnd.push(this.own(on(lyr.layerObject, \"update-end\", lang.hitch(this, this._updateEnd))));\n              }\n            }\n          }\n        }\n      }\n      this.addMapLayers();\n    },\n\n    _updateEnd: function _updateEnd(results) {\n      var lid = this.layerList.hasOwnProperty(results.target.id) ? results.target.id : this.layerList.hasOwnProperty(results.target.id + \"_CL\") ? results.target.id + \"_CL\" : \"\";\n\n      //For map service with sub layers...the results ID is for the parent layer\n      if (lid === \"\") {\n        for (var i in this.layerList) {\n          var l = this.layerList[i];\n          if (l && l.layerObject && l.layerObject.id === results.target.id) {\n            lid = l.li.id;\n            break;\n          }\n        }\n      }\n      if (this.layerList.hasOwnProperty(lid)) {\n        var lyr = this.layerList[lid];\n        lyr.isLoaded = false;\n        lyr.updating = false;\n        lyr.requiresReload = true;\n        if (lyr) {\n          if (lyr.legendOpen) {\n            this._loadList(lyr, this.config.countEnabled);\n          } else if (this.config.countEnabled) {\n            this.countFeatures(lyr);\n          }\n        }\n      }\n    },\n\n    updateThemeClusterSymbol: function updateThemeClusterSymbol(lyrInfo, i) {\n      var sd = lyrInfo.symbolData;\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        if (typeof this._styleColor === 'undefined') {\n          this._updateStyleColor(this.appConfig.theme.styles[0]);\n        }\n      }\n      if (this._styleColor) {\n        var _rgb = dojoColor.fromHex(this._styleColor);\n        var x = i + 1;\n        var xx = x > 0 ? x * 30 : 30;\n        var evenOdd = x % 2 === 0;\n        var r = _rgb.r;\n        var g = _rgb.g;\n        var b = _rgb.b;\n\n        var rr = r - xx;\n        if (evenOdd) {\n          if (rr > 255) {\n            rr = rr - 255;\n          } else if (rr < 0) {\n            rr = rr + 255;\n          }\n        }\n\n        var bb = b - xx;\n        if (x % 3 === 0) {\n          if (evenOdd) {\n            if (bb > 255) {\n              bb = bb - 255;\n            } else if (bb < 0) {\n              bb = bb + 255;\n            }\n          }\n        }\n\n        var gg = g - xx;\n        if (x % 5 === 0) {\n          if (evenOdd) {\n            if (gg > 255) {\n              gg = gg - 255;\n            } else if (gg < 0) {\n              gg = gg + 255;\n            }\n          }\n        }\n        sd.clusterType = 'CustomCluster';\n        sd.clusterSymbol = {\n          color: [rr, gg, bb, 1],\n          outline: {\n            color: [0, 0, 0, 0],\n            width: 0,\n            type: \"esriSLS\",\n            style: \"esriSLSNull\"\n          },\n          type: \"esriSFS\",\n          style: \"esriSFSSolid\"\n        };\n      }\n    },\n\n    removeOldClusterLayers: function removeOldClusterLayers(lInfos) {\n      //check if the widget was previously configured\n      // with a layer that it no longer consumes...if so remove it\n      var deleteLayers = [];\n      for (var id in this.layerList) {\n        var l = this.layerList[id];\n        if (l.type === \"ClusterLayer\") {\n          layer_info_loop: for (var i = 0; i < lInfos.length; i++) {\n            var lo = lInfos[i];\n            var potentialNewClusterID = lo.id + this.UNIQUE_APPEND_VAL_CL;\n            if (potentialNewClusterID === id) {\n              if (lo.symbolData && !lo.symbolData.clusteringEnabled) {\n                deleteLayers.push(id);\n              }\n              break layer_info_loop;\n            }\n          }\n        }\n      }\n      if (deleteLayers.length > 0) {\n        for (var dl in deleteLayers) {\n          if (this.layerList.hasOwnProperty(deleteLayers[dl])) {\n            if (this.map.graphicsLayerIds.indexOf(deleteLayers[dl]) > -1) {\n              var _dl = this.layerList[deleteLayers[dl]];\n              if (_dl && _dl.li) {\n                var jimuLayerInfo;\n                if (_dl.li.parentLayerID) {\n                  jimuLayerInfo = this.operLayerInfos.getLayerInfoById(_dl.li.parentLayerID);\n                }\n                if (!jimuLayerInfo && _dl.li.layer) {\n                  jimuLayerInfo = this.operLayerInfos.getLayerInfoById(_dl.li.layer);\n                }\n                if (jimuLayerInfo && _dl.hasOwnProperty('parentLayerVisible')) {\n                  jimuLayerInfo.setTopLayerVisible(_dl.parentLayerVisible);\n                }\n              }\n              this.map.removeLayer(this.layerList[deleteLayers[dl]].layerObject);\n            }\n            this.layerList[deleteLayers[dl]].layerObject.destroy();\n            delete this.layerList[deleteLayers[dl]];\n          }\n        }\n      }\n    },\n\n    addMapLayers: function addMapLayers() {\n      var ids = Object.keys(this.layerList).reverse();\n      for (var i = 0; i < ids.length; i++) {\n        var id = ids[i];\n        var l = this.layerList[id];\n        if (l.type && l.type === \"ClusterLayer\") {\n          if (this.map.graphicsLayerIds.indexOf(id) === -1) {\n            this.map.addLayer(l.layerObject);\n          }\n        }\n      }\n    },\n\n    updateLayerList: function updateLayerList(lyr, lyrInfo, lyrType, jimuLayerInfo) {\n      var l,\n          ll = null;\n      var type, id, layerObject, pl;\n\n      jimuLayerInfo = jimuLayerInfo || this.operLayerInfos.getLayerInfoById(lyr.id);\n\n      var selfType = this._checkSelfType(jimuLayerInfo, lyrInfo, lyrType, lyr);\n      var listDisabled = this._checkListDisabled(lyrInfo);\n\n      //Handle cluster layers\n      if (lyrInfo.symbolData.clusteringEnabled) {\n        l = this._getClusterLayer(lyrInfo, lyr, jimuLayerInfo, lyrType);\n        type = \"ClusterLayer\";\n        layerObject = l;\n        id = l.id;\n        if (!this.hidePanel) {\n          this.own(on(l, \"update-end\", lang.hitch(this, function () {\n            this._loadList(this.layerList[l.id], true);\n          })));\n        }\n        this.numClusterLayers += 1;\n      } else {\n        if (lyr.layerType === \"ArcGISStreamLayer\") {\n          type = \"StreamLayer\";\n          id = lyr.layerObject.id;\n          layerObject = lyr.layerObject;\n          pl = lyr;\n        } else {\n          id = lyrType === \"FeatureLayer\" ? lyrInfo.id : lyr.id;\n          var parentLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.parentLayerID) || lyr.parentLayerInfo;\n          if (parentLayerInfo) {\n            if (parentLayerInfo.layerObject) {\n              ll = parentLayerInfo.layerObject;\n              type = ll.type;\n              if (parentLayerInfo.originOperLayer && parentLayerInfo.originOperLayer.featureCollection) {\n                var layers = parentLayerInfo.originOperLayer.featureCollection.layers;\n                if (layers) {\n                  for (var j = 0; j < layers.length; j++) {\n                    var _lyr = layers[j];\n                    if (_lyr.id === id) {\n                      pl = _lyr;\n                    }\n                  }\n                }\n              }\n            }\n          }\n          l = lyr.layerObject ? lyr.layerObject : lyr;\n          type = lyrType;\n          layerObject = ll && !ll.empty ? ll : l ? l : lyr;\n          if (selfType === 'geo_rss' && layerObject && layerObject.getFeatureLayers) {\n            var featureLayers = layerObject.getFeatureLayers();\n            for (var i = 0; i < featureLayers.length; i++) {\n              var fl = featureLayers[i];\n              if (fl.id === lyrInfo.id) {\n                layerObject = fl;\n              }\n            }\n          }\n          pl = pl ? pl : lyr;\n        }\n      }\n\n      this.layerList[id] = {\n        type: type,\n        layerObject: layerObject,\n        pl: pl,\n        id: id,\n        visible: jimuLayerInfo && jimuLayerInfo.isShowInMap ? jimuLayerInfo.isShowInMap() : true,\n        li: lyrInfo,\n        filter: jimuLayerInfo ? jimuLayerInfo.getFilter() : \"1=1\",\n        infoTemplate: jimuLayerInfo.getInfoTemplate() || lyrInfo.infoTemplate,\n        selfType: selfType,\n        listDisabled: listDisabled,\n        showAllFeatures: this.showAllFeatures\n      };\n\n      if (lyr.layerType !== \"ArcGISStreamLayer\") {\n        this.updateRenderer(id);\n      }\n\n      if (!this.hidePanel) {\n        this._addPanelItem(ll ? ll : l ? l : lyr, lyrInfo, listDisabled, jimuLayerInfo);\n      }\n    },\n\n    _checkListDisabled: function _checkListDisabled(lyrInfo) {\n      return lyrInfo.symbolData.featureDisplayOptions.listDisabled ? lyrInfo.symbolData.featureDisplayOptions.listDisabled : lyrInfo.symbolData.featureDisplayOptions.fields ? lyrInfo.symbolData.featureDisplayOptions.fields.length === 0 : true;\n    },\n\n    _checkSelfType: function _checkSelfType(jimuLayerInfo, lyrInfo, lyrType, lyr) {\n      var _lo = lyrInfo.layerObject && !lyrInfo.layerObject.empty ? lyrInfo.layerObject : lyr;\n      var originOpLayer = _lo && _lo.originOperLayer ? _lo.originOperLayer : lyr;\n\n      var selfType = jimuLayerInfo.originOperLayer && jimuLayerInfo.originOperLayer.selfType ? jimuLayerInfo.originOperLayer.selfType : originOpLayer && originOpLayer.selfType ? originOpLayer.selfType : '';\n\n      selfType = selfType && selfType !== '' ? selfType : originOpLayer && originOpLayer.layerType && originOpLayer.layerType === \"CSV\" ? \"collection\" : lyrType === \"Feature Collection\" ? \"collection\" : '';\n      if (!selfType && lyrType && lyrType === \"KML\") {\n        selfType = \"kml\";\n      }\n      return selfType;\n    },\n\n    updateRenderer: function updateRenderer(id) {\n      var l = this.layerList[id];\n      if (l.li.symbolData.symbolType !== 'LayerSymbol') {\n        if (typeof l.li.orgRenderer === 'undefined') {\n          if (l.layerObject.renderer) {\n            l.li.orgRenderer = l.layerObject.renderer;\n          } else {\n            l.li.orgRenderer = l.li.renderer;\n          }\n        }\n        var renderer = new SimpleRenderer(jsonUtils.fromJson(l.li.symbolData.symbol));\n        l.li.newRenderer = renderer;\n        if (l.layerObject.setRenderer) {\n          l.layerObject.setRenderer(renderer);\n        } else if (l.layerObject.setLayerDrawingOptions) {\n          var optionsArray = [];\n          var drawingOptions = new LayerDrawingOptions();\n          drawingOptions.renderer = renderer;\n          optionsArray[l.li.subLayerId] = drawingOptions;\n          l.layerObject.setLayerDrawingOptions(optionsArray);\n        } else {\n          console.log(\"Error setting the new renderer...will use the default rendering of the layer\");\n        }\n\n        if (typeof l.layerObject.refresh === 'function') {\n          l.layerObject.refresh();\n        }\n      }\n    },\n\n    _onRecNodeMouseover: function _onRecNodeMouseover(rec) {\n      domClass.add(rec, this.isDartTheme ? \"layer-row-mouseover-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"layer-row-mouseover-dashboard\" : \"layer-row-mouseover\");\n    },\n\n    _onRecNodeMouseout: function _onRecNodeMouseout(rec) {\n      domClass.remove(rec, this.isDartTheme ? \"layer-row-mouseover-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"layer-row-mouseover-dashboard\" : \"layer-row-mouseover\");\n    },\n\n    _addPanelItem: function _addPanelItem(layer, lyrInfo, listDisabled, jimuLayerInfo) {\n      var potentialNewID = lyrInfo.id + this.UNIQUE_APPEND_VAL_CL;\n      var id = lyrInfo.id in this.layerList ? lyrInfo.id : potentialNewID in this.layerList ? potentialNewID : '';\n      var lyr = this.layerList[id];\n      if (lyr) {\n        var lyrType = lyr.type;\n        var cssAry;\n        if (this.isDashboardTheme) {\n          cssAry = ['rec', 'expand', 'expandDown-dashboard', 'solidBorder'];\n        } else if (this.isDartTheme) {\n          cssAry = ['rec-dart', 'expand-dart', 'expandDown-dart', 'solidBorder-dart'];\n        } else {\n          cssAry = ['rec', 'expand', 'expandDown', 'solidBorder'];\n        }\n        var rec = domConstruct.create(\"div\", {\n          'class': cssAry[0] + \" \" + cssAry[3],\n          id: 'rec_' + id\n        }, this.pageMain);\n\n        var expandClass;\n        if (!listDisabled) {\n          this.own(on(rec, 'mouseover', lang.hitch(this, this._onRecNodeMouseover, rec)));\n          this.own(on(rec, 'mouseout', lang.hitch(this, this._onRecNodeMouseout, rec)));\n          expandClass = cssAry[1] + \" \" + cssAry[2];\n          if (jimuLayerInfo && jimuLayerInfo.isInScale) {\n            expandClass += jimuLayerInfo.isInScale() ? \"\" : \" expandInActive\";\n          }\n        } else {\n          html.setStyle(rec, \"cursor\", \"default\");\n          expandClass = 'expand-empty';\n        }\n        domConstruct.create(\"div\", {\n          'class': expandClass,\n          id: \"exp_\" + id\n        }, rec);\n\n        var recIcon = domConstruct.create(\"div\", {\n          'class': \"recIcon active\",\n          id: \"recIcon_\" + id\n        }, rec);\n\n        if (lyrInfo.panelImageData && lyrInfo.panelImageData.toString().indexOf('<img') > -1) {\n          var img = document.createElement('div');\n          img.innerHTML = lyrInfo.panelImageData;\n          var icon = new PictureMarkerSymbol(img.children[0].src, 26, 26);\n          lyrInfo.panelImageData = this._createImageDataDiv(icon, 44, 44, undefined, true).innerHTML;\n        }\n        recIcon.innerHTML = lyrInfo.panelImageData;\n        domStyle.set(recIcon.firstChild, \"border-radius\", \"41px\");\n\n        var recLabel;\n        var recNum;\n        if (this.config.countEnabled) {\n          recLabel = domConstruct.create(\"div\", {\n            'class': \"recLabel\",\n            id: \"recLabel_\" + id,\n            innerHTML: \"<p>\" + lyrInfo.label + \"</p>\"\n          }, rec);\n          html.setStyle(recLabel, \"top\", \"20px\");\n          recNum = domConstruct.create(\"div\", {\n            'class': \"recNum\",\n            id: \"recNum_\" + id,\n            innerHTML: \"\"\n          }, rec);\n        } else {\n          recLabel = domConstruct.create(\"div\", {\n            'class': \"recLabelNoCount\",\n            id: \"recLabel_\" + id,\n            innerHTML: \"<p>\" + lyrInfo.label + \"</p>\"\n          }, rec);\n        }\n\n        if (lyrType === \"ClusterLayer\") {\n          layer.node = recNum;\n          if (!listDisabled) {\n            this._addLegend(id, lyr);\n          }\n          layer._updateNode(layer.nodeCount);\n        } else if (lyrType === \"StreamLayer\") {\n          lyr.node = recNum;\n          this.countFeatures(lyr);\n          if (!listDisabled) {\n            this._addLegend(id, lyr);\n          }\n        } else {\n          lyr.node = recNum;\n          this._addLegend(id, lyr);\n        }\n\n        on(recIcon, \"click\", lang.hitch(this, this._toggleLayerVisibility, lyr));\n\n        if (!listDisabled) {\n          lyr.toggleLegend = on(rec, \"click\", lang.hitch(this, this._toggleLegend, lyr));\n        }\n      }\n    },\n\n    _addLegend: function _addLegend(id, layerListLayer) {\n      layerListLayer.legendOpen = this.row === null && this.config.expandList;\n      var _class = layerListLayer.legendOpen ? \"legendOn\" : \"legendOff\";\n      layerListLayer.legendNode = domConstruct.create(\"div\", {\n        \"class\": \"legendLayer \" + _class,\n        \"id\": \"legend_\" + id\n      }, this.pageMain);\n      if (layerListLayer.type === 'ClusterLayer') {\n        layerListLayer.layerObject.legendNode = layerListLayer.legendNode;\n      }\n      this.row = 'firstRowExpanded';\n    },\n\n    _getListFields: function _getListFields(lyr) {\n      var popupFields = [];\n      var infoTemp = this._getInfoTemplate(lyr);\n\n      var fieldInfos = infoTemp && infoTemp.info && infoTemp.info.fieldInfos ? infoTemp.info.fieldInfos : [];\n      array.forEach(fieldInfos, function (fieldInfo) {\n        if (fieldInfo.visible) {\n          popupFields.push(fieldInfo.fieldName);\n        }\n      });\n\n      var displayOptions = lyr.li.symbolData && lyr.li.symbolData.featureDisplayOptions ? lyr.li.symbolData.featureDisplayOptions : {};\n      var fields = displayOptions.fields || [];\n      array.forEach(fields, function (field) {\n        if (popupFields.indexOf(field.name) === -1) {\n          popupFields.push(field.name);\n        }\n      });\n      if (displayOptions.groupField) {\n        if (popupFields.indexOf(displayOptions.groupField.name) === -1) {\n          popupFields.push(displayOptions.groupField.name);\n        }\n      }\n\n      if (popupFields.length === 0 || typeof infoTemp === 'undefined') {\n        popupFields = ['*'];\n      }\n\n      if (popupFields[0] !== '*') {\n        if (lyr.layerObject && lyr.layerObject.objectIdField) {\n          if (popupFields.indexOf(lyr.layerObject.objectIdField) === -1) {\n            popupFields.push(lyr.layerObject.objectIdField);\n          }\n        }\n      }\n      return popupFields;\n    },\n\n    _loadList: function _loadList(lyr, updateCount) {\n      if (!this.hidePanel) {\n        var id = lyr.layerObject.id in this.layerList ? lyr.layerObject.id : lyr.li.id;\n        if (updateCount) {\n          this._addSearching(id);\n        }\n\n        var popupFields = this._getListFields(lyr);\n        if (lyr.type === \"ClusterLayer\") {\n          if (lyr.li.layerListExtentChanged) {\n            lyr.layerObject.clusterFeatures();\n            lyr.li.layerListExtentChanged = false;\n          }\n          var features = [];\n          if (lyr.layerObject.clusterGraphics || lyr.layerObject._features) {\n            if (this.showAllFeatures) {\n              features = lyr.layerObject._features;\n            } else {\n              var clusterGraphics = lyr.layerObject.clusterGraphics;\n              for (var z = 0; z < clusterGraphics.length; z++) {\n                var clusterGraphic = clusterGraphics[z];\n                if (clusterGraphic.graphics && clusterGraphic.graphics.length > 0) {\n                  for (var f = 0; f < clusterGraphic.graphics.length; f++) {\n                    var g = clusterGraphic.graphics[f];\n                    features.push(g);\n                  }\n                }\n              }\n            }\n            setTimeout(lang.hitch(this, function () {\n              this._updateList(features, lyr.legendNode, lyr.layerObject.node, popupFields, updateCount, lyr);\n            }), 100);\n          } else {\n            this._removeSearching(id, lyr.legendNode ? !domClass.contains(lyr.legendNode, 'legendOff') : true);\n          }\n        } else {\n          this.getFeatures(lyr, popupFields, updateCount);\n          return;\n        }\n      }\n    },\n\n    _addSearching: function _addSearching(id) {\n      var disabled = this.layerList[id].listDisabled;\n      var eD = disabled ? 'expand-empty' : this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n      var eU = disabled ? 'expand-empty' : this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n      var eS = disabled ? \"expandSearching-empty\" : \"expandSearching\";\n      if (domClass.contains(\"exp_\" + id, eD)) {\n        domClass.remove(\"exp_\" + id, eD);\n        domClass.add(\"exp_\" + id, eS);\n      }\n      if (domClass.contains(\"exp_\" + id, eU)) {\n        domClass.remove(\"exp_\" + id, eU);\n        domClass.add(\"exp_\" + id, eS);\n      }\n    },\n\n    _removeSearching: function _removeSearching(id, legendOpen) {\n      var disabled = this.layerList[id].listDisabled;\n      var eD = disabled ? 'expand-empty' : this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n      var eU = disabled ? 'expand-empty' : this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n      var eS = disabled ? \"expandSearching-empty\" : \"expandSearching\";\n      if (domClass.contains(\"exp_\" + id, eS)) {\n        domClass.remove(\"exp_\" + id, eS);\n        domClass.add(\"exp_\" + id, legendOpen ? eU : eD);\n      }\n    },\n\n    _getClusterLayer: function _getClusterLayer(lyrInfo, layer, jimuLayerInfo, lyrType) {\n      var lyr = layer.layerObject ? layer.layerObject : layer;\n      var infoTemplate = lyrInfo.infoTemplate;\n      var originOperLayer = lyr && lyr.originOperLayer ? lyr.originOperLayer : layer.parentLayerInfo ? layer.parentLayerInfo : jimuLayerInfo ? jimuLayerInfo.originOperLayer : undefined;\n      var clusterLayer = null;\n      var n;\n      var potentialNewID = lyrInfo.id + this.UNIQUE_APPEND_VAL_CL;\n      var configChange = true;\n      if (this.map.graphicsLayerIds.indexOf(potentialNewID) > -1 || this.map._layers.indexOf(potentialNewID) > -1) {\n        clusterLayer = this.map.getLayer(potentialNewID);\n\n        var reloadData = false;\n        var refreshData = false;\n\n        //update the symbol if it has changed\n        if (JSON.stringify(clusterLayer.symbolData) !== JSON.stringify(lyrInfo.symbolData)) {\n          clusterLayer.symbolData = lyrInfo.symbolData;\n          clusterLayer.countColor = lyrInfo.symbolData._highLightColor;\n          refreshData = true;\n        }\n\n        //update the icon if it has changed\n        n = domConstruct.toDom(lyrInfo.panelImageData);\n        if (JSON.stringify(clusterLayer.icon) !== JSON.stringify(n.src)) {\n          clusterLayer.icon = n.src;\n          refreshData = true;\n        }\n        domConstruct.destroy(n.id);\n\n        clusterLayer.displayFeatureCount = lyrInfo.symbolData.displayFeatureCount;\n\n        if (clusterLayer.refresh !== lyrInfo.refresh) {\n          clusterLayer.refresh = lyrInfo.refresh;\n          reloadData = true;\n        }\n\n        if (refreshData) {\n          clusterLayer._setupSymbols();\n        }\n\n        clusterLayer.countEnabled = this.config.countEnabled;\n        clusterLayer.hidePanel = this.hidePanel;\n\n        if (clusterLayer.showAllFeatures !== this.showAllFeatures) {\n          reloadData = true;\n          clusterLayer.showAllFeatures = this.showAllFeatures;\n        }\n        if (clusterLayer.listDisabled !== this.listDisabled) {\n          reloadData = true;\n          clusterLayer.listDisabled = this.listDisabled;\n        }\n\n        if (reloadData) {\n          if (clusterLayer.url) {\n            clusterLayer.refreshFeatures(clusterLayer.url);\n          }\n        } else if (refreshData) {\n          clusterLayer.clusterFeatures();\n        }\n      } else {\n        configChange = false;\n        clusterLayer = new ClusterLayer({\n          name: lyrInfo.label + this.UNIQUE_APPEND_VAL_CL,\n          id: potentialNewID,\n          map: this.map,\n          node: dom.byId(\"recNum_\" + potentialNewID),\n          legendNode: dom.byId(\"legend_\" + potentialNewID),\n          infoTemplate: typeof lyr.infoTemplate !== 'undefined' ? lyr.infoTemplate : infoTemplate,\n          refreshInterval: this.config.refreshInterval,\n          refreshEnabled: this.config.refreshEnabled,\n          parentLayer: lyr,\n          lyrInfo: lyrInfo,\n          lyrType: lyrType,\n          _styleColor: this._styleColor,\n          originOperLayer: originOperLayer,\n          countEnabled: this.config.countEnabled,\n          hidePanel: this.hidePanel,\n          filter: jimuLayerInfo ? jimuLayerInfo.getFilter() : \"1=1\",\n          showAllFeatures: this.showAllFeatures,\n          listDisabled: this.listDisabled\n        });\n      }\n      clusterLayer.setVisibility(configChange ? clusterLayer.visible : jimuLayerInfo.isShowInMap ? jimuLayerInfo.isShowInMap() : true);\n      return clusterLayer;\n    },\n\n    _createImageDataDiv: function _createImageDataDiv(sym, w, h, parent, isCustom) {\n      var a;\n      var symbol = sym;\n      if (symbol) {\n        //TODO are these switched??\n        var height = w;\n        var width = h;\n        if (symbol.height && symbol.width) {\n          var ar;\n          if (symbol.height > symbol.width) {\n            ar = symbol.width / symbol.height;\n            width = w * ar;\n          } else if (symbol.width === symbol.height || symbol.width > symbol.height) {\n            width = w;\n            ar = symbol.width / symbol.height;\n            height = ar > 0 ? h * ar : h;\n          }\n        }\n        if (typeof symbol.setWidth !== 'undefined') {\n          if (typeof symbol.setHeight !== 'undefined') {\n            symbol.setWidth(isCustom ? width - width * 0.25 : width);\n            symbol.setHeight(isCustom ? height - height * 0.25 : height);\n          } else {\n            symbol.setWidth(2);\n          }\n        } else if (typeof symbol.size !== 'undefined') {\n          if (symbol.size > 20) {\n            symbol.setSize(20);\n          }\n        }\n        a = domConstruct.create(\"div\", { 'class': \"imageDataGFX\" }, parent);\n        var mySurface = gfx.createSurface(a, w, h);\n        var descriptors = jsonUtils.getShapeDescriptors(symbol);\n        var shape = mySurface.createShape(descriptors.defaultShape).setFill(descriptors.fill).setStroke(descriptors.stroke);\n        shape.applyTransform({ dx: w / 2, dy: h / 2 });\n      }\n      return a;\n    },\n\n    _updateUI: function _updateUI(styleName) {\n      this.styleName = styleName;\n\n      if (this.isDashboardTheme) {\n        this.isLightTheme = styleName ? styleName === 'light' : this.isLightTheme;\n\n        var removeDownClass = this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n        var addDownClass = this.isLightTheme ? 'expandDown' : 'expandDown-dashboard';\n        this._updateNodes(removeDownClass, addDownClass);\n\n        var removeUpClass = this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n        var addUpClass = this.isLightTheme ? 'expandUp' : 'expandUp-dashboard';\n        this._updateNodes(removeUpClass, addUpClass);\n\n        var removeExpandClass = this.isLightTheme ? 'expand-dashboard' : 'expand';\n        var addExpandClass = this.isLightTheme ? 'expand' : 'expand-dashboard';\n        this._updateNodes(removeExpandClass, addExpandClass);\n\n        var removeGroupItemUpClass = this.isLightTheme ? 'groupItemImageUp-dashboard' : 'groupItemImageUp';\n        var addGroupItemUpClass = this.isLightTheme ? 'groupItemImageUp' : 'groupItemImageUp-dashboard';\n        this._updateNodes(removeGroupItemUpClass, addGroupItemUpClass);\n\n        var removeGroupItemDownClass = this.isLightTheme ? 'groupItemImageDown-dashboard' : 'groupItemImageDown';\n        var addGroupItemDownClass = this.isLightTheme ? 'groupItemImageDown' : 'groupItemImageDown-dashboard';\n        this._updateNodes(removeGroupItemDownClass, addGroupItemDownClass);\n\n        var removeGroupItemClass = this.isLightTheme ? 'groupItemImage-dashboard' : 'groupItemImage';\n        var addGroupItemClass = this.isLightTheme ? 'groupItemImage' : 'groupItemImage-dashboard';\n        this._updateNodes(removeGroupItemClass, addGroupItemClass);\n      }\n    },\n\n    _updateNodes: function _updateNodes(remove, add) {\n      var nodes = query('.' + remove);\n      array.forEach(nodes, function (node) {\n        domClass.remove(node, remove);\n        domClass.add(node, add);\n      });\n    },\n\n    _toggleLayerVisibility: function _toggleLayerVisibility(obj, e) {\n      e.stopPropagation();\n      this.map.infoWindow.hide();\n      var id = obj.id ? obj.id : obj.layerObject.id;\n      var lyr = this.layerList[id];\n      if (!lyr) {\n        if (obj.pl) {\n          id = obj.pl.id;\n        }\n        lyr = this.layerList[id];\n      }\n\n      if (lyr) {\n        var hasSubLayerId = lyr.li && lyr.li.hasOwnProperty(\"subLayerId\") ? typeof lyr.li.subLayerId !== 'undefined' && lyr.li.subLayerId.toString() !== \"-1\" : false;\n\n        var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n        var _vis = !domClass.contains(\"recIcon_\" + id, \"active\");\n\n        if (hasSubLayerId && lyr.type !== 'ClusterLayer') {\n          if (_vis) {\n            var currentLayerInfo = lyrInfo.parentLayerInfo;\n            while (currentLayerInfo) {\n              currentLayerInfo.setTopLayerVisible(true);\n              currentLayerInfo = currentLayerInfo.parentLayerInfo;\n            }\n          }\n          lyrInfo.setTopLayerVisible(_vis);\n        } else if (lyr) {\n          lyr.layerObject.setVisibility(_vis);\n          if (lyr.type === 'ClusterLayer' && _vis) {\n            lyr.layerObject.handleMapExtentChange({ levelChange: true });\n            lyr.layerObject.flashFeatures();\n          }\n          if (typeof lyr.pl !== 'undefined') {\n            lyr.pl.visibility = _vis;\n            if (this.map.graphicsLayerIds.indexOf(id) > -1) {\n              var l = this.map.getLayer(id);\n              l.setVisibility(_vis);\n            }\n          }\n        }\n      }\n    },\n\n    _toggleLayerUI: function _toggleLayerUI(obj, vis) {\n      var id = obj.id ? obj.id : obj.layerObject.id;\n      var lyr = this.layerList[id];\n      if (!lyr) {\n        if (obj.pl) {\n          id = obj.pl.id;\n        }\n        lyr = this.layerList[id];\n      }\n      if (lyr) {\n        var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n        var visScalRange = lyrInfo.isCurrentScaleInTheScaleRange ? lyrInfo.isCurrentScaleInTheScaleRange() : true;\n\n        var c = dom.byId(\"recLabel_\" + id);\n\n        this.layerList[id].visible = vis;\n        this.layerList[id].parentLayerVisible = vis;\n        if (this.layerList[id].type === 'ClusterLayer') {\n          this.layerList[id].layerObject.parentLayerVisible = vis;\n        }\n        if (this.config.countEnabled) {\n          if (domClass.contains(\"recNum_\" + id, !vis ? \"recNum\" : \"recNumInActive\")) {\n            var _append = this.isDartTheme ? ' darkThemeColor' : ' lightThemeColor';\n            domClass.remove(\"recNum_\" + id, !vis ? \"recNum\" : \"recNumInActive\");\n            domClass.add(\"recNum_\" + id, (!vis ? \"recNumInActive\" : \"recNum\") + _append);\n          }\n        }\n\n        var eD = this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n        var eU = this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n\n        if (!vis) {\n          domClass.remove(\"recIcon_\" + id, \"active\");\n          //this._clearList(this.layerList[id]);\n          if (c && c.firstChild) {\n            domClass.add(c.firstChild, \"inActive\");\n          }\n          if (!domClass.contains(\"exp_\" + id, \"expandInActive\")) {\n            domClass.add(\"exp_\" + id, \"expandInActive\");\n          }\n          if (lyr.legendOpen) {\n            if (domClass.contains(\"legend_\" + id, \"legendOn\")) {\n              //this.layerList[id].legendOpen = false;\n              domClass.remove(\"legend_\" + id, \"legendOn\");\n              domClass.add(\"legend_\" + id, \"legendOff\");\n              if (domClass.contains(\"exp_\" + id, eU)) {\n                domClass.remove(\"exp_\" + id, eU);\n                domClass.add(\"exp_\" + id, eD);\n              }\n            }\n          }\n          if (lyr.toggleLegend) {\n            lyr.toggleLegend.remove();\n          }\n          if (domClass.contains(\"rec_\" + id, \"rec\")) {\n            domClass.add(\"rec_\" + id, \"recDefault\");\n          }\n        } else {\n          domClass.add(\"recIcon_\" + id, \"active\");\n          if (c && c.firstChild) {\n            domClass.remove(c.firstChild, \"inActive\");\n          }\n          if (domClass.contains(\"exp_\" + id, \"expandInActive\") && visScalRange) {\n            domClass.remove(\"exp_\" + id, \"expandInActive\");\n          }\n          if (lyr.toggleLegend) {\n            lyr.toggleLegend.remove();\n          }\n          var rec = dom.byId('rec_' + id);\n          if (rec) {\n            lyr.toggleLegend = on(rec, \"click\", lang.hitch(this, this._toggleLegend, lyr));\n          }\n\n          if (domClass.contains(\"rec_\" + id, \"recDefault\")) {\n            domClass.remove(\"rec_\" + id, \"recDefault\");\n          }\n\n          if (!lyr.listDisabled) {\n            this._loadList(lyr, true);\n            if (lyr.legendOpen) {\n              domClass.add(\"legend_\" + id, \"legendOn\");\n              domClass.remove(\"legend_\" + id, \"legendOff\");\n              if (domClass.contains(\"exp_\" + id, eD)) {\n                domClass.remove(\"exp_\" + id, eD);\n                domClass.add(\"exp_\" + id, eU);\n              }\n            }\n          }\n        }\n      }\n      return false;\n    },\n\n    _toggleLegend: function _toggleLegend(obj, evt) {\n      if (evt.currentTarget.className !== 'thumb2' && evt.currentTarget.className !== 'recIcon') {\n        var id = obj.layerObject.id in this.layerList ? obj.layerObject.id : obj.li.id;\n        if (domClass.contains(\"legend_\" + id, \"legendOff\")) {\n          this._addSearching(id);\n          this.layerList[id].legendOpen = true;\n          if (typeof this.layerList[id].li.layerListExtentChanged === 'undefined' || this.layerList[id].requiresReload) {\n            this.layerList[id].li.layerListExtentChanged = true;\n            this.layerList[id].requiresReload = false;\n          }\n          if (this.layerList[id].li.layerListExtentChanged) {\n            setTimeout(lang.hitch(this, function () {\n              this._loadList(obj, false);\n            }), 500);\n          } else {\n            this._removeSearching(id, true);\n          }\n          domClass.remove(\"legend_\" + id, \"legendOff\");\n          domClass.add(\"legend_\" + id, \"legendOn\");\n        } else {\n          if (domClass.contains(\"legend_\" + id, \"legendOn\")) {\n            this.layerList[id].legendOpen = false;\n            var eD = this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n            var eU = this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n            if (domClass.contains(\"exp_\" + id, eU)) {\n              domClass.remove(\"exp_\" + id, eU);\n              domClass.add(\"exp_\" + id, eD);\n            }\n            domClass.remove(\"legend_\" + id, \"legendOn\");\n            domClass.add(\"legend_\" + id, \"legendOff\");\n          }\n        }\n      }\n      evt.stopPropagation();\n    },\n\n    _toggleGroup: function _toggleGroup(obj, e) {\n      var id = e.currentTarget.id.slice(0, -2);\n      var fI = this.isDartTheme ? 'featureItem-dart' : 'featureItem';\n\n      var toggle = true;\n      if (e.target.parentNode) {\n        if (e.target.parentNode.id !== \"\") {\n          if (domClass.contains(e.target.parentNode.id, fI)) {\n            toggle = false;\n          }\n        }\n        if (e.target.id !== \"\") {\n          if (domClass.contains(e.target.id, fI)) {\n            toggle = false;\n          }\n        }\n      }\n\n      var gII = this.isDartTheme ? \"groupItemImage-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImage-dashboard\" : \"groupItemImage\";\n      var gIIUp = this.isDartTheme ? \"groupItemImageUp-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageUp-dashboard\" : \"groupItemImageUp\";\n      var gIIDown = this.isDartTheme ? \"groupItemImageDown-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageDown-dashboard\" : \"groupItemImageDown\";\n      if (toggle) {\n        var lId = obj.layerObject.id in this.layerList ? obj.layerObject.id : obj.li.id;\n        var node = document.getElementById(e.currentTarget.id);\n        var _idx = node.childNodes[0].childNodes.length - 1;\n        if (domClass.contains(id, \"groupOff\")) {\n          if (this.layerList[lId].openGroups && this.layerList[lId].openGroups.length > 0) {\n            if (this.layerList[lId].openGroups.indexOf(id) === -1) {\n              this.layerList[lId].openGroups.push(id);\n            }\n          } else {\n            this.layerList[lId].openGroups = [id];\n          }\n          domClass.remove(id, \"groupOff\");\n          domClass.add(id, \"groupOn\");\n          this.layerList[lId].groupOpen = true;\n          if (node.childNodes[0].childNodes[_idx].childNodes[0].className.indexOf(gII) > -1) {\n            html.removeClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIDown);\n            html.addClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIUp);\n          }\n        } else {\n          if (domClass.contains(id, \"groupOn\")) {\n            domClass.remove(id, \"groupOn\");\n            domClass.add(id, \"groupOff\");\n\n            if (this.layerList[lId].openGroups && this.layerList[lId].openGroups.length > 0) {\n              var idx = this.layerList[lId].openGroups.indexOf(id);\n              if (idx > -1) {\n                this.layerList[lId].openGroups.splice(idx, 1);\n              }\n              if (this.layerList[lId].openGroups.length === 0) {\n                this.layerList[lId].groupOpen = false;\n              }\n            } else {\n              this.layerList[lId].groupOpen = false;\n            }\n            if (node.childNodes[0].childNodes[_idx].childNodes[0].className.indexOf(gII) > -1) {\n              html.removeClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIUp);\n              html.addClass(e.currentTarget.childNodes[0].childNodes[_idx].childNodes[0], gIIDown);\n            }\n          }\n        }\n      }\n    },\n\n    /*jshint unused:false*/\n    onAppConfigChanged: function onAppConfigChanged(appConfig, reason, changedData) {\n      switch (reason) {\n        case 'themeChange':\n          this.inPanelOverrides(changedData);\n          this.destroy();\n          break;\n        case 'layoutChange':\n          this.inPanelOverrides(changedData);\n          break;\n        case 'styleChange':\n          if (!this.hidePanel) {\n            this._updateUI(changedData);\n            this._updateStyleColor(changedData);\n          }\n          break;\n        case 'widgetChange':\n          this.widgetChange = true;\n          if (changedData && changedData.config && changedData.config.layerInfos) {\n            this.removeOldClusterLayers(changedData.config.layerInfos);\n          }\n          this.row = null;\n          break;\n        case 'mapChange':\n          this._clearMap();\n      }\n    },\n\n    _updateStyleColor: function _updateStyleColor(changedData) {\n      setTimeout(lang.hitch(this, function () {\n        var p = this.getPanel();\n        var node;\n        switch (this.appConfig.theme.name) {\n          case 'BoxTheme':\n            node = p.containerNode.parentNode.parentNode.children[0];\n            break;\n          case 'DartTheme':\n            node = p.containerNode.parentNode;\n            break;\n          case 'TabTheme':\n            node = p.containerNode;\n            break;\n          case 'BillboardTheme':\n            node = p.containerNode.parentNode;\n            break;\n          case 'FoldableTheme':\n            node = p.containerNode.parentNode.firstChild;\n            break;\n          default:\n            node = this.pageHeader;\n            break;\n        }\n        var bc = window.getComputedStyle(node, null).getPropertyValue('background-color');\n        this._styleColor = Color.fromRgb(bc).toHex();\n        for (var k in this.layerList) {\n          var l = this.layerList[k];\n          if (l.type === \"ClusterLayer\") {\n            l.layerObject.setStyleColor(this._styleColor);\n          }\n        }\n        this._updateUI(changedData);\n      }), 50);\n    },\n\n    _clearMap: function _clearMap() {\n      if (this.layerList) {\n        for (var k in this.layerList) {\n          var l = this.layerList[k];\n          if (l.type === \"ClusterLayer\") {\n            var _clear = true;\n            if (typeof this.continuousRefreshEnabled !== 'undefined') {\n              _clear = !this.continuousRefreshEnabled;\n            }\n            if (_clear) {\n              l.layerObject._clear();\n              this.map.removeLayer(l.layerObject);\n            }\n          }\n        }\n        this.layerList = {};\n      }\n    },\n\n    _close: function _close() {\n      this.widgetManager.closeWidget(this.id);\n    },\n\n    onClose: function onClose() {\n      this.inherited(arguments);\n\n      for (var key in this.layerList) {\n        var layerListLayer = this.layerList[key];\n        if (layerListLayer.li && layerListLayer.li.orgRenderer) {\n          if (layerListLayer.layerObject.setRenderer) {\n            layerListLayer.layerObject.setRenderer(layerListLayer.li.orgRenderer);\n          } else if (layerListLayer.layerObject.setLayerDrawingOptions) {\n            layerListLayer.layerObject.setLayerDrawingOptions([]);\n          } else {\n            console.log(\"Error re-setting the renderer\");\n          }\n          layerListLayer.layerObject.refresh();\n        }\n      }\n\n      var disableRefresh = true;\n      if (typeof this.config.continuousRefreshEnabled !== 'undefined') {\n        disableRefresh = !this.config.continuousRefreshEnabled;\n      }\n      if (disableRefresh) {\n        if (this.refreshInterval !== 0) {\n          this.refreshIntervalValue = 0;\n          clearInterval(this.refreshInterval);\n          this.refreshInterval = 0;\n        }\n      }\n\n      if (!this.hidePanel) {\n        if (typeof this.mapExtentChangedHandler !== 'undefined') {\n          this.mapExtentChangedHandler.remove();\n          this.mapExtentChangedHandler = undefined;\n        } else {\n          if (typeof this.iconClickHandler !== 'undefined') {\n            this.iconClickHandler.remove();\n            this.iconClickHandler = undefined;\n          }\n        }\n      }\n    },\n\n    _clearChildNodes: function _clearChildNodes(parentNode) {\n      while (parentNode.hasChildNodes()) {\n        parentNode.removeChild(parentNode.lastChild);\n      }\n    },\n\n    _inVisibleRange: function _inVisibleRange(lyr, id) {\n      var visScaleRange = true;\n      if (lyr.layerObject && lyr.layerObject.hasOwnProperty('visibleAtMapScale')) {\n        visScaleRange = lyr.layerObject.visibleAtMapScale;\n      }\n      var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n      if (lyrInfo && lyrInfo.isCurrentScaleInTheScaleRange) {\n        visScaleRange = lyrInfo.isCurrentScaleInTheScaleRange();\n      }\n      return visScaleRange;\n    },\n\n    _mapExtentChange: function _mapExtentChange() {\n      var countEnabled = this.config.countEnabled;\n      var queries = [];\n      for (var key in this.layerList) {\n        var lyr = this.layerList[key];\n        lyr.visScaleRange = this._inVisibleRange(lyr, key);\n        if (!this.showAllFeatures) {\n          this._clearList(lyr);\n        }\n        if (!lyr.legendOpen || lyr.groupEnabled && !lyr.groupOpen) {\n          if (lyr.li) {\n            lyr.li.layerListExtentChanged = true;\n          }\n          if (lyr.visible && lyr.visScaleRange) {\n            if (lyr.type === \"ClusterLayer\" && lyr.layerObject.initalLoad && this.config.countEnabled) {\n              lyr.layerObject._updateNode(lyr.layerObject.node.innerHTML);\n            }\n\n            if (lyr.type !== 'ClusterLayer') {\n              var uNode = this.config.countEnabled ? lyr.node : lyr.legendNode;\n              if (typeof lyr.layerObject === 'undefined') {\n                console.log(\"layer object not known\");\n              } else {\n                this.countFeatures(lyr);\n              }\n            }\n          } else if (!lyr.visScaleRange) {\n            this._updateList([], lyr.legendNode, lyr.node, [], true, lyr);\n          }\n        } else {\n          if (lyr.visible && lyr.visScaleRange) {\n            lyr.updateList = true;\n            this._loadList(lyr, lyr.updateList);\n          } else {\n            this._updateList([], lyr.legendNode, lyr.node, [], true, lyr);\n          }\n        }\n      }\n    },\n\n    getFeatures: function getFeatures(lyrInfo, fields, updateCount) {\n      var lyr = lyrInfo.layerObject;\n      var legendNode = lyrInfo.legendNode;\n      var node = lyrInfo.node;\n      var _needsGeom = !lyrInfo.listDisabled && lyrInfo.legendOpen ? true : false;\n      var visScaleRange = lyrInfo.visScaleRange;\n      var maxRecordCount = lyr && lyr.maxRecordCount ? lyr.maxRecordCount : undefined;\n      var url;\n      var queries = [];\n      var q = this._getQuery(lyrInfo, fields, _needsGeom);\n      if (lyrInfo.visible && visScaleRange) {\n        if (lyr.queryFeatures) {\n          //get the first set of features\n          if (!lyrInfo.listDisabled) {\n            queries.push(lyr.queryFeatures(q));\n          }\n          //query the ids incase we need more than maxRecordCount\n          queries.push(lyr.queryIds(q));\n        } else {\n          url = lyrInfo.li.url;\n          if (url.indexOf(\"MapServer\") > -1 || url.indexOf(\"FeatureServer\") > -1) {\n            var qt = new QueryTask(url);\n            //get the first set of features\n            if (!lyrInfo.listDisabled) {\n              queries.push(qt.execute(q));\n            }\n            //query the ids incase we need more than maxRecordCount\n            queries.push(qt.executeForIds(q));\n          }\n        }\n      } else {\n        //if it's not visible and not within the visible scale range\n        this._updateList([], lyrInfo.legendNode, lyrInfo.node, [], true, lyrInfo);\n      }\n      if (queries.length > 0) {\n        var featurePromises = all(queries);\n        featurePromises.then(lang.hitch(this, function (results) {\n          var s_id = lyrInfo.layerObject.id in this.layerList ? lyrInfo.layerObject.id : lyrInfo.li.id;\n          var updateNode;\n          if (node) {\n            updateNode = this.config.countEnabled ? node.parentNode : node.previousSibling;\n          }\n          if (results && results.length > 1) {\n            var _queries = [];\n            var queryIDs = results[1];\n            var count = 0;\n            //if IDs exceed max count we need to chunk\n            if (queryIDs && maxRecordCount && queryIDs.length > maxRecordCount) {\n              this._chunkRequest(lyr, url, queryIDs, maxRecordCount, fields, _needsGeom).then(lang.hitch(this, function (fullFeatures) {\n                this._updateList(fullFeatures, legendNode, node, fields, updateCount, lyrInfo);\n              }));\n            } else {\n              this._updateList(results[0].features, legendNode, node, fields, updateCount, lyrInfo);\n            }\n          } else if (results && results.length === 1) {\n            if (this.config.countEnabled) {\n              node.innerHTML = utils.localizeNumber(results[0].length);\n            }\n            this._removeSearching(s_id, false);\n          } else {\n            if (this.config.countEnabled) {\n              node.innerHTML = utils.localizeNumber(0);\n            }\n            this.updateExpand(updateNode, true);\n            this._removeSearching(s_id, lyrInfo.legendOpen);\n          }\n        }));\n      }\n    },\n\n    _chunkRequest: function _chunkRequest(lyr, url, IDs, max, fields, needsGeom) {\n      var def = new Deferred();\n      var queries = [];\n      var i, j;\n      for (i = 0, j = IDs.length; i < j; i += max) {\n        var ids = IDs.slice(i, i + max);\n\n        var q = new Query();\n        q.outFields = fields;\n        q.objectIds = ids;\n        q.returnGeometry = needsGeom;\n\n        if (lyr.queryFeatures) {\n          queries.push(lyr.queryFeatures(q));\n        } else if (url) {\n          var qt = new QueryTask(url);\n          queries.push(qt.execute(q));\n        }\n      }\n      var queryList = new DeferredList(queries);\n      queryList.then(lang.hitch(this, function (queryResults) {\n        if (queryResults) {\n          var allFeatures = [];\n          for (var i = 0; i < queryResults.length; i++) {\n            if (queryResults[i][1].features) {\n              allFeatures.push.apply(allFeatures, queryResults[i][1].features);\n            }\n          }\n          def.resolve(allFeatures);\n        }\n      }));\n      return def;\n    },\n\n    _clearList: function _clearList(lyrInfo) {\n      if (!lyrInfo.isLoaded && lyrInfo.legendNode) {\n        lyrInfo.isLoaded = false;\n        lyrInfo.legendNode.innerHTML = '';\n      }\n    },\n\n    _updateList: function _updateList(features, legendNode, node, fields, updateCount, lyrInfo, countOnly) {\n      var li = lyrInfo.li ? lyrInfo.li : lyrInfo;\n\n      if (lyrInfo.type === 'ClusterLayer') {\n        if (lyrInfo.layerObject.node) {\n          if (domClass.contains(lyrInfo.layerObject.node.id, 'searching')) {\n            domClass.remove(lyrInfo.layerObject.node.id, 'searching');\n          }\n        }\n      }\n\n      var visScaleRange = lyrInfo.visScaleRange;\n      var infoTemplate = lyrInfo.infoTemplate;\n      var displayOptions = lyrInfo.symbolData ? lyrInfo.symbolData.featureDisplayOptions : li && li.symbolData ? li.symbolData.featureDisplayOptions : {};\n\n      if (node || legendNode) {\n        if (legendNode && (lyrInfo.hasOwnProperty('isLoaded') ? !lyrInfo.isLoaded : true)) {\n          legendNode.innerHTML = '';\n        }\n        if (updateCount && node && this.config.countEnabled) {\n          if (visScaleRange) {\n            node.innerHTML = utils.localizeNumber(features.length);\n          } else {\n            this.countFeatures(lyrInfo, lyrInfo.id || li.id);\n          }\n        }\n        var updateNode = this.config.countEnabled ? node.parentNode : legendNode.previousSibling;\n        if (lyrInfo.type === 'ClusterLayer' && lyrInfo.visible || lyrInfo.type !== 'ClusterLayer') {\n          this.updateExpand(updateNode, visScaleRange ? features.length === 0 : true);\n        }\n      }\n      if (countOnly) {\n        return;\n      }\n\n      if (!lyrInfo.listDisabled && !lyrInfo.isLoaded) {\n        if (features.length > 0) {\n          var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.id);\n\n          var renderer = lyrInfo.type === \"ClusterLayer\" ? lyrInfo.layerObject.renderer : jimuLayerInfo && jimuLayerInfo.layerObject && jimuLayerInfo.layerObject.renderer ? jimuLayerInfo.layerObject.renderer : features[0]._graphicsLayer ? features[0]._graphicsLayer.renderer : lyrInfo.layerObject && lyrInfo.layerObject.renderer ? lyrInfo.layerObject.renderer : li && li.renderer ? jsonUtil.fromJson(li.renderer) || li.renderer : lyrInfo.renderer ? jsonUtil.fromJson(lyrInfo.renderer) || lyrInfo.renderer : undefined;\n          var _fields = lyrInfo.li && lyrInfo.li.fields ? lyrInfo.li.fields : lyrInfo.fields;\n\n          var groupNodes = [];\n          var finalGroupNodes = [];\n          var finalDomNodes = [];\n          for (var i = 0; i < features.length; i++) {\n            var groupAdded = false;\n            var feature = features[i];\n            if (typeof feature.infoTemplate === 'undefined' && infoTemplate) {\n              feature.infoTemplate = infoTemplate;\n            }\n\n            var symbol = renderer && renderer.getSymbol ? renderer.getSymbol(feature) : feature.symbol ? jsonUtils.fromJson(feature.symbol) : undefined;\n\n            var oidName = feature._layer && feature._layer.objectIdField ? feature._layer.objectIdField : li && li.oidFieldName && li.oidFieldName.name ? li.oidFieldName.name : lyrInfo.layerObject && lyrInfo.layerObject.objectIdField ? lyrInfo.layerObject.objectIdField : lyrInfo && lyrInfo.oidFieldName ? lyrInfo.oidFieldName : undefined;\n\n            var id = oidName ? feature.attributes[oidName] : legendNode.id + i;\n\n            var flds = fields[0] === '*' ? feature.attributes : fields;\n            var isNames = fields[0] === '*' ? false : true;\n\n            var displayStringObj = this.getDisplayString(feature, lyrInfo, flds, displayOptions, oidName, isNames);\n            var displayString = displayStringObj.displayString;\n            var aliasNames = displayStringObj.aliasNames;\n            var firstValue = displayStringObj.firstValue;\n            var groupField, groupNode, groupContainer, displayValue, groupType;\n            if (displayOptions.groupEnabled) {\n              var featureValue;\n              var _value;\n              var appendVal = undefined; // jshint ignore:line\n              if (typeof displayOptions.groupByField === 'undefined' || displayOptions.groupByField) {\n                groupField = displayOptions.groupField;\n                featureValue = feature.attributes[groupField.name];\n                groupType = 'byField';\n                appendVal = featureValue;\n              } else {\n                groupField = displayOptions.groupByRendererOptions.fields[0];\n                featureValue = feature.attributes[groupField.name];\n                var groubByFields = displayOptions.groupByRendererOptions.fields;\n                var groupByValues = displayOptions.groupByRendererOptions.values;\n                groupType = 'byRenderer';\n\n                if (featureValue !== null && featureValue !== \"\") {\n                  expression_loop: for (var ii = 0; ii < groupByValues.length; ii++) {\n                    var _val = groupByValues[ii];\n                    var exp = _val.value;\n                    var expParts = exp.split(\"&&\");\n                    if (expParts && expParts.length > 1) {\n                      exp = featureValue + expParts[0] + \"&& \" + featureValue + expParts[1];\n                    } else {\n                      exp = isNaN(featureValue) ? \"'\" + featureValue + \"'\" + _val.value : featureValue + _val.value;\n                    }\n                    if (eval(exp)) {\n                      // jshint ignore:line\n                      _value = _val;\n                      break expression_loop;\n                    }\n                  }\n                  if (typeof _value !== 'undefined' && _value !== null) {\n                    appendVal = _value.label.replace(/ /g, '');\n                  }\n                }\n              }\n              var gId = 'group_' + li.id + \"_\" + groupField.name + \"_\" + appendVal;\n              var addGroup = true;\n              var n;\n              if (groupNodes.length > 0) {\n                node_loop: for (var iii = 0; iii < groupNodes.length; iii++) {\n                  var gNode = groupNodes[iii];\n                  if (gId === gNode.id) {\n                    if (groupType === 'byField' && featureValue === gNode.value || groupType === 'byRenderer') {\n                      addGroup = false;\n                      n = gNode.node;\n                      groupContainer = gNode.parent;\n                      break node_loop;\n                    }\n                  }\n                }\n              }\n              if (addGroup) {\n                groupAdded = true;\n                groupContainer = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupItem-dart' : 'groupItem',\n                  id: gId + \"_c\"\n                });\n                var groupTitle = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupItemTitle-dart' : 'groupItemTitle',\n                  id: gId + \"_t\"\n                }, groupContainer);\n                var label = \"\";\n                var title = groupType === 'byRenderer' ? \"\" : groupField.name + \": \";\n                if (typeof aliasNames !== 'undefined') {\n                  if (aliasNames.hasOwnProperty(groupField.name) && aliasNames[groupField.name] !== '') {\n                    if (groupType === 'byField') {\n                      title = aliasNames[groupField.name] + \": \";\n                    } else {\n                      title = \"\";\n                    }\n                  }\n                }\n                if (groupType === 'byField') {\n                  if (typeof groupField.label !== 'undefined' && groupField.label !== \"\") {\n                    label = groupField.label + \": \";\n                    title = label;\n                  }\n                  if (label === \": \") {\n                    label = \"\";\n                    title = \"\";\n                  }\n                } else {\n                  if (typeof _value !== 'undefined') {\n                    if (typeof _value.label !== 'undefined' && _value.label !== \"\") {\n                      label = title + _value.label;\n                      title = label;\n                    }\n                  } else {\n                    label = title + featureValue;\n                    title = label;\n                  }\n                  if (label === \": \") {\n                    label = \"\";\n                    title = \"\";\n                  }\n                }\n\n                displayValue = this._getFormattedValue(feature, groupField.name, lyrInfo, _fields);\n\n                if (groupType === 'byRenderer' && symbol) {\n                  this._createImageDataDiv(lang.clone(symbol), 30, 30, groupTitle, isCustom);\n                }\n\n                domConstruct.create('div', {\n                  'class': groupType === 'byField' ? 'groupField' : 'groupFieldImage',\n                  innerHTML: groupType === 'byField' ? label + displayValue : label,\n                  title: groupType === 'byField' ? title + displayValue : title\n                }, groupTitle);\n\n                var inGrpList = false;\n                if (lyrInfo.openGroups && lyrInfo.openGroups.length > 0) {\n                  inGrpList = lyrInfo.openGroups.indexOf(gId) > -1;\n                }\n                var _append = this.isDartTheme ? ' darkThemeColor' : ' lightThemeColor';\n                var groupCountNode = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupCountLabel' : 'groupCountLabel' + _append\n                }, groupTitle);\n\n                var imageContainer = domConstruct.create('div', {\n                  'class': this.isDartTheme || this.isDashboardTheme && !this.isLightTheme ? 'expandImageContainer-dart' : 'expandImageContainer'\n                }, groupTitle);\n\n                var gIIUp = this.isDartTheme ? \"groupItemImageUp-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageUp-dashboard\" : \"groupItemImageUp\";\n                var gIIDown = this.isDartTheme ? \"groupItemImageDown-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageDown-dashboard\" : \"groupItemImageDown\";\n                var cNames = this.isDartTheme ? 'groupItemImage-dart' : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImage-dashboard\" : 'groupItemImage';\n                cNames += inGrpList ? ' ' + gIIUp : ' ' + gIIDown;\n                domConstruct.create('div', {\n                  'class': cNames\n                }, imageContainer);\n\n                cNames = this.isDartTheme ? 'groupItem-dart' : 'groupItem';\n                cNames += lyrInfo.groupOpen && inGrpList ? ' groupOn' : ' groupOff';\n                groupNode = domConstruct.create('div', {\n                  'class': cNames,\n                  id: gId\n                }, groupContainer);\n\n                groupNodes.push({\n                  id: 'group_' + li.id + \"_\" + groupField.name + \"_\" + appendVal,\n                  node: groupNode,\n                  parent: groupContainer,\n                  value: featureValue\n                });\n\n                finalGroupNodes.push({\n                  value: featureValue,\n                  node: groupContainer,\n                  countNode: groupCountNode,\n                  count: 1\n                });\n\n                on(groupContainer, \"click\", lang.hitch(this, this._toggleGroup, lyrInfo));\n              } else {\n                var result = finalGroupNodes.filter(function (o) {\n                  if (o.node.id === n.id + \"_c\") {\n                    return o;\n                  }\n                });\n\n                result[0].count += 1;\n                groupNode = n;\n              }\n            }\n            var featureItem = domConstruct.create('div', {\n              'class': this.isDartTheme ? 'featureItem-dart' : 'featureItem',\n              id: 'feature_' + li.id + \"_\" + id\n            });\n\n            var isCustom = false;\n            if (li && li.symbolData) {\n              isCustom = li.symbolData.symbolType === \"CustomSymbol\";\n            }\n            if (symbol) {\n              if (displayOptions.groupEnabled && groupType === 'byRenderer') {\n                //this._createImageDataDiv(lang.clone(symbol), 30, 30, groupTitle, isCustom);\n              } else {\n                this._createImageDataDiv(lang.clone(symbol), 30, 30, featureItem, isCustom);\n              }\n            }\n\n            on(featureItem, \"click\", lang.hitch(this, this._panToFeature, feature));\n\n            if (displayString.indexOf(\" - \") > -1) {\n              displayString = displayString.slice(0, -3);\n            }\n            var _margin = displayOptions.groupEnabled && groupType === 'byRenderer' ? \"15px\" : \"50px\";\n            var _txtAlign = window.isRTL ? \"right\" : \"left\";\n            domConstruct.create('div', {\n              style: \"padding: 7px 5px 5px \" + _margin + \"; text-align: \" + _txtAlign + \";\",\n              innerHTML: displayString,\n              title: displayString\n            }, featureItem);\n\n            finalDomNodes.push({\n              node: featureItem,\n              updateNode: groupNode ? groupNode : legendNode,\n              firstValue: firstValue\n            });\n          }\n\n          if (finalGroupNodes.length > 0) {\n            //sort and place at legendNode\n            var nodes = finalGroupNodes.sort(function (a, b) {\n              if (typeof a.value === 'undefined') {\n                return b.value;\n              } else if (typeof b.value === 'undefined') {\n                return a.value;\n              }\n              if (isNaN(a.value)) {\n                return a.value.localeCompare(b.value);\n              } else {\n                return parseFloat(a.value) - parseFloat(b.value);\n              }\n            });\n            var cE = this.config.countEnabled;\n            array.forEach(nodes, function (n) {\n              if (cE) {\n                n.countNode.innerHTML = utils.localizeNumber(n.count);\n              }\n              legendNode.appendChild(n.node);\n            });\n          }\n\n          if (finalDomNodes.length > 0) {\n            var sortedNodes = finalDomNodes.sort(function (a, b) {\n              var _a = a.firstValue;\n              var _b = b.firstValue;\n              if (typeof _a === 'undefined' || _a === null || _a === \"\") {\n                return 1;\n              } else if (typeof _b === 'undefined' || _b === null || _b === \"\") {\n                return -1;\n              } else if (_a === _b) {\n                return 0;\n              }\n              return _a.toString().localeCompare(_b.toString());\n            });\n            array.forEach(sortedNodes, function (fdn) {\n              domConstruct.place(fdn.node, fdn.updateNode);\n            });\n          }\n        }\n      }\n      li.layerListExtentChanged = false;\n\n      var s_id = lyrInfo.layerObject && lyrInfo.layerObject.id && lyrInfo.layerObject.id in this.layerList ? lyrInfo.layerObject.id : li.id;\n      if (this.showAllFeatures && lyrInfo.visible) {\n        var loaded = true;\n        if (lyrInfo.layerObject && lyrInfo.type === 'ClusterLayer') {\n          loaded = !lyrInfo.layerObject.queryPending;\n          if (lyrInfo.layerObject.hasOwnProperty('requiresReload')) {\n            loaded = loaded && !lyrInfo.layerObject.requiresReload;\n            lyrInfo.layerObject.requiresReload = false;\n          }\n        }\n        lyrInfo.isLoaded = loaded;\n      }\n\n      this._removeSearching(s_id, lyrInfo.legendOpen);\n    },\n\n    updateExpand: function updateExpand(node, hide) {\n      if (typeof node !== 'undefined') {\n        var id;\n        var en;\n        if (node.id.indexOf('rec_') > -1) {\n          id = node.id.replace('rec_', '');\n          en = dom.byId(\"exp_\" + id);\n        }\n\n        if (hide) {\n          if (node) {\n            html.addClass(node, \"recDefault\");\n            html.addClass(node, \"inActive\");\n          }\n          if (en) {\n            if (!domClass.contains(en, 'expand-empty')) {\n              html.addClass(en, \"expandInActive\");\n            }\n          }\n        } else {\n          if (node) {\n            html.removeClass(node, \"recDefault\");\n            html.removeClass(node, \"inActive\");\n          }\n          if (en) {\n            if (!domClass.contains(en, 'expand-empty')) {\n              html.removeClass(en, \"expandInActive\");\n            }\n          }\n        }\n      }\n    },\n\n    getDisplayString: function getDisplayString(feature, lyrInfo, fields, displayOptions, oidName, isNames) {\n      var displayString = \"\";\n      var aliasNames = {};\n      var firstValue = \"\";\n      if (displayOptions.fields.length > 0) {\n        //get the layer fields\n        var _fields = lyrInfo.li && lyrInfo.li.fields ? lyrInfo.li.fields : lyrInfo.fields;\n        array.forEach(displayOptions.fields, lang.hitch(this, function (displayField) {\n          for (var a in fields) {\n            var fieldName = isNames ? fields[a] : a;\n            if (fieldName === displayField.name) {\n\n              //get the value with proper formatting\n              var featureValue = this._getFormattedValue(feature, fieldName, lyrInfo, _fields);\n              //set the alias name\n              aliasNames[fieldName] = this._checkAliasName(_fields, fieldName);\n\n              firstValue = firstValue === \"\" ? featureValue : firstValue;\n              var hasLabel = typeof displayField.label !== 'undefined';\n              var append = hasLabel ? displayField.label.trim() === \"\" ? \"\" : \": \" : \"\";\n              var label = hasLabel ? displayField.label : \"\";\n\n              displayString += label + append + featureValue + \" - \";\n              break;\n            }\n          }\n        }));\n      }\n      return {\n        displayString: displayString,\n        aliasNames: aliasNames,\n        firstValue: firstValue\n      };\n    },\n\n    _getFormattedValue: function _getFormattedValue(feature, fieldName, lyrInfo, fields) {\n      //get raw feature value\n      var featureValue = feature.attributes[fieldName] || \"\";\n\n      //get the fieldInfos\n      var fieldInfos;\n      var infoTemplate = this._getInfoTemplate(lyrInfo);\n      if (infoTemplate) {\n        if (infoTemplate.info && infoTemplate.info.fieldInfos) {\n          fieldInfos = infoTemplate.info.fieldInfos;\n        } else if (infoTemplate._fieldsMap) {\n          fieldInfos = infoTemplate._fieldsMap;\n        }\n      }\n      //get fieldInfo and field\n      var fieldInfo;\n      if (fieldInfos && Array.isArray(fieldInfos) && fieldInfos.hasOwnProperty('length')) {\n        fieldInfo = this._getFieldByName(fieldInfos, fieldName);\n      }\n      var field = this._getFieldByName(fields, fieldName);\n      if (field) {\n        var intField = this._checkIntField(field);\n        var domainField = this._checkDomainField(field);\n        var dateField = this._checkDateField(field);\n\n        featureValue = dateField ? this.formatDateValue(featureValue, fieldInfo) : domainField ? this.formatDomainValue(featureValue, domainField) : intField ? this.formatNumberValue(featureValue, fieldInfo) : featureValue;\n      }\n      return featureValue;\n    },\n\n    _getFieldByName: function _getFieldByName(fields, fieldName) {\n      if (fields) {\n        var _fields = fields.filter(function (f) {\n          return f.name === fieldName || f.fieldName === fieldName || fields.hasOwnProperty(f) && fields[f].fieldName === fieldName;\n        });\n        if (_fields && _fields.length > 0) {\n          return _fields[0];\n        }\n      }\n      return undefined;\n    },\n\n    _getInfoTemplate: function _getInfoTemplate(lyrInfo) {\n      var infoTemplate = lyrInfo.infoTemplate;\n      if (!infoTemplate) {\n        if (lyrInfo.layerObject && lyrInfo.layerObject.infoTemplate) {\n          infoTemplate = lyrInfo.layerObject.infoTemplate;\n        } else if (lyrInfo.li && lyrInfo.li.infoTemplate) {\n          infoTemplate = lyrInfo.li.infoTemplate;\n        }\n      }\n      if (!infoTemplate) {\n        if (typeof lyrInfo.li.subLayerId !== 'undefined') {\n          var infoTemplates = lyrInfo.layerObject.infoTemplates;\n          if (infoTemplates && infoTemplates.hasOwnProperty(lyrInfo.li.subLayerId)) {\n            infoTemplate = infoTemplates[lyrInfo.li.subLayerId].infoTemplate;\n          }\n        }\n      }\n      return infoTemplate;\n    },\n\n    formatNumberValue: function formatNumberValue(v, fieldInfo) {\n      var num = v;\n      if (!isNaN(v)) {\n        var options = fieldInfo && fieldInfo.format ? fieldInfo : undefined;\n        num = utils.localizeNumberByFieldInfo(v, options);\n      }\n      return num || \"\";\n    },\n\n    formatDomainValue: function formatDomainValue(v, domain) {\n      if (domain && domain.codedValues) {\n        var cvs = domain.codedValues;\n        for (var i = 0; i < cvs.length; i++) {\n          var cv = cvs[i];\n          if (cv.code === v) {\n            return cv.name;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    formatDateValue: function formatDateValue(v, fieldInfo) {\n      if (v) {\n        var options = fieldInfo && fieldInfo.format ? fieldInfo : undefined;\n        var d = new Date(parseInt(v, 10));\n        return options ? utils.localizeDateByFieldInfo(d, options) : utils.localizeDate(d);\n      } else {\n        return \"\";\n      }\n    },\n\n    _checkAliasName: function _checkAliasName(field) {\n      return typeof field.alias !== 'undefined' ? field.alias : false;\n    },\n\n    _checkDomainField: function _checkDomainField(field) {\n      return typeof field.domain !== 'undefined' ? field.domain : false;\n    },\n\n    _checkDateField: function _checkDateField(field) {\n      return field.type === 'esriFieldTypeDate';\n    },\n\n    _checkIntField: function _checkIntField(field) {\n      var testTypes = ['esriFieldTypeSmallInteger', 'esriFieldTypeInteger', 'esriFieldTypeSingle', 'esriFieldTypeDouble'];\n      return testTypes.indexOf(field.type) > -1;\n    },\n\n    _checkDisplayField: function _checkDisplayField(displayFields, featureField) {\n      var includeField = true;\n      if (displayFields) {\n        for (var j = 0; j < displayFields.length; j++) {\n          if (displayFields[j].name === featureField) {\n            return displayFields[j];\n          } else {\n            includeField = false;\n          }\n        }\n      }\n      return includeField;\n    },\n\n    flashGraphics: function flashGraphics(graphics) {\n      for (var i = 0; i < graphics.length; i++) {\n        var g = graphics[i];\n        this._flashFeature(g);\n      }\n    },\n\n    _flashFeature: function _flashFeature(feature) {\n      var symbol;\n      if (feature.geometry) {\n        var color = Color.fromHex(this._styleColor);\n        var color2 = lang.clone(color);\n        color2.a = 0.4;\n        switch (feature.geometry.type) {\n          case 'point':\n            symbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CIRCLE, 15, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 1), color2);\n            break;\n          case 'polyline':\n            symbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 3);\n            break;\n          case 'polygon':\n            symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_DIAGONAL_CROSS, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 2), color2);\n            break;\n        }\n      }\n\n      var g = new Graphic(feature.geometry, symbol);\n      this.map.graphics.add(g);\n      var dShape = g.getDojoShape();\n      if (dShape) {\n        fx.animateStroke({\n          shape: dShape,\n          duration: 900,\n          color: {\n            start: dShape.strokeStyle.color,\n            end: dShape.strokeStyle.color\n          },\n          width: {\n            start: 25,\n            end: 0\n          }\n        }).play();\n        setTimeout(this._clearFeature, 1075, g);\n      }\n    },\n\n    _clearFeature: function _clearFeature(f) {\n      var gl = f.getLayer();\n      gl.remove(f);\n    },\n\n    _panToFeature: function _panToFeature(feature) {\n      if (feature.geometry) {\n        var geom = feature.geometry;\n        if (geom.type === 'polyline') {\n          var path = geom.paths[Math.ceil(geom.paths.length / 2) - 1];\n          var g = path[Math.ceil((path.length - 1) / 2)];\n          geom = new Point(g[0], g[1], geom.spatialReference);\n        }\n        if (geom.type !== 'point') {\n          geom = geom.getExtent().getCenter();\n        }\n        this._pan(feature, geom).then(lang.hitch(this, function () {\n          this._flashFeature(feature);\n          if (feature._layer && feature._layer.infoTemplate || feature.infoTemplate) {\n            this.map.infoWindow.setFeatures([feature]);\n            this.map.infoWindow.select(0);\n            this.map.infoWindow.show(geom);\n          }\n        }));\n      }\n    },\n\n    _pan: function _pan(feature, centerPoint) {\n      var def = new Deferred();\n      if (this.showAllFeatures && !this.map.extent.contains(feature.geometry)) {\n        this.map.centerAt(centerPoint).then(function (ext) {\n          def.resolve(ext);\n        });\n      } else {\n        def.resolve(undefined);\n      }\n      return def;\n    },\n\n    _getQuery: function _getQuery(layerListLayer, fields, needsGeom) {\n      var layerObject = layerListLayer.layerObject;\n      var q = new Query();\n      q.geometry = !this.showAllFeatures ? this.map.extent : null;\n      q.outFields = fields;\n      q.returnGeometry = needsGeom;\n      var collectionTypes = ['collection', 'kml', 'geo_rss'];\n      var isCollection = layerListLayer.selfType ? collectionTypes.indexOf(layerListLayer.selfType) > -1 : false;\n      //layer types from feature collection don't support where\n      if (!isCollection && layerObject.url) {\n        q.where = layerListLayer.filter ? layerListLayer.filter : \"1=1\";\n      } else if (this.showAllFeatures && layerObject && layerObject.fullExtent) {\n        //still need a way to support showing of all features\n        q.geometry = layerObject.fullExtent;\n      }\n      return q;\n    },\n\n    countFeatures: function countFeatures(layerListLayer) {\n      if (!this.hidePanel) {\n        var lyr = layerListLayer.layerObject;\n        var visible = typeof layerListLayer.visible !== 'undefined' ? layerListLayer.visible : lyr.visible;\n        var visScaleRange = layerListLayer.visScaleRange;\n        var node = this.config.countEnabled ? layerListLayer.node : layerListLayer.legendNode;\n        var q = this._getQuery(layerListLayer);\n        if (lyr.queryCount && lyr.visible) {\n          lyr.queryCount(q, lang.hitch(this, function (r) {\n            if (node) {\n              var updateNode;\n              if (this.config.countEnabled) {\n                node.innerHTML = utils.localizeNumber(r);\n                updateNode = node.parentNode;\n              } else {\n                updateNode = node.previousSibling;\n              }\n              this.updateExpand(updateNode, visScaleRange ? r === 0 : true);\n            }\n          }));\n        } else if (layerListLayer && layerListLayer.li && layerListLayer.li.url && visible) {\n          var url = layerListLayer.li.url;\n          if (url.indexOf(\"MapServer\") > -1 || url.indexOf(\"FeatureServer\") > -1) {\n            var qt = new QueryTask(url);\n            qt.executeForIds(q).then(lang.hitch(this, function (ids) {\n              if (node) {\n                var updateNode;\n                var length = ids ? ids.length : 0;\n                if (this.config.countEnabled) {\n                  node.innerHTML = utils.localizeNumber(length);\n                  updateNode = node.parentNode;\n                } else {\n                  updateNode = node.previousSibling;\n                }\n                this.updateExpand(updateNode, visScaleRange ? length === 0 : true);\n              }\n            }));\n          }\n        }\n      }\n    }\n  });\n});\n//# sourceMappingURL=Widget.js.map\n"]}
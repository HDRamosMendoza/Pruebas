{"version":3,"sources":["../../../widgets/InfoSummary2/Widget.js"],"names":["define","BaseWidget","LayerInfos","utils","dom","domClass","domConstruct","on","domStyle","declare","lang","html","dojoColor","all","array","DeferredList","Deferred","query","fx","gfx","xhr","_WidgetsInTemplateMixin","_TemplatedMixin","Message","Graphic","Point","FeatureLayer","SimpleMarkerSymbol","PictureMarkerSymbol","SimpleLineSymbol","SimpleFillSymbol","Color","Query","QueryTask","FeatureSet","arcgisUtils","jsonUtils","esriRequest","SimpleRenderer","jsonUtil","ClusterLayer","LayerDrawingOptions","baseClass","name","opLayerInfos","layerList","UNIQUE_APPEND_VAL_CL","widgetChange","refreshInterval","refreshIntervalValue","configLayerInfos","legendNodes","currentQueryList","symbols","row","departamento","provincia","distrito","resulta","selectedColor","urlDepartamento","urlProvincia","urlDistrito","legendDepartamento","legendDepartamentoLineBorder","legendDepartamentoLineSize","legendDepartamentoBackground","legendProvincia","legendProvinciaLineBorder","legendProvinciaLineSize","legendProvinciaBackground","legendDistrito","legendDistritoLineBorder","legendDistritoLineSize","legendDistritoBackground","queryDepartamento","queryTaskDepartamento","featureLayerDepartamento","queryProvincia","queryTaskProvincia","featureLayerProvincia","queryDistrito","queryTaskDistrito","featureLayerDistrito","_lineColor","color","_fillLineColor","fill1","line1","colorLine","sizeLine","colorBackground","_settingDepartamento","url","lineBorder","lineColor","lineSize","window","paramDepartamento","id","outFields","mode","MODE_SELECTION","showLabels","returnGeometry","OBJECTID","IDDEPARTAMENTO","NAME_DEPARTAMENTO","setScaleRange","setRenderer","setObject","map","addLayer","_settingProvincia","paramProvincia","orderByFields","IDPROVINCIA","NAME_PROVINCIA","_settingDistrito","paramDistrito","IDDISTRITO","NAME_DISTRITO","_clearNodes","item","i","length","nodeName","style","error","console","log","message","_reseatParam","_countProject","queryString","substring","trim","getLayer","setDefinitionExpression","_onFocus","NombreLimite","focus","_loadNoneGeneralLimite","LoadGeneral","display","ID_General","_loadBlockGeneralLimite","_tableResult","paramNumber","tagHtml","_nameSelected","thisValue","parentNode","childNodes","innerText","_zoomDistrito","objectId","objectIds","selectFeatures","SELECTION_NEW","features","setExtent","geometry","getExtent","expand","bind","_onClickDistrito","event","target","attributes","value","_errorDistrito","push","clearSelection","CboDistrito","innerHTML","join","_callDistrito","featuresLength","featureAttributes","_zoomProvincia","_onClickProvincia","where","execute","document","getElementById","disabled","click","_errorProvincia","CboProvincia","_callProvincia","_zoomDepartamento","erro","_onClickDepartamento","nameDepartamento","_errorDepartamento","_stringToHTML","str","doc","DOMParser","parser","parseFromString","body","_callDepartamento","CboDepartamento","_clearSelection","_onClickLimpiarAmbito","_initialExtent","_onClickZoomGeneral","nameLimite","dataLimite","dataName","dataObjectId","_onChangeLimitePolitico","e","LimitePolitico_Selected","LimitePolitico","options","selectedIndex","_callGeneralDistrito","inName","counter","r","_callGeneralProvincia","_callGeneralDepartamento","_onClickBuscarLugar","param","limitePolitico","limiteTodo","toUpperCase","titleLabel","_onClickLimpiarLugar","_activeTabSearch","positionTab","tabs4","querySelectorAll","tabsContent4","deactvateAllTabs","forEach","tab","classList","remove","hideTabsContent","tabContent","activateTabsContent","getIndex","add","el","parentElement","children","indexOf","currentValue","index","addEventListener","_getPanel","paramWidget","paramHeight","panel","getPanel","pos","position","left","top","width","height","setPosition","_onLoadDepartamento","postCreate","inherited","arguments","config","leyendDepartamento","legendDepartamentoBorder","leyendDepartamentoLineBorder","leyendDepartamentoLineSize","leyendDepartamentoBackground","leyendProvincia","leyendProvinciaLineBorder","leyendProvinciaLineSize","leyendProvinciaBackground","leyendDistrito","leyendDistritoLineBorder","leyendDistritoLineSize","leyendDistritoBackground","inPanelOverrides","appConfig","theme","layerInfos","parseFloat","_initWidget","_forceClose","themeName","dcThemes","p","containerNode","widgetManager","closeWidget","getParent","_toggleBox","ss","outerHTML","aw","widgets","widgetOnScreen","ii","isThemeWidget","getWidgetById","_switchNodeToClose","_closeDropMenu","iconClickHandler","undefined","hidePanel","iconNodeThemes","iconNodes","hitch","firstChild","className","padding","_updateBackgroundColors","isDartTheme","isDashboardTheme","contains","pageHeader","updateForDartTheme","updateForBoxTheme","updateForTabTheme","updateForLaunchpadTheme","updateForBillboardTheme","updateForPlateauTheme","updateForDashboardTheme","fc","isOnScreen","right","lastUpdated","useDarkText","startup","showAllFeatures","mapExtentChangedHandler","_mapExtentChange","onOpen","_updatePanelHeader","styles","_updateStyleColor","visibleSubLayers","key","layerListLayer","li","lo","layerObject","orgRenderer","newRenderer","setLayerDrawingOptions","optionsArray","drawingOptions","renderer","subLayerId","refresh","_Pl","parentLayerID","l","visibleLayers","_foundIt","sub_layers_id_loop","subVizLyrId","layers","x","subLayerLoop","o","visLayers","inVisLayers","plVis","parentLayerVisible","loPlVis","type","visible","splice","graphicsLayerIds","setVisibility","updatePanelVisibility","_parentLayer","expandList","legendOpen","isLoaded","visScaleRange","_inVisibleRange","updateList","parentLayer","setVisibleLayers","refreshEnabled","enableRefresh","infoWindow","highlight","c","byId","countEnabled","listDisabled","toggleLegend","checkedTime","itemId","getItem","tempVal","setInterval","refreshLayers","clearInterval","portalUrl","substr","content","f","requestTime","Date","now","then","response","itemModified","modified","update","lastModifiedTime","_updatePanelTime","_updateItem","modifiedTime","_d","_f","dateFormat","fieldFormatter","getFormattedDate","lyr","featureCollection","_updateLayerItem","responseLayer","list","fields","k","pl","layerDefinition","symbolData","featureDisplayOptions","refreshFeatures","_loadList","featureSet","graphics","responseFeatureSetFeatures","mapFeatureSetFeatures","responseSR","_getSpatialReference","mapSR","gra","g","geom","rings","paths","points","y","mixin","spatialReference","wkid","transform","fs","shouldUpdate","JSON","stringify","requiresReload","layerListExtentChanged","clear","sr","j","go","getGraphicOptions","setAttributes","_infoTemplate","setInfoTemplate","countFeatures","hasOwnProperty","firstFeature","graphicOptions","getInstance","itemInfo","operLayerInfos","wmLayerInfos","getLayerInfoArrayOfWebmap","getLayerInfoArray","_updateLayerIDs","upgradeFields","_upgradeFields","_createPanelUI","_addFilterChanged","_addVisibleChanged","_addZoomChanged","removeIDs","getUrl","configLayer","jimuLayerInfo","config_layer_loop","getLayerInfoById","updated","wm_layer_loop","_opLayer","originOpLayer","originOperLayer","urlId","_compareURL","_compareItemID","subId","_compareSubId","layer","sort","a","b","opLayer","geomMatch","_compareGeom","fieldMatch","_compareFields","fcLayers","fcLayer","geometryType","matchingFields","filter","fn","configField","lyrInfo","oidFieldName","objectIdField","firstLayerFieldName","firstLayerFieldAlias","layerFields","layer_field_loop","_i","alias","keyFieldName","keyFieldAlias","infoTemplate","info","fieldInfos","getInfoTemplate","subLayers","getSubLayers","sub_layers_loop","sli","sl","title","popupFields","popup_field_loop","popupField","fieldName","label","wabVersion","own","changedLayerInfoArray","layerInfo","clId","getFilter","_initFeatures","_updateVisibility","vis","isShowInMap","_toggleLayerUI","changedLayerInfos","traversal","panelTitle","w","displayPanelIcon","removeClass","mainPanelText","addClass","pageBody","pageTitle","panelMainIcon","mainPanelIcon","jimuLayerInfos","numClusterLayers","_updateUI","_clearChildNodes","pageMain","updateEnd","clusterType","updateThemeClusterSymbol","getLayerType","layerType","getLayerObject","updateLayerList","_updateEnd","addMapLayers","results","lid","updating","sd","_styleColor","_rgb","fromHex","xx","evenOdd","rr","bb","gg","clusterSymbol","outline","removeOldClusterLayers","lInfos","deleteLayers","layer_info_loop","potentialNewClusterID","clusteringEnabled","dl","_dl","setTopLayerVisible","removeLayer","destroy","ids","Object","keys","reverse","lyrType","ll","selfType","_checkSelfType","_checkListDisabled","_getClusterLayer","parentLayerInfo","_lyr","empty","getFeatureLayers","featureLayers","fl","updateRenderer","_addPanelItem","_lo","symbolType","fromJson","symbol","_onRecNodeMouseover","rec","isLightTheme","_onRecNodeMouseout","potentialNewID","cssAry","create","expandClass","isInScale","setStyle","recIcon","panelImageData","toString","img","createElement","icon","src","_createImageDataDiv","set","recLabel","recNum","node","_addLegend","_updateNode","nodeCount","_toggleLayerVisibility","_toggleLegend","_class","legendNode","_getListFields","infoTemp","_getInfoTemplate","fieldInfo","displayOptions","field","groupField","updateCount","_addSearching","clusterFeatures","clusterGraphics","_features","z","clusterGraphic","setTimeout","_updateList","_removeSearching","getFeatures","eD","eU","eS","clusterLayer","n","configChange","_layers","reloadData","refreshData","countColor","_highLightColor","toDom","displayFeatureCount","_setupSymbols","sym","h","parent","isCustom","ar","setWidth","setHeight","size","setSize","mySurface","createSurface","descriptors","getShapeDescriptors","shape","createShape","defaultShape","setFill","fill","setStroke","stroke","applyTransform","dx","dy","styleName","removeDownClass","addDownClass","_updateNodes","removeUpClass","addUpClass","removeExpandClass","addExpandClass","removeGroupItemUpClass","addGroupItemUpClass","removeGroupItemDownClass","addGroupItemDownClass","removeGroupItemClass","addGroupItemClass","nodes","obj","stopPropagation","hide","hasSubLayerId","_vis","currentLayerInfo","handleMapExtentChange","levelChange","flashFeatures","visibility","visScalRange","isCurrentScaleInTheScaleRange","_append","evt","currentTarget","_toggleGroup","slice","fI","toggle","gII","gIIUp","gIIDown","lId","_idx","openGroups","groupOpen","idx","onAppConfigChanged","reason","changedData","_clearMap","bc","getComputedStyle","getPropertyValue","fromRgb","toHex","setStyleColor","_clear","continuousRefreshEnabled","_close","onClose","disableRefresh","hasChildNodes","removeChild","lastChild","visibleAtMapScale","queries","_clearList","groupEnabled","initalLoad","uNode","_needsGeom","maxRecordCount","q","_getQuery","queryFeatures","queryIds","qt","executeForIds","featurePromises","s_id","updateNode","previousSibling","_queries","queryIDs","count","_chunkRequest","fullFeatures","localizeNumber","updateExpand","IDs","max","needsGeom","def","queryList","queryResults","allFeatures","apply","resolve","countOnly","_graphicsLayer","_fields","groupNodes","finalGroupNodes","finalDomNodes","groupAdded","feature","getSymbol","oidName","_layer","flds","isNames","displayStringObj","getDisplayString","displayString","aliasNames","firstValue","groupNode","groupContainer","displayValue","groupType","featureValue","_value","appendVal","groupByField","groupByRendererOptions","groubByFields","groupByValues","values","expression_loop","_val","exp","expParts","split","isNaN","eval","replace","gId","addGroup","node_loop","iii","gNode","groupTitle","_getFormattedValue","clone","inGrpList","groupCountNode","imageContainer","cNames","countNode","result","featureItem","_panToFeature","_margin","_txtAlign","isRTL","localeCompare","cE","appendChild","sortedNodes","_a","_b","fdn","place","loaded","queryPending","en","displayField","_checkAliasName","hasLabel","append","_fieldsMap","Array","isArray","_getFieldByName","intField","_checkIntField","domainField","_checkDomainField","dateField","_checkDateField","formatDateValue","formatDomainValue","formatNumberValue","infoTemplates","v","num","format","localizeNumberByFieldInfo","domain","codedValues","cvs","cv","code","d","parseInt","localizeDateByFieldInfo","localizeDate","testTypes","_checkDisplayField","displayFields","featureField","includeField","flashGraphics","_flashFeature","color2","STYLE_CIRCLE","STYLE_SOLID","STYLE_DIAGONAL_CROSS","dShape","getDojoShape","animateStroke","duration","start","strokeStyle","end","play","_clearFeature","gl","path","Math","ceil","getCenter","_pan","setFeatures","select","show","centerPoint","extent","centerAt","ext","collectionTypes","isCollection","fullExtent","queryCount"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright  2014 - 2018 Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n/*jshint loopfunc: true */\ndefine([\n  'jimu/BaseWidget',\n  'jimu/LayerInfos/LayerInfos',\n  'jimu/utils',\n  'dojo/dom',\n  'dojo/dom-class',\n  'dojo/dom-construct',\n  'dojo/on',\n  'dojo/dom-style',\n  'dojo/_base/declare',\n  'dojo/_base/lang',\n  'dojo/_base/html',\n  'dojo/_base/Color',\n  'dojo/promise/all',\n  'dojo/_base/array',\n  'dojo/DeferredList',\n  'dojo/Deferred',\n  'dojo/query',\n  \"dojox/gfx/fx\",\n  'dojox/gfx',\n  'dojo/_base/xhr',\n  'dijit/_WidgetsInTemplateMixin',\n  'dijit/_TemplatedMixin',\n  'jimu/dijit/Message',\n  'esri/graphic',\n  'esri/geometry/Point',\n  'esri/layers/FeatureLayer',/**/\n  'esri/symbols/SimpleMarkerSymbol',\n  'esri/symbols/PictureMarkerSymbol',\n  'esri/symbols/SimpleLineSymbol',\n  'esri/symbols/SimpleFillSymbol',\n  'esri/Color',\n  'esri/tasks/query',\n  'esri/tasks/QueryTask',\n  \"esri/tasks/FeatureSet\",\n  \"esri/arcgis/utils\",\n  'esri/symbols/jsonUtils',\n  'esri/request',\n  \"esri/renderers/SimpleRenderer\",\n  \"esri/renderers/jsonUtils\",\n  './js/ClusterLayer', 'esri/layers/LayerDrawingOptions'\n  ], \n  function (\n    BaseWidget,\n    LayerInfos,\n    utils,\n    dom,\n    domClass,\n    domConstruct,\n    on,\n    domStyle,\n    declare,\n    lang,\n    html,\n    dojoColor,\n    all,\n    array,\n    DeferredList,\n    Deferred,\n    query,\n    fx,\n    gfx,\n    xhr,\n    _WidgetsInTemplateMixin,\n    _TemplatedMixin,\n    Message,\n    Graphic,\n    Point,\n    FeatureLayer,/**/\n    SimpleMarkerSymbol,\n    PictureMarkerSymbol,\n    SimpleLineSymbol,\n    SimpleFillSymbol,\n    Color,\n    Query,\n    QueryTask,\n    FeatureSet,\n    arcgisUtils,\n    jsonUtils,\n    esriRequest,\n    SimpleRenderer,\n    jsonUtil,\n    ClusterLayer,\n    LayerDrawingOptions\n  ) {\n  return declare([BaseWidget, _WidgetsInTemplateMixin], {\n    baseClass: 'jimu-widget-InfoSummary',\n\n    name: \"InfoSummary2\",\n    opLayerInfos: null,\n    layerList: {},\n    UNIQUE_APPEND_VAL_CL: \"_CL\",\n    widgetChange: false,\n    refreshInterval: 0,\n    refreshIntervalValue: 0,\n    configLayerInfos: [],\n    legendNodes: [],\n    currentQueryList: [],\n    symbols: [],\n    row: null,\n    \n    // FIELD Departamento\n    departamento: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dpto\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\"\n    },\n    // FIELD Provincia\n    provincia: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dpto\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\",\n      \"IDPROVINCIA\":\"id_prov\",\n      \"NAME_PROVINCIA\":\"nom_prov\",\n    },\n    // FIELD Distrito\n    distrito: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dep\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\",\n      \"IDPROVINCIA\":\"id_prov\",\n      \"NAME_PROVINCIA\":\"nom_prov\",\n      \"IDDISTRITO\":\"id_dist\",\n      \"NAME_DISTRITO\":\"nom_dist\"\n    },\n//style=\"border: 2px solid ${config.colorLeyendDistrito};\"\n    resulta: 0,\n\n    selectedColor: \"#D6DDEB\",\n\n    urlDepartamento: null,\n    urlProvincia: null,\n    urlDistrito: null,\n\n    legendDepartamento: \"#D10202\",\n    legendDepartamentoLineBorder: \"dash\",\n    legendDepartamentoLineSize: 1.5,\n    legendDepartamentoBackground: [209,2,2,0],\n\n    legendProvincia: \"#FF0202\",\n    legendProvinciaLineBorder: \"dash\",\n    legendProvinciaLineSize: 1.5,\n    legendProvinciaBackground: [255,2,2,0],\n\n    legendDistrito: \"#FFD133\",\n    legendDistritoLineBorder: \"dash\",\n    legendDistritoLineSize: 1.5,\n    legendDistritoBackground: [255,249,51,0],\n    \n    // ************** DEPARTAMENTO //\n    // Query\n    queryDepartamento: new Query(),\n    // Query Task\n    queryTaskDepartamento: null,\n    // Feature Layer\n    featureLayerDepartamento: null,\n    // ************** DEPARTAMENTO //\n\n    // ************** PROVINCIA //\n    // Query\n    queryProvincia: new Query(),\n    // Query Task\n    queryTaskProvincia: null,\n    // Feature Layer\n    featureLayerProvincia: null,\n    // ************** PROVINCIA //\n\n    // ************** DISTRITO //\n    queryDistrito: new Query(),\n    // Query Task\n    queryTaskDistrito: null,\n    // Feature Layer\n    featureLayerDistrito: null,\n    // ************** DISTRITO //\n\n    // Color de lnea\n    _lineColor: function(color){\n      if(color == null){\n        return color;\n      }else{\n        return (color = new Color(color));\n      }\n    },\n\n    // Contornos de colores\n    _fillLineColor: function(fill1, line1, colorLine, sizeLine, colorBackground) {\n      return (\n        new SimpleRenderer(\n          new SimpleFillSymbol(\n            fill1, \n            new SimpleLineSymbol(\n              line1,this._lineColor(colorLine), sizeLine\n            ), \n            this._lineColor(colorBackground)\n          )\n        )\n      );\n    }, \n\n    /* Configurar departamentos */\n    _settingDepartamento: function(url, lineBorder, lineColor, lineSize, colorBackground) {\n      window.paramDepartamento = \"\";\n      // Query Task\n      this.queryTaskDepartamento = new QueryTask(url);\n      // Feature Layer\n      this.featureLayerDepartamento = new FeatureLayer(url, {\n          id:\"Departamento1\", outFields: [\"*\"],\n          mode: FeatureLayer.MODE_SELECTION,\n          showLabels: true\n        }\n      );\n      this.queryDepartamento.returnGeometry = true;\n      this.queryDepartamento.outFields = [\n        this.departamento.OBJECTID,\n        this.departamento.IDDEPARTAMENTO,\n        this.departamento.NAME_DEPARTAMENTO\n      ];      \n      this.featureLayerDepartamento.setScaleRange(0,0);\n      this.featureLayerDepartamento.setRenderer(\n        this._fillLineColor(\"solid\", lineBorder, lineColor, lineSize, colorBackground)\n      );\n      \n      // Se elimina de la lista de capas\n      lang.setObject(\"_wabProperties.isTemporaryLayer\", true, this.featureLayerDepartamento);\n      // Se adiciona al mapa\n      this.map.addLayer(this.featureLayerDepartamento);\n    },\n\n    /* Configurar provincias */\n    _settingProvincia: function(url, lineBorder, lineColor, lineSize, colorBackground) {\n      window.paramProvincia = \"\";\n      this.queryTaskProvincia = new QueryTask(url);\n      // Feature Layer\n      this.featureLayerProvincia = new FeatureLayer(url, {\n          id:\"Provincia1\", outFields: [\"OBJECTID\"],\n          mode: FeatureLayer.MODE_SELECTION,\n          showLabels: true\n        }\n      );\n      this.queryProvincia.orderByFields =  [\"nom_prov ASC\"];\n      this.queryProvincia.returnGeometry = true;\n      this.queryProvincia.outFields = [\n        this.provincia.OBJECTID,\n        this.provincia.IDDEPARTAMENTO,\n        this.provincia.NAME_DEPARTAMENTO,\n        this.provincia.IDPROVINCIA,\n        this.provincia.NAME_PROVINCIA,\n      ];\n      this.featureLayerProvincia.setScaleRange(0,0);\n      this.featureLayerProvincia.setRenderer(\n        this._fillLineColor(\"solid\", lineBorder, lineColor, lineSize, colorBackground)\n      );      \n      lang.setObject(\"_wabProperties.isTemporaryLayer\", true, this.featureLayerProvincia);\n      // Se adiciona al mapa\n      this.map.addLayer(this.featureLayerProvincia);\n    },\n\n    /* Configurar provincias */\n    _settingDistrito: function(url, lineBorder, lineColor, lineSize, colorBackground) {\n      window.paramDistrito = \"\";\n      // Query Task\n      this.queryTaskDistrito = new QueryTask(url);\n      // Feature Layer\n      this.featureLayerDistrito = new FeatureLayer(url, {\n          id:\"Distrito1\", outFields: [\"OBJECTID\"],\n          mode: FeatureLayer.MODE_SELECTION,\n          showLabels: true\n        }\n      );\n      this.queryDistrito.orderByFields =  [\"nom_dist ASC\"];\n      this.queryDistrito.returnGeometry = true;\n      this.queryDistrito.outFields = [\n        this.distrito.OBJECTID,\n        this.distrito.IDDEPARTAMENTO,\n        this.distrito.NAME_DEPARTAMENTO,\n        this.distrito.IDPROVINCIA,\n        this.distrito.NAME_PROVINCIA,\n        this.distrito.IDDISTRITO,\n        this.distrito.NAME_DISTRITO,\n      ];      \n      this.featureLayerDistrito.setScaleRange(0,0);      \n      this.featureLayerDistrito.setRenderer (\n        this._fillLineColor(\"solid\", lineBorder, lineColor, lineSize, colorBackground)\n      );\n      lang.setObject(\"_wabProperties.isTemporaryLayer\", true, this.featureLayerDistrito);\n      //Se adiciona al mapa\n      this.map.addLayer(this.featureLayerDistrito);\n    },\n   \n    // Limpia la seleccin del departamento\n    _clearNodes: function(item) {\n      try {\n        for(let i = 0; i<item.length; i++) {\n          if(item[i].nodeName == \"LI\") {\n            item[i].style[\"background-color\"] = \"#FFFFFF\";\n          }          \n        }\n      } catch (error) {\n        console.log(`Error: _clearNodes ${error.name} - ${error.message}`);\n      }\n    },\n\n    _reseatParam: function() {\n      window.paramDepartamento = \"\";\n      window.paramProvincia = \"\";\n      window.paramDistrito = \"\";\n    },\n\n    _countProject: function() {\n      let queryString = \"\";\n      try {\n        // QueryString\n        queryString += window.paramDepartamento == \"\"? ``: `departamento = '${window.paramDepartamento}' AND `;\n        queryString += window.paramProvincia ==\"\"? ``: `provincia = '${window.paramProvincia}' AND `;\n        queryString += window.paramDistrito ==\"\"? ``: `distrito = '${window.paramDistrito}' AND`;\n        queryString = queryString.substring(0, queryString.length - 4);\n        // Valida si no tiene consultas se debe de llamar tosos los\n        queryString = queryString.trim().length == \"\"? `1=1`: queryString;\n        /* Filtrado de capas */\n        this.map.getLayer(`VMVU_VISOR_DECRETO_DE_URGENCIA_9093`)\n          .setDefinitionExpression(`${queryString}`);\n        this.map.getLayer(`VMCS_VISOR_DECRETO_DE_URGENCIA_5572`)\n          .setDefinitionExpression(`${queryString}`);\n      } catch (error) {\n        console.log(`Error: _countProject ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onFocus: function() {\n      try {\n        this.NombreLimite.focus();\n      } catch (error) {\n        console.log(`Error: _onFocus ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Se oculta la muestra de la bsqueda general del lmite\n    _loadNoneGeneralLimite: function(){\n      try {\n        this.LoadGeneral.style.display = \"none\";\n        this.ID_General.style.display = \"block\";\n      } catch (error) {\n        console.log(`Error: _loadNoneGeneralLimite ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Se muestra la bsqueda general del limite\n    _loadBlockGeneralLimite: function(){\n      try {\n        this.LoadGeneral.style.display = \"block\";\n        this.ID_General.style.display = \"none\";\n      } catch (error) {\n        console.log(`Error: _loadBlockGeneralLimite ${error.name} - ${error.message}`);\n      }\n    },\n\n    _tableResult: function(paramNumber) {\n      let tagHtml = [];\n      try {\n        if(paramNumber != null) {\n          this.resulta = this.resulta + paramNumber;\n          if(this.resulta == 3) {\n            this._loadNoneGeneralLimite();\n            this._tableResult(null);\n          }\n        } else {\n          this.resulta = 0;\n        }\n      } catch (error) {\n        console.log(\"Error: _tableResult \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    // Cambia el nombre del limite seleccionado\n    _nameSelected: function(thisValue, name) {\n      try {\n        thisValue\n            .parentNode\n            .parentNode\n              .childNodes[3]\n              .childNodes[3].innerText = name; \n      } catch (error) {\n        console.log(\"Error: _nameSelected \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _zoomDistrito: function (objectId) {\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerDistrito.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            this.map.setExtent(features[0].geometry.getExtent().expand(1.6));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onClickDistrito: function() {\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[\"data-distritoId\"].value != \"\") {\n          // Cambia el nombre del limite seleccionado\n          this._nameSelected(thisValue.parentNode, thisValue.innerText);\n          // Limpiar seleccin\n          this._clearNodes(thisValue.parentNode.childNodes);\n          // Pinta la seleccin\n          thisValue.style[\"background-color\"] = this.selectedColor;\n          // Asigna nombre de DISTRITO\n          window.paramDistrito = thisValue.innerText.trim();\n          this._zoomDistrito(thisValue.attributes[\"data-objectId\"].value);\n          // Contador de proyectos\n          this._countProject();\n        }\n      } catch (error) {\n        console.log(`Error: _onClickDistrito ${error.name} - ${error.message}`);\n      } \n    },\n\n    // Error - Select PROVINCIA\n    _errorDistrito: function(item) {\n      try {\n        let tagHtml = [];\n        tagHtml.push(`<li class=\"list-group-item\" \\\n          data-objectId=\"\" data-id=\"\">\\\n          Error al cargar\\\n        </li>`);\n        this.featureLayerDistrito.clearSelection();\n        this.CboDistrito.innerHTML = tagHtml.join(\"\");\n      } catch (error) {\n          console.log(`Error: _errorDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callDistrito: function(item) {\n      try {\n        let tagHtml = [];\n        if(item != null) { \n          featuresLength = item.features.length;\n          for(let i = 0; i < featuresLength; i++) {\n            featureAttributes = item.features[i].attributes;\n            tagHtml.push(`<li class=\"list-group-item\" \\\n              data-objectId=\"${featureAttributes[this.distrito.OBJECTID]}\" \\\n              data-distritoId=\"${featureAttributes[this.distrito.IDDISTRITO]}\">\\\n              ${featureAttributes[this.distrito.NAME_DISTRITO]}\\\n            </li>`);\n          }\n        } else {\n          tagHtml.push(`<li class=\"list-group-item\">\\\n            <p class=\"font-italic\">CARGANDO ....</p>\\\n          </li>`);\n        }\n        this.featureLayerDistrito.clearSelection();\n        this.CboDistrito.innerHTML = tagHtml.join(\"\");\n        // Cambia el nombre del limite seleccionado\n        this._nameSelected(this.CboDistrito,'');\n      } catch (error) {\n          console.log(`Error: _callDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _zoomProvincia: function (objectId) {\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerProvincia.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            this.map.setExtent(features[0].geometry.getExtent().expand(1.6));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onClickProvincia: function(){\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[`data-provinciaId`].value != \"\") {\n          // Cambia el nombre del limite seleccionado\n          this._nameSelected(thisValue.parentNode, thisValue.innerText);\n          // Limpiar seleccin\n          this._clearNodes(thisValue.parentNode.childNodes);\n          // Departamento seleccionado\n          thisValue.style[`background-color`] = this.selectedColor;\n          // Asigna valor el nombre PROVINCIA\n          window.paramProvincia = thisValue.innerText.trim();\n          window.paramDistrito = \"\";\n          // Acercamiento a PROVINCIA\n          this._zoomProvincia(thisValue.attributes[`data-objectId`].value);\n          // Contador proyectos\n          this._countProject();\n          // Consulta de PROVINCIA\n          this.queryDistrito.where = `\n            ${this.distrito.IDDEPARTAMENTO} = '${thisValue.attributes[\"data-departamentoId\"].value.trim()}' AND \n            ${this.distrito.IDPROVINCIA} = '${thisValue.attributes[\"data-provinciaId\"].value.trim()}'`;\n          // Executa consulta de DISTRITOS\n          this.queryTaskDistrito.execute(\n            this.queryDistrito,\n            this._callDistrito.bind(this),\n            this._errorDistrito.bind(this)\n          );\n          document.getElementById(\"Distritos\").disabled = false;\n          document.getElementById(\"Distritos\").click();\n        }\n      } catch (error) {\n        console.log(`Error: _onClickProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Error - Select PROVINCIA\n    _errorProvincia: function(item) {\n      try {\n        let tagHtml = [];\n          tagHtml.push(`<li class=\"list-group-item\" \\\n            data-objectId=\"\" data-id=\"\">\\\n            Error al cargar\n          </li>`);\n        this.featureLayerProvincia.clearSelection();\n        this.CboProvincia.innerHTML = tagHtml.join(\"\");\n      } catch (error) {\n        console.log(`Error: _errorProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Carga de PROVINCIAS\n    _callProvincia: function(item) {\n      try {\n        let tagHtml = [];\n        if(item != null) {\n          featuresLength = item.features.length;\n          for(let i = 0; i < featuresLength; i++) {\n            this.featureAttributes = item.features[i].attributes;\n            tagHtml.push(`<li class=\"list-group-item\" \\\n                data-objectId=\"${this.featureAttributes[this.provincia.OBJECTID]}\" \\\n                data-departamentoid=\"${this.featureAttributes[this.provincia.IDDEPARTAMENTO]}\" \\\n                data-provinciaId=\"${this.featureAttributes[this.provincia.IDPROVINCIA]}\">\\\n                ${this.featureAttributes[this.provincia.NAME_PROVINCIA]}\n              </li>`);\n          }\n          document.getElementById(\"Distritos\").disabled = true;\n        } else {\n          tagHtml.push(`<li class=\"list-group-item\">\n              <p class=\"font-italic\">Seleccione Departamento</p>\n            </li>`);\n        }\n        this._callDistrito(null);\n        this.featureLayerProvincia.clearSelection();\n        this.CboProvincia.innerHTML = tagHtml.join(\"\");\n        // Cambia el nombre del limite seleccionado\n        this._nameSelected(this.CboProvincia,'');\n      } catch (error) {\n        console.log(`Error: _callProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    /* Realiza un acercameinto al departamento */\n    _zoomDepartamento: function (objectId) {\n      // objectId. Es del departamento.\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerDepartamento.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            // Valida si el zoom se activa o no\n            this.map.setExtent(features[0].geometry.getExtent().expand(2));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomDepartamento ${erro.name} - ${error.message}`);\n      }\n    },\n\n    _onClickDepartamento: function() {\n      let nameDepartamento;\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[`data-objectId`].value != \"\") {\n          // Cambia el nombre del limite seleccionado\n          this._nameSelected(thisValue.parentNode, thisValue.innerText);\n          // Limpiar seleccin\n          this._clearNodes(thisValue.parentNode.childNodes);          \n          // Departamento seleccionado\n          thisValue.style[`background-color`] = this.selectedColor;\n          // Asigna el nombre de DEPARTAMENTO\n          window.paramDepartamento = thisValue.innerText.trim();\n          window.paramProvincia = \"\";\n          window.paramDistrito = \"\";\n          // Acercamiento DEPARTAMENTO\n          this._zoomDepartamento(thisValue.attributes[\"data-objectId\"].value);\n          this._countProject();\n          // Ejecutar llamado de PROVINCIAS\n          this.queryProvincia.where = this.provincia.IDDEPARTAMENTO + \" = '\" + thisValue.attributes[\"data-departamentoId\"].value +\"'\";\n          this.queryTaskProvincia.execute(\n            this.queryProvincia,\n            this._callProvincia.bind(this),\n            this._errorProvincia.bind(this)\n          );\n          document.getElementById(\"Provincias\").disabled = false;\n          document.getElementById(\"Provincias\").click();\n        }\n      } catch (error) {\n        console.log(`Error: _onClickDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n  \n    // Error - Select DEPARTAMENTAL\n    _errorDepartamento: function(item) {\n      try {\n        let tagHtml = [];\n        tagHtml.push(`<li class=\"list-group-item\" \\\n          data-id=\"\"> Error al cargar </li>`);\n      } catch (error) {\n          console.log(`Error: _errorDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n\n    _stringToHTML: function () {\n      var str = `<li class=\"list-group-item\" data-objectId=\"\" name=\"\"></li>`;\n      var doc = new DOMParser().parser.parseFromString(str, 'text/html');\n      return doc.body;\n    },\n\n    _callDepartamento: function(item) {\n      try {\n        let tagHtml = [];\n        this.featureLayerDepartamento.clearSelection();\n        document.getElementById(\"Departamentos\").click();\n        document.getElementById(\"Provincias\").disabled = true;\n        document.getElementById(\"Distritos\").disabled = true;\n        if(item != null) {\n          this.featuresLength = item.features.length;\n          for(let i = 0; i < this.featuresLength; i++) {\n            this.featureAttributes = item.features[i].attributes;\n            tagHtml.push(`<li class=\"list-group-item\" \\\n                data-objectId=\"${this.featureAttributes[this.departamento.OBJECTID]}\" \\\n                data-departamentoId=\"${this.featureAttributes[this.departamento.IDDEPARTAMENTO]}\">\\\n                ${this.featureAttributes[this.departamento.NAME_DEPARTAMENTO]}\n              </li>`\n            );\n          }\n          this.CboDepartamento.innerHTML = tagHtml.join(\"\");\n        } else {\n          // Cambia el nombre del limite seleccionado\n          this._nameSelected(this.CboDepartamento,'');\n          // Se limpia la seleccin del departamento\n          this._clearNodes(this.CboDepartamento.childNodes);\n        }\n      } catch (error) {\n        console.log(`Error: _callDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Limpiar capas seleccionadas\n    _clearSelection: function() {\n      try {\n        this.featureLayerDepartamento.clearSelection();\n        this.featureLayerProvincia.clearSelection();\n        this.featureLayerDistrito.clearSelection();\n      } catch (error) {\n        console.log(`Error: _clearSelection ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onClickLimpiarAmbito: function() {\n      try {\n        /* Limpia DEPARTAMENTO */\n        this._callDepartamento(null);\n        /* Limpia PROVINCIA */\n        this._callProvincia(null);\n        /* Limpia DISTRITO */\n        this._callDistrito(null);\n        /* Limpiar los proyectos */\n        this._reseatParam();\n        // Extension por defecto del map\n        this.map.setExtent(this.map._initialExtent);\n        this._countProject();\n      } catch (error) {\n        console.log(`Error: _onClickBuscarAmbito ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Se limpia la bsqueda GENERAL\n    _onClickZoomGeneral: function() {\n      let nameLimite = \"\", dataLimite = \"\";\n      try {\n        thisValue = event.target;\n        // Atributo data-HTML\n        dataName     = thisValue.attributes[\"data-name\"];\n        dataLimite   = thisValue.attributes[\"data-limite\"];\n        dataObjectId = thisValue.attributes[\"data-objectId\"];\n        // Se limpia la seleccin\n        this._clearNodes(thisValue.parentNode.childNodes);\n        thisValue.style[\"background-color\"] = this.selectedColor;\n        // Limpiar seleccin\n        this._clearSelection();\n        this._reseatParam();\n        // Acercamiento segn el lmite poltico\n        if(dataName.value == `departamento`) {\n          this._zoomDepartamento(dataObjectId.value);\n          window.paramDepartamento = dataLimite.value;\n        } else if(dataName.value == `provincia`) {\n          this._zoomProvincia(dataObjectId.value);\n          window.paramProvincia = dataLimite.value;\n        } else if(dataName.value == `distrito`) {\n          this._zoomDistrito(dataObjectId.value);\n          window.paramDistrito = dataLimite.value;\n        }\n        this._countProject();\n      } catch (error) {\n        console.log(`Error: _onClickGeneral ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Selecciona el lmite poltico\n    _onChangeLimitePolitico: function(e) {\n      try {\n        this.LimitePolitico_Selected.innerHTML = this.LimitePolitico.options[this.LimitePolitico.selectedIndex].innerText;\n      } catch (error) {\n        console.log(`Error: _onChangeLimitePolitico ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callGeneralDistrito: function(inName, counter) {\n      try {\n        // DISTRITOS\n        this.queryDistrito.where = `${this.distrito.NAME_DISTRITO} LIKE '%${inName}%'`;\n        this.queryTaskDistrito.execute(\n          this.queryDistrito,\n          // Resultado de DISTRITOS\n          function(item) {\n            let tagHtml = [];\n            try {\n              featuresLength = item.features.length;\n              for(let r = 0; r < featuresLength; r++) {\n                featureAttributes = item.features[r].attributes;\n                tagHtml.push(`<li class=\"list-group-item\" \\\n                  data-objectId=\"${featureAttributes[this.distrito.OBJECTID]}\" \\\n                  data-id=\"${featureAttributes[this.distrito.IDDISTRITO]}\" \\\n                  data-name=\"distrito\" data-limite=\"${featureAttributes[this.distrito.NAME_DISTRITO]}\">\\\n                   <span class=\"leyend-distrito\" style=\"border: 2px solid ${this.legendDistrito};\"></span>&nbsp;\\\n                   ${featureAttributes[this.distrito.NAME_DEPARTAMENTO]},\\\n                   Provincia ${featureAttributes[this.distrito.NAME_PROVINCIA]},\\\n                   Distrito ${featureAttributes[this.distrito.NAME_DISTRITO]}\n                  </li>`);\n              }\n              this.ID_General.innerHTML += tagHtml.join(\"\");\n              this._tableResult(counter);\n            } catch (error) {\n              console.log(`Error: _onClickBuscarLugar > distrito > ${error.name} - ${error.message}`);\n            }\n          }.bind(this)\n          // /Resultado de DISTRITOS\n        );\n        // /DISTRITOS\n      } catch (error) {\n        console.log(`Error: _callGeneralDistrito > distrito function > ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callGeneralProvincia: function(inName, counter) {\n      try {\n        // PROVINCIAS\n        this.queryProvincia.where = `${this.provincia.NAME_PROVINCIA} LIKE '%${inName}%'`;\n        // Ejecutar de PROVINCIAS\n        this.queryTaskProvincia.execute(\n          this.queryProvincia,\n          // Resultado de PROVINCIAS\n          function(item) {\n            let tagHtml = [];\n            try {\n              featuresLength = item.features.length;              \n              for(let i = 0; i < featuresLength; i++) {\n                featureAttributes = item.features[i].attributes;\n                tagHtml.push(`<li class=\"list-group-item\" \\\n                  data-objectId=\"${featureAttributes[this.provincia.OBJECTID]}\" \\\n                  data-id=\"${featureAttributes[this.provincia.IDPROVINCIA]}\" \\\n                  data-name=\"provincia\" data-limite=\"${featureAttributes[this.provincia.NAME_PROVINCIA]}\">\n                    <span class=\"leyend-provincia\" style=\"border: 2px solid ${this.legendProvincia};\"></span>&nbsp;\\\n                    ${featureAttributes[this.provincia.NAME_DEPARTAMENTO]}, \\\n                    Provincia ${featureAttributes[this.provincia.NAME_PROVINCIA]}\\\n                  </li>`);\n              }\n              this.ID_General.innerHTML += tagHtml.join(\"\");\n              this._tableResult(counter);\n            } catch (error) {\n              console.log(`Error: _callGeneralProvincia > provincia function > ${error.name} - ${error.message}`);\n            }\n          }.bind(this)\n          // /Resultado de PROVINCIAS\n        );\n        // /PROVINCIAS\n      } catch (error) {\n        console.log(`Error: _callGeneralProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callGeneralDepartamento: function(inName, counter) {\n      try {\n        // DEPARTAMENTOS\n        this.queryDepartamento.where = `\\\n        ${this.departamento.NAME_DEPARTAMENTO} LIKE '%${inName}%'`;\n        // Ejecutar de DEPARTAMENTOS\n        this.queryTaskDepartamento.execute(\n          this.queryDepartamento,\n          // Resultado de DEPARTAMENTOS\n          function(item) {\n            let tagHtml = [];\n            try {\n              featuresLength = item.features.length;\n              for(let i = 0; i<featuresLength; i++) {\n                featureAttributes = item.features[i].attributes;\n                tagHtml.push(`<li class=\"list-group-item\" \\\n                  data-objectId=\"${featureAttributes[this.departamento.OBJECTID]}\" \\\n                  data-id=\"${featureAttributes[this.departamento.IDDEPARTAMENTO]}\" \\\n                  data-name=\"departamento\" data-limite=\"${featureAttributes[this.departamento.NAME_DEPARTAMENTO]}\">\\\n                  <span class=\"leyend-departamento\" style=\"border: 2px solid ${this.legendDepartamento};\"></span>&nbsp;\\\n                  ${featureAttributes[this.departamento.NAME_DEPARTAMENTO]}\\\n                </li>`);                \n              }\n              this.ID_General.innerHTML += tagHtml.join(\"\");\n              this._tableResult(counter);\n            } catch (error) {\n              console.log(`Error: _onClickBuscarLugar > departamento function > ${error.name} - ${error.message}`);\n            }\n          }.bind(this)\n          // /Resultado de DEPARTAMENTOS\n        );\n        // /DEPARTAMENTOS\n      } catch (error) {\n        console.log(`Error: _callGeneralDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Limpiar resultado de lugar\n    _onClickBuscarLugar: function(param) {\n      let inName=\"\", limitePolitico=\"\", limiteTodo = \"\";\n      try {\n        if(param != null){\n          // Limpiar seleccin\n          this._clearSelection();\n          this._reseatParam();\n          // Se obtiene el valor del campo\n          inName = this.NombreLimite.value.trim().toUpperCase(); \n          if(inName) {\n            // Limpiando contenido\n            this.ID_General.innerHTML = \"\";\n            // Mostrar animacin de carga\n            this._loadBlockGeneralLimite();\n            limitePolitico = this.LimitePolitico.value;\n            // Simulando un SWITCH CASE\n            limiteTodo =  limitePolitico == 'departamento' ? this._callGeneralDepartamento(inName,3):\n                          limitePolitico == 'provincia' ? this._callGeneralProvincia(inName,3):\n                          limitePolitico == 'distrito' ? this._callGeneralDistrito(inName,3):\n                          'todos';\n            // Muestra TODOS\n            if(limiteTodo == 'todos') {\n              this._callGeneralDepartamento(inName,1);\n              this._callGeneralProvincia(inName,1);\n              this._callGeneralDistrito(inName,1);\n            }\n          } else {\n            // Muestra mensaje de advertencia\n            new Message({\n              titleLabel: `<strong>\\\n                <i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>&nbsp;\\\n                COMPLETAR CAMPO</strong>`,\n              message: `<i class=\"fa fa-terminal\" aria-hidden=\"true\"></i>&nbsp;\\\n                Ingrese el <strong>LMITE POLTICO</strong> segn la seleccin \\\n                (<u>DEPARTAMENTOS</u>, <u>PROVINCIAS</u>, <u>DISTRITOS</u> o <u>TODOS</u>).`\n            });\n          }\n        } else {\n          this.ID_General.innerHTML = `<li class=\"list-group-item\">Resultado de bsqueda</li>`;\n        }\n      } catch (error) {\n        console.log(`Error: _onClickBuscarLugar ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Limpiar resultado de lugar\n    _onClickLimpiarLugar: function() {\n      try {\n        this.LimitePolitico.value = \"todos\";\n        this.NombreLimite.value = \"\";\n        this.LimitePolitico_Selected.innerHTML = this.LimitePolitico.value.toUpperCase();\n        this._onClickBuscarLugar(null);\n        this._onFocus();\n        // Limpiar seleccin\n        this._clearSelection();\n        this._reseatParam();\n        // Extension por defecto del map\n        this.map.setExtent(this.map._initialExtent);\n        this._countProject();\n      } catch (error) {\n        console.log(`Error: _onClickLimpiarLugar ${error.name} - ${error.message}`);\n      }\n    },\n\n    _activeTabSearch: function(positionTab) {\n      try {\n        let tabs4 = document.querySelectorAll('.jimu-widget-InfoSummary .tabs .tab');\n        let tabsContent4 = document.querySelectorAll('.jimu-widget-InfoSummary .tab-content');\n\n        let deactvateAllTabs = function () {\n          tabs4.forEach(function (tab) {\n            tab.classList.remove('jimu-state-selected');\n          });\n        };\n\n        let hideTabsContent = function () {\n          tabsContent4.forEach(function (tabContent) {\n            tabContent.classList.remove('jimu-state-selected');\n          });\n        };\n\n        let activateTabsContent = function (tab) {\n          tabsContent4[getIndex(tab)].classList.add('jimu-state-selected');\n        };\n\n        let getIndex = function (el) {\n          return [...el.parentElement.children].indexOf(el);\n        };\n\n        tabs4.forEach(function (currentValue, index, array) {\n          currentValue.addEventListener('click', function () {\n              deactvateAllTabs();\n              hideTabsContent();\n              /* Limpia la funcionalidad */\n              currentValue.classList.add('jimu-state-selected');\n              activateTabsContent(currentValue);\n              this._onFocus();\n          }.bind(this));\n\n        }.bind(this));\n        tabs4[positionTab].click();\n        if(positionTab){ this._onFocus(); }\n      } catch (error) {\n        console.log(\"Error: _activeTabSearch \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    /* Cambiar el tamao del widget */\n    _getPanel: function(paramWidget, paramHeight) {  \n      try {\n        let panel = this.getPanel();\n        let pos = panel.position;\n        // Posicin por defecto\n        pos.left = 70; pos.top = 52;\n        pos.width = paramWidget;\n        pos.height = paramHeight;\n        panel.setPosition(pos);\n      } catch (error) {\n        console.log(\"_getPanel: \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _onLoadDepartamento: function() {\n      this.queryDepartamento.where = \"1=1\";\n      this.queryTaskDepartamento.execute(\n        this.queryDepartamento,\n        this._callDepartamento.bind(this),\n        this._errorDepartamento.bind(this)\n      );\n    },\n\n    postCreate: function postCreate() {\n      this.inherited(arguments);\n\n      /* Cambiar el tamao del widget */\n      this._getPanel(320, 650);\n\n      this.urlDepartamento = this.config.urlDepartamento;\n      this.urlProvincia = this.config.urlProvincia;\n      this.urlDistrito = this.config.urlDistrito;\n\n      this.legendDepartamento = this.config.leyendDepartamento;\n      this.legendDepartamentoBorder = this.config.leyendDepartamentoLineBorder;\n      this.legendDepartamentoLineSize = this.config.leyendDepartamentoLineSize;\n      this.legendDepartamentoBackground = this.config.leyendDepartamentoBackground;\n      this.legendProvincia = this.config.leyendProvincia;\n      this.legendProvinciaLineBorder = this.config.leyendProvinciaLineBorder;\n      this.legendProvinciaLineSize = this.config.leyendProvinciaLineSize;\n      this.legendProvinciaBackground = this.config.leyendProvinciaBackground;\n      this.legendDistrito = this.config.leyendDistrito;\n      this.legendDistritoLineBorder = this.config.leyendDistritoLineBorder;\n      this.legendDistritoLineSize = this.config.leyendDistritoLineSize;\n      this.legendDistritoBackground = this.config.leyendDistritoBackground;\n\n      this.inPanelOverrides(this.appConfig.theme.name);\n      this.configLayerInfos = this.config.layerInfos;\n      this.layerList = {};\n      /* Configuracion departamento */\n      this._settingDepartamento(\n        this.urlDepartamento,\n        this.legendDepartamentoBorder,\n        this.legendDepartamento,\n        parseFloat(this.legendDepartamentoLineSize),\n        this.legendDepartamentoBackground\n      );\n      /* Configuracion provincia */\n      this._settingProvincia(\n        this.urlProvincia,\n        this.legendProvinciaLineBorder,\n        this.legendProvincia,\n        parseFloat(this.legendProvinciaLineSize),\n        this.legendProvinciaBackground\n      );\n      /* Configuracion distrito */\n      this._settingDistrito(\n        this.urlDistrito,\n        this.legendDistritoLineBorder,\n        this.legendDistrito,\n        parseFloat(this.legendDistritoLineSize),\n        this.legendDistritoBackground\n      );    \n      /* Cargar los departamentos */\n      this._onLoadDepartamento();\n      //populates this.layerInfos and creates the panel\n      this._initWidget();\n      \n    },\n\n    _forceClose: function _forceClose() {\n      var themeName = this.appConfig.theme.name;\n      var dcThemes = ['LaunchpadTheme', 'DartTheme', 'FoldableTheme', 'JewelryBoxTheme', 'BillboardTheme', 'TabTheme', 'DashboardTheme'];\n      var p = this.getPanel();\n      if (dcThemes.indexOf(themeName) > -1) {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        this.widgetManager.closeWidget(this.id);\n      } else if (themeName === 'BoxTheme') {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        if (p.getParent && p.getParent()._toggleBox) {\n          var ss = query('.icon-node-active');\n          for (var i = 0; i < ss.length; i++) {\n            if (ss[i].outerHTML.indexOf(this.id) > -1) {\n              p.getParent()._toggleBox();\n            }\n          }\n        }\n      } else if (themeName === 'PlateauTheme') {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        this.widgetManager.closeWidget(this.id);\n        if (!this.aw) {\n          var widgets = this.widgetManager.appConfig.widgetOnScreen.widgets;\n          for (var ii = 0; ii < this.widgetManager.appConfig.widgetOnScreen.widgets.length; ii++) {\n            if (widgets[ii].isThemeWidget) {\n              this.aw = this.widgetManager.getWidgetById(widgets[ii].id);\n              this.aw._switchNodeToClose(this.id);\n              this.aw._closeDropMenu();\n              break;\n            }\n          }\n        } else {\n          this.aw._switchNodeToClose(this.id);\n          this.aw._closeDropMenu();\n        }\n      }\n    },\n\n    inPanelOverrides: function inPanelOverrides(themeName) {\n      if (typeof this.iconClickHandler !== 'undefined') {\n        this.iconClickHandler.remove();\n        this.iconClickHandler = undefined;\n      }\n\n      var p = this.getPanel();\n\n      if (this.config.hidePanel) {\n        var iconNodeThemes = ['DartTheme', 'BoxTheme', 'FoldableTheme', 'JewelryBoxTheme', 'PlateauTheme'];\n\n        var iconNodes;\n        if (themeName === 'LaunchpadTheme') {\n          this._forceClose();\n          iconNodes = query('.selected');\n          if (iconNodes.length > 0) {\n            if (iconNodes[0].parentNode.outerHTML.indexOf(this.id) > -1) {\n              this.iconClickHandler = on(iconNodes[0], 'click', lang.hitch(this, this._forceClose));\n            }\n          }\n        } else if (iconNodeThemes.indexOf(themeName) > -1) {\n          if (themeName === 'BoxTheme') {\n            this._forceClose(); //did this for box...make sure it doesn't jack others up\n          }\n          iconNodes = query('.icon-node');\n          for (var i = 0; i < iconNodes.length; i++) {\n            if (iconNodes[i].outerHTML.indexOf(this.id) > -1) {\n              this.iconClickHandler = on(iconNodes[i], 'click', lang.hitch(this, this._forceClose));\n            }\n          }\n        }\n      } else {\n        //TODO test if this has the class .jimu-widget-frame.jimu-container\n        if (p.containerNode && p.containerNode.firstChild && p.containerNode.firstChild.className) {\n          p.containerNode.firstChild.style.padding = '0px 0px 10px 0px';\n        }\n\n        //change associated with the tab theme...all others will show the background color behind refresh text and panel image\n        if (['TabTheme', 'BillboardTheme', 'PlateauTheme', 'DashboardTheme'].indexOf(themeName) === -1) {\n          this._updateBackgroundColors(true);\n        }\n\n        this.isDartTheme = themeName === \"DartTheme\";\n        this.isDashboardTheme = themeName === 'DashboardTheme';\n        if (domClass.contains(this.pageHeader, this.isDartTheme ? 'pageHeader-border' : 'pageHeader-border-dart')) {\n          domClass.remove(this.pageHeader, this.isDartTheme ? 'pageHeader-border' : 'pageHeader-border-dart');\n        }\n        domClass.add(this.pageHeader, this.isDartTheme ? 'pageHeader-border-dart' : 'pageHeader-border');\n\n        switch (themeName) {\n          case 'DartTheme':\n            this.updateForDartTheme(p);\n            break;\n          case 'BoxTheme':\n            this.updateForBoxTheme(p);\n            break;\n          case 'TabTheme':\n            this.updateForTabTheme(p);\n            break;\n          case 'LaunchpadTheme':\n            this.updateForLaunchpadTheme(p);\n            break;\n          case 'BillboardTheme':\n            this.updateForBillboardTheme(p);\n            break;\n          case 'PlateauTheme':\n            this.updateForPlateauTheme(p);\n            break;\n          case 'DashboardTheme':\n            this.updateForDashboardTheme(p);\n            break;\n        }\n      }\n    },\n\n    updateForLaunchpadTheme: function updateForLaunchpadTheme(p) {\n      p.containerNode.style.top = '30px';\n    },\n\n    updateForTabTheme: function updateForTabTheme(p) {\n      if (p.containerNode.children.length > 0) {\n        var fc = p.containerNode.children[0];\n        if (fc.children.length > 1) {\n          fc.children[1].style.padding = '14px 0px 14px 0px';\n        }\n      }\n      if (!p.config.isOnScreen) {\n        this._updateBackgroundColors(false);\n      }\n    },\n\n    updateForBoxTheme: function updateForBoxTheme(p) {\n      p.containerNode.parentNode.style.top = '140px';\n    },\n\n    updateForDartTheme: function updateForDartTheme(p) {\n      p.containerNode.style.right = '0px';\n      p.containerNode.style.left = '0px';\n    },\n\n    updateForBillboardTheme: function updateForBillboardTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    updateForPlateauTheme: function updateForPlateauTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    updateForDashboardTheme: function updateForDashboardTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    _updateBackgroundColors: function _updateBackgroundColors(add) {\n      //deal with text color\n      if (domClass.contains(this.lastUpdated, add ? 'lastUpdated-tab' : 'lastUpdated')) {\n        domClass.remove(this.lastUpdated, add ? 'lastUpdated-tab' : 'lastUpdated');\n      }\n      domClass.add(this.lastUpdated, add ? 'lastUpdated' : 'lastUpdated-tab');\n\n      add = add && this.appConfig.theme.name !== 'DashboardTheme';\n      this.useDarkText = !add;\n\n      //deal with background color for page header\n      if (domClass.contains(this.pageHeader, 'jimu-main-background') && !add) {\n        domClass.remove(this.pageHeader, 'jimu-main-background');\n      } else if (!domClass.contains(this.pageHeader, 'jimu-main-background') && add) {\n        domClass.add(this.pageHeader, 'jimu-main-background');\n      }\n      if (domClass.contains(this.pageHeader, 'dart-bgcolor') && !add) {\n        domClass.remove(this.pageHeader, 'dart-bgcolor');\n      } else if (!domClass.contains(this.pageHeader, 'dart-bgcolor') && add) {\n        domClass.add(this.pageHeader, 'dart-bgcolor');\n      }\n      if (domClass.contains(this.pageHeader, 'box-bgcolor') && !add) {\n        domClass.remove(this.pageHeader, 'box-bgcolor');\n      } else if (!domClass.contains(this.pageHeader, 'box-bgcolor') && add) {\n        domClass.add(this.pageHeader, 'box-bgcolor');\n      }\n    },\n\n    startup: function startup() {\n      this.inherited(arguments);\n      if (!this.hidePanel && !this.showAllFeatures) {\n        this.mapExtentChangedHandler = this.map.on(\"extent-change\", lang.hitch(this, this._mapExtentChange));\n        this._mapExtentChange();\n      } else if (this.showAllFeatures) {\n        this._mapExtentChange();\n      }\n      /* Habre la primer acordion de departamento */\n      document.getElementById(\"Departamentos\").click();\n      document.getElementById(\"Provincias\").disabled = true;\n      document.getElementById(\"Distritos\").disabled = true;\n      // Ocultar animacion de carga\n      this._loadNoneGeneralLimite();\n      /* Pestaa que se activa\n        - 0. Activa la pestaa de ESPECIFICO\n        - 1. Activa la pestaa de GENERAL */\n      this._activeTabSearch(0);\n    },\n\n    onOpen: function onOpen() {\n      this.widgetChange = false;\n\n      if (!this.hidePanel) {\n        this._updatePanelHeader();\n      } else {\n        if (this.appConfig.theme.name !== 'BoxTheme') {\n          this._forceClose();\n        }\n      }\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        this._updateStyleColor(this.appConfig.theme.styles[0]);\n      }\n\n      var visibleSubLayers = [];\n      //update the renderer for the layer in the layer list if a new one has been defined\n      for (var key in this.layerList) {\n        var layerListLayer = this.layerList[key];\n        var li = layerListLayer.li;\n        var lo = layerListLayer.layerObject;\n        if (li && li.orgRenderer) {\n          if (lo.setRenderer) {\n            lo.setRenderer(li.newRenderer);\n          } else if (lo.setLayerDrawingOptions) {\n            var optionsArray = [];\n            var drawingOptions = new LayerDrawingOptions();\n            drawingOptions.renderer = li.newRenderer;\n            optionsArray[li.subLayerId] = drawingOptions;\n            lo.setLayerDrawingOptions(optionsArray);\n          } else {\n            console.log(\"Error setting the new renderer...will use the default rendering of the layer\");\n          }\n          if (typeof lo.refresh === 'function') {\n            lo.refresh();\n          }\n        }\n\n        var _Pl;\n        if (lo && lo.layerInfos) {\n          _Pl = lo;\n        } else if (li && typeof li.parentLayerID !== 'undefined') {\n          _Pl = this.map.getLayer(li.parentLayerID);\n        }\n\n        var l;\n        if (_Pl && _Pl.visibleLayers) {\n          var _foundIt = false;\n          sub_layers_id_loop: for (var ii = 0; ii < visibleSubLayers.length; ii++) {\n            var subVizLyrId = visibleSubLayers[ii].id;\n            if (subVizLyrId === _Pl.id) {\n              _foundIt = true;\n              break sub_layers_id_loop;\n            }\n          }\n          if (visibleSubLayers.length === 0 || !_foundIt) {\n            visibleSubLayers.push({\n              id: _Pl.id,\n              layers: _Pl.visibleLayers\n            });\n          }\n          var x = 0;\n          subLayerLoop: for (x; x < visibleSubLayers.length; x++) {\n            var o = visibleSubLayers[x];\n            if (o.id === _Pl.id) {\n              break subLayerLoop;\n            }\n          }\n          var visLayers = visibleSubLayers[x].layers;\n          if (_Pl.layerInfos) {\n            //Handle MapService layers\n            if (_Pl.layerInfos.length > 0) {\n              if (li && typeof li.subLayerId !== 'undefined') {\n                var inVisLayers = visLayers.indexOf(li.subLayerId) > -1;\n                var plVis = layerListLayer.parentLayerVisible;\n                var loPlVis = layerListLayer.layerObject.parentLayerVisible;\n                if (layerListLayer.type === \"ClusterLayer\" && (inVisLayers || plVis || loPlVis)) {\n                  layerListLayer.parentLayerVisible = true;\n                  layerListLayer.layerObject.parentLayerVisible = true;\n                  layerListLayer.visible = true;\n                  if (inVisLayers) {\n                    visLayers.splice(visLayers.indexOf(li.subLayerId), 1);\n                  }\n                } else if (inVisLayers || plVis) {\n                  layerListLayer.parentLayerVisible = true;\n                  layerListLayer.visible = true;\n                  if (visLayers.indexOf(li.subLayerId) === -1) {\n                    visLayers.push(li.subLayerId);\n                  }\n                } else {\n                  layerListLayer.parentLayerVisible = false;\n                  layerListLayer.visible = false;\n                  if (inVisLayers) {\n                    visLayers.splice(visLayers.indexOf(li.subLayerId), 1);\n                  }\n                  if (layerListLayer.type === \"ClusterLayer\") {\n                    layerListLayer.layerObject.parentLayerVisible = false;\n                    if (this.map.graphicsLayerIds.indexOf(layerListLayer.id) > -1) {\n                      l = this.map.getLayer(layerListLayer.id);\n                      l.setVisibility(false);\n                    }\n                  }\n                }\n              }\n            }\n            visibleSubLayers[x].layers = visLayers;\n          }\n          this.updatePanelVisibility(layerListLayer, key, layerListLayer);\n        } else if (lo) {\n          //Handle non MapService layers\n          if (layerListLayer.type === \"ClusterLayer\") {\n            if (lo._parentLayer) {\n              if (this.map.graphicsLayerIds.indexOf(layerListLayer.id) > -1) {\n                l = this.map.getLayer(layerListLayer.id);\n                if (typeof layerListLayer.layerObject.parentLayerVisible === 'undefined') {\n                  layerListLayer.parentLayerVisible = lo._parentLayer.visible;\n                  layerListLayer.layerObject.parentLayerVisible = lo._parentLayer.visible;\n                }\n                l.setVisibility(layerListLayer.layerObject.parentLayerVisible);\n              }\n              if (lo._parentLayer.setVisibility) {\n                lo._parentLayer.setVisibility(false);\n              }\n            }\n          }\n          this.updatePanelVisibility(lo, key, layerListLayer);\n        }\n\n        if (this.showAllFeatures && this.config.expandList && layerListLayer.legendOpen && !layerListLayer.isLoaded) {\n          var visScaleRange = layerListLayer.visScaleRange;\n          if (typeof visScaleRange !== 'undefined') {\n            visScaleRange = this._inVisibleRange(layerListLayer, key);\n          }\n          if (layerListLayer.visible && visScaleRange) {\n            layerListLayer.updateList = true;\n          }\n        }\n      }\n\n      for (var i = 0; i < visibleSubLayers.length; i++) {\n        var parentLayer = this.map.getLayer(visibleSubLayers[i].id);\n        if (parentLayer) {\n          parentLayer.setVisibleLayers(visibleSubLayers[i].layers);\n        }\n      }\n\n      if (!this.hidePanel && !this.showAllFeatures) {\n        if (typeof this.mapExtentChangedHandler === 'undefined') {\n          this.mapExtentChangedHandler = this.map.on(\"extent-change\", lang.hitch(this, this._mapExtentChange));\n          this._mapExtentChange();\n        }\n      }\n\n      //if refresh is enabled set refereshInterval on any widget source layers with refresh set to true\n      //and call setInterval to refresh the static graphics\n      if (this.config.refreshEnabled) {\n        this.enableRefresh();\n      }\n\n      if (this.map.infoWindow) {\n        this.map.infoWindow.highlight = true;\n      }\n    },\n\n    updatePanelVisibility: function updatePanelVisibility(lo, key, layerListLayer) {\n      if (!this.hidePanel) {\n        if (typeof lo.visible !== 'undefined') {\n          //var visScaleRange = this._inVisibleRange(layerListLayer, key);\n          var visScaleRange = layerListLayer.visScaleRange;\n          var c = dom.byId(\"recLabel_\" + key);\n          if (!lo.visible) {\n            if (domClass.contains(\"recIcon_\" + key, \"active\")) {\n              domClass.remove(\"recIcon_\" + key, \"active\");\n            }\n            if (this.config.countEnabled) {\n              if (domClass.contains(\"recNum_\" + key, \"recNum\")) {\n                domClass.remove(\"recNum_\" + key, \"recNum\");\n                domClass.add(\"recNum_\" + key, \"recNumInActive\");\n              }\n            }\n            if (c && c.firstChild) {\n              domClass.add(c.firstChild, \"inActive\");\n            }\n            if (!layerListLayer.listDisabled) {\n              if (!domClass.contains(\"exp_\" + key, \"expandInActive\")) {\n                domClass.add(\"exp_\" + key, \"expandInActive\");\n              }\n              layerListLayer.toggleLegend.remove();\n            }\n            if (domClass.contains(\"rec_\" + key, \"rec\")) {\n              domClass.add(\"rec_\" + key, \"recDefault\");\n            }\n          } else {\n            if (!domClass.contains(\"recIcon_\" + key, \"active\")) {\n              domClass.add(\"recIcon_\" + key, \"active\");\n            }\n            if (this.config.countEnabled) {\n              if (domClass.contains(\"recNum_\" + key, \"recNumInActive\")) {\n                domClass.remove(\"recNum_\" + key, \"recNumInActive\");\n                domClass.add(\"recNum_\" + key, \"recNum\");\n              }\n            }\n            if (c && c.firstChild) {\n              domClass.remove(c.firstChild, \"inActive\");\n            }\n            if (!layerListLayer.listDisabled) {\n              if (typeof visScaleRange === 'undefined' || visScaleRange) {\n                if (domClass.contains(\"exp_\" + key, \"expandInActive\")) {\n                  domClass.remove(\"exp_\" + key, \"expandInActive\");\n                }\n              }\n            }\n            if (domClass.contains(\"rec_\" + key, \"recDefault\")) {\n              domClass.remove(\"rec_\" + key, \"recDefault\");\n            }\n          }\n        }\n      }\n    },\n\n    enableRefresh: function enableRefresh() {\n      //set refreshItereval on all widget source layers that support it\n      var layerListLayer = null;\n      var checkedTime = false;\n      for (var key in this.layerList) {\n        var id;\n        layerListLayer = this.layerList[key];\n        if (layerListLayer.li) {\n          id = layerListLayer.li.itemId;\n        }\n        if (layerListLayer.type !== \"ClusterLayer\") {\n          layerListLayer = layerListLayer.layerObject;\n        } else {\n          for (var i = 0; i < this.layerInfos.length; i++) {\n            var l = this.layerInfos[i];\n            if (l.layerObject) {\n              layerListLayer = l.layerObject;\n              break;\n            }\n          }\n        }\n        if (!checkedTime && id) {\n          this.getItem(id);\n          checkedTime = true;\n        }\n        if (layerListLayer) {\n          layerListLayer.refreshInterval = this.config.refreshInterval;\n        }\n      }\n\n      var tempVal = this.config.refreshInterval * 60000;\n      if (this.refreshInterval === 0 && this.refreshIntervalValue === 0) {\n        //set the refresh interval based on the configs interval value\n        this.refreshIntervalValue = tempVal;\n        this.refreshInterval = setInterval(lang.hitch(this, this.refreshLayers), this.refreshIntervalValue);\n      } else if (this.refreshIntervalValue !== 0 && this.refreshIntervalValue !== tempVal) {\n        //clear and update the refresh interval if the configs refresh interval has changed\n        this.refreshIntervalValue = tempVal;\n        clearInterval(this.refreshInterval);\n        this.refreshInterval = 0;\n        this.refreshInterval = setInterval(lang.hitch(this, this.refreshLayers), this.refreshIntervalValue);\n      }\n    },\n\n    getItem: function getItem(id) {\n      var portalUrl = window.portalUrl.substr(-1) !== '/' ? window.portalUrl += '/' : window.portalUrl;\n      var url = portalUrl + \"sharing/rest/content/items/\" + id;\n      esriRequest({\n        url: url,\n        content: {\n          f: \"json\",\n          requestTime: Date.now()\n        }\n      }).then(lang.hitch(this, function (response) {\n        if (response) {\n          var itemModified = response.modified;\n          var update = true;\n          if (this.lastModifiedTime) {\n            update = this.lastModifiedTime < itemModified;\n          }\n          if (this.currentQueryList.indexOf(id) > -1) {\n            this.currentQueryList.splice(this.currentQueryList.indexOf(id), 1);\n          }\n          if (update) {\n            this.lastModifiedTime = itemModified;\n            this._updatePanelTime(itemModified);\n            esriRequest({\n              url: url + '/data',\n              content: {\n                f: \"json\",\n                requestTime: Date.now()\n              }\n            }).then(lang.hitch(this, this._updateItem, id));\n          }\n        }\n      }));\n    },\n\n    _updatePanelTime: function _updatePanelTime(modifiedTime) {\n      if (!this.hidePanel) {\n        this.lastUpdated.innerHTML = \"<div></div>\";\n        var _d = new Date(modifiedTime);\n        var _f = { dateFormat: 'shortDateShortTime' };\n        this.lastUpdated.innerHTML = utils.fieldFormatter.getFormattedDate(_d, _f);\n      }\n    },\n\n    refreshLayers: function refreshLayers() {\n      for (var key in this.layerList) {\n        var lyr = this.layerList[key];\n        var id;\n        if (lyr.li && lyr.li.itemId) {\n          id = lyr.li.itemId;\n        } else if (lyr.layerObject.itemId) {\n          id = lyr.layerObject.itemId;\n        }\n\n        if (id) {\n          if (this.currentQueryList.indexOf(id) === -1) {\n            this.currentQueryList.push(id);\n            this.getItem(id);\n          }\n        }\n      }\n    },\n\n    _updateItem: function _updateItem(id, response) {\n      var featureCollection = response;\n      for (var i = 0; i < featureCollection.layers.length; i++) {\n        this._updateLayerItem(featureCollection.layers[i], this.lastModifiedTime);\n      }\n      this.currentQueryList.splice(this.currentQueryList.indexOf(id), 1);\n    },\n\n    //TDOO ensure this functions as expected when filter by map extent id disabled\n    _updateLayerItem: function _updateLayerItem(responseLayer) {\n      var layerListLayer;\n      var parentLayer;\n      var list, fields;\n      for (var k in this.layerList) {\n        var lyr = this.layerList[k];\n        if (lyr.pl && lyr.pl.layerDefinition) {\n          if (lyr.pl.layerDefinition.name === responseLayer.layerDefinition.name) {\n            layerListLayer = lyr;\n            parentLayer = lyr.pl;\n            break;\n          }\n        } else if (lyr.layerObject._parentLayer) {\n          if (lyr.layerObject._parentLayer.name === responseLayer.layerDefinition.name) {\n            list = typeof lyr.listDisabled !== 'undefined' ? lyr.listDisabled : false;\n            fields = lyr.li.symbolData.featureDisplayOptions.fields && lyr.li.symbolData.featureDisplayOptions.fields.length > 0;\n            if (!list && fields) {\n              lyr.isLoaded = false;\n            }\n            lyr.layerObject.refreshFeatures(responseLayer);\n            if (lyr.layerObject) {\n              this._loadList(lyr, true);\n            }\n          }\n        } else if (lyr.pl && lyr.pl.name) {\n          if (lyr.pl.name === responseLayer.layerDefinition.name) {\n            layerListLayer = lyr;\n            parentLayer = lyr.pl;\n            break;\n          }\n        }\n      }\n\n      if (responseLayer && layerListLayer && parentLayer && (parentLayer.featureSet || parentLayer.graphics)) {\n        var responseFeatureSetFeatures = responseLayer.featureSet.features;\n\n        var mapFeatureSetFeatures;\n        if (parentLayer.featureSet) {\n          mapFeatureSetFeatures = parentLayer.featureSet.features;\n        } else {\n          mapFeatureSetFeatures = [];\n          var responseSR = this._getSpatialReference(responseFeatureSetFeatures);\n          var mapSR = this._getSpatialReference(parentLayer.graphics);\n          array.forEach(parentLayer.graphics, function (gra) {\n            var g = gra.geometry;\n            var geom = g.rings ? { rings: g.rings } : g.paths ? { paths: g.paths } : g.points ? { points: g.points } : g.x && g.y ? { x: g.x, y: g.y } : {};\n            if (geom !== {}) {\n              mapFeatureSetFeatures.push({\n                attributes: gra.attributes,\n                geometry: lang.mixin({\n                  spatialReference: responseSR && mapSR && responseSR.wkid === mapSR.wkid ? responseSR : mapSR\n                }, geom)\n              });\n            }\n          });\n        }\n\n        if (responseLayer.featureSet.transform) {\n          var fs = new FeatureSet(responseLayer.featureSet);\n          responseFeatureSetFeatures = fs.features;\n        }\n\n        var shouldUpdate = true;\n        //TODO Figure out a better test for larger responses\n        if (responseFeatureSetFeatures.length < 10000) {\n          shouldUpdate = JSON.stringify(mapFeatureSetFeatures) !== JSON.stringify(responseFeatureSetFeatures);\n        }\n\n        if (shouldUpdate) {\n          list = typeof layerListLayer.listDisabled !== 'undefined' ? layerListLayer.listDisabled : false;\n          fields = layerListLayer.li.symbolData.featureDisplayOptions.fields && layerListLayer.li.symbolData.featureDisplayOptions.fields.length > 0;\n          if (!list && fields) {\n            layerListLayer.isLoaded = false;\n            layerListLayer.requiresReload = true;\n          }\n          if (list) {\n            layerListLayer.li.layerListExtentChanged = true;\n          }\n          layerListLayer.layerObject.clear();\n          var sr = layerListLayer.layerObject.spatialReference;\n          for (var j = 0; j < responseFeatureSetFeatures.length; j++) {\n            var item = responseFeatureSetFeatures[j];\n            if (item.geometry) {\n              //check li for renderer also\n              var go = this.getGraphicOptions(item, sr);\n              var gra = new Graphic(go);\n              //removed for https://devtopia.esri.com/WebGIS/arcgis-webappbuilder/issues/11551\n              //gra.setSymbol(go.symbol);\n              gra.setAttributes(item.attributes);\n              if (this._infoTemplate) {\n                gra.setInfoTemplate(this._infoTemplate);\n              }\n              layerListLayer.layerObject.add(gra);\n            } else {\n              console.log(\"Null geometry skipped\");\n            }\n          }\n          layerListLayer.layerObject.refresh();\n          if (parentLayer.featureSet) {\n            parentLayer.featureSet.features = responseFeatureSetFeatures;\n          }\n          this.countFeatures(layerListLayer);\n          if (layerListLayer.layerObject && layerListLayer.layerObject.visible) {\n            this._loadList(layerListLayer, true);\n          }\n        }\n      }\n    },\n\n    _getSpatialReference: function _getSpatialReference(features) {\n      var sr;\n      if (features && features.hasOwnProperty('length') && features.length > 0) {\n        var firstFeature = features[0];\n        if (firstFeature.geometry && firstFeature.geometry.spatialReference) {\n          sr = firstFeature.geometry.spatialReference;\n        }\n      }\n      return sr;\n    },\n\n    getGraphicOptions: function getGraphicOptions(item, sr) {\n      var graphicOptions;\n      if (typeof item.geometry.rings !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            rings: item.geometry.rings,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else if (typeof item.geometry.paths !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            paths: item.geometry.paths,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else if (typeof item.geometry.points !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            points: item.geometry.points,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else {\n        graphicOptions = {\n          geometry: new Point(item.geometry.x, item.geometry.y, item.geometry.spatialReference)\n        };\n      }\n      return graphicOptions;\n    },\n\n    _initWidget: function _initWidget() {\n      this.hidePanel = typeof this.config.hidePanel !== 'undefined' ? this.config.hidePanel : false;\n      this.showAllFeatures = typeof this.config.showAllFeatures !== 'undefined' ? this.config.showAllFeatures : false;\n      if (this.map.itemId) {\n        LayerInfos.getInstance(this.map, this.map.itemInfo).then(lang.hitch(this, function (operLayerInfos) {\n          this.wmLayerInfos = operLayerInfos.getLayerInfoArrayOfWebmap();\n          this.layerInfos = operLayerInfos.getLayerInfoArray();\n          this.operLayerInfos = operLayerInfos;\n          this._updateLayerIDs();\n          if (this.config.upgradeFields) {\n            this._upgradeFields();\n          }\n          this._createPanelUI(this.configLayerInfos, operLayerInfos);\n          this._addFilterChanged(operLayerInfos);\n          this._addVisibleChanged(operLayerInfos);\n          this._addZoomChanged(operLayerInfos);\n        }));\n      }\n    },\n\n    _updateLayerIDs: function _updateLayerIDs() {\n      var removeIDs = [];\n\n      //added to make sure the url we have uses the proxy url\n      //issue: https://devtopia.esri.com/WebGIS/arcgis-webappbuilder/issues/11551\n      var getUrl = function getUrl(configLayer, jimuLayerInfo) {\n        return jimuLayerInfo.layerObject && jimuLayerInfo.layerObject.url ? jimuLayerInfo.layerObject.url : configLayer.url;\n      };\n\n      config_layer_loop: for (var i = 0; i < this.configLayerInfos.length; i++) {\n        var configLayer = this.configLayerInfos[i];\n        var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(configLayer.id);\n\n        //If we cannot find the jimu layer info based on the stored ID we need to determine it\n        if (!jimuLayerInfo) {\n          var updated = false;\n          wm_layer_loop: for (var ii = 0; ii < this.wmLayerInfos.length; ii++) {\n            var _opLayer = this.wmLayerInfos[ii];\n            var originOpLayer = _opLayer ? _opLayer.originOperLayer : undefined;\n\n            var urlId = this._compareURL(originOpLayer, configLayer);\n            var itemId = this._compareItemID(originOpLayer, configLayer);\n            var subId = this._compareSubId(_opLayer, configLayer);\n\n            var id = urlId ? urlId : itemId ? itemId : subId ? subId : undefined;\n            jimuLayerInfo = id ? this.operLayerInfos.getLayerInfoById(id) : jimuLayerInfo;\n\n            if (jimuLayerInfo) {\n              this.configLayerInfos[i].id = jimuLayerInfo.id;\n              this.configLayerInfos[i].layer = jimuLayerInfo.id;\n              this.configLayerInfos[i].url = getUrl(this.configLayerInfos[i], jimuLayerInfo);\n              updated = true;\n              break wm_layer_loop;\n            }\n          }\n\n          if (!updated && !jimuLayerInfo) {\n            removeIDs.push(i);\n          }\n        } else {\n          configLayer.url = getUrl(configLayer, jimuLayerInfo);\n        }\n      }\n\n      //This needs to occur largest to smallest\n      if (removeIDs.length > 0) {\n        //removeIDs.sort((a, b) => (b - a));\n        removeIDs.sort(function (a, b) {\n          return b - a;\n        });\n        array.forEach(removeIDs, lang.hitch(this, function (id) {\n          this.configLayerInfos.splice(id, 1);\n        }));\n      }\n    },\n\n    _compareSubId: function _compareSubId(opLayer, configLayer) {\n      if (opLayer && opLayer.subId && opLayer.subId.indexOf(configLayer.id) > -1) {\n        if (opLayer.layerObject) {\n          var geomMatch = this._compareGeom(opLayer.layerObject, configLayer);\n          var fieldMatch = this._compareFields(opLayer.layerObject, configLayer);\n          if (geomMatch && fieldMatch) {\n            return opLayer.subId;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    _compareItemID: function _compareItemID(originOpLayer, configLayer) {\n      if (originOpLayer && originOpLayer.itemId && originOpLayer.itemId === configLayer.itemId) {\n        if (originOpLayer.featureCollection && originOpLayer.featureCollection.layers && originOpLayer.featureCollection.layers.hasOwnProperty('length')) {\n          var fcLayers = originOpLayer.featureCollection.layers;\n          for (var i = 0; i < fcLayers.length; i++) {\n            var fcLayer = fcLayers[i];\n            if (this._compareGeom(fcLayer, configLayer)) {\n              if (this._compareFields(fcLayer, configLayer)) {\n                return fcLayer.id;\n              }\n            }\n          }\n          return undefined;\n        } else {\n          console.log('error in checking item by itemID');\n        }\n      }\n    },\n\n    _compareURL: function _compareURL(originOpLayer, configLayer) {\n      return originOpLayer && originOpLayer.url && configLayer.url && originOpLayer.url === configLayer.url ? originOpLayer.id : undefined;\n    },\n\n    _compareGeom: function _compareGeom(layerObject, configLayer) {\n      return layerObject && layerObject.geometryType && configLayer.geometryType ? layerObject.geometryType === configLayer.geometryType : undefined;\n    },\n\n    _compareFields: function _compareFields(layerObject, configLayer) {\n      var fieldMatch;\n      if (layerObject && layerObject.fields && configLayer.fields && layerObject.fields.length === configLayer.fields.length) {\n        //test if Names match\n        var matchingFields = layerObject.fields.filter(function (f) {\n          for (var fn = 0; fn < configLayer.fields.length; fn++) {\n            var configField = configLayer.fields[fn];\n            if (f.name === configField.name) {\n              return f;\n            }\n          }\n        });\n        fieldMatch = matchingFields.length === layerObject.fields.length;\n      }\n      return fieldMatch;\n    },\n\n    //added for backwards compatability\n    //could not handle directly in VersionManager as some stored layerInfos\n    // do not have a valid infoTemplate saved\n    _upgradeFields: function _upgradeFields() {\n      if (this.configLayerInfos) {\n        for (var i = 0; i < this.configLayerInfos.length; i++) {\n          var li = this.configLayerInfos[i];\n          if (li && li.symbolData && li.symbolData.featureDisplayOptions) {\n            var lyrInfo = this.operLayerInfos.getLayerInfoById(li.id);\n            if (lyrInfo) {\n              var fields = li.symbolData.featureDisplayOptions.fields;\n              //At previous releases we would use the first field from the infoTemplate or\n              //the first non-OID field from the layer if no fields were selected by the user\n              if (typeof fields === 'undefined' || fields.hasOwnProperty('length') && fields.length === 0) {\n                //check layer fields\n                var layerObject = lyrInfo && lyrInfo.layerObject ? lyrInfo.layerObject : undefined;\n                var oidFieldName = layerObject && layerObject.objectIdField ? layerObject.objectIdField : undefined;\n                var firstLayerFieldName = \"\";\n                var firstLayerFieldAlias = \"\";\n                var layerFields = li.fields ? li.fields : layerObject ? layerObject.fields : undefined;\n                if (layerFields && layerFields.length > 0) {\n                  layer_field_loop: for (var _i = 0; _i < layerFields.length; _i++) {\n                    var f = layerFields[_i];\n                    if (firstLayerFieldName === \"\" && f.type !== \"esriFieldTypeOID\" && f.type !== \"esriFieldTypeGeometry\" && f.name !== oidFieldName) {\n                      firstLayerFieldName = f.name;\n                      firstLayerFieldAlias = f.alias || f.name;\n                    }\n                    if (!oidFieldName) {\n                      oidFieldName = f.type === \"esriFieldTypeOID\" ? f.name : oidFieldName;\n                    }\n                    if (oidFieldName && firstLayerFieldName !== \"\") {\n                      break layer_field_loop;\n                    }\n                  }\n                }\n\n                //check popup fields\n                var keyFieldName = \"\";\n                var keyFieldAlias = \"\";\n                var infoTemplate = li.infoTemplate && li.infoTemplate.info && li.infoTemplate.info.fieldInfos ? li.infoTemplate : lyrInfo ? lyrInfo.getInfoTemplate() : undefined;\n                if (!infoTemplate) {\n                  var subLayers = lyrInfo.getSubLayers();\n                  sub_layers_loop: for (var sli = 0; sli < subLayers.length; sli++) {\n                    var sl = subLayers[sli];\n                    if (sl.title && sl.layerObject && sl.layerObject.name && sl.title === sl.layerObject.name) {\n                      infoTemplate = sl.getInfoTemplate ? sl.getInfoTemplate() : infoTemplate;\n                      break sub_layers_loop;\n                    }\n                  }\n                }\n                var popupFields = infoTemplate ? infoTemplate.info.fieldInfos : [];\n                popup_field_loop: for (var j = 0; j < popupFields.length; j++) {\n                  var popupField = popupFields[j];\n                  if (popupField && popupField.visible) {\n                    if (!oidFieldName || oidFieldName !== popupField.fieldName) {\n                      keyFieldName = popupField.fieldName;\n                      keyFieldAlias = popupField.label || popupField.fieldName;\n                      break popup_field_loop;\n                    }\n                  }\n                }\n\n                //update the config\n                this.configLayerInfos[i].symbolData.featureDisplayOptions.fields = [{\n                  name: keyFieldName ? keyFieldName : firstLayerFieldName,\n                  label: keyFieldName ? keyFieldAlias : firstLayerFieldAlias\n                }];\n              }\n            }\n          }\n        }\n      }\n    },\n\n    _addFilterChanged: function _addFilterChanged(layerInfos) {\n      if (parseFloat(this.appConfig.wabVersion) >= 2.1) {\n        this.own(layerInfos.on('layerInfosFilterChanged', lang.hitch(this, function (changedLayerInfoArray) {\n          array.forEach(changedLayerInfoArray, lang.hitch(this, function (layerInfo) {\n            var id = layerInfo.id;\n            var clId = layerInfo.id + this.UNIQUE_APPEND_VAL_CL;\n            if (this.layerList.hasOwnProperty(id)) {\n              this.layerList[id].filter = layerInfo.getFilter();\n            } else if (this.layerList.hasOwnProperty(clId)) {\n              this.layerList[clId].layerObject.filter = layerInfo.getFilter();\n              this.layerList[clId].layerObject._initFeatures();\n            }\n          }));\n        })));\n      }\n    },\n\n    _updateVisibility: function _updateVisibility(layerInfo) {\n      if (layerInfo) {\n        var id = layerInfo.id;\n        var vis = layerInfo.isShowInMap();\n        if (this.layerList.hasOwnProperty(id)) {\n          var lyr = this.layerList[id];\n          if (id === lyr.li.id && lyr.visible !== vis) {\n            this._toggleLayerUI(lyr.li, vis);\n          } else if (id === lyr.id && lyr.visible !== vis) {\n            this._toggleLayerUI(layerInfo, vis);\n          }\n        }\n      }\n    },\n\n    _addVisibleChanged: function _addVisibleChanged(layerInfos) {\n      this.own(layerInfos.on('layerInfosIsVisibleChanged', lang.hitch(this, function (changedLayerInfos) {\n        array.forEach(changedLayerInfos, function (layerInfo) {\n          this._updateVisibility(layerInfo);\n        }, this);\n      })));\n    },\n\n    _addZoomChanged: function _addZoomChanged(layerInfos) {\n      this.own(on(this.map, 'zoom-end', lang.hitch(this, function () {\n        layerInfos.traversal(lang.hitch(this, function (layerInfo) {\n          this._updateVisibility(layerInfo);\n        }));\n      })));\n    },\n\n    _updatePanelHeader: function _updatePanelHeader() {\n      var panelTitle;\n      var w = this.map.width;\n      if (this.config.displayPanelIcon && w > 750) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n\n          if (this.config.refreshEnabled) {\n            if (this.config.mainPanelText !== \"\") {\n              html.addClass(this.pageHeader, \"pageHeaderRefresh\");\n            } else {\n              html.addClass(this.pageHeader, \"pageHeaderRefreshNoText\");\n            }\n          } else {\n            html.addClass(this.pageHeader, \"pageHeader\");\n          }\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          if (this.config.refreshEnabled) {\n            if (this.config.mainPanelText !== \"\") {\n              html.addClass(this.pageBody, \"pageBodyRefresh\");\n            } else {\n              html.addClass(this.pageBody, \"pageBodyRefreshNoText\");\n            }\n          } else {\n            html.addClass(this.pageBody, \"pageBody\");\n          }\n        }\n\n        if (this.pageTitle) {\n          html.addClass(this.pageTitle, \"pageTitleWidth\");\n          if (this.config.refreshEnabled) {\n            html.removeClass(this.pageTitle, \"pageTitle\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh-tab\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh\");\n            html.addClass(this.pageTitle, this.useDarkText ? \"pageTitleRefresh-tab\" : \"pageTitleRefresh\");\n          } else {\n            html.removeClass(this.pageTitle, \"pageTitleRefresh\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh-tab\");\n            html.addClass(this.pageTitle, \"pageTitle\");\n          }\n        }\n\n        panelTitle = this.config.mainPanelText;\n        if (typeof panelTitle === 'undefined') {\n          panelTitle = \"\";\n        }\n        this.pageTitle.innerHTML = panelTitle;\n        this.panelMainIcon.innerHTML = this.config.mainPanelIcon;\n      } else if (!this.config.displayPanelIcon && !this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n          html.addClass(this.pageHeader, \"pageHeaderNoIcon\");\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBody\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          html.addClass(this.pageBody, \"pageBodyNoIcon\");\n        }\n        this.pageTitle.innerHTML = \"<div></div>\";\n        this.panelMainIcon.innerHTML = \"<div></div>\";\n      } else if (!this.config.displayPanelIcon && this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.addClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBody\");\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.addClass(this.pageBody, \"pageBodyNoIconRefresh\");\n        }\n\n        if (this.pageTitle) {\n          html.removeClass(this.pageTitle, \"pageTitleWidth\");\n        }\n        this.pageTitle.innerHTML = \"<div></div>\";\n        this.panelMainIcon.innerHTML = \"<div></div>\";\n      } else if (this.config.displayPanelIcon && w <= 750 && this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          if (this.config.mainPanelText !== \"\") {\n            html.addClass(this.pageHeader, \"pageHeaderRefresh\");\n          } else {\n            html.addClass(this.pageHeader, \"pageHeaderRefreshNoText\");\n          }\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          html.removeClass(this.pageBody, \"pageBody\");\n          if (this.config.mainPanelText !== \"\") {\n            html.addClass(this.pageBody, \"pageBodyRefresh\");\n          } else {\n            html.addClass(this.pageBody, \"pageBodyRefreshNoText\");\n          }\n        }\n\n        if (this.pageTitle) {\n          html.addClass(this.pageTitle, \"pageTitleWidth\");\n        }\n\n        panelTitle = this.config.mainPanelText;\n        if (typeof panelTitle === 'undefined') {\n          panelTitle = \"\";\n        }\n        this.pageTitle.innerHTML = panelTitle;\n      }\n    },\n\n    _createPanelUI: function _createPanelUI(configLayerInfos, jimuLayerInfos) {\n      this.numClusterLayers = 0;\n\n      if (!this.hidePanel) {\n        this._updatePanelHeader();\n        this._updateUI(null);\n        this._clearChildNodes(this.pageMain);\n        this.updateEnd = [];\n      }\n\n      for (var i = 0; i < configLayerInfos.length; i++) {\n        var lyrInfo = configLayerInfos[i];\n        if (lyrInfo.symbolData.clusterType === 'ThemeCluster') {\n          this.updateThemeClusterSymbol(lyrInfo, i);\n        }\n\n        var jimuLayerInfo = jimuLayerInfos.getLayerInfoById(lyrInfo.id);\n        if (jimuLayerInfo) {\n          jimuLayerInfo.getLayerType().then(lang.hitch(this, function (layerType) {\n            jimuLayerInfo.getLayerObject().then(lang.hitch(this, function (layerObject) {\n              this.updateLayerList(layerObject, lyrInfo, layerType, jimuLayerInfo);\n            }));\n          }));\n        }\n      }\n\n      if (!this.hidePanel) {\n        for (var k in this.layerList) {\n          var lyr = this.layerList[k];\n          if (lyr.type !== \"ClusterLayer\") {\n            if (lyr && lyr.layerObject) {\n              if (lyr.layerObject.hasOwnProperty('refreshInterval') && lyr.layerObject.refreshInterval > 0) {\n                this.updateEnd.push(this.own(on(lyr.layerObject, \"update-end\", lang.hitch(this, this._updateEnd))));\n              }\n            }\n          }\n        }\n      }\n      this.addMapLayers();\n    },\n\n    _updateEnd: function _updateEnd(results) {\n      var lid = this.layerList.hasOwnProperty(results.target.id) ? results.target.id : this.layerList.hasOwnProperty(results.target.id + \"_CL\") ? results.target.id + \"_CL\" : \"\";\n\n      //For map service with sub layers...the results ID is for the parent layer\n      if (lid === \"\") {\n        for (var i in this.layerList) {\n          var l = this.layerList[i];\n          if (l && l.layerObject && l.layerObject.id === results.target.id) {\n            lid = l.li.id;\n            break;\n          }\n        }\n      }\n      if (this.layerList.hasOwnProperty(lid)) {\n        var lyr = this.layerList[lid];\n        lyr.isLoaded = false;\n        lyr.updating = false;\n        lyr.requiresReload = true;\n        if (lyr) {\n          if (lyr.legendOpen) {\n            this._loadList(lyr, this.config.countEnabled);\n          } else if (this.config.countEnabled) {\n            this.countFeatures(lyr);\n          }\n        }\n      }\n    },\n\n    updateThemeClusterSymbol: function updateThemeClusterSymbol(lyrInfo, i) {\n      var sd = lyrInfo.symbolData;\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        if (typeof this._styleColor === 'undefined') {\n          this._updateStyleColor(this.appConfig.theme.styles[0]);\n        }\n      }\n      if (this._styleColor) {\n        var _rgb = dojoColor.fromHex(this._styleColor);\n        var x = i + 1;\n        var xx = x > 0 ? x * 30 : 30;\n        var evenOdd = x % 2 === 0;\n        var r = _rgb.r;\n        var g = _rgb.g;\n        var b = _rgb.b;\n\n        var rr = r - xx;\n        if (evenOdd) {\n          if (rr > 255) {\n            rr = rr - 255;\n          } else if (rr < 0) {\n            rr = rr + 255;\n          }\n        }\n\n        var bb = b - xx;\n        if (x % 3 === 0) {\n          if (evenOdd) {\n            if (bb > 255) {\n              bb = bb - 255;\n            } else if (bb < 0) {\n              bb = bb + 255;\n            }\n          }\n        }\n\n        var gg = g - xx;\n        if (x % 5 === 0) {\n          if (evenOdd) {\n            if (gg > 255) {\n              gg = gg - 255;\n            } else if (gg < 0) {\n              gg = gg + 255;\n            }\n          }\n        }\n        sd.clusterType = 'CustomCluster';\n        sd.clusterSymbol = {\n          color: [rr, gg, bb, 1],\n          outline: {\n            color: [0, 0, 0, 0],\n            width: 0,\n            type: \"esriSLS\",\n            style: \"esriSLSNull\"\n          },\n          type: \"esriSFS\",\n          style: \"esriSFSSolid\"\n        };\n      }\n    },\n\n    removeOldClusterLayers: function removeOldClusterLayers(lInfos) {\n      //check if the widget was previously configured\n      // with a layer that it no longer consumes...if so remove it\n      var deleteLayers = [];\n      for (var id in this.layerList) {\n        var l = this.layerList[id];\n        if (l.type === \"ClusterLayer\") {\n          layer_info_loop: for (var i = 0; i < lInfos.length; i++) {\n            var lo = lInfos[i];\n            var potentialNewClusterID = lo.id + this.UNIQUE_APPEND_VAL_CL;\n            if (potentialNewClusterID === id) {\n              if (lo.symbolData && !lo.symbolData.clusteringEnabled) {\n                deleteLayers.push(id);\n              }\n              break layer_info_loop;\n            }\n          }\n        }\n      }\n      if (deleteLayers.length > 0) {\n        for (var dl in deleteLayers) {\n          if (this.layerList.hasOwnProperty(deleteLayers[dl])) {\n            if (this.map.graphicsLayerIds.indexOf(deleteLayers[dl]) > -1) {\n              var _dl = this.layerList[deleteLayers[dl]];\n              if (_dl && _dl.li) {\n                var jimuLayerInfo;\n                if (_dl.li.parentLayerID) {\n                  jimuLayerInfo = this.operLayerInfos.getLayerInfoById(_dl.li.parentLayerID);\n                }\n                if (!jimuLayerInfo && _dl.li.layer) {\n                  jimuLayerInfo = this.operLayerInfos.getLayerInfoById(_dl.li.layer);\n                }\n                if (jimuLayerInfo && _dl.hasOwnProperty('parentLayerVisible')) {\n                  jimuLayerInfo.setTopLayerVisible(_dl.parentLayerVisible);\n                }\n              }\n              this.map.removeLayer(this.layerList[deleteLayers[dl]].layerObject);\n            }\n            this.layerList[deleteLayers[dl]].layerObject.destroy();\n            delete this.layerList[deleteLayers[dl]];\n          }\n        }\n      }\n    },\n\n    addMapLayers: function addMapLayers() {\n      var ids = Object.keys(this.layerList).reverse();\n      for (var i = 0; i < ids.length; i++) {\n        var id = ids[i];\n        var l = this.layerList[id];\n        if (l.type && l.type === \"ClusterLayer\") {\n          if (this.map.graphicsLayerIds.indexOf(id) === -1) {\n            this.map.addLayer(l.layerObject);\n          }\n        }\n      }\n    },\n\n    updateLayerList: function updateLayerList(lyr, lyrInfo, lyrType, jimuLayerInfo) {\n      var l,\n          ll = null;\n      var type, id, layerObject, pl;\n\n      jimuLayerInfo = jimuLayerInfo || this.operLayerInfos.getLayerInfoById(lyr.id);\n\n      var selfType = this._checkSelfType(jimuLayerInfo, lyrInfo, lyrType, lyr);\n      var listDisabled = this._checkListDisabled(lyrInfo);\n\n      //Handle cluster layers\n      if (lyrInfo.symbolData.clusteringEnabled) {\n        l = this._getClusterLayer(lyrInfo, lyr, jimuLayerInfo, lyrType);\n        type = \"ClusterLayer\";\n        layerObject = l;\n        id = l.id;\n        if (!this.hidePanel) {\n          this.own(on(l, \"update-end\", lang.hitch(this, function () {\n            this._loadList(this.layerList[l.id], true);\n          })));\n        }\n        this.numClusterLayers += 1;\n      } else {\n        if (lyr.layerType === \"ArcGISStreamLayer\") {\n          type = \"StreamLayer\";\n          id = lyr.layerObject.id;\n          layerObject = lyr.layerObject;\n          pl = lyr;\n        } else {\n          id = lyrType === \"FeatureLayer\" ? lyrInfo.id : lyr.id;\n          var parentLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.parentLayerID) || lyr.parentLayerInfo;\n          if (parentLayerInfo) {\n            if (parentLayerInfo.layerObject) {\n              ll = parentLayerInfo.layerObject;\n              type = ll.type;\n              if (parentLayerInfo.originOperLayer && parentLayerInfo.originOperLayer.featureCollection) {\n                var layers = parentLayerInfo.originOperLayer.featureCollection.layers;\n                if (layers) {\n                  for (var j = 0; j < layers.length; j++) {\n                    var _lyr = layers[j];\n                    if (_lyr.id === id) {\n                      pl = _lyr;\n                    }\n                  }\n                }\n              }\n            }\n          }\n          l = lyr.layerObject ? lyr.layerObject : lyr;\n          type = lyrType;\n          layerObject = ll && !ll.empty ? ll : l ? l : lyr;\n          if (selfType === 'geo_rss' && layerObject && layerObject.getFeatureLayers) {\n            var featureLayers = layerObject.getFeatureLayers();\n            for (var i = 0; i < featureLayers.length; i++) {\n              var fl = featureLayers[i];\n              if (fl.id === lyrInfo.id) {\n                layerObject = fl;\n              }\n            }\n          }\n          pl = pl ? pl : lyr;\n        }\n      }\n\n      this.layerList[id] = {\n        type: type,\n        layerObject: layerObject,\n        pl: pl,\n        id: id,\n        visible: jimuLayerInfo && jimuLayerInfo.isShowInMap ? jimuLayerInfo.isShowInMap() : true,\n        li: lyrInfo,\n        filter: jimuLayerInfo ? jimuLayerInfo.getFilter() : \"1=1\",\n        infoTemplate: jimuLayerInfo.getInfoTemplate() || lyrInfo.infoTemplate,\n        selfType: selfType,\n        listDisabled: listDisabled,\n        showAllFeatures: this.showAllFeatures\n      };\n\n      if (lyr.layerType !== \"ArcGISStreamLayer\") {\n        this.updateRenderer(id);\n      }\n\n      if (!this.hidePanel) {\n        this._addPanelItem(ll ? ll : l ? l : lyr, lyrInfo, listDisabled, jimuLayerInfo);\n      }\n    },\n\n    _checkListDisabled: function _checkListDisabled(lyrInfo) {\n      return lyrInfo.symbolData.featureDisplayOptions.listDisabled ? lyrInfo.symbolData.featureDisplayOptions.listDisabled : lyrInfo.symbolData.featureDisplayOptions.fields ? lyrInfo.symbolData.featureDisplayOptions.fields.length === 0 : true;\n    },\n\n    _checkSelfType: function _checkSelfType(jimuLayerInfo, lyrInfo, lyrType, lyr) {\n      var _lo = lyrInfo.layerObject && !lyrInfo.layerObject.empty ? lyrInfo.layerObject : lyr;\n      var originOpLayer = _lo && _lo.originOperLayer ? _lo.originOperLayer : lyr;\n\n      var selfType = jimuLayerInfo.originOperLayer && jimuLayerInfo.originOperLayer.selfType ? jimuLayerInfo.originOperLayer.selfType : originOpLayer && originOpLayer.selfType ? originOpLayer.selfType : '';\n\n      selfType = selfType && selfType !== '' ? selfType : originOpLayer && originOpLayer.layerType && originOpLayer.layerType === \"CSV\" ? \"collection\" : lyrType === \"Feature Collection\" ? \"collection\" : '';\n      if (!selfType && lyrType && lyrType === \"KML\") {\n        selfType = \"kml\";\n      }\n      return selfType;\n    },\n\n    updateRenderer: function updateRenderer(id) {\n      var l = this.layerList[id];\n      if (l.li.symbolData.symbolType !== 'LayerSymbol') {\n        if (typeof l.li.orgRenderer === 'undefined') {\n          if (l.layerObject.renderer) {\n            l.li.orgRenderer = l.layerObject.renderer;\n          } else {\n            l.li.orgRenderer = l.li.renderer;\n          }\n        }\n        var renderer = new SimpleRenderer(jsonUtils.fromJson(l.li.symbolData.symbol));\n        l.li.newRenderer = renderer;\n        if (l.layerObject.setRenderer) {\n          l.layerObject.setRenderer(renderer);\n        } else if (l.layerObject.setLayerDrawingOptions) {\n          var optionsArray = [];\n          var drawingOptions = new LayerDrawingOptions();\n          drawingOptions.renderer = renderer;\n          optionsArray[l.li.subLayerId] = drawingOptions;\n          l.layerObject.setLayerDrawingOptions(optionsArray);\n        } else {\n          console.log(\"Error setting the new renderer...will use the default rendering of the layer\");\n        }\n\n        if (typeof l.layerObject.refresh === 'function') {\n          l.layerObject.refresh();\n        }\n      }\n    },\n\n    _onRecNodeMouseover: function _onRecNodeMouseover(rec) {\n      domClass.add(rec, this.isDartTheme ? \"layer-row-mouseover-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"layer-row-mouseover-dashboard\" : \"layer-row-mouseover\");\n    },\n\n    _onRecNodeMouseout: function _onRecNodeMouseout(rec) {\n      domClass.remove(rec, this.isDartTheme ? \"layer-row-mouseover-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"layer-row-mouseover-dashboard\" : \"layer-row-mouseover\");\n    },\n\n    _addPanelItem: function _addPanelItem(layer, lyrInfo, listDisabled, jimuLayerInfo) {\n      var potentialNewID = lyrInfo.id + this.UNIQUE_APPEND_VAL_CL;\n      var id = lyrInfo.id in this.layerList ? lyrInfo.id : potentialNewID in this.layerList ? potentialNewID : '';\n      var lyr = this.layerList[id];\n      if (lyr) {\n        var lyrType = lyr.type;\n        var cssAry;\n        if (this.isDashboardTheme) {\n          cssAry = ['rec', 'expand', 'expandDown-dashboard', 'solidBorder'];\n        } else if (this.isDartTheme) {\n          cssAry = ['rec-dart', 'expand-dart', 'expandDown-dart', 'solidBorder-dart'];\n        } else {\n          cssAry = ['rec', 'expand', 'expandDown', 'solidBorder'];\n        }\n        var rec = domConstruct.create(\"div\", {\n          'class': cssAry[0] + \" \" + cssAry[3],\n          id: 'rec_' + id\n        }, this.pageMain);\n\n        var expandClass;\n        if (!listDisabled) {\n          this.own(on(rec, 'mouseover', lang.hitch(this, this._onRecNodeMouseover, rec)));\n          this.own(on(rec, 'mouseout', lang.hitch(this, this._onRecNodeMouseout, rec)));\n          expandClass = cssAry[1] + \" \" + cssAry[2];\n          if (jimuLayerInfo && jimuLayerInfo.isInScale) {\n            expandClass += jimuLayerInfo.isInScale() ? \"\" : \" expandInActive\";\n          }\n        } else {\n          html.setStyle(rec, \"cursor\", \"default\");\n          expandClass = 'expand-empty';\n        }\n        domConstruct.create(\"div\", {\n          'class': expandClass,\n          id: \"exp_\" + id\n        }, rec);\n\n        var recIcon = domConstruct.create(\"div\", {\n          'class': \"recIcon active\",\n          id: \"recIcon_\" + id\n        }, rec);\n\n        if (lyrInfo.panelImageData && lyrInfo.panelImageData.toString().indexOf('<img') > -1) {\n          var img = document.createElement('div');\n          img.innerHTML = lyrInfo.panelImageData;\n          var icon = new PictureMarkerSymbol(img.children[0].src, 26, 26);\n          lyrInfo.panelImageData = this._createImageDataDiv(icon, 44, 44, undefined, true).innerHTML;\n        }\n        recIcon.innerHTML = lyrInfo.panelImageData;\n        domStyle.set(recIcon.firstChild, \"border-radius\", \"41px\");\n\n        var recLabel;\n        var recNum;\n        if (this.config.countEnabled) {\n          recLabel = domConstruct.create(\"div\", {\n            'class': \"recLabel\",\n            id: \"recLabel_\" + id,\n            innerHTML: \"<p>\" + lyrInfo.label + \"</p>\"\n          }, rec);\n          html.setStyle(recLabel, \"top\", \"20px\");\n          recNum = domConstruct.create(\"div\", {\n            'class': \"recNum\",\n            id: \"recNum_\" + id,\n            innerHTML: \"\"\n          }, rec);\n        } else {\n          recLabel = domConstruct.create(\"div\", {\n            'class': \"recLabelNoCount\",\n            id: \"recLabel_\" + id,\n            innerHTML: \"<p>\" + lyrInfo.label + \"</p>\"\n          }, rec);\n        }\n\n        if (lyrType === \"ClusterLayer\") {\n          layer.node = recNum;\n          if (!listDisabled) {\n            this._addLegend(id, lyr);\n          }\n          layer._updateNode(layer.nodeCount);\n        } else if (lyrType === \"StreamLayer\") {\n          lyr.node = recNum;\n          this.countFeatures(lyr);\n          if (!listDisabled) {\n            this._addLegend(id, lyr);\n          }\n        } else {\n          lyr.node = recNum;\n          this._addLegend(id, lyr);\n        }\n\n        on(recIcon, \"click\", lang.hitch(this, this._toggleLayerVisibility, lyr));\n\n        if (!listDisabled) {\n          lyr.toggleLegend = on(rec, \"click\", lang.hitch(this, this._toggleLegend, lyr));\n        }\n      }\n    },\n\n    _addLegend: function _addLegend(id, layerListLayer) {\n      layerListLayer.legendOpen = this.row === null && this.config.expandList;\n      var _class = layerListLayer.legendOpen ? \"legendOn\" : \"legendOff\";\n      layerListLayer.legendNode = domConstruct.create(\"div\", {\n        \"class\": \"legendLayer \" + _class,\n        \"id\": \"legend_\" + id\n      }, this.pageMain);\n      if (layerListLayer.type === 'ClusterLayer') {\n        layerListLayer.layerObject.legendNode = layerListLayer.legendNode;\n      }\n      this.row = 'firstRowExpanded';\n    },\n\n    _getListFields: function _getListFields(lyr) {\n      var popupFields = [];\n      var infoTemp = this._getInfoTemplate(lyr);\n\n      var fieldInfos = infoTemp && infoTemp.info && infoTemp.info.fieldInfos ? infoTemp.info.fieldInfos : [];\n      array.forEach(fieldInfos, function (fieldInfo) {\n        if (fieldInfo.visible) {\n          popupFields.push(fieldInfo.fieldName);\n        }\n      });\n\n      var displayOptions = lyr.li.symbolData && lyr.li.symbolData.featureDisplayOptions ? lyr.li.symbolData.featureDisplayOptions : {};\n      var fields = displayOptions.fields || [];\n      array.forEach(fields, function (field) {\n        if (popupFields.indexOf(field.name) === -1) {\n          popupFields.push(field.name);\n        }\n      });\n      if (displayOptions.groupField) {\n        if (popupFields.indexOf(displayOptions.groupField.name) === -1) {\n          popupFields.push(displayOptions.groupField.name);\n        }\n      }\n\n      if (popupFields.length === 0 || typeof infoTemp === 'undefined') {\n        popupFields = ['*'];\n      }\n\n      if (popupFields[0] !== '*') {\n        if (lyr.layerObject && lyr.layerObject.objectIdField) {\n          if (popupFields.indexOf(lyr.layerObject.objectIdField) === -1) {\n            popupFields.push(lyr.layerObject.objectIdField);\n          }\n        }\n      }\n      return popupFields;\n    },\n\n    _loadList: function _loadList(lyr, updateCount) {\n      if (!this.hidePanel) {\n        var id = lyr.layerObject.id in this.layerList ? lyr.layerObject.id : lyr.li.id;\n        if (updateCount) {\n          this._addSearching(id);\n        }\n\n        var popupFields = this._getListFields(lyr);\n        if (lyr.type === \"ClusterLayer\") {\n          if (lyr.li.layerListExtentChanged) {\n            lyr.layerObject.clusterFeatures();\n            lyr.li.layerListExtentChanged = false;\n          }\n          var features = [];\n          if (lyr.layerObject.clusterGraphics || lyr.layerObject._features) {\n            if (this.showAllFeatures) {\n              features = lyr.layerObject._features;\n            } else {\n              var clusterGraphics = lyr.layerObject.clusterGraphics;\n              for (var z = 0; z < clusterGraphics.length; z++) {\n                var clusterGraphic = clusterGraphics[z];\n                if (clusterGraphic.graphics && clusterGraphic.graphics.length > 0) {\n                  for (var f = 0; f < clusterGraphic.graphics.length; f++) {\n                    var g = clusterGraphic.graphics[f];\n                    features.push(g);\n                  }\n                }\n              }\n            }\n            setTimeout(lang.hitch(this, function () {\n              this._updateList(features, lyr.legendNode, lyr.layerObject.node, popupFields, updateCount, lyr);\n            }), 100);\n          } else {\n            this._removeSearching(id, lyr.legendNode ? !domClass.contains(lyr.legendNode, 'legendOff') : true);\n          }\n        } else {\n          this.getFeatures(lyr, popupFields, updateCount);\n          return;\n        }\n      }\n    },\n\n    _addSearching: function _addSearching(id) {\n      var disabled = this.layerList[id].listDisabled;\n      var eD = disabled ? 'expand-empty' : this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n      var eU = disabled ? 'expand-empty' : this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n      var eS = disabled ? \"expandSearching-empty\" : \"expandSearching\";\n      if (domClass.contains(\"exp_\" + id, eD)) {\n        domClass.remove(\"exp_\" + id, eD);\n        domClass.add(\"exp_\" + id, eS);\n      }\n      if (domClass.contains(\"exp_\" + id, eU)) {\n        domClass.remove(\"exp_\" + id, eU);\n        domClass.add(\"exp_\" + id, eS);\n      }\n    },\n\n    _removeSearching: function _removeSearching(id, legendOpen) {\n      var disabled = this.layerList[id].listDisabled;\n      var eD = disabled ? 'expand-empty' : this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n      var eU = disabled ? 'expand-empty' : this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n      var eS = disabled ? \"expandSearching-empty\" : \"expandSearching\";\n      if (domClass.contains(\"exp_\" + id, eS)) {\n        domClass.remove(\"exp_\" + id, eS);\n        domClass.add(\"exp_\" + id, legendOpen ? eU : eD);\n      }\n    },\n\n    _getClusterLayer: function _getClusterLayer(lyrInfo, layer, jimuLayerInfo, lyrType) {\n      var lyr = layer.layerObject ? layer.layerObject : layer;\n      var infoTemplate = lyrInfo.infoTemplate;\n      var originOperLayer = lyr && lyr.originOperLayer ? lyr.originOperLayer : layer.parentLayerInfo ? layer.parentLayerInfo : jimuLayerInfo ? jimuLayerInfo.originOperLayer : undefined;\n      var clusterLayer = null;\n      var n;\n      var potentialNewID = lyrInfo.id + this.UNIQUE_APPEND_VAL_CL;\n      var configChange = true;\n      if (this.map.graphicsLayerIds.indexOf(potentialNewID) > -1 || this.map._layers.indexOf(potentialNewID) > -1) {\n        clusterLayer = this.map.getLayer(potentialNewID);\n\n        var reloadData = false;\n        var refreshData = false;\n\n        //update the symbol if it has changed\n        if (JSON.stringify(clusterLayer.symbolData) !== JSON.stringify(lyrInfo.symbolData)) {\n          clusterLayer.symbolData = lyrInfo.symbolData;\n          clusterLayer.countColor = lyrInfo.symbolData._highLightColor;\n          refreshData = true;\n        }\n\n        //update the icon if it has changed\n        n = domConstruct.toDom(lyrInfo.panelImageData);\n        if (JSON.stringify(clusterLayer.icon) !== JSON.stringify(n.src)) {\n          clusterLayer.icon = n.src;\n          refreshData = true;\n        }\n        domConstruct.destroy(n.id);\n\n        clusterLayer.displayFeatureCount = lyrInfo.symbolData.displayFeatureCount;\n\n        if (clusterLayer.refresh !== lyrInfo.refresh) {\n          clusterLayer.refresh = lyrInfo.refresh;\n          reloadData = true;\n        }\n\n        if (refreshData) {\n          clusterLayer._setupSymbols();\n        }\n\n        clusterLayer.countEnabled = this.config.countEnabled;\n        clusterLayer.hidePanel = this.hidePanel;\n\n        if (clusterLayer.showAllFeatures !== this.showAllFeatures) {\n          reloadData = true;\n          clusterLayer.showAllFeatures = this.showAllFeatures;\n        }\n        if (clusterLayer.listDisabled !== this.listDisabled) {\n          reloadData = true;\n          clusterLayer.listDisabled = this.listDisabled;\n        }\n\n        if (reloadData) {\n          if (clusterLayer.url) {\n            clusterLayer.refreshFeatures(clusterLayer.url);\n          }\n        } else if (refreshData) {\n          clusterLayer.clusterFeatures();\n        }\n      } else {\n        configChange = false;\n        clusterLayer = new ClusterLayer({\n          name: lyrInfo.label + this.UNIQUE_APPEND_VAL_CL,\n          id: potentialNewID,\n          map: this.map,\n          node: dom.byId(\"recNum_\" + potentialNewID),\n          legendNode: dom.byId(\"legend_\" + potentialNewID),\n          infoTemplate: typeof lyr.infoTemplate !== 'undefined' ? lyr.infoTemplate : infoTemplate,\n          refreshInterval: this.config.refreshInterval,\n          refreshEnabled: this.config.refreshEnabled,\n          parentLayer: lyr,\n          lyrInfo: lyrInfo,\n          lyrType: lyrType,\n          _styleColor: this._styleColor,\n          originOperLayer: originOperLayer,\n          countEnabled: this.config.countEnabled,\n          hidePanel: this.hidePanel,\n          filter: jimuLayerInfo ? jimuLayerInfo.getFilter() : \"1=1\",\n          showAllFeatures: this.showAllFeatures,\n          listDisabled: this.listDisabled\n        });\n      }\n      clusterLayer.setVisibility(configChange ? clusterLayer.visible : jimuLayerInfo.isShowInMap ? jimuLayerInfo.isShowInMap() : true);\n      return clusterLayer;\n    },\n\n    _createImageDataDiv: function _createImageDataDiv(sym, w, h, parent, isCustom) {\n      var a;\n      var symbol = sym;\n      if (symbol) {\n        //TODO are these switched??\n        var height = w;\n        var width = h;\n        if (symbol.height && symbol.width) {\n          var ar;\n          if (symbol.height > symbol.width) {\n            ar = symbol.width / symbol.height;\n            width = w * ar;\n          } else if (symbol.width === symbol.height || symbol.width > symbol.height) {\n            width = w;\n            ar = symbol.width / symbol.height;\n            height = ar > 0 ? h * ar : h;\n          }\n        }\n        if (typeof symbol.setWidth !== 'undefined') {\n          if (typeof symbol.setHeight !== 'undefined') {\n            symbol.setWidth(isCustom ? width - width * 0.25 : width);\n            symbol.setHeight(isCustom ? height - height * 0.25 : height);\n          } else {\n            symbol.setWidth(2);\n          }\n        } else if (typeof symbol.size !== 'undefined') {\n          if (symbol.size > 20) {\n            symbol.setSize(20);\n          }\n        }\n        a = domConstruct.create(\"div\", { 'class': \"imageDataGFX\" }, parent);\n        var mySurface = gfx.createSurface(a, w, h);\n        var descriptors = jsonUtils.getShapeDescriptors(symbol);\n        var shape = mySurface.createShape(descriptors.defaultShape).setFill(descriptors.fill).setStroke(descriptors.stroke);\n        shape.applyTransform({ dx: w / 2, dy: h / 2 });\n      }\n      return a;\n    },\n\n    _updateUI: function _updateUI(styleName) {\n      this.styleName = styleName;\n\n      if (this.isDashboardTheme) {\n        this.isLightTheme = styleName ? styleName === 'light' : this.isLightTheme;\n\n        var removeDownClass = this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n        var addDownClass = this.isLightTheme ? 'expandDown' : 'expandDown-dashboard';\n        this._updateNodes(removeDownClass, addDownClass);\n\n        var removeUpClass = this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n        var addUpClass = this.isLightTheme ? 'expandUp' : 'expandUp-dashboard';\n        this._updateNodes(removeUpClass, addUpClass);\n\n        var removeExpandClass = this.isLightTheme ? 'expand-dashboard' : 'expand';\n        var addExpandClass = this.isLightTheme ? 'expand' : 'expand-dashboard';\n        this._updateNodes(removeExpandClass, addExpandClass);\n\n        var removeGroupItemUpClass = this.isLightTheme ? 'groupItemImageUp-dashboard' : 'groupItemImageUp';\n        var addGroupItemUpClass = this.isLightTheme ? 'groupItemImageUp' : 'groupItemImageUp-dashboard';\n        this._updateNodes(removeGroupItemUpClass, addGroupItemUpClass);\n\n        var removeGroupItemDownClass = this.isLightTheme ? 'groupItemImageDown-dashboard' : 'groupItemImageDown';\n        var addGroupItemDownClass = this.isLightTheme ? 'groupItemImageDown' : 'groupItemImageDown-dashboard';\n        this._updateNodes(removeGroupItemDownClass, addGroupItemDownClass);\n\n        var removeGroupItemClass = this.isLightTheme ? 'groupItemImage-dashboard' : 'groupItemImage';\n        var addGroupItemClass = this.isLightTheme ? 'groupItemImage' : 'groupItemImage-dashboard';\n        this._updateNodes(removeGroupItemClass, addGroupItemClass);\n      }\n    },\n\n    _updateNodes: function _updateNodes(remove, add) {\n      var nodes = query('.' + remove);\n      array.forEach(nodes, function (node) {\n        domClass.remove(node, remove);\n        domClass.add(node, add);\n      });\n    },\n\n    _toggleLayerVisibility: function _toggleLayerVisibility(obj, e) {\n      e.stopPropagation();\n      this.map.infoWindow.hide();\n      var id = obj.id ? obj.id : obj.layerObject.id;\n      var lyr = this.layerList[id];\n      if (!lyr) {\n        if (obj.pl) {\n          id = obj.pl.id;\n        }\n        lyr = this.layerList[id];\n      }\n\n      if (lyr) {\n        var hasSubLayerId = lyr.li && lyr.li.hasOwnProperty(\"subLayerId\") ? typeof lyr.li.subLayerId !== 'undefined' && lyr.li.subLayerId.toString() !== \"-1\" : false;\n\n        var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n        var _vis = !domClass.contains(\"recIcon_\" + id, \"active\");\n\n        if (hasSubLayerId && lyr.type !== 'ClusterLayer') {\n          if (_vis) {\n            var currentLayerInfo = lyrInfo.parentLayerInfo;\n            while (currentLayerInfo) {\n              currentLayerInfo.setTopLayerVisible(true);\n              currentLayerInfo = currentLayerInfo.parentLayerInfo;\n            }\n          }\n          lyrInfo.setTopLayerVisible(_vis);\n        } else if (lyr) {\n          lyr.layerObject.setVisibility(_vis);\n          if (lyr.type === 'ClusterLayer' && _vis) {\n            lyr.layerObject.handleMapExtentChange({ levelChange: true });\n            lyr.layerObject.flashFeatures();\n          }\n          if (typeof lyr.pl !== 'undefined') {\n            lyr.pl.visibility = _vis;\n            if (this.map.graphicsLayerIds.indexOf(id) > -1) {\n              var l = this.map.getLayer(id);\n              l.setVisibility(_vis);\n            }\n          }\n        }\n      }\n    },\n\n    _toggleLayerUI: function _toggleLayerUI(obj, vis) {\n      var id = obj.id ? obj.id : obj.layerObject.id;\n      var lyr = this.layerList[id];\n      if (!lyr) {\n        if (obj.pl) {\n          id = obj.pl.id;\n        }\n        lyr = this.layerList[id];\n      }\n      if (lyr) {\n        var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n        var visScalRange = lyrInfo.isCurrentScaleInTheScaleRange ? lyrInfo.isCurrentScaleInTheScaleRange() : true;\n\n        var c = dom.byId(\"recLabel_\" + id);\n\n        this.layerList[id].visible = vis;\n        this.layerList[id].parentLayerVisible = vis;\n        if (this.layerList[id].type === 'ClusterLayer') {\n          this.layerList[id].layerObject.parentLayerVisible = vis;\n        }\n        if (this.config.countEnabled) {\n          if (domClass.contains(\"recNum_\" + id, !vis ? \"recNum\" : \"recNumInActive\")) {\n            var _append = this.isDartTheme ? ' darkThemeColor' : ' lightThemeColor';\n            domClass.remove(\"recNum_\" + id, !vis ? \"recNum\" : \"recNumInActive\");\n            domClass.add(\"recNum_\" + id, (!vis ? \"recNumInActive\" : \"recNum\") + _append);\n          }\n        }\n\n        var eD = this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n        var eU = this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n\n        if (!vis) {\n          domClass.remove(\"recIcon_\" + id, \"active\");\n          //this._clearList(this.layerList[id]);\n          if (c && c.firstChild) {\n            domClass.add(c.firstChild, \"inActive\");\n          }\n          if (!domClass.contains(\"exp_\" + id, \"expandInActive\")) {\n            domClass.add(\"exp_\" + id, \"expandInActive\");\n          }\n          if (lyr.legendOpen) {\n            if (domClass.contains(\"legend_\" + id, \"legendOn\")) {\n              //this.layerList[id].legendOpen = false;\n              domClass.remove(\"legend_\" + id, \"legendOn\");\n              domClass.add(\"legend_\" + id, \"legendOff\");\n              if (domClass.contains(\"exp_\" + id, eU)) {\n                domClass.remove(\"exp_\" + id, eU);\n                domClass.add(\"exp_\" + id, eD);\n              }\n            }\n          }\n          if (lyr.toggleLegend) {\n            lyr.toggleLegend.remove();\n          }\n          if (domClass.contains(\"rec_\" + id, \"rec\")) {\n            domClass.add(\"rec_\" + id, \"recDefault\");\n          }\n        } else {\n          domClass.add(\"recIcon_\" + id, \"active\");\n          if (c && c.firstChild) {\n            domClass.remove(c.firstChild, \"inActive\");\n          }\n          if (domClass.contains(\"exp_\" + id, \"expandInActive\") && visScalRange) {\n            domClass.remove(\"exp_\" + id, \"expandInActive\");\n          }\n          if (lyr.toggleLegend) {\n            lyr.toggleLegend.remove();\n          }\n          var rec = dom.byId('rec_' + id);\n          if (rec) {\n            lyr.toggleLegend = on(rec, \"click\", lang.hitch(this, this._toggleLegend, lyr));\n          }\n\n          if (domClass.contains(\"rec_\" + id, \"recDefault\")) {\n            domClass.remove(\"rec_\" + id, \"recDefault\");\n          }\n\n          if (!lyr.listDisabled) {\n            this._loadList(lyr, true);\n            if (lyr.legendOpen) {\n              domClass.add(\"legend_\" + id, \"legendOn\");\n              domClass.remove(\"legend_\" + id, \"legendOff\");\n              if (domClass.contains(\"exp_\" + id, eD)) {\n                domClass.remove(\"exp_\" + id, eD);\n                domClass.add(\"exp_\" + id, eU);\n              }\n            }\n          }\n        }\n      }\n      return false;\n    },\n\n    _toggleLegend: function _toggleLegend(obj, evt) {\n      if (evt.currentTarget.className !== 'thumb2' && evt.currentTarget.className !== 'recIcon') {\n        var id = obj.layerObject.id in this.layerList ? obj.layerObject.id : obj.li.id;\n        if (domClass.contains(\"legend_\" + id, \"legendOff\")) {\n          this._addSearching(id);\n          this.layerList[id].legendOpen = true;\n          if (typeof this.layerList[id].li.layerListExtentChanged === 'undefined' || this.layerList[id].requiresReload) {\n            this.layerList[id].li.layerListExtentChanged = true;\n            this.layerList[id].requiresReload = false;\n          }\n          if (this.layerList[id].li.layerListExtentChanged) {\n            setTimeout(lang.hitch(this, function () {\n              this._loadList(obj, false);\n            }), 500);\n          } else {\n            this._removeSearching(id, true);\n          }\n          domClass.remove(\"legend_\" + id, \"legendOff\");\n          domClass.add(\"legend_\" + id, \"legendOn\");\n        } else {\n          if (domClass.contains(\"legend_\" + id, \"legendOn\")) {\n            this.layerList[id].legendOpen = false;\n            var eD = this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n            var eU = this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n            if (domClass.contains(\"exp_\" + id, eU)) {\n              domClass.remove(\"exp_\" + id, eU);\n              domClass.add(\"exp_\" + id, eD);\n            }\n            domClass.remove(\"legend_\" + id, \"legendOn\");\n            domClass.add(\"legend_\" + id, \"legendOff\");\n          }\n        }\n      }\n      evt.stopPropagation();\n    },\n\n    _toggleGroup: function _toggleGroup(obj, e) {\n      var id = e.currentTarget.id.slice(0, -2);\n      var fI = this.isDartTheme ? 'featureItem-dart' : 'featureItem';\n\n      var toggle = true;\n      if (e.target.parentNode) {\n        if (e.target.parentNode.id !== \"\") {\n          if (domClass.contains(e.target.parentNode.id, fI)) {\n            toggle = false;\n          }\n        }\n        if (e.target.id !== \"\") {\n          if (domClass.contains(e.target.id, fI)) {\n            toggle = false;\n          }\n        }\n      }\n\n      var gII = this.isDartTheme ? \"groupItemImage-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImage-dashboard\" : \"groupItemImage\";\n      var gIIUp = this.isDartTheme ? \"groupItemImageUp-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageUp-dashboard\" : \"groupItemImageUp\";\n      var gIIDown = this.isDartTheme ? \"groupItemImageDown-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageDown-dashboard\" : \"groupItemImageDown\";\n      if (toggle) {\n        var lId = obj.layerObject.id in this.layerList ? obj.layerObject.id : obj.li.id;\n        var node = document.getElementById(e.currentTarget.id);\n        var _idx = node.childNodes[0].childNodes.length - 1;\n        if (domClass.contains(id, \"groupOff\")) {\n          if (this.layerList[lId].openGroups && this.layerList[lId].openGroups.length > 0) {\n            if (this.layerList[lId].openGroups.indexOf(id) === -1) {\n              this.layerList[lId].openGroups.push(id);\n            }\n          } else {\n            this.layerList[lId].openGroups = [id];\n          }\n          domClass.remove(id, \"groupOff\");\n          domClass.add(id, \"groupOn\");\n          this.layerList[lId].groupOpen = true;\n          if (node.childNodes[0].childNodes[_idx].childNodes[0].className.indexOf(gII) > -1) {\n            html.removeClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIDown);\n            html.addClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIUp);\n          }\n        } else {\n          if (domClass.contains(id, \"groupOn\")) {\n            domClass.remove(id, \"groupOn\");\n            domClass.add(id, \"groupOff\");\n\n            if (this.layerList[lId].openGroups && this.layerList[lId].openGroups.length > 0) {\n              var idx = this.layerList[lId].openGroups.indexOf(id);\n              if (idx > -1) {\n                this.layerList[lId].openGroups.splice(idx, 1);\n              }\n              if (this.layerList[lId].openGroups.length === 0) {\n                this.layerList[lId].groupOpen = false;\n              }\n            } else {\n              this.layerList[lId].groupOpen = false;\n            }\n            if (node.childNodes[0].childNodes[_idx].childNodes[0].className.indexOf(gII) > -1) {\n              html.removeClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIUp);\n              html.addClass(e.currentTarget.childNodes[0].childNodes[_idx].childNodes[0], gIIDown);\n            }\n          }\n        }\n      }\n    },\n\n    /*jshint unused:false*/\n    onAppConfigChanged: function onAppConfigChanged(appConfig, reason, changedData) {\n      switch (reason) {\n        case 'themeChange':\n          this.inPanelOverrides(changedData);\n          this.destroy();\n          break;\n        case 'layoutChange':\n          this.inPanelOverrides(changedData);\n          break;\n        case 'styleChange':\n          if (!this.hidePanel) {\n            this._updateUI(changedData);\n            this._updateStyleColor(changedData);\n          }\n          break;\n        case 'widgetChange':\n          this.widgetChange = true;\n          if (changedData && changedData.config && changedData.config.layerInfos) {\n            this.removeOldClusterLayers(changedData.config.layerInfos);\n          }\n          this.row = null;\n          break;\n        case 'mapChange':\n          this._clearMap();\n      }\n    },\n\n    _updateStyleColor: function _updateStyleColor(changedData) {\n      setTimeout(lang.hitch(this, function () {\n        var p = this.getPanel();\n        var node;\n        switch (this.appConfig.theme.name) {\n          case 'BoxTheme':\n            node = p.containerNode.parentNode.parentNode.children[0];\n            break;\n          case 'DartTheme':\n            node = p.containerNode.parentNode;\n            break;\n          case 'TabTheme':\n            node = p.containerNode;\n            break;\n          case 'BillboardTheme':\n            node = p.containerNode.parentNode;\n            break;\n          case 'FoldableTheme':\n            node = p.containerNode.parentNode.firstChild;\n            break;\n          default:\n            node = this.pageHeader;\n            break;\n        }\n        var bc = window.getComputedStyle(node, null).getPropertyValue('background-color');\n        this._styleColor = Color.fromRgb(bc).toHex();\n        for (var k in this.layerList) {\n          var l = this.layerList[k];\n          if (l.type === \"ClusterLayer\") {\n            l.layerObject.setStyleColor(this._styleColor);\n          }\n        }\n        this._updateUI(changedData);\n      }), 50);\n    },\n\n    _clearMap: function _clearMap() {\n      if (this.layerList) {\n        for (var k in this.layerList) {\n          var l = this.layerList[k];\n          if (l.type === \"ClusterLayer\") {\n            var _clear = true;\n            if (typeof this.continuousRefreshEnabled !== 'undefined') {\n              _clear = !this.continuousRefreshEnabled;\n            }\n            if (_clear) {\n              l.layerObject._clear();\n              this.map.removeLayer(l.layerObject);\n            }\n          }\n        }\n        this.layerList = {};\n      }\n    },\n\n    _close: function _close() {\n      this.widgetManager.closeWidget(this.id);\n    },\n\n    onClose: function onClose() {\n      this.inherited(arguments);\n\n      for (var key in this.layerList) {\n        var layerListLayer = this.layerList[key];\n        if (layerListLayer.li && layerListLayer.li.orgRenderer) {\n          if (layerListLayer.layerObject.setRenderer) {\n            layerListLayer.layerObject.setRenderer(layerListLayer.li.orgRenderer);\n          } else if (layerListLayer.layerObject.setLayerDrawingOptions) {\n            layerListLayer.layerObject.setLayerDrawingOptions([]);\n          } else {\n            console.log(\"Error re-setting the renderer\");\n          }\n          layerListLayer.layerObject.refresh();\n        }\n      }\n\n      var disableRefresh = true;\n      if (typeof this.config.continuousRefreshEnabled !== 'undefined') {\n        disableRefresh = !this.config.continuousRefreshEnabled;\n      }\n      if (disableRefresh) {\n        if (this.refreshInterval !== 0) {\n          this.refreshIntervalValue = 0;\n          clearInterval(this.refreshInterval);\n          this.refreshInterval = 0;\n        }\n      }\n\n      if (!this.hidePanel) {\n        if (typeof this.mapExtentChangedHandler !== 'undefined') {\n          this.mapExtentChangedHandler.remove();\n          this.mapExtentChangedHandler = undefined;\n        } else {\n          if (typeof this.iconClickHandler !== 'undefined') {\n            this.iconClickHandler.remove();\n            this.iconClickHandler = undefined;\n          }\n        }\n      }\n    },\n\n    _clearChildNodes: function _clearChildNodes(parentNode) {\n      while (parentNode.hasChildNodes()) {\n        parentNode.removeChild(parentNode.lastChild);\n      }\n    },\n\n    _inVisibleRange: function _inVisibleRange(lyr, id) {\n      var visScaleRange = true;\n      if (lyr.layerObject && lyr.layerObject.hasOwnProperty('visibleAtMapScale')) {\n        visScaleRange = lyr.layerObject.visibleAtMapScale;\n      }\n      var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n      if (lyrInfo && lyrInfo.isCurrentScaleInTheScaleRange) {\n        visScaleRange = lyrInfo.isCurrentScaleInTheScaleRange();\n      }\n      return visScaleRange;\n    },\n\n    _mapExtentChange: function _mapExtentChange() {\n      var countEnabled = this.config.countEnabled;\n      var queries = [];\n      for (var key in this.layerList) {\n        var lyr = this.layerList[key];\n        lyr.visScaleRange = this._inVisibleRange(lyr, key);\n        if (!this.showAllFeatures) {\n          this._clearList(lyr);\n        }\n        if (!lyr.legendOpen || lyr.groupEnabled && !lyr.groupOpen) {\n          if (lyr.li) {\n            lyr.li.layerListExtentChanged = true;\n          }\n          if (lyr.visible && lyr.visScaleRange) {\n            if (lyr.type === \"ClusterLayer\" && lyr.layerObject.initalLoad && this.config.countEnabled) {\n              lyr.layerObject._updateNode(lyr.layerObject.node.innerHTML);\n            }\n\n            if (lyr.type !== 'ClusterLayer') {\n              var uNode = this.config.countEnabled ? lyr.node : lyr.legendNode;\n              if (typeof lyr.layerObject === 'undefined') {\n                console.log(\"layer object not known\");\n              } else {\n                this.countFeatures(lyr);\n              }\n            }\n          } else if (!lyr.visScaleRange) {\n            this._updateList([], lyr.legendNode, lyr.node, [], true, lyr);\n          }\n        } else {\n          if (lyr.visible && lyr.visScaleRange) {\n            lyr.updateList = true;\n            this._loadList(lyr, lyr.updateList);\n          } else {\n            this._updateList([], lyr.legendNode, lyr.node, [], true, lyr);\n          }\n        }\n      }\n    },\n\n    getFeatures: function getFeatures(lyrInfo, fields, updateCount) {\n      var lyr = lyrInfo.layerObject;\n      var legendNode = lyrInfo.legendNode;\n      var node = lyrInfo.node;\n      var _needsGeom = !lyrInfo.listDisabled && lyrInfo.legendOpen ? true : false;\n      var visScaleRange = lyrInfo.visScaleRange;\n      var maxRecordCount = lyr && lyr.maxRecordCount ? lyr.maxRecordCount : undefined;\n      var url;\n      var queries = [];\n      var q = this._getQuery(lyrInfo, fields, _needsGeom);\n      if (lyrInfo.visible && visScaleRange) {\n        if (lyr.queryFeatures) {\n          //get the first set of features\n          if (!lyrInfo.listDisabled) {\n            queries.push(lyr.queryFeatures(q));\n          }\n          //query the ids incase we need more than maxRecordCount\n          queries.push(lyr.queryIds(q));\n        } else {\n          url = lyrInfo.li.url;\n          if (url.indexOf(\"MapServer\") > -1 || url.indexOf(\"FeatureServer\") > -1) {\n            var qt = new QueryTask(url);\n            //get the first set of features\n            if (!lyrInfo.listDisabled) {\n              queries.push(qt.execute(q));\n            }\n            //query the ids incase we need more than maxRecordCount\n            queries.push(qt.executeForIds(q));\n          }\n        }\n      } else {\n        //if it's not visible and not within the visible scale range\n        this._updateList([], lyrInfo.legendNode, lyrInfo.node, [], true, lyrInfo);\n      }\n      if (queries.length > 0) {\n        var featurePromises = all(queries);\n        featurePromises.then(lang.hitch(this, function (results) {\n          var s_id = lyrInfo.layerObject.id in this.layerList ? lyrInfo.layerObject.id : lyrInfo.li.id;\n          var updateNode;\n          if (node) {\n            updateNode = this.config.countEnabled ? node.parentNode : node.previousSibling;\n          }\n          if (results && results.length > 1) {\n            var _queries = [];\n            var queryIDs = results[1];\n            var count = 0;\n            //if IDs exceed max count we need to chunk\n            if (queryIDs && maxRecordCount && queryIDs.length > maxRecordCount) {\n              this._chunkRequest(lyr, url, queryIDs, maxRecordCount, fields, _needsGeom).then(lang.hitch(this, function (fullFeatures) {\n                this._updateList(fullFeatures, legendNode, node, fields, updateCount, lyrInfo);\n              }));\n            } else {\n              this._updateList(results[0].features, legendNode, node, fields, updateCount, lyrInfo);\n            }\n          } else if (results && results.length === 1) {\n            if (this.config.countEnabled) {\n              node.innerHTML = utils.localizeNumber(results[0].length);\n            }\n            this._removeSearching(s_id, false);\n          } else {\n            if (this.config.countEnabled) {\n              node.innerHTML = utils.localizeNumber(0);\n            }\n            this.updateExpand(updateNode, true);\n            this._removeSearching(s_id, lyrInfo.legendOpen);\n          }\n        }));\n      }\n    },\n\n    _chunkRequest: function _chunkRequest(lyr, url, IDs, max, fields, needsGeom) {\n      var def = new Deferred();\n      var queries = [];\n      var i, j;\n      for (i = 0, j = IDs.length; i < j; i += max) {\n        var ids = IDs.slice(i, i + max);\n\n        var q = new Query();\n        q.outFields = fields;\n        q.objectIds = ids;\n        q.returnGeometry = needsGeom;\n\n        if (lyr.queryFeatures) {\n          queries.push(lyr.queryFeatures(q));\n        } else if (url) {\n          var qt = new QueryTask(url);\n          queries.push(qt.execute(q));\n        }\n      }\n      var queryList = new DeferredList(queries);\n      queryList.then(lang.hitch(this, function (queryResults) {\n        if (queryResults) {\n          var allFeatures = [];\n          for (var i = 0; i < queryResults.length; i++) {\n            if (queryResults[i][1].features) {\n              allFeatures.push.apply(allFeatures, queryResults[i][1].features);\n            }\n          }\n          def.resolve(allFeatures);\n        }\n      }));\n      return def;\n    },\n\n    _clearList: function _clearList(lyrInfo) {\n      if (!lyrInfo.isLoaded && lyrInfo.legendNode) {\n        lyrInfo.isLoaded = false;\n        lyrInfo.legendNode.innerHTML = '';\n      }\n    },\n\n    _updateList: function _updateList(features, legendNode, node, fields, updateCount, lyrInfo, countOnly) {\n      var li = lyrInfo.li ? lyrInfo.li : lyrInfo;\n\n      if (lyrInfo.type === 'ClusterLayer') {\n        if (lyrInfo.layerObject.node) {\n          if (domClass.contains(lyrInfo.layerObject.node.id, 'searching')) {\n            domClass.remove(lyrInfo.layerObject.node.id, 'searching');\n          }\n        }\n      }\n\n      var visScaleRange = lyrInfo.visScaleRange;\n      var infoTemplate = lyrInfo.infoTemplate;\n      var displayOptions = lyrInfo.symbolData ? lyrInfo.symbolData.featureDisplayOptions : li && li.symbolData ? li.symbolData.featureDisplayOptions : {};\n\n      if (node || legendNode) {\n        if (legendNode && (lyrInfo.hasOwnProperty('isLoaded') ? !lyrInfo.isLoaded : true)) {\n          legendNode.innerHTML = '';\n        }\n        if (updateCount && node && this.config.countEnabled) {\n          if (visScaleRange) {\n            node.innerHTML = utils.localizeNumber(features.length);\n          } else {\n            this.countFeatures(lyrInfo, lyrInfo.id || li.id);\n          }\n        }\n        var updateNode = this.config.countEnabled ? node.parentNode : legendNode.previousSibling;\n        if (lyrInfo.type === 'ClusterLayer' && lyrInfo.visible || lyrInfo.type !== 'ClusterLayer') {\n          this.updateExpand(updateNode, visScaleRange ? features.length === 0 : true);\n        }\n      }\n      if (countOnly) {\n        return;\n      }\n\n      if (!lyrInfo.listDisabled && !lyrInfo.isLoaded) {\n        if (features.length > 0) {\n          var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.id);\n\n          var renderer = lyrInfo.type === \"ClusterLayer\" ? lyrInfo.layerObject.renderer : jimuLayerInfo && jimuLayerInfo.layerObject && jimuLayerInfo.layerObject.renderer ? jimuLayerInfo.layerObject.renderer : features[0]._graphicsLayer ? features[0]._graphicsLayer.renderer : lyrInfo.layerObject && lyrInfo.layerObject.renderer ? lyrInfo.layerObject.renderer : li && li.renderer ? jsonUtil.fromJson(li.renderer) || li.renderer : lyrInfo.renderer ? jsonUtil.fromJson(lyrInfo.renderer) || lyrInfo.renderer : undefined;\n          var _fields = lyrInfo.li && lyrInfo.li.fields ? lyrInfo.li.fields : lyrInfo.fields;\n\n          var groupNodes = [];\n          var finalGroupNodes = [];\n          var finalDomNodes = [];\n          for (var i = 0; i < features.length; i++) {\n            var groupAdded = false;\n            var feature = features[i];\n            if (typeof feature.infoTemplate === 'undefined' && infoTemplate) {\n              feature.infoTemplate = infoTemplate;\n            }\n\n            var symbol = renderer && renderer.getSymbol ? renderer.getSymbol(feature) : feature.symbol ? jsonUtils.fromJson(feature.symbol) : undefined;\n\n            var oidName = feature._layer && feature._layer.objectIdField ? feature._layer.objectIdField : li && li.oidFieldName && li.oidFieldName.name ? li.oidFieldName.name : lyrInfo.layerObject && lyrInfo.layerObject.objectIdField ? lyrInfo.layerObject.objectIdField : lyrInfo && lyrInfo.oidFieldName ? lyrInfo.oidFieldName : undefined;\n\n            var id = oidName ? feature.attributes[oidName] : legendNode.id + i;\n\n            var flds = fields[0] === '*' ? feature.attributes : fields;\n            var isNames = fields[0] === '*' ? false : true;\n\n            var displayStringObj = this.getDisplayString(feature, lyrInfo, flds, displayOptions, oidName, isNames);\n            var displayString = displayStringObj.displayString;\n            var aliasNames = displayStringObj.aliasNames;\n            var firstValue = displayStringObj.firstValue;\n            var groupField, groupNode, groupContainer, displayValue, groupType;\n            if (displayOptions.groupEnabled) {\n              var featureValue;\n              var _value;\n              var appendVal = undefined; // jshint ignore:line\n              if (typeof displayOptions.groupByField === 'undefined' || displayOptions.groupByField) {\n                groupField = displayOptions.groupField;\n                featureValue = feature.attributes[groupField.name];\n                groupType = 'byField';\n                appendVal = featureValue;\n              } else {\n                groupField = displayOptions.groupByRendererOptions.fields[0];\n                featureValue = feature.attributes[groupField.name];\n                var groubByFields = displayOptions.groupByRendererOptions.fields;\n                var groupByValues = displayOptions.groupByRendererOptions.values;\n                groupType = 'byRenderer';\n\n                if (featureValue !== null && featureValue !== \"\") {\n                  expression_loop: for (var ii = 0; ii < groupByValues.length; ii++) {\n                    var _val = groupByValues[ii];\n                    var exp = _val.value;\n                    var expParts = exp.split(\"&&\");\n                    if (expParts && expParts.length > 1) {\n                      exp = featureValue + expParts[0] + \"&& \" + featureValue + expParts[1];\n                    } else {\n                      exp = isNaN(featureValue) ? \"'\" + featureValue + \"'\" + _val.value : featureValue + _val.value;\n                    }\n                    if (eval(exp)) {\n                      // jshint ignore:line\n                      _value = _val;\n                      break expression_loop;\n                    }\n                  }\n                  if (typeof _value !== 'undefined' && _value !== null) {\n                    appendVal = _value.label.replace(/ /g, '');\n                  }\n                }\n              }\n              var gId = 'group_' + li.id + \"_\" + groupField.name + \"_\" + appendVal;\n              var addGroup = true;\n              var n;\n              if (groupNodes.length > 0) {\n                node_loop: for (var iii = 0; iii < groupNodes.length; iii++) {\n                  var gNode = groupNodes[iii];\n                  if (gId === gNode.id) {\n                    if (groupType === 'byField' && featureValue === gNode.value || groupType === 'byRenderer') {\n                      addGroup = false;\n                      n = gNode.node;\n                      groupContainer = gNode.parent;\n                      break node_loop;\n                    }\n                  }\n                }\n              }\n              if (addGroup) {\n                groupAdded = true;\n                groupContainer = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupItem-dart' : 'groupItem',\n                  id: gId + \"_c\"\n                });\n                var groupTitle = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupItemTitle-dart' : 'groupItemTitle',\n                  id: gId + \"_t\"\n                }, groupContainer);\n                var label = \"\";\n                var title = groupType === 'byRenderer' ? \"\" : groupField.name + \": \";\n                if (typeof aliasNames !== 'undefined') {\n                  if (aliasNames.hasOwnProperty(groupField.name) && aliasNames[groupField.name] !== '') {\n                    if (groupType === 'byField') {\n                      title = aliasNames[groupField.name] + \": \";\n                    } else {\n                      title = \"\";\n                    }\n                  }\n                }\n                if (groupType === 'byField') {\n                  if (typeof groupField.label !== 'undefined' && groupField.label !== \"\") {\n                    label = groupField.label + \": \";\n                    title = label;\n                  }\n                  if (label === \": \") {\n                    label = \"\";\n                    title = \"\";\n                  }\n                } else {\n                  if (typeof _value !== 'undefined') {\n                    if (typeof _value.label !== 'undefined' && _value.label !== \"\") {\n                      label = title + _value.label;\n                      title = label;\n                    }\n                  } else {\n                    label = title + featureValue;\n                    title = label;\n                  }\n                  if (label === \": \") {\n                    label = \"\";\n                    title = \"\";\n                  }\n                }\n\n                displayValue = this._getFormattedValue(feature, groupField.name, lyrInfo, _fields);\n\n                if (groupType === 'byRenderer' && symbol) {\n                  this._createImageDataDiv(lang.clone(symbol), 30, 30, groupTitle, isCustom);\n                }\n\n                domConstruct.create('div', {\n                  'class': groupType === 'byField' ? 'groupField' : 'groupFieldImage',\n                  innerHTML: groupType === 'byField' ? label + displayValue : label,\n                  title: groupType === 'byField' ? title + displayValue : title\n                }, groupTitle);\n\n                var inGrpList = false;\n                if (lyrInfo.openGroups && lyrInfo.openGroups.length > 0) {\n                  inGrpList = lyrInfo.openGroups.indexOf(gId) > -1;\n                }\n                var _append = this.isDartTheme ? ' darkThemeColor' : ' lightThemeColor';\n                var groupCountNode = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupCountLabel' : 'groupCountLabel' + _append\n                }, groupTitle);\n\n                var imageContainer = domConstruct.create('div', {\n                  'class': this.isDartTheme || this.isDashboardTheme && !this.isLightTheme ? 'expandImageContainer-dart' : 'expandImageContainer'\n                }, groupTitle);\n\n                var gIIUp = this.isDartTheme ? \"groupItemImageUp-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageUp-dashboard\" : \"groupItemImageUp\";\n                var gIIDown = this.isDartTheme ? \"groupItemImageDown-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageDown-dashboard\" : \"groupItemImageDown\";\n                var cNames = this.isDartTheme ? 'groupItemImage-dart' : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImage-dashboard\" : 'groupItemImage';\n                cNames += inGrpList ? ' ' + gIIUp : ' ' + gIIDown;\n                domConstruct.create('div', {\n                  'class': cNames\n                }, imageContainer);\n\n                cNames = this.isDartTheme ? 'groupItem-dart' : 'groupItem';\n                cNames += lyrInfo.groupOpen && inGrpList ? ' groupOn' : ' groupOff';\n                groupNode = domConstruct.create('div', {\n                  'class': cNames,\n                  id: gId\n                }, groupContainer);\n\n                groupNodes.push({\n                  id: 'group_' + li.id + \"_\" + groupField.name + \"_\" + appendVal,\n                  node: groupNode,\n                  parent: groupContainer,\n                  value: featureValue\n                });\n\n                finalGroupNodes.push({\n                  value: featureValue,\n                  node: groupContainer,\n                  countNode: groupCountNode,\n                  count: 1\n                });\n\n                on(groupContainer, \"click\", lang.hitch(this, this._toggleGroup, lyrInfo));\n              } else {\n                var result = finalGroupNodes.filter(function (o) {\n                  if (o.node.id === n.id + \"_c\") {\n                    return o;\n                  }\n                });\n\n                result[0].count += 1;\n                groupNode = n;\n              }\n            }\n            var featureItem = domConstruct.create('div', {\n              'class': this.isDartTheme ? 'featureItem-dart' : 'featureItem',\n              id: 'feature_' + li.id + \"_\" + id\n            });\n\n            var isCustom = false;\n            if (li && li.symbolData) {\n              isCustom = li.symbolData.symbolType === \"CustomSymbol\";\n            }\n            if (symbol) {\n              if (displayOptions.groupEnabled && groupType === 'byRenderer') {\n                //this._createImageDataDiv(lang.clone(symbol), 30, 30, groupTitle, isCustom);\n              } else {\n                this._createImageDataDiv(lang.clone(symbol), 30, 30, featureItem, isCustom);\n              }\n            }\n\n            on(featureItem, \"click\", lang.hitch(this, this._panToFeature, feature));\n\n            if (displayString.indexOf(\" - \") > -1) {\n              displayString = displayString.slice(0, -3);\n            }\n            var _margin = displayOptions.groupEnabled && groupType === 'byRenderer' ? \"15px\" : \"50px\";\n            var _txtAlign = window.isRTL ? \"right\" : \"left\";\n            domConstruct.create('div', {\n              style: \"padding: 7px 5px 5px \" + _margin + \"; text-align: \" + _txtAlign + \";\",\n              innerHTML: displayString,\n              title: displayString\n            }, featureItem);\n\n            finalDomNodes.push({\n              node: featureItem,\n              updateNode: groupNode ? groupNode : legendNode,\n              firstValue: firstValue\n            });\n          }\n\n          if (finalGroupNodes.length > 0) {\n            //sort and place at legendNode\n            var nodes = finalGroupNodes.sort(function (a, b) {\n              if (typeof a.value === 'undefined') {\n                return b.value;\n              } else if (typeof b.value === 'undefined') {\n                return a.value;\n              }\n              if (isNaN(a.value)) {\n                return a.value.localeCompare(b.value);\n              } else {\n                return parseFloat(a.value) - parseFloat(b.value);\n              }\n            });\n            var cE = this.config.countEnabled;\n            array.forEach(nodes, function (n) {\n              if (cE) {\n                n.countNode.innerHTML = utils.localizeNumber(n.count);\n              }\n              legendNode.appendChild(n.node);\n            });\n          }\n\n          if (finalDomNodes.length > 0) {\n            var sortedNodes = finalDomNodes.sort(function (a, b) {\n              var _a = a.firstValue;\n              var _b = b.firstValue;\n              if (typeof _a === 'undefined' || _a === null || _a === \"\") {\n                return 1;\n              } else if (typeof _b === 'undefined' || _b === null || _b === \"\") {\n                return -1;\n              } else if (_a === _b) {\n                return 0;\n              }\n              return _a.toString().localeCompare(_b.toString());\n            });\n            array.forEach(sortedNodes, function (fdn) {\n              domConstruct.place(fdn.node, fdn.updateNode);\n            });\n          }\n        }\n      }\n      li.layerListExtentChanged = false;\n\n      var s_id = lyrInfo.layerObject && lyrInfo.layerObject.id && lyrInfo.layerObject.id in this.layerList ? lyrInfo.layerObject.id : li.id;\n      if (this.showAllFeatures && lyrInfo.visible) {\n        var loaded = true;\n        if (lyrInfo.layerObject && lyrInfo.type === 'ClusterLayer') {\n          loaded = !lyrInfo.layerObject.queryPending;\n          if (lyrInfo.layerObject.hasOwnProperty('requiresReload')) {\n            loaded = loaded && !lyrInfo.layerObject.requiresReload;\n            lyrInfo.layerObject.requiresReload = false;\n          }\n        }\n        lyrInfo.isLoaded = loaded;\n      }\n\n      this._removeSearching(s_id, lyrInfo.legendOpen);\n    },\n\n    updateExpand: function updateExpand(node, hide) {\n      if (typeof node !== 'undefined') {\n        var id;\n        var en;\n        if (node.id.indexOf('rec_') > -1) {\n          id = node.id.replace('rec_', '');\n          en = dom.byId(\"exp_\" + id);\n        }\n\n        if (hide) {\n          if (node) {\n            html.addClass(node, \"recDefault\");\n            html.addClass(node, \"inActive\");\n          }\n          if (en) {\n            if (!domClass.contains(en, 'expand-empty')) {\n              html.addClass(en, \"expandInActive\");\n            }\n          }\n        } else {\n          if (node) {\n            html.removeClass(node, \"recDefault\");\n            html.removeClass(node, \"inActive\");\n          }\n          if (en) {\n            if (!domClass.contains(en, 'expand-empty')) {\n              html.removeClass(en, \"expandInActive\");\n            }\n          }\n        }\n      }\n    },\n\n    getDisplayString: function getDisplayString(feature, lyrInfo, fields, displayOptions, oidName, isNames) {\n      var displayString = \"\";\n      var aliasNames = {};\n      var firstValue = \"\";\n      if (displayOptions.fields.length > 0) {\n        //get the layer fields\n        var _fields = lyrInfo.li && lyrInfo.li.fields ? lyrInfo.li.fields : lyrInfo.fields;\n        array.forEach(displayOptions.fields, lang.hitch(this, function (displayField) {\n          for (var a in fields) {\n            var fieldName = isNames ? fields[a] : a;\n            if (fieldName === displayField.name) {\n\n              //get the value with proper formatting\n              var featureValue = this._getFormattedValue(feature, fieldName, lyrInfo, _fields);\n              //set the alias name\n              aliasNames[fieldName] = this._checkAliasName(_fields, fieldName);\n\n              firstValue = firstValue === \"\" ? featureValue : firstValue;\n              var hasLabel = typeof displayField.label !== 'undefined';\n              var append = hasLabel ? displayField.label.trim() === \"\" ? \"\" : \": \" : \"\";\n              var label = hasLabel ? displayField.label : \"\";\n\n              displayString += label + append + featureValue + \" - \";\n              break;\n            }\n          }\n        }));\n      }\n      return {\n        displayString: displayString,\n        aliasNames: aliasNames,\n        firstValue: firstValue\n      };\n    },\n\n    _getFormattedValue: function _getFormattedValue(feature, fieldName, lyrInfo, fields) {\n      //get raw feature value\n      var featureValue = feature.attributes[fieldName] || \"\";\n\n      //get the fieldInfos\n      var fieldInfos;\n      var infoTemplate = this._getInfoTemplate(lyrInfo);\n      if (infoTemplate) {\n        if (infoTemplate.info && infoTemplate.info.fieldInfos) {\n          fieldInfos = infoTemplate.info.fieldInfos;\n        } else if (infoTemplate._fieldsMap) {\n          fieldInfos = infoTemplate._fieldsMap;\n        }\n      }\n      //get fieldInfo and field\n      var fieldInfo;\n      if (fieldInfos && Array.isArray(fieldInfos) && fieldInfos.hasOwnProperty('length')) {\n        fieldInfo = this._getFieldByName(fieldInfos, fieldName);\n      }\n      var field = this._getFieldByName(fields, fieldName);\n      if (field) {\n        var intField = this._checkIntField(field);\n        var domainField = this._checkDomainField(field);\n        var dateField = this._checkDateField(field);\n\n        featureValue = dateField ? this.formatDateValue(featureValue, fieldInfo) : domainField ? this.formatDomainValue(featureValue, domainField) : intField ? this.formatNumberValue(featureValue, fieldInfo) : featureValue;\n      }\n      return featureValue;\n    },\n\n    _getFieldByName: function _getFieldByName(fields, fieldName) {\n      if (fields) {\n        var _fields = fields.filter(function (f) {\n          return f.name === fieldName || f.fieldName === fieldName || fields.hasOwnProperty(f) && fields[f].fieldName === fieldName;\n        });\n        if (_fields && _fields.length > 0) {\n          return _fields[0];\n        }\n      }\n      return undefined;\n    },\n\n    _getInfoTemplate: function _getInfoTemplate(lyrInfo) {\n      var infoTemplate = lyrInfo.infoTemplate;\n      if (!infoTemplate) {\n        if (lyrInfo.layerObject && lyrInfo.layerObject.infoTemplate) {\n          infoTemplate = lyrInfo.layerObject.infoTemplate;\n        } else if (lyrInfo.li && lyrInfo.li.infoTemplate) {\n          infoTemplate = lyrInfo.li.infoTemplate;\n        }\n      }\n      if (!infoTemplate) {\n        if (typeof lyrInfo.li.subLayerId !== 'undefined') {\n          var infoTemplates = lyrInfo.layerObject.infoTemplates;\n          if (infoTemplates && infoTemplates.hasOwnProperty(lyrInfo.li.subLayerId)) {\n            infoTemplate = infoTemplates[lyrInfo.li.subLayerId].infoTemplate;\n          }\n        }\n      }\n      return infoTemplate;\n    },\n\n    formatNumberValue: function formatNumberValue(v, fieldInfo) {\n      var num = v;\n      if (!isNaN(v)) {\n        var options = fieldInfo && fieldInfo.format ? fieldInfo : undefined;\n        num = utils.localizeNumberByFieldInfo(v, options);\n      }\n      return num || \"\";\n    },\n\n    formatDomainValue: function formatDomainValue(v, domain) {\n      if (domain && domain.codedValues) {\n        var cvs = domain.codedValues;\n        for (var i = 0; i < cvs.length; i++) {\n          var cv = cvs[i];\n          if (cv.code === v) {\n            return cv.name;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    formatDateValue: function formatDateValue(v, fieldInfo) {\n      if (v) {\n        var options = fieldInfo && fieldInfo.format ? fieldInfo : undefined;\n        var d = new Date(parseInt(v, 10));\n        return options ? utils.localizeDateByFieldInfo(d, options) : utils.localizeDate(d);\n      } else {\n        return \"\";\n      }\n    },\n\n    _checkAliasName: function _checkAliasName(field) {\n      return typeof field.alias !== 'undefined' ? field.alias : false;\n    },\n\n    _checkDomainField: function _checkDomainField(field) {\n      return typeof field.domain !== 'undefined' ? field.domain : false;\n    },\n\n    _checkDateField: function _checkDateField(field) {\n      return field.type === 'esriFieldTypeDate';\n    },\n\n    _checkIntField: function _checkIntField(field) {\n      var testTypes = ['esriFieldTypeSmallInteger', 'esriFieldTypeInteger', 'esriFieldTypeSingle', 'esriFieldTypeDouble'];\n      return testTypes.indexOf(field.type) > -1;\n    },\n\n    _checkDisplayField: function _checkDisplayField(displayFields, featureField) {\n      var includeField = true;\n      if (displayFields) {\n        for (var j = 0; j < displayFields.length; j++) {\n          if (displayFields[j].name === featureField) {\n            return displayFields[j];\n          } else {\n            includeField = false;\n          }\n        }\n      }\n      return includeField;\n    },\n\n    flashGraphics: function flashGraphics(graphics) {\n      for (var i = 0; i < graphics.length; i++) {\n        var g = graphics[i];\n        this._flashFeature(g);\n      }\n    },\n\n    _flashFeature: function _flashFeature(feature) {\n      var symbol;\n      if (feature.geometry) {\n        var color = Color.fromHex(this._styleColor);\n        var color2 = lang.clone(color);\n        color2.a = 0.4;\n        switch (feature.geometry.type) {\n          case 'point':\n            symbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CIRCLE, 15, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 1), color2);\n            break;\n          case 'polyline':\n            symbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 3);\n            break;\n          case 'polygon':\n            symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_DIAGONAL_CROSS, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 2), color2);\n            break;\n        }\n      }\n\n      var g = new Graphic(feature.geometry, symbol);\n      this.map.graphics.add(g);\n      var dShape = g.getDojoShape();\n      if (dShape) {\n        fx.animateStroke({\n          shape: dShape,\n          duration: 900,\n          color: {\n            start: dShape.strokeStyle.color,\n            end: dShape.strokeStyle.color\n          },\n          width: {\n            start: 25,\n            end: 0\n          }\n        }).play();\n        setTimeout(this._clearFeature, 1075, g);\n      }\n    },\n\n    _clearFeature: function _clearFeature(f) {\n      var gl = f.getLayer();\n      gl.remove(f);\n    },\n\n    _panToFeature: function _panToFeature(feature) {\n      if (feature.geometry) {\n        var geom = feature.geometry;\n        if (geom.type === 'polyline') {\n          var path = geom.paths[Math.ceil(geom.paths.length / 2) - 1];\n          var g = path[Math.ceil((path.length - 1) / 2)];\n          geom = new Point(g[0], g[1], geom.spatialReference);\n        }\n        if (geom.type !== 'point') {\n          geom = geom.getExtent().getCenter();\n        }\n        this._pan(feature, geom).then(lang.hitch(this, function () {\n          this._flashFeature(feature);\n          if (feature._layer && feature._layer.infoTemplate || feature.infoTemplate) {\n            this.map.infoWindow.setFeatures([feature]);\n            this.map.infoWindow.select(0);\n            this.map.infoWindow.show(geom);\n          }\n        }));\n      }\n    },\n\n    _pan: function _pan(feature, centerPoint) {\n      var def = new Deferred();\n      if (this.showAllFeatures && !this.map.extent.contains(feature.geometry)) {\n        this.map.centerAt(centerPoint).then(function (ext) {\n          def.resolve(ext);\n        });\n      } else {\n        def.resolve(undefined);\n      }\n      return def;\n    },\n\n    _getQuery: function _getQuery(layerListLayer, fields, needsGeom) {\n      var layerObject = layerListLayer.layerObject;\n      var q = new Query();\n      q.geometry = !this.showAllFeatures ? this.map.extent : null;\n      q.outFields = fields;\n      q.returnGeometry = needsGeom;\n      var collectionTypes = ['collection', 'kml', 'geo_rss'];\n      var isCollection = layerListLayer.selfType ? collectionTypes.indexOf(layerListLayer.selfType) > -1 : false;\n      //layer types from feature collection don't support where\n      if (!isCollection && layerObject.url) {\n        q.where = layerListLayer.filter ? layerListLayer.filter : \"1=1\";\n      } else if (this.showAllFeatures && layerObject && layerObject.fullExtent) {\n        //still need a way to support showing of all features\n        q.geometry = layerObject.fullExtent;\n      }\n      return q;\n    },\n\n    countFeatures: function countFeatures(layerListLayer) {\n      if (!this.hidePanel) {\n        var lyr = layerListLayer.layerObject;\n        var visible = typeof layerListLayer.visible !== 'undefined' ? layerListLayer.visible : lyr.visible;\n        var visScaleRange = layerListLayer.visScaleRange;\n        var node = this.config.countEnabled ? layerListLayer.node : layerListLayer.legendNode;\n        var q = this._getQuery(layerListLayer);\n        if (lyr.queryCount && lyr.visible) {\n          lyr.queryCount(q, lang.hitch(this, function (r) {\n            if (node) {\n              var updateNode;\n              if (this.config.countEnabled) {\n                node.innerHTML = utils.localizeNumber(r);\n                updateNode = node.parentNode;\n              } else {\n                updateNode = node.previousSibling;\n              }\n              this.updateExpand(updateNode, visScaleRange ? r === 0 : true);\n            }\n          }));\n        } else if (layerListLayer && layerListLayer.li && layerListLayer.li.url && visible) {\n          var url = layerListLayer.li.url;\n          if (url.indexOf(\"MapServer\") > -1 || url.indexOf(\"FeatureServer\") > -1) {\n            var qt = new QueryTask(url);\n            qt.executeForIds(q).then(lang.hitch(this, function (ids) {\n              if (node) {\n                var updateNode;\n                var length = ids ? ids.length : 0;\n                if (this.config.countEnabled) {\n                  node.innerHTML = utils.localizeNumber(length);\n                  updateNode = node.parentNode;\n                } else {\n                  updateNode = node.previousSibling;\n                }\n                this.updateExpand(updateNode, visScaleRange ? length === 0 : true);\n              }\n            }));\n          }\n        }\n      }\n    }\n  });\n});\n//# sourceMappingURL=Widget.js.map\n"]}
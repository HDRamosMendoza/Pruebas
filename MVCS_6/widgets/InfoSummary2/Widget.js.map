{"version":3,"sources":["../../../widgets/InfoSummary2/Widget.js"],"names":["define","BaseWidget","LayerInfos","utils","dom","domClass","domConstruct","on","domStyle","declare","lang","html","dojoColor","all","array","DeferredList","Deferred","query","fx","gfx","xhr","_WidgetsInTemplateMixin","_TemplatedMixin","Message","Graphic","Point","FeatureLayer","SimpleMarkerSymbol","PictureMarkerSymbol","SimpleLineSymbol","SimpleFillSymbol","Color","Query","QueryTask","FeatureSet","arcgisUtils","jsonUtils","esriRequest","SimpleRenderer","jsonUtil","ClusterLayer","LayerDrawingOptions","baseClass","name","opLayerInfos","layerList","UNIQUE_APPEND_VAL_CL","widgetChange","refreshInterval","refreshIntervalValue","configLayerInfos","legendNodes","currentQueryList","symbols","row","layersMap","departamento","provincia","distrito","resulta","selectedColor","listLayer","urlDepartamento","urlProvincia","urlDistrito","legendDepartamento","legendDepartamentoLineBorder","legendDepartamentoLineSize","legendDepartamentoBackground","legendProvincia","legendProvinciaLineBorder","legendProvinciaLineSize","legendProvinciaBackground","legendDistrito","legendDistritoLineBorder","legendDistritoLineSize","legendDistritoBackground","queryDepartamento","queryTaskDepartamento","featureLayerDepartamento","queryProvincia","queryTaskProvincia","featureLayerProvincia","queryDistrito","queryTaskDistrito","featureLayerDistrito","_getAllLayers","getInstance","map","itemInfo","then","hitch","layerInfosObj","error","console","message","_lineColor","color","_fillLineColor","fill1","line1","colorLine","sizeLine","colorBackground","_settingDepartamento","url","lineBorder","lineColor","lineSize","window","paramDepartamento","id","outFields","mode","MODE_SELECTION","showLabels","returnGeometry","OBJECTID","IDDEPARTAMENTO","NAME_DEPARTAMENTO","setScaleRange","setRenderer","setObject","addLayer","_settingProvincia","paramProvincia","orderByFields","IDPROVINCIA","NAME_PROVINCIA","_settingDistrito","paramDistrito","IDDISTRITO","NAME_DISTRITO","_clearNodes","item","i","length","nodeName","style","log","_reseatParam","_countProject","queryString","resultLayer","substring","trim","forEach","getLayer","element","setDefinitionExpression","show","_onFocus","NombreLimite","focus","_loadNoneGeneralLimite","LoadGeneral","display","ID_General","_loadBlockGeneralLimite","_tableResult","paramNumber","_nameSelected","thisValue","parentNode","childNodes","innerText","_zoomDistrito","objectId","objectIds","selectFeatures","SELECTION_NEW","features","setExtent","geometry","getExtent","expand","bind","_onClickDistrito","event","target","attributes","value","_errorDistrito","tagHtml","push","clearSelection","CboDistrito","innerHTML","join","_callDistrito","featuresLength","featureAttributes","_zoomProvincia","_onClickProvincia","where","execute","document","getElementById","disabled","click","_errorProvincia","CboProvincia","_callProvincia","_zoomDepartamento","erro","_onClickDepartamento","nameDepartamento","_errorDepartamento","_stringToHTML","str","doc","DOMParser","parser","parseFromString","body","_callDepartamento","CboDepartamento","_clearSelection","_onClickLimpiarAmbito","_initialExtent","_onClickZoomGeneral","nameLimite","dataLimite","dataName","dataObjectId","_onChangeLimitePolitico","e","LimitePolitico_Selected","LimitePolitico","options","selectedIndex","_callGeneralDistrito","inName","counter","r","_callGeneralProvincia","_callGeneralDepartamento","_onClickBuscarLugar","param","limitePolitico","limiteTodo","toUpperCase","titleLabel","_onClickLimpiarLugar","_activeTabSearch","positionTab","tabs4","querySelectorAll","tabsContent4","deactvateAllTabs","tab","classList","remove","hideTabsContent","tabContent","activateTabsContent","getIndex","add","el","parentElement","children","indexOf","currentValue","index","addEventListener","_getPanel","paramWidget","paramHeight","panel","getPanel","pos","position","left","top","width","height","setPosition","_onLoadDepartamento","postCreate","inherited","arguments","config","leyendDepartamento","legendDepartamentoBorder","leyendDepartamentoLineBorder","leyendDepartamentoLineSize","leyendDepartamentoBackground","leyendProvincia","leyendProvinciaLineBorder","leyendProvinciaLineSize","leyendProvinciaBackground","leyendDistrito","leyendDistritoLineBorder","leyendDistritoLineSize","leyendDistritoBackground","inPanelOverrides","appConfig","theme","layerInfos","parseFloat","_initWidget","_forceClose","themeName","dcThemes","p","containerNode","widgetManager","closeWidget","getParent","_toggleBox","ss","outerHTML","aw","widgets","widgetOnScreen","ii","isThemeWidget","getWidgetById","_switchNodeToClose","_closeDropMenu","iconClickHandler","undefined","hidePanel","iconNodeThemes","iconNodes","firstChild","className","padding","_updateBackgroundColors","isDartTheme","isDashboardTheme","contains","pageHeader","updateForDartTheme","updateForBoxTheme","updateForTabTheme","updateForLaunchpadTheme","updateForBillboardTheme","updateForPlateauTheme","updateForDashboardTheme","fc","isOnScreen","right","lastUpdated","useDarkText","startup","showAllFeatures","mapExtentChangedHandler","_mapExtentChange","resize","onOpen","_updatePanelHeader","styles","_updateStyleColor","visibleSubLayers","key","layerListLayer","li","lo","layerObject","orgRenderer","newRenderer","setLayerDrawingOptions","optionsArray","drawingOptions","renderer","subLayerId","refresh","_Pl","parentLayerID","l","visibleLayers","_foundIt","sub_layers_id_loop","subVizLyrId","layers","x","subLayerLoop","o","visLayers","inVisLayers","plVis","parentLayerVisible","loPlVis","type","visible","splice","graphicsLayerIds","setVisibility","updatePanelVisibility","_parentLayer","expandList","legendOpen","isLoaded","visScaleRange","_inVisibleRange","updateList","parentLayer","setVisibleLayers","refreshEnabled","enableRefresh","infoWindow","highlight","c","byId","countEnabled","listDisabled","toggleLegend","checkedTime","itemId","getItem","tempVal","setInterval","refreshLayers","clearInterval","portalUrl","substr","content","f","requestTime","Date","now","response","itemModified","modified","update","lastModifiedTime","_updatePanelTime","_updateItem","modifiedTime","_d","_f","dateFormat","fieldFormatter","getFormattedDate","lyr","featureCollection","_updateLayerItem","responseLayer","list","fields","k","pl","layerDefinition","symbolData","featureDisplayOptions","refreshFeatures","_loadList","featureSet","graphics","responseFeatureSetFeatures","mapFeatureSetFeatures","responseSR","_getSpatialReference","mapSR","gra","g","geom","rings","paths","points","y","mixin","spatialReference","wkid","transform","fs","shouldUpdate","JSON","stringify","requiresReload","layerListExtentChanged","clear","sr","j","go","getGraphicOptions","setAttributes","_infoTemplate","setInfoTemplate","countFeatures","hasOwnProperty","firstFeature","graphicOptions","operLayerInfos","wmLayerInfos","getLayerInfoArrayOfWebmap","getLayerInfoArray","_updateLayerIDs","upgradeFields","_upgradeFields","_createPanelUI","_addFilterChanged","_addVisibleChanged","_addZoomChanged","removeIDs","getUrl","configLayer","jimuLayerInfo","config_layer_loop","getLayerInfoById","updated","wm_layer_loop","_opLayer","originOpLayer","originOperLayer","urlId","_compareURL","_compareItemID","subId","_compareSubId","layer","sort","a","b","opLayer","geomMatch","_compareGeom","fieldMatch","_compareFields","fcLayers","fcLayer","geometryType","matchingFields","filter","fn","configField","lyrInfo","oidFieldName","objectIdField","firstLayerFieldName","firstLayerFieldAlias","layerFields","layer_field_loop","_i","alias","keyFieldName","keyFieldAlias","infoTemplate","info","fieldInfos","getInfoTemplate","subLayers","getSubLayers","sub_layers_loop","sli","sl","title","popupFields","popup_field_loop","popupField","fieldName","label","wabVersion","own","changedLayerInfoArray","layerInfo","clId","getFilter","_initFeatures","_updateVisibility","vis","isShowInMap","_toggleLayerUI","changedLayerInfos","traversal","panelTitle","w","displayPanelIcon","removeClass","mainPanelText","addClass","pageBody","pageTitle","panelMainIcon","mainPanelIcon","jimuLayerInfos","numClusterLayers","_updateUI","_clearChildNodes","pageMain","updateEnd","clusterType","updateThemeClusterSymbol","getLayerType","layerType","getLayerObject","updateLayerList","_updateEnd","addMapLayers","results","lid","updating","sd","_styleColor","_rgb","fromHex","xx","evenOdd","rr","bb","gg","clusterSymbol","outline","removeOldClusterLayers","lInfos","deleteLayers","layer_info_loop","potentialNewClusterID","clusteringEnabled","dl","_dl","setTopLayerVisible","removeLayer","destroy","ids","Object","keys","reverse","lyrType","ll","selfType","_checkSelfType","_checkListDisabled","_getClusterLayer","parentLayerInfo","_lyr","empty","getFeatureLayers","featureLayers","fl","updateRenderer","_addPanelItem","_lo","symbolType","fromJson","symbol","_onRecNodeMouseover","rec","isLightTheme","_onRecNodeMouseout","potentialNewID","cssAry","create","expandClass","isInScale","setStyle","recIcon","panelImageData","toString","img","createElement","icon","src","_createImageDataDiv","set","recLabel","recNum","node","_addLegend","_updateNode","nodeCount","_toggleLayerVisibility","_toggleLegend","_class","legendNode","_getListFields","infoTemp","_getInfoTemplate","fieldInfo","displayOptions","field","groupField","updateCount","_addSearching","clusterFeatures","clusterGraphics","_features","z","clusterGraphic","setTimeout","_updateList","_removeSearching","getFeatures","eD","eU","eS","clusterLayer","n","configChange","_layers","reloadData","refreshData","countColor","_highLightColor","toDom","displayFeatureCount","_setupSymbols","sym","h","parent","isCustom","ar","setWidth","setHeight","size","setSize","mySurface","createSurface","descriptors","getShapeDescriptors","shape","createShape","defaultShape","setFill","fill","setStroke","stroke","applyTransform","dx","dy","styleName","removeDownClass","addDownClass","_updateNodes","removeUpClass","addUpClass","removeExpandClass","addExpandClass","removeGroupItemUpClass","addGroupItemUpClass","removeGroupItemDownClass","addGroupItemDownClass","removeGroupItemClass","addGroupItemClass","nodes","obj","stopPropagation","hide","hasSubLayerId","_vis","currentLayerInfo","handleMapExtentChange","levelChange","flashFeatures","visibility","visScalRange","isCurrentScaleInTheScaleRange","_append","evt","currentTarget","_toggleGroup","slice","fI","toggle","gII","gIIUp","gIIDown","lId","_idx","openGroups","groupOpen","idx","onAppConfigChanged","reason","changedData","_clearMap","bc","getComputedStyle","getPropertyValue","fromRgb","toHex","setStyleColor","_clear","continuousRefreshEnabled","_close","onClose","disableRefresh","hasChildNodes","removeChild","lastChild","visibleAtMapScale","queries","_clearList","groupEnabled","initalLoad","uNode","_needsGeom","maxRecordCount","q","_getQuery","queryFeatures","queryIds","qt","executeForIds","featurePromises","s_id","updateNode","previousSibling","_queries","queryIDs","count","_chunkRequest","fullFeatures","localizeNumber","updateExpand","IDs","max","needsGeom","def","queryList","queryResults","allFeatures","apply","resolve","countOnly","_graphicsLayer","_fields","groupNodes","finalGroupNodes","finalDomNodes","groupAdded","feature","getSymbol","oidName","_layer","flds","isNames","displayStringObj","getDisplayString","displayString","aliasNames","firstValue","groupNode","groupContainer","displayValue","groupType","featureValue","_value","appendVal","groupByField","groupByRendererOptions","groubByFields","groupByValues","values","expression_loop","_val","exp","expParts","split","isNaN","eval","replace","gId","addGroup","node_loop","iii","gNode","groupTitle","_getFormattedValue","clone","inGrpList","groupCountNode","imageContainer","cNames","countNode","result","featureItem","_panToFeature","_margin","_txtAlign","isRTL","localeCompare","cE","appendChild","sortedNodes","_a","_b","fdn","place","loaded","queryPending","en","displayField","_checkAliasName","hasLabel","append","_fieldsMap","Array","isArray","_getFieldByName","intField","_checkIntField","domainField","_checkDomainField","dateField","_checkDateField","formatDateValue","formatDomainValue","formatNumberValue","infoTemplates","v","num","format","localizeNumberByFieldInfo","domain","codedValues","cvs","cv","code","d","parseInt","localizeDateByFieldInfo","localizeDate","testTypes","_checkDisplayField","displayFields","featureField","includeField","flashGraphics","_flashFeature","color2","STYLE_CIRCLE","STYLE_SOLID","STYLE_DIAGONAL_CROSS","dShape","getDojoShape","animateStroke","duration","start","strokeStyle","end","play","_clearFeature","gl","path","Math","ceil","getCenter","_pan","setFeatures","select","centerPoint","extent","centerAt","ext","collectionTypes","isCollection","fullExtent","queryCount"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright © 2014 - 2018 Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n/*jshint loopfunc: true */\ndefine([\n  'jimu/BaseWidget',\n  'jimu/LayerInfos/LayerInfos',\n  'jimu/utils',\n  'dojo/dom',\n  'dojo/dom-class',\n  'dojo/dom-construct',\n  'dojo/on',\n  'dojo/dom-style',\n  'dojo/_base/declare',\n  'dojo/_base/lang',\n  'dojo/_base/html',\n  'dojo/_base/Color',\n  'dojo/promise/all',\n  'dojo/_base/array',\n  'dojo/DeferredList',\n  'dojo/Deferred',\n  'dojo/query',\n  \"dojox/gfx/fx\",\n  'dojox/gfx',\n  'dojo/_base/xhr',\n  'dijit/_WidgetsInTemplateMixin',\n  'dijit/_TemplatedMixin',\n  'jimu/dijit/Message',\n  'esri/graphic',\n  'esri/geometry/Point',\n  'esri/layers/FeatureLayer',/**/\n  'esri/symbols/SimpleMarkerSymbol',\n  'esri/symbols/PictureMarkerSymbol',\n  'esri/symbols/SimpleLineSymbol',\n  'esri/symbols/SimpleFillSymbol',\n  'esri/Color',\n  'esri/tasks/query',\n  'esri/tasks/QueryTask',\n  \"esri/tasks/FeatureSet\",\n  \"esri/arcgis/utils\",\n  'esri/symbols/jsonUtils',\n  'esri/request',\n  \"esri/renderers/SimpleRenderer\",\n  \"esri/renderers/jsonUtils\",\n  './js/ClusterLayer', 'esri/layers/LayerDrawingOptions'\n  ], \n  function (\n    BaseWidget,\n    LayerInfos,\n    utils,\n    dom,\n    domClass,\n    domConstruct,\n    on,\n    domStyle,\n    declare,\n    lang,\n    html,\n    dojoColor,\n    all,\n    array,\n    DeferredList,\n    Deferred,\n    query,\n    fx,\n    gfx,\n    xhr,\n    _WidgetsInTemplateMixin,\n    _TemplatedMixin,\n    Message,\n    Graphic,\n    Point,\n    FeatureLayer,/**/\n    SimpleMarkerSymbol,\n    PictureMarkerSymbol,\n    SimpleLineSymbol,\n    SimpleFillSymbol,\n    Color,\n    Query,\n    QueryTask,\n    FeatureSet,\n    arcgisUtils,\n    jsonUtils,\n    esriRequest,\n    SimpleRenderer,\n    jsonUtil,\n    ClusterLayer,\n    LayerDrawingOptions\n  ) {\n  return declare([BaseWidget, _WidgetsInTemplateMixin], {\n    baseClass: 'jimu-widget-InfoSummary',\n\n    name: \"InfoSummary2\",\n    opLayerInfos: null,\n    layerList: {},\n    UNIQUE_APPEND_VAL_CL: \"_CL\",\n    widgetChange: false,\n    refreshInterval: 0,\n    refreshIntervalValue: 0,\n    configLayerInfos: [],\n    legendNodes: [],\n    currentQueryList: [],\n    symbols: [],\n    row: null,\n    layersMap: null,\n    \n    // FIELD Departamento\n    departamento: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dpto\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\"\n    },\n    // FIELD Provincia\n    provincia: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dpto\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\",\n      \"IDPROVINCIA\":\"id_prov\",\n      \"NAME_PROVINCIA\":\"nom_prov\",\n    },\n    // FIELD Distrito\n    distrito: {\n      \"OBJECTID\":\"objectid\",\n      \"IDDEPARTAMENTO\":\"id_dep\",\n      \"NAME_DEPARTAMENTO\":\"nom_dep\",\n      \"IDPROVINCIA\":\"id_prov\",\n      \"NAME_PROVINCIA\":\"nom_prov\",\n      \"IDDISTRITO\":\"id_dist\",\n      \"NAME_DISTRITO\":\"nom_dist\"\n    },\n//style=\"border: 2px solid ${config.colorLeyendDistrito};\"\n    resulta: 0,\n\n    selectedColor: \"#D6DDEB\",\n\n    listLayer: null,\n\n    urlDepartamento: null,\n    urlProvincia: null,\n    urlDistrito: null,\n\n    legendDepartamento: \"#D10202\",\n    legendDepartamentoLineBorder: \"dash\",\n    legendDepartamentoLineSize: 1.5,\n    legendDepartamentoBackground: [209,2,2,0],\n\n    legendProvincia: \"#FF0202\",\n    legendProvinciaLineBorder: \"dash\",\n    legendProvinciaLineSize: 1.5,\n    legendProvinciaBackground: [255,2,2,0],\n\n    legendDistrito: \"#FFD133\",\n    legendDistritoLineBorder: \"dash\",\n    legendDistritoLineSize: 1.5,\n    legendDistritoBackground: [255,249,51,0],\n    \n    // ************** DEPARTAMENTO //\n    // Query\n    queryDepartamento: new Query(),\n    // Query Task\n    queryTaskDepartamento: null,\n    // Feature Layer\n    featureLayerDepartamento: null,\n    // ************** DEPARTAMENTO //\n\n    // ************** PROVINCIA //\n    // Query\n    queryProvincia: new Query(),\n    // Query Task\n    queryTaskProvincia: null,\n    // Feature Layer\n    featureLayerProvincia: null,\n    // ************** PROVINCIA //\n\n    // ************** DISTRITO //\n    queryDistrito: new Query(),\n    // Query Task\n    queryTaskDistrito: null,\n    // Feature Layer\n    featureLayerDistrito: null,\n    // ************** DISTRITO //\n\n    // Lista de capas\n    _getAllLayers() {\n      try {\n          LayerInfos.getInstance(this.map, this.map.itemInfo)\n              .then(lang.hitch(this, function(layerInfosObj) { \n                  this.layersMap = layerInfosObj; \n              })\n          );\n      } catch (error) {\n          console.error(`Error: _getAllLayers ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Color de línea\n    _lineColor: function(color){\n      if(color == null){\n        return color;\n      }else{\n        return (color = new Color(color));\n      }\n    },\n\n    // Contornos de colores\n    _fillLineColor: function(fill1, line1, colorLine, sizeLine, colorBackground) {\n      return (\n        new SimpleRenderer(\n          new SimpleFillSymbol(\n            fill1, \n            new SimpleLineSymbol(\n              line1,this._lineColor(colorLine), sizeLine\n            ), \n            this._lineColor(colorBackground)\n          )\n        )\n      );\n    }, \n\n    /* Configurar departamentos */\n    _settingDepartamento: function(url, lineBorder, lineColor, lineSize, colorBackground) {\n      window.paramDepartamento = \"\";\n      // Query Task\n      this.queryTaskDepartamento = new QueryTask(url);\n      // Feature Layer\n      this.featureLayerDepartamento = new FeatureLayer(url, {\n          id:\"Departamento1\", outFields: [\"*\"],\n          mode: FeatureLayer.MODE_SELECTION,\n          showLabels: true\n        }\n      );\n      this.queryDepartamento.returnGeometry = true;\n      this.queryDepartamento.outFields = [\n        this.departamento.OBJECTID,\n        this.departamento.IDDEPARTAMENTO,\n        this.departamento.NAME_DEPARTAMENTO\n      ];      \n      this.featureLayerDepartamento.setScaleRange(0,0);\n      this.featureLayerDepartamento.setRenderer(\n        this._fillLineColor(\"solid\", lineBorder, lineColor, lineSize, colorBackground)\n      );\n      \n      // Se elimina de la lista de capas\n      lang.setObject(\"_wabProperties.isTemporaryLayer\", true, this.featureLayerDepartamento);\n      // Se adiciona al mapa\n      this.map.addLayer(this.featureLayerDepartamento);\n    },\n\n    /* Configurar provincias */\n    _settingProvincia: function(url, lineBorder, lineColor, lineSize, colorBackground) {\n      window.paramProvincia = \"\";\n      this.queryTaskProvincia = new QueryTask(url);\n      // Feature Layer\n      this.featureLayerProvincia = new FeatureLayer(url, {\n          id:\"Provincia1\", outFields: [\"OBJECTID\"],\n          mode: FeatureLayer.MODE_SELECTION,\n          showLabels: true\n        }\n      );\n      this.queryProvincia.orderByFields =  [\"nom_prov ASC\"];\n      this.queryProvincia.returnGeometry = true;\n      this.queryProvincia.outFields = [\n        this.provincia.OBJECTID,\n        this.provincia.IDDEPARTAMENTO,\n        this.provincia.NAME_DEPARTAMENTO,\n        this.provincia.IDPROVINCIA,\n        this.provincia.NAME_PROVINCIA,\n      ];\n      this.featureLayerProvincia.setScaleRange(0,0);\n      this.featureLayerProvincia.setRenderer(\n        this._fillLineColor(\"solid\", lineBorder, lineColor, lineSize, colorBackground)\n      );      \n      lang.setObject(\"_wabProperties.isTemporaryLayer\", true, this.featureLayerProvincia);\n      // Se adiciona al mapa\n      this.map.addLayer(this.featureLayerProvincia);\n    },\n\n    /* Configurar provincias */\n    _settingDistrito: function(url, lineBorder, lineColor, lineSize, colorBackground) {\n      window.paramDistrito = \"\";\n      // Query Task\n      this.queryTaskDistrito = new QueryTask(url);\n      // Feature Layer\n      this.featureLayerDistrito = new FeatureLayer(url, {\n          id:\"Distrito1\", outFields: [\"OBJECTID\"],\n          mode: FeatureLayer.MODE_SELECTION,\n          showLabels: true\n        }\n      );\n      this.queryDistrito.orderByFields =  [\"nom_dist ASC\"];\n      this.queryDistrito.returnGeometry = true;\n      this.queryDistrito.outFields = [\n        this.distrito.OBJECTID,\n        this.distrito.IDDEPARTAMENTO,\n        this.distrito.NAME_DEPARTAMENTO,\n        this.distrito.IDPROVINCIA,\n        this.distrito.NAME_PROVINCIA,\n        this.distrito.IDDISTRITO,\n        this.distrito.NAME_DISTRITO,\n      ];      \n      this.featureLayerDistrito.setScaleRange(0,0);      \n      this.featureLayerDistrito.setRenderer (\n        this._fillLineColor(\"solid\", lineBorder, lineColor, lineSize, colorBackground)\n      );\n      lang.setObject(\"_wabProperties.isTemporaryLayer\", true, this.featureLayerDistrito);\n      //Se adiciona al mapa\n      this.map.addLayer(this.featureLayerDistrito);\n    },\n   \n    // Limpia la selección del departamento\n    _clearNodes: function(item) {\n      try {\n        for(let i = 0; i<item.length; i++) {\n          if(item[i].nodeName == \"LI\") {\n            item[i].style[\"background-color\"] = \"#FFFFFF\";\n          }          \n        }\n      } catch (error) {\n        console.log(`Error: _clearNodes ${error.name} - ${error.message}`);\n      }\n    },\n\n    _reseatParam: function() {\n      window.paramDepartamento = \"\";\n      window.paramProvincia = \"\";\n      window.paramDistrito = \"\";\n    },\n\n    _countProject: function() {\n      let queryString = \"\", resultLayer;\n      try {\n        // QueryString\n        queryString += window.paramDepartamento == \"\" ? \"\" : `departamento = '${window.paramDepartamento}' AND `;\n        queryString += window.paramProvincia == \"\" ? \"\" : `provincia = '${window.paramProvincia}' AND `;\n        queryString += window.paramDistrito == \"\" ? \"\" : `distrito = '${window.paramDistrito}' AND`;\n        queryString = queryString.substring(0, queryString.length - 4);\n        // Valida si no tiene consultas se debe de llamar tosos los\n        queryString = queryString.trim().length == \"\"? \"1=1\": queryString;\n        /* Filtrado de capas */\n        this.listLayer.forEach(element => {\n          resultLayer = this.map.getLayer(element)\n          resultLayer.setDefinitionExpression(queryString);\n          resultLayer.show();\n        });\n        \n      } catch (error) {\n        console.log(`Error: _countProject ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onFocus: function() {\n      try {\n        this.NombreLimite.focus();\n      } catch (error) {\n        console.log(`Error: _onFocus ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Se oculta la muestra de la búsqueda general del límite\n    _loadNoneGeneralLimite: function(){\n      try {\n        this.LoadGeneral.style.display = \"none\";\n        this.ID_General.style.display = \"block\";\n      } catch (error) {\n        console.log(`Error: _loadNoneGeneralLimite ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Se muestra la búsqueda general del limite\n    _loadBlockGeneralLimite: function(){\n      try {\n        this.LoadGeneral.style.display = \"block\";\n        this.ID_General.style.display = \"none\";\n      } catch (error) {\n        console.log(`Error: _loadBlockGeneralLimite ${error.name} - ${error.message}`);\n      }\n    },\n\n    _tableResult: function(paramNumber) {\n      try {\n        if(paramNumber != null) {\n          this.resulta = this.resulta + paramNumber;\n          if(this.resulta == 3) {\n            this._loadNoneGeneralLimite();\n            this._tableResult(null);\n          }\n        } else {\n          this.resulta = 0;\n        }\n      } catch (error) {\n        console.log(\"Error: _tableResult \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    // Cambia el nombre del limite seleccionado\n    _nameSelected: function(thisValue, name) {\n      try {\n        thisValue\n            .parentNode\n            .parentNode\n              .childNodes[3]\n              .childNodes[3].innerText = name; \n      } catch (error) {\n        console.log(\"Error: _nameSelected \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _zoomDistrito: function (objectId) {\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerDistrito.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            this.map.setExtent(features[0].geometry.getExtent().expand(1.6));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onClickDistrito: function() {\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[\"data-distritoId\"].value != \"\") {\n          // Cambia el nombre del limite seleccionado\n          this._nameSelected(thisValue.parentNode, thisValue.innerText);\n          // Limpiar selección\n          this._clearNodes(thisValue.parentNode.childNodes);\n          // Pinta la selección\n          thisValue.style[\"background-color\"] = this.selectedColor;\n          // Asigna nombre de DISTRITO\n          window.paramDistrito = thisValue.innerText.trim();\n          this._zoomDistrito(thisValue.attributes[\"data-objectId\"].value);\n          // Contador de proyectos\n          this._countProject();\n        }\n      } catch (error) {\n        console.log(`Error: _onClickDistrito ${error.name} - ${error.message}`);\n      } \n    },\n\n    // Error - Select PROVINCIA\n    _errorDistrito: function(item) {\n      try {\n        let tagHtml = [];\n        tagHtml.push(`<li class=\"list-group-item\" \\\n          data-objectId=\"\" data-id=\"\">\\\n          Error al cargar\\\n        </li>`);\n        this.featureLayerDistrito.clearSelection();\n        this.CboDistrito.innerHTML = tagHtml.join(\"\");\n      } catch (error) {\n          console.log(`Error: _errorDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callDistrito: function(item) {\n      try {\n        let tagHtml = [];\n        if(item != null) { \n          featuresLength = item.features.length;\n          for(let i = 0; i < featuresLength; i++) {\n            featureAttributes = item.features[i].attributes;\n            tagHtml.push(`<li class=\"list-group-item\" \\\n              data-objectId=\"${featureAttributes[this.distrito.OBJECTID]}\" \\\n              data-distritoId=\"${featureAttributes[this.distrito.IDDISTRITO]}\">\\\n              ${featureAttributes[this.distrito.NAME_DISTRITO]}\\\n            </li>`);\n          }\n        } else {\n          tagHtml.push(`<li class=\"list-group-item\">\\\n            <p class=\"font-italic\">CARGANDO ....</p>\\\n          </li>`);\n        }\n        this.featureLayerDistrito.clearSelection();\n        this.CboDistrito.innerHTML = tagHtml.join(\"\");\n        // Cambia el nombre del limite seleccionado\n        this._nameSelected(this.CboDistrito,'');\n      } catch (error) {\n          console.log(`Error: _callDistrito ${error.name} - ${error.message}`);\n      }\n    },\n\n    _zoomProvincia: function (objectId) {\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerProvincia.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            this.map.setExtent(features[0].geometry.getExtent().expand(1.6));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onClickProvincia: function(){\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[`data-provinciaId`].value != \"\") {\n          // Cambia el nombre del limite seleccionado\n          this._nameSelected(thisValue.parentNode, thisValue.innerText);\n          // Limpiar selección\n          this._clearNodes(thisValue.parentNode.childNodes);\n          // Departamento seleccionado\n          thisValue.style[`background-color`] = this.selectedColor;\n          // Asigna valor el nombre PROVINCIA\n          window.paramProvincia = thisValue.innerText.trim();\n          window.paramDistrito = \"\";\n          // Acercamiento a PROVINCIA\n          this._zoomProvincia(thisValue.attributes[`data-objectId`].value);\n          // Contador proyectos\n          this._countProject();\n          // Consulta de PROVINCIA\n          this.queryDistrito.where = `\n            ${this.distrito.IDDEPARTAMENTO} = '${thisValue.attributes[\"data-departamentoId\"].value.trim()}' AND \n            ${this.distrito.IDPROVINCIA} = '${thisValue.attributes[\"data-provinciaId\"].value.trim()}'`;\n          // Executa consulta de DISTRITOS\n          this.queryTaskDistrito.execute(\n            this.queryDistrito,\n            this._callDistrito.bind(this),\n            this._errorDistrito.bind(this)\n          );\n          document.getElementById(\"Distritos\").disabled = false;\n          document.getElementById(\"Distritos\").click();\n        }\n      } catch (error) {\n        console.log(`Error: _onClickProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Error - Select PROVINCIA\n    _errorProvincia: function(item) {\n      try {\n        let tagHtml = [];\n          tagHtml.push(`<li class=\"list-group-item\" \\\n            data-objectId=\"\" data-id=\"\">\\\n            Error al cargar\n          </li>`);\n        this.featureLayerProvincia.clearSelection();\n        this.CboProvincia.innerHTML = tagHtml.join(\"\");\n      } catch (error) {\n        console.log(`Error: _errorProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Carga de PROVINCIAS\n    _callProvincia: function(item) {\n      try {\n        let tagHtml = [];\n        if(item != null) {\n          featuresLength = item.features.length;\n          for(let i = 0; i < featuresLength; i++) {\n            this.featureAttributes = item.features[i].attributes;\n            tagHtml.push(`<li class=\"list-group-item\" \\\n                data-objectId=\"${this.featureAttributes[this.provincia.OBJECTID]}\" \\\n                data-departamentoid=\"${this.featureAttributes[this.provincia.IDDEPARTAMENTO]}\" \\\n                data-provinciaId=\"${this.featureAttributes[this.provincia.IDPROVINCIA]}\">\\\n                ${this.featureAttributes[this.provincia.NAME_PROVINCIA]}\n              </li>`);\n          }\n          document.getElementById(\"Distritos\").disabled = true;\n        } else {\n          tagHtml.push(`<li class=\"list-group-item\">\n              <p class=\"font-italic\">Seleccione Departamento</p>\n            </li>`);\n        }\n        this._callDistrito(null);\n        this.featureLayerProvincia.clearSelection();\n        this.CboProvincia.innerHTML = tagHtml.join(\"\");\n        // Cambia el nombre del limite seleccionado\n        this._nameSelected(this.CboProvincia,'');\n      } catch (error) {\n        console.log(`Error: _callProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    /* Realiza un acercameinto al departamento */\n    _zoomDepartamento: function (objectId) {\n      // objectId. Es del departamento.\n      try {\n        let query = new Query();\n        query.objectIds = [objectId];\n        // Zoom - Object GIS\n        this.featureLayerDepartamento.selectFeatures (\n          query, FeatureLayer.SELECTION_NEW, function (features) {\n            // Valida si el zoom se activa o no\n            this.map.setExtent(features[0].geometry.getExtent().expand(2));\n          }.bind(this)\n        );\n      } catch (error) {\n        console.log(`Error: _zoomDepartamento ${erro.name} - ${error.message}`);\n      }\n    },\n\n    _onClickDepartamento: function() {\n      let nameDepartamento;\n      try {\n        thisValue = event.target;\n        if(thisValue.attributes[`data-objectId`].value != \"\") {\n          // Cambia el nombre del limite seleccionado\n          this._nameSelected(thisValue.parentNode, thisValue.innerText);\n          // Limpiar selección\n          this._clearNodes(thisValue.parentNode.childNodes);          \n          // Departamento seleccionado\n          thisValue.style[`background-color`] = this.selectedColor;\n          // Asigna el nombre de DEPARTAMENTO\n          window.paramDepartamento = thisValue.innerText.trim();\n          window.paramProvincia = \"\";\n          window.paramDistrito = \"\";\n          // Acercamiento DEPARTAMENTO\n          this._zoomDepartamento(thisValue.attributes[\"data-objectId\"].value);\n          this._countProject();\n          // Ejecutar llamado de PROVINCIAS\n          this.queryProvincia.where = this.provincia.IDDEPARTAMENTO + \" = '\" + thisValue.attributes[\"data-departamentoId\"].value +\"'\";\n          this.queryTaskProvincia.execute(\n            this.queryProvincia,\n            this._callProvincia.bind(this),\n            this._errorProvincia.bind(this)\n          );\n          document.getElementById(\"Provincias\").disabled = false;\n          document.getElementById(\"Provincias\").click();\n        }\n      } catch (error) {\n        console.log(`Error: _onClickDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n  \n    // Error - Select DEPARTAMENTAL\n    _errorDepartamento: function(item) {\n      try {\n        let tagHtml = [];\n        tagHtml.push(`<li class=\"list-group-item\" \\\n          data-id=\"\"> Error al cargar </li>`);\n      } catch (error) {\n          console.log(`Error: _errorDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n\n    _stringToHTML: function () {\n      var str = `<li class=\"list-group-item\" data-objectId=\"\" name=\"\"></li>`;\n      var doc = new DOMParser().parser.parseFromString(str, 'text/html');\n      return doc.body;\n    },\n\n    _callDepartamento: function(item) {\n      try {\n        let tagHtml = [];\n        this.featureLayerDepartamento.clearSelection();\n        document.getElementById(\"Departamentos\").click();\n        document.getElementById(\"Provincias\").disabled = true;\n        document.getElementById(\"Distritos\").disabled = true;\n        if(item != null) {\n          this.featuresLength = item.features.length;\n          for(let i = 0; i < this.featuresLength; i++) {\n            this.featureAttributes = item.features[i].attributes;\n            tagHtml.push(`<li class=\"list-group-item\" \\\n                data-objectId=\"${this.featureAttributes[this.departamento.OBJECTID]}\" \\\n                data-departamentoId=\"${this.featureAttributes[this.departamento.IDDEPARTAMENTO]}\">\\\n                ${this.featureAttributes[this.departamento.NAME_DEPARTAMENTO]}\n              </li>`\n            );\n          }\n          this.CboDepartamento.innerHTML = tagHtml.join(\"\");\n        } else {\n          // Cambia el nombre del limite seleccionado\n          this._nameSelected(this.CboDepartamento,'');\n          // Se limpia la selección del departamento\n          this._clearNodes(this.CboDepartamento.childNodes);\n        }\n      } catch (error) {\n        console.log(`Error: _callDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Limpiar capas seleccionadas\n    _clearSelection: function() {\n      try {\n        this.featureLayerDepartamento.clearSelection();\n        this.featureLayerProvincia.clearSelection();\n        this.featureLayerDistrito.clearSelection();\n      } catch (error) {\n        console.log(`Error: _clearSelection ${error.name} - ${error.message}`);\n      }\n    },\n\n    _onClickLimpiarAmbito: function() {\n      try {\n        /* Limpia DEPARTAMENTO */\n        this._callDepartamento(null);\n        /* Limpia PROVINCIA */\n        this._callProvincia(null);\n        /* Limpia DISTRITO */\n        this._callDistrito(null);\n        /* Limpiar los proyectos */\n        this._reseatParam();\n        // Extension por defecto del map\n        this.map.setExtent(this.map._initialExtent);\n        this._countProject();\n      } catch (error) {\n        console.log(`Error: _onClickBuscarAmbito ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Se limpia la búsqueda GENERAL\n    _onClickZoomGeneral: function() {\n      let nameLimite = \"\", dataLimite = \"\";\n      try {\n        thisValue = event.target;\n        // Atributo data-HTML\n        dataName     = thisValue.attributes[\"data-name\"];\n        dataLimite   = thisValue.attributes[\"data-limite\"];\n        dataObjectId = thisValue.attributes[\"data-objectId\"];\n        // Se limpia la selección\n        this._clearNodes(thisValue.parentNode.childNodes);\n        thisValue.style[\"background-color\"] = this.selectedColor;\n        // Limpiar selección\n        this._clearSelection();\n        this._reseatParam();\n        // Acercamiento según el límite político\n        if(dataName.value == `departamento`) {\n          this._zoomDepartamento(dataObjectId.value);\n          window.paramDepartamento = dataLimite.value;\n        } else if(dataName.value == `provincia`) {\n          this._zoomProvincia(dataObjectId.value);\n          window.paramProvincia = dataLimite.value;\n        } else if(dataName.value == `distrito`) {\n          this._zoomDistrito(dataObjectId.value);\n          window.paramDistrito = dataLimite.value;\n        }\n        this._countProject();\n      } catch (error) {\n        console.log(`Error: _onClickGeneral ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Selecciona el límite político\n    _onChangeLimitePolitico: function(e) {\n      try {\n        this.LimitePolitico_Selected.innerHTML = this.LimitePolitico.options[this.LimitePolitico.selectedIndex].innerText;\n      } catch (error) {\n        console.log(`Error: _onChangeLimitePolitico ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callGeneralDistrito: function(inName, counter) {\n      try {\n        // DISTRITOS\n        this.queryDistrito.where = `${this.distrito.NAME_DISTRITO} LIKE '%${inName}%'`;\n        this.queryTaskDistrito.execute(\n          this.queryDistrito,\n          // Resultado de DISTRITOS\n          function(item) {\n            let tagHtml = [];\n            try {\n              featuresLength = item.features.length;\n              for(let r = 0; r < featuresLength; r++) {\n                featureAttributes = item.features[r].attributes;\n                /*<span class=\"leyend-distrito\" style=\"border: 2px solid ${this.legendDistrito};\"></span>*/\n                tagHtml.push(`<li class=\"list-group-item\" \\\n                  data-objectId=\"${featureAttributes[this.distrito.OBJECTID]}\" \\\n                  data-id=\"${featureAttributes[this.distrito.IDDISTRITO]}\" \\\n                  data-name=\"distrito\" data-limite=\"${featureAttributes[this.distrito.NAME_DISTRITO]}\">\\\n                    &nbsp;${featureAttributes[this.distrito.NAME_DEPARTAMENTO]},\\\n                    Provincia ${featureAttributes[this.distrito.NAME_PROVINCIA]},\\\n                    Distrito ${featureAttributes[this.distrito.NAME_DISTRITO]}\n                  </li>`);\n              }\n              this.ID_General.innerHTML += tagHtml.join(\"\");\n              this._tableResult(counter);\n            } catch (error) {\n              console.log(`Error: _onClickBuscarLugar > distrito > ${error.name} - ${error.message}`);\n            }\n          }.bind(this)\n          // /Resultado de DISTRITOS\n        );\n        // /DISTRITOS\n      } catch (error) {\n        console.log(`Error: _callGeneralDistrito > distrito function > ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callGeneralProvincia: function(inName, counter) {\n      try {\n        // PROVINCIAS\n        this.queryProvincia.where = `${this.provincia.NAME_PROVINCIA} LIKE '%${inName}%'`;\n        // Ejecutar de PROVINCIAS\n        this.queryTaskProvincia.execute(\n          this.queryProvincia,\n          // Resultado de PROVINCIAS\n          function(item) {\n            let tagHtml = [];\n            try {\n              featuresLength = item.features.length;              \n              for(let i = 0; i < featuresLength; i++) {\n                featureAttributes = item.features[i].attributes;\n                /*<span class=\"leyend-provincia\" style=\"border: 2px solid ${this.legendProvincia};\"></span>*/\n                tagHtml.push(`<li class=\"list-group-item\" \\\n                  data-objectId=\"${featureAttributes[this.provincia.OBJECTID]}\" \\\n                  data-id=\"${featureAttributes[this.provincia.IDPROVINCIA]}\" \\\n                  data-name=\"provincia\" data-limite=\"${featureAttributes[this.provincia.NAME_PROVINCIA]}\">\n                    &nbsp; ${featureAttributes[this.provincia.NAME_DEPARTAMENTO]}, \\\n                    Provincia ${featureAttributes[this.provincia.NAME_PROVINCIA]}\\\n                  </li>`);\n              }\n              this.ID_General.innerHTML += tagHtml.join(\"\");\n              this._tableResult(counter);\n            } catch (error) {\n              console.log(`Error: _callGeneralProvincia > provincia function > ${error.name} - ${error.message}`);\n            }\n          }.bind(this)\n          // /Resultado de PROVINCIAS\n        );\n        // /PROVINCIAS\n      } catch (error) {\n        console.log(`Error: _callGeneralProvincia ${error.name} - ${error.message}`);\n      }\n    },\n\n    _callGeneralDepartamento: function(inName, counter) {\n      try {\n        // DEPARTAMENTOS\n        this.queryDepartamento.where = `\\\n        ${this.departamento.NAME_DEPARTAMENTO} LIKE '%${inName}%'`;\n        // Ejecutar de DEPARTAMENTOS\n        this.queryTaskDepartamento.execute(\n          this.queryDepartamento,\n          // Resultado de DEPARTAMENTOS\n          function(item) {\n            let tagHtml = [];\n            try {\n              featuresLength = item.features.length;\n              for(let i = 0; i<featuresLength; i++) {\n                featureAttributes = item.features[i].attributes;\n                /*<span class=\"leyend-departamento\" style=\"border: 2px solid ${this.legendDepartamento};\"></span>*/\n                tagHtml.push(`<li class=\"list-group-item\" \\\n                  data-objectId=\"${featureAttributes[this.departamento.OBJECTID]}\" \\\n                  data-id=\"${featureAttributes[this.departamento.IDDEPARTAMENTO]}\" \\\n                  data-name=\"departamento\" data-limite=\"${featureAttributes[this.departamento.NAME_DEPARTAMENTO]}\">\\\n                  &nbsp; ${featureAttributes[this.departamento.NAME_DEPARTAMENTO]}\\\n                </li>`);                \n              }\n              this.ID_General.innerHTML += tagHtml.join(\"\");\n              this._tableResult(counter);\n            } catch (error) {\n              console.log(`Error: _onClickBuscarLugar > departamento function > ${error.name} - ${error.message}`);\n            }\n          }.bind(this)\n          // /Resultado de DEPARTAMENTOS\n        );\n        // /DEPARTAMENTOS\n      } catch (error) {\n        console.log(`Error: _callGeneralDepartamento ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Limpiar resultado de lugar\n    _onClickBuscarLugar: function(param) {\n      let inName=\"\", limitePolitico=\"\", limiteTodo = \"\";\n      try {\n        if(param != null){\n          // Limpiar selección\n          this._clearSelection();\n          this._reseatParam();\n          // Se obtiene el valor del campo\n          inName = this.NombreLimite.value.trim().toUpperCase(); \n          if(inName) {\n            // Limpiando contenido\n            this.ID_General.innerHTML = \"\";\n            // Mostrar animación de carga\n            this._loadBlockGeneralLimite();\n            limitePolitico = this.LimitePolitico.value;\n            // Simulando un SWITCH CASE\n            limiteTodo =  limitePolitico == 'departamento' ? this._callGeneralDepartamento(inName,3):\n                          limitePolitico == 'provincia' ? this._callGeneralProvincia(inName,3):\n                          limitePolitico == 'distrito' ? this._callGeneralDistrito(inName,3):\n                          'todos';\n            // Muestra TODOS\n            if(limiteTodo == 'todos') {\n              this._callGeneralDepartamento(inName,1);\n              this._callGeneralProvincia(inName,1);\n              this._callGeneralDistrito(inName,1);\n            }\n          } else {\n            // Muestra mensaje de advertencia\n            new Message({\n              titleLabel: `<strong>\\\n                <i class=\"fa fa-exclamation-triangle\" aria-hidden=\"true\"></i>&nbsp;\\\n                COMPLETAR CAMPO</strong>`,\n              message: `<i class=\"fa fa-terminal\" aria-hidden=\"true\"></i>&nbsp;\\\n                Ingrese el <strong>LÍMITE POLÍTICO</strong> según la selección \\\n                (<u>DEPARTAMENTOS</u>, <u>PROVINCIAS</u>, <u>DISTRITOS</u> o <u>TODOS</u>).`\n            });\n          }\n        } else {\n          this.ID_General.innerHTML = `<li class=\"list-group-item\">Resultado de búsqueda</li>`;\n        }\n      } catch (error) {\n        console.log(`Error: _onClickBuscarLugar ${error.name} - ${error.message}`);\n      }\n    },\n\n    // Limpiar resultado de lugar\n    _onClickLimpiarLugar: function() {\n      try {\n        this.LimitePolitico.value = \"todos\";\n        this.NombreLimite.value = \"\";\n        this.LimitePolitico_Selected.innerHTML = this.LimitePolitico.value.toUpperCase();\n        this._onClickBuscarLugar(null);\n        this._onFocus();\n        // Limpiar selección\n        this._clearSelection();\n        this._reseatParam();\n        // Extension por defecto del map\n        this.map.setExtent(this.map._initialExtent);\n        this._countProject();\n      } catch (error) {\n        console.log(`Error: _onClickLimpiarLugar ${error.name} - ${error.message}`);\n      }\n    },\n\n    _activeTabSearch: function(positionTab) {\n      try {\n        let tabs4 = document.querySelectorAll('.jimu-widget-InfoSummary .tabs .tab');\n        let tabsContent4 = document.querySelectorAll('.jimu-widget-InfoSummary .tab-content');\n\n        let deactvateAllTabs = function () {\n          tabs4.forEach(function (tab) {\n            tab.classList.remove('jimu-state-selected');\n          });\n        };\n\n        let hideTabsContent = function () {\n          tabsContent4.forEach(function (tabContent) {\n            tabContent.classList.remove('jimu-state-selected');\n          });\n        };\n\n        let activateTabsContent = function (tab) {\n          tabsContent4[getIndex(tab)].classList.add('jimu-state-selected');\n        };\n\n        let getIndex = function (el) {\n          return [...el.parentElement.children].indexOf(el);\n        };\n\n        tabs4.forEach(function (currentValue, index, array) {\n          currentValue.addEventListener('click', function () {\n              deactvateAllTabs();\n              hideTabsContent();\n              /* Limpia la funcionalidad */\n              currentValue.classList.add('jimu-state-selected');\n              activateTabsContent(currentValue);\n              this._onFocus();\n          }.bind(this));\n\n        }.bind(this));\n        tabs4[positionTab].click();\n        if(positionTab){ this._onFocus(); }\n      } catch (error) {\n        console.log(\"Error: _activeTabSearch \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    /* Cambiar el tamaño del widget */\n    _getPanel: function(paramWidget, paramHeight) {  \n      try {\n        let panel = this.getPanel();\n        let pos = panel.position;\n        // Posición por defecto\n        console.log(pos);\n        pos.left = 100; pos.top = 95;\n        pos.width = paramWidget;\n        pos.height = paramHeight;\n        panel.setPosition(pos);\n      } catch (error) {\n        console.log(\"_getPanel: \" + error.name + \" - \" + error.message);\n      }\n    },\n\n    _onLoadDepartamento: function() {\n      this.queryDepartamento.where = \"1=1\";\n      this.queryTaskDepartamento.execute(\n        this.queryDepartamento,\n        this._callDepartamento.bind(this),\n        this._errorDepartamento.bind(this)\n      );\n    },\n\n    postCreate: function postCreate() {\n      this.inherited(arguments);\n      this._getAllLayers();\n      this.listLayer = this.config.listLayer;\n\n      this.urlDepartamento = this.config.urlDepartamento;\n      this.urlProvincia = this.config.urlProvincia;\n      this.urlDistrito = this.config.urlDistrito;\n\n      this.legendDepartamento = this.config.leyendDepartamento;\n      this.legendDepartamentoBorder = this.config.leyendDepartamentoLineBorder;\n      this.legendDepartamentoLineSize = this.config.leyendDepartamentoLineSize;\n      this.legendDepartamentoBackground = this.config.leyendDepartamentoBackground;\n      this.legendProvincia = this.config.leyendProvincia;\n      this.legendProvinciaLineBorder = this.config.leyendProvinciaLineBorder;\n      this.legendProvinciaLineSize = this.config.leyendProvinciaLineSize;\n      this.legendProvinciaBackground = this.config.leyendProvinciaBackground;\n      this.legendDistrito = this.config.leyendDistrito;\n      this.legendDistritoLineBorder = this.config.leyendDistritoLineBorder;\n      this.legendDistritoLineSize = this.config.leyendDistritoLineSize;\n      this.legendDistritoBackground = this.config.leyendDistritoBackground;\n\n      this.inPanelOverrides(this.appConfig.theme.name);\n      this.configLayerInfos = this.config.layerInfos;\n      this.layerList = {};\n      /* Configuracion departamento */\n      this._settingDepartamento(\n        this.urlDepartamento,\n        this.legendDepartamentoBorder,\n        this.legendDepartamento,\n        parseFloat(this.legendDepartamentoLineSize),\n        this.legendDepartamentoBackground\n      );\n      /* Configuracion provincia */\n      this._settingProvincia(\n        this.urlProvincia,\n        this.legendProvinciaLineBorder,\n        this.legendProvincia,\n        parseFloat(this.legendProvinciaLineSize),\n        this.legendProvinciaBackground\n      );\n      /* Configuracion distrito */\n      this._settingDistrito(\n        this.urlDistrito,\n        this.legendDistritoLineBorder,\n        this.legendDistrito,\n        parseFloat(this.legendDistritoLineSize),\n        this.legendDistritoBackground\n      );    \n      /* Cargar los departamentos */\n      this._onLoadDepartamento();\n      //populates this.layerInfos and creates the panel\n      this._initWidget();\n      /* Cambiar el tamaño del widget */\n      // paramWidget, paramHeight\n      this._getPanel(320, 650);\n    },\n\n    _forceClose: function _forceClose() {\n      var themeName = this.appConfig.theme.name;\n      var dcThemes = ['LaunchpadTheme', 'DartTheme', 'FoldableTheme', 'JewelryBoxTheme', 'BillboardTheme', 'TabTheme', 'DashboardTheme'];\n      var p = this.getPanel();\n      if (dcThemes.indexOf(themeName) > -1) {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        this.widgetManager.closeWidget(this.id);\n      } else if (themeName === 'BoxTheme') {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        if (p.getParent && p.getParent()._toggleBox) {\n          var ss = query('.icon-node-active');\n          for (var i = 0; i < ss.length; i++) {\n            if (ss[i].outerHTML.indexOf(this.id) > -1) {\n              p.getParent()._toggleBox();\n            }\n          }\n        }\n      } else if (themeName === 'PlateauTheme') {\n        p.containerNode.parentNode.style.display = 'none';\n        p.containerNode.style.display = 'none';\n        this.widgetManager.closeWidget(this.id);\n        if (!this.aw) {\n          var widgets = this.widgetManager.appConfig.widgetOnScreen.widgets;\n          for (var ii = 0; ii < this.widgetManager.appConfig.widgetOnScreen.widgets.length; ii++) {\n            if (widgets[ii].isThemeWidget) {\n              this.aw = this.widgetManager.getWidgetById(widgets[ii].id);\n              this.aw._switchNodeToClose(this.id);\n              this.aw._closeDropMenu();\n              break;\n            }\n          }\n        } else {\n          this.aw._switchNodeToClose(this.id);\n          this.aw._closeDropMenu();\n        }\n      }\n    },\n\n    inPanelOverrides: function inPanelOverrides(themeName) {\n      if (typeof this.iconClickHandler !== 'undefined') {\n        this.iconClickHandler.remove();\n        this.iconClickHandler = undefined;\n      }\n\n      var p = this.getPanel();\n\n      if (this.config.hidePanel) {\n        var iconNodeThemes = ['DartTheme', 'BoxTheme', 'FoldableTheme', 'JewelryBoxTheme', 'PlateauTheme'];\n\n        var iconNodes;\n        if (themeName === 'LaunchpadTheme') {\n          this._forceClose();\n          iconNodes = query('.selected');\n          if (iconNodes.length > 0) {\n            if (iconNodes[0].parentNode.outerHTML.indexOf(this.id) > -1) {\n              this.iconClickHandler = on(iconNodes[0], 'click', lang.hitch(this, this._forceClose));\n            }\n          }\n        } else if (iconNodeThemes.indexOf(themeName) > -1) {\n          if (themeName === 'BoxTheme') {\n            this._forceClose(); //did this for box...make sure it doesn't jack others up\n          }\n          iconNodes = query('.icon-node');\n          for (var i = 0; i < iconNodes.length; i++) {\n            if (iconNodes[i].outerHTML.indexOf(this.id) > -1) {\n              this.iconClickHandler = on(iconNodes[i], 'click', lang.hitch(this, this._forceClose));\n            }\n          }\n        }\n      } else {\n        //TODO test if this has the class .jimu-widget-frame.jimu-container\n        if (p.containerNode && p.containerNode.firstChild && p.containerNode.firstChild.className) {\n          p.containerNode.firstChild.style.padding = '0px 0px 10px 0px';\n        }\n\n        //change associated with the tab theme...all others will show the background color behind refresh text and panel image\n        if (['TabTheme', 'BillboardTheme', 'PlateauTheme', 'DashboardTheme'].indexOf(themeName) === -1) {\n          this._updateBackgroundColors(true);\n        }\n\n        this.isDartTheme = themeName === \"DartTheme\";\n        this.isDashboardTheme = themeName === 'DashboardTheme';\n        if (domClass.contains(this.pageHeader, this.isDartTheme ? 'pageHeader-border' : 'pageHeader-border-dart')) {\n          domClass.remove(this.pageHeader, this.isDartTheme ? 'pageHeader-border' : 'pageHeader-border-dart');\n        }\n        domClass.add(this.pageHeader, this.isDartTheme ? 'pageHeader-border-dart' : 'pageHeader-border');\n\n        switch (themeName) {\n          case 'DartTheme':\n            this.updateForDartTheme(p);\n            break;\n          case 'BoxTheme':\n            this.updateForBoxTheme(p);\n            break;\n          case 'TabTheme':\n            this.updateForTabTheme(p);\n            break;\n          case 'LaunchpadTheme':\n            this.updateForLaunchpadTheme(p);\n            break;\n          case 'BillboardTheme':\n            this.updateForBillboardTheme(p);\n            break;\n          case 'PlateauTheme':\n            this.updateForPlateauTheme(p);\n            break;\n          case 'DashboardTheme':\n            this.updateForDashboardTheme(p);\n            break;\n        }\n      }\n    },\n\n    updateForLaunchpadTheme: function updateForLaunchpadTheme(p) {\n      p.containerNode.style.top = '30px';\n    },\n\n    updateForTabTheme: function updateForTabTheme(p) {\n      if (p.containerNode.children.length > 0) {\n        var fc = p.containerNode.children[0];\n        if (fc.children.length > 1) {\n          fc.children[1].style.padding = '14px 0px 14px 0px';\n        }\n      }\n      if (!p.config.isOnScreen) {\n        this._updateBackgroundColors(false);\n      }\n    },\n\n    updateForBoxTheme: function updateForBoxTheme(p) {\n      p.containerNode.parentNode.style.top = '140px';\n    },\n\n    updateForDartTheme: function updateForDartTheme(p) {\n      p.containerNode.style.right = '0px';\n      p.containerNode.style.left = '0px';\n    },\n\n    updateForBillboardTheme: function updateForBillboardTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    updateForPlateauTheme: function updateForPlateauTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    updateForDashboardTheme: function updateForDashboardTheme() {\n      this._updateBackgroundColors(false);\n    },\n\n    _updateBackgroundColors: function _updateBackgroundColors(add) {\n      //deal with text color\n      if (domClass.contains(this.lastUpdated, add ? 'lastUpdated-tab' : 'lastUpdated')) {\n        domClass.remove(this.lastUpdated, add ? 'lastUpdated-tab' : 'lastUpdated');\n      }\n      domClass.add(this.lastUpdated, add ? 'lastUpdated' : 'lastUpdated-tab');\n\n      add = add && this.appConfig.theme.name !== 'DashboardTheme';\n      this.useDarkText = !add;\n\n      //deal with background color for page header\n      if (domClass.contains(this.pageHeader, 'jimu-main-background') && !add) {\n        domClass.remove(this.pageHeader, 'jimu-main-background');\n      } else if (!domClass.contains(this.pageHeader, 'jimu-main-background') && add) {\n        domClass.add(this.pageHeader, 'jimu-main-background');\n      }\n      if (domClass.contains(this.pageHeader, 'dart-bgcolor') && !add) {\n        domClass.remove(this.pageHeader, 'dart-bgcolor');\n      } else if (!domClass.contains(this.pageHeader, 'dart-bgcolor') && add) {\n        domClass.add(this.pageHeader, 'dart-bgcolor');\n      }\n      if (domClass.contains(this.pageHeader, 'box-bgcolor') && !add) {\n        domClass.remove(this.pageHeader, 'box-bgcolor');\n      } else if (!domClass.contains(this.pageHeader, 'box-bgcolor') && add) {\n        domClass.add(this.pageHeader, 'box-bgcolor');\n      }\n    },\n\n    startup: function startup() {\n      this.inherited(arguments);\n      if (!this.hidePanel && !this.showAllFeatures) {\n        this.mapExtentChangedHandler = this.map.on(\"extent-change\", lang.hitch(this, this._mapExtentChange));\n        this._mapExtentChange();\n      } else if (this.showAllFeatures) {\n        this._mapExtentChange();\n      }\n      \n      /* Habre la primer acordion de departamento */\n      document.getElementById(\"Departamentos\").click();\n      document.getElementById(\"Provincias\").disabled = true;\n      document.getElementById(\"Distritos\").disabled = true;\n      // Ocultar animacion de carga\n      this._loadNoneGeneralLimite();\n      /* Pestaña que se activa\n        - 0. Activa la pestaña de ESPECIFICO\n        - 1. Activa la pestaña de GENERAL */\n      this._activeTabSearch(0);\n    },\n\n    resize: function(){\n      console.log('Widget-ConsultaProyecto::resize');\n    },\n\n    onOpen: function onOpen() {\n      this.widgetChange = false;\n\n      if (!this.hidePanel) {\n        this._updatePanelHeader();\n      } else {\n        if (this.appConfig.theme.name !== 'BoxTheme') {\n          this._forceClose();\n        }\n      }\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        this._updateStyleColor(this.appConfig.theme.styles[0]);\n      }\n\n      var visibleSubLayers = [];\n      //update the renderer for the layer in the layer list if a new one has been defined\n      for (var key in this.layerList) {\n        var layerListLayer = this.layerList[key];\n        var li = layerListLayer.li;\n        var lo = layerListLayer.layerObject;\n        if (li && li.orgRenderer) {\n          if (lo.setRenderer) {\n            lo.setRenderer(li.newRenderer);\n          } else if (lo.setLayerDrawingOptions) {\n            var optionsArray = [];\n            var drawingOptions = new LayerDrawingOptions();\n            drawingOptions.renderer = li.newRenderer;\n            optionsArray[li.subLayerId] = drawingOptions;\n            lo.setLayerDrawingOptions(optionsArray);\n          } else {\n            console.log(\"Error setting the new renderer...will use the default rendering of the layer\");\n          }\n          if (typeof lo.refresh === 'function') {\n            lo.refresh();\n          }\n        }\n\n        var _Pl;\n        if (lo && lo.layerInfos) {\n          _Pl = lo;\n        } else if (li && typeof li.parentLayerID !== 'undefined') {\n          _Pl = this.map.getLayer(li.parentLayerID);\n        }\n\n        var l;\n        if (_Pl && _Pl.visibleLayers) {\n          var _foundIt = false;\n          sub_layers_id_loop: for (var ii = 0; ii < visibleSubLayers.length; ii++) {\n            var subVizLyrId = visibleSubLayers[ii].id;\n            if (subVizLyrId === _Pl.id) {\n              _foundIt = true;\n              break sub_layers_id_loop;\n            }\n          }\n          if (visibleSubLayers.length === 0 || !_foundIt) {\n            visibleSubLayers.push({\n              id: _Pl.id,\n              layers: _Pl.visibleLayers\n            });\n          }\n          var x = 0;\n          subLayerLoop: for (x; x < visibleSubLayers.length; x++) {\n            var o = visibleSubLayers[x];\n            if (o.id === _Pl.id) {\n              break subLayerLoop;\n            }\n          }\n          var visLayers = visibleSubLayers[x].layers;\n          if (_Pl.layerInfos) {\n            //Handle MapService layers\n            if (_Pl.layerInfos.length > 0) {\n              if (li && typeof li.subLayerId !== 'undefined') {\n                var inVisLayers = visLayers.indexOf(li.subLayerId) > -1;\n                var plVis = layerListLayer.parentLayerVisible;\n                var loPlVis = layerListLayer.layerObject.parentLayerVisible;\n                if (layerListLayer.type === \"ClusterLayer\" && (inVisLayers || plVis || loPlVis)) {\n                  layerListLayer.parentLayerVisible = true;\n                  layerListLayer.layerObject.parentLayerVisible = true;\n                  layerListLayer.visible = true;\n                  if (inVisLayers) {\n                    visLayers.splice(visLayers.indexOf(li.subLayerId), 1);\n                  }\n                } else if (inVisLayers || plVis) {\n                  layerListLayer.parentLayerVisible = true;\n                  layerListLayer.visible = true;\n                  if (visLayers.indexOf(li.subLayerId) === -1) {\n                    visLayers.push(li.subLayerId);\n                  }\n                } else {\n                  layerListLayer.parentLayerVisible = false;\n                  layerListLayer.visible = false;\n                  if (inVisLayers) {\n                    visLayers.splice(visLayers.indexOf(li.subLayerId), 1);\n                  }\n                  if (layerListLayer.type === \"ClusterLayer\") {\n                    layerListLayer.layerObject.parentLayerVisible = false;\n                    if (this.map.graphicsLayerIds.indexOf(layerListLayer.id) > -1) {\n                      l = this.map.getLayer(layerListLayer.id);\n                      l.setVisibility(false);\n                    }\n                  }\n                }\n              }\n            }\n            visibleSubLayers[x].layers = visLayers;\n          }\n          this.updatePanelVisibility(layerListLayer, key, layerListLayer);\n        } else if (lo) {\n          //Handle non MapService layers\n          if (layerListLayer.type === \"ClusterLayer\") {\n            if (lo._parentLayer) {\n              if (this.map.graphicsLayerIds.indexOf(layerListLayer.id) > -1) {\n                l = this.map.getLayer(layerListLayer.id);\n                if (typeof layerListLayer.layerObject.parentLayerVisible === 'undefined') {\n                  layerListLayer.parentLayerVisible = lo._parentLayer.visible;\n                  layerListLayer.layerObject.parentLayerVisible = lo._parentLayer.visible;\n                }\n                l.setVisibility(layerListLayer.layerObject.parentLayerVisible);\n              }\n              if (lo._parentLayer.setVisibility) {\n                lo._parentLayer.setVisibility(false);\n              }\n            }\n          }\n          this.updatePanelVisibility(lo, key, layerListLayer);\n        }\n\n        if (this.showAllFeatures && this.config.expandList && layerListLayer.legendOpen && !layerListLayer.isLoaded) {\n          var visScaleRange = layerListLayer.visScaleRange;\n          if (typeof visScaleRange !== 'undefined') {\n            visScaleRange = this._inVisibleRange(layerListLayer, key);\n          }\n          if (layerListLayer.visible && visScaleRange) {\n            layerListLayer.updateList = true;\n          }\n        }\n      }\n\n      for (var i = 0; i < visibleSubLayers.length; i++) {\n        var parentLayer = this.map.getLayer(visibleSubLayers[i].id);\n        if (parentLayer) {\n          parentLayer.setVisibleLayers(visibleSubLayers[i].layers);\n        }\n      }\n\n      if (!this.hidePanel && !this.showAllFeatures) {\n        if (typeof this.mapExtentChangedHandler === 'undefined') {\n          this.mapExtentChangedHandler = this.map.on(\"extent-change\", lang.hitch(this, this._mapExtentChange));\n          this._mapExtentChange();\n        }\n      }\n\n      //if refresh is enabled set refereshInterval on any widget source layers with refresh set to true\n      //and call setInterval to refresh the static graphics\n      if (this.config.refreshEnabled) {\n        this.enableRefresh();\n      }\n\n      if (this.map.infoWindow) {\n        this.map.infoWindow.highlight = true;\n      }\n    },\n\n    updatePanelVisibility: function updatePanelVisibility(lo, key, layerListLayer) {\n      if (!this.hidePanel) {\n        if (typeof lo.visible !== 'undefined') {\n          //var visScaleRange = this._inVisibleRange(layerListLayer, key);\n          var visScaleRange = layerListLayer.visScaleRange;\n          var c = dom.byId(\"recLabel_\" + key);\n          if (!lo.visible) {\n            if (domClass.contains(\"recIcon_\" + key, \"active\")) {\n              domClass.remove(\"recIcon_\" + key, \"active\");\n            }\n            if (this.config.countEnabled) {\n              if (domClass.contains(\"recNum_\" + key, \"recNum\")) {\n                domClass.remove(\"recNum_\" + key, \"recNum\");\n                domClass.add(\"recNum_\" + key, \"recNumInActive\");\n              }\n            }\n            if (c && c.firstChild) {\n              domClass.add(c.firstChild, \"inActive\");\n            }\n            if (!layerListLayer.listDisabled) {\n              if (!domClass.contains(\"exp_\" + key, \"expandInActive\")) {\n                domClass.add(\"exp_\" + key, \"expandInActive\");\n              }\n              layerListLayer.toggleLegend.remove();\n            }\n            if (domClass.contains(\"rec_\" + key, \"rec\")) {\n              domClass.add(\"rec_\" + key, \"recDefault\");\n            }\n          } else {\n            if (!domClass.contains(\"recIcon_\" + key, \"active\")) {\n              domClass.add(\"recIcon_\" + key, \"active\");\n            }\n            if (this.config.countEnabled) {\n              if (domClass.contains(\"recNum_\" + key, \"recNumInActive\")) {\n                domClass.remove(\"recNum_\" + key, \"recNumInActive\");\n                domClass.add(\"recNum_\" + key, \"recNum\");\n              }\n            }\n            if (c && c.firstChild) {\n              domClass.remove(c.firstChild, \"inActive\");\n            }\n            if (!layerListLayer.listDisabled) {\n              if (typeof visScaleRange === 'undefined' || visScaleRange) {\n                if (domClass.contains(\"exp_\" + key, \"expandInActive\")) {\n                  domClass.remove(\"exp_\" + key, \"expandInActive\");\n                }\n              }\n            }\n            if (domClass.contains(\"rec_\" + key, \"recDefault\")) {\n              domClass.remove(\"rec_\" + key, \"recDefault\");\n            }\n          }\n        }\n      }\n    },\n\n    enableRefresh: function enableRefresh() {\n      //set refreshItereval on all widget source layers that support it\n      var layerListLayer = null;\n      var checkedTime = false;\n      for (var key in this.layerList) {\n        var id;\n        layerListLayer = this.layerList[key];\n        if (layerListLayer.li) {\n          id = layerListLayer.li.itemId;\n        }\n        if (layerListLayer.type !== \"ClusterLayer\") {\n          layerListLayer = layerListLayer.layerObject;\n        } else {\n          for (var i = 0; i < this.layerInfos.length; i++) {\n            var l = this.layerInfos[i];\n            if (l.layerObject) {\n              layerListLayer = l.layerObject;\n              break;\n            }\n          }\n        }\n        if (!checkedTime && id) {\n          this.getItem(id);\n          checkedTime = true;\n        }\n        if (layerListLayer) {\n          layerListLayer.refreshInterval = this.config.refreshInterval;\n        }\n      }\n\n      var tempVal = this.config.refreshInterval * 60000;\n      if (this.refreshInterval === 0 && this.refreshIntervalValue === 0) {\n        //set the refresh interval based on the configs interval value\n        this.refreshIntervalValue = tempVal;\n        this.refreshInterval = setInterval(lang.hitch(this, this.refreshLayers), this.refreshIntervalValue);\n      } else if (this.refreshIntervalValue !== 0 && this.refreshIntervalValue !== tempVal) {\n        //clear and update the refresh interval if the configs refresh interval has changed\n        this.refreshIntervalValue = tempVal;\n        clearInterval(this.refreshInterval);\n        this.refreshInterval = 0;\n        this.refreshInterval = setInterval(lang.hitch(this, this.refreshLayers), this.refreshIntervalValue);\n      }\n    },\n\n    getItem: function getItem(id) {\n      var portalUrl = window.portalUrl.substr(-1) !== '/' ? window.portalUrl += '/' : window.portalUrl;\n      var url = portalUrl + \"sharing/rest/content/items/\" + id;\n      esriRequest({\n        url: url,\n        content: {\n          f: \"json\",\n          requestTime: Date.now()\n        }\n      }).then(lang.hitch(this, function (response) {\n        if (response) {\n          var itemModified = response.modified;\n          var update = true;\n          if (this.lastModifiedTime) {\n            update = this.lastModifiedTime < itemModified;\n          }\n          if (this.currentQueryList.indexOf(id) > -1) {\n            this.currentQueryList.splice(this.currentQueryList.indexOf(id), 1);\n          }\n          if (update) {\n            this.lastModifiedTime = itemModified;\n            this._updatePanelTime(itemModified);\n            esriRequest({\n              url: url + '/data',\n              content: {\n                f: \"json\",\n                requestTime: Date.now()\n              }\n            }).then(lang.hitch(this, this._updateItem, id));\n          }\n        }\n      }));\n    },\n\n    _updatePanelTime: function _updatePanelTime(modifiedTime) {\n      if (!this.hidePanel) {\n        this.lastUpdated.innerHTML = \"<div></div>\";\n        var _d = new Date(modifiedTime);\n        var _f = { dateFormat: 'shortDateShortTime' };\n        this.lastUpdated.innerHTML = utils.fieldFormatter.getFormattedDate(_d, _f);\n      }\n    },\n\n    refreshLayers: function refreshLayers() {\n      for (var key in this.layerList) {\n        var lyr = this.layerList[key];\n        var id;\n        if (lyr.li && lyr.li.itemId) {\n          id = lyr.li.itemId;\n        } else if (lyr.layerObject.itemId) {\n          id = lyr.layerObject.itemId;\n        }\n\n        if (id) {\n          if (this.currentQueryList.indexOf(id) === -1) {\n            this.currentQueryList.push(id);\n            this.getItem(id);\n          }\n        }\n      }\n    },\n\n    _updateItem: function _updateItem(id, response) {\n      var featureCollection = response;\n      for (var i = 0; i < featureCollection.layers.length; i++) {\n        this._updateLayerItem(featureCollection.layers[i], this.lastModifiedTime);\n      }\n      this.currentQueryList.splice(this.currentQueryList.indexOf(id), 1);\n    },\n\n    //TDOO ensure this functions as expected when filter by map extent id disabled\n    _updateLayerItem: function _updateLayerItem(responseLayer) {\n      var layerListLayer;\n      var parentLayer;\n      var list, fields;\n      for (var k in this.layerList) {\n        var lyr = this.layerList[k];\n        if (lyr.pl && lyr.pl.layerDefinition) {\n          if (lyr.pl.layerDefinition.name === responseLayer.layerDefinition.name) {\n            layerListLayer = lyr;\n            parentLayer = lyr.pl;\n            break;\n          }\n        } else if (lyr.layerObject._parentLayer) {\n          if (lyr.layerObject._parentLayer.name === responseLayer.layerDefinition.name) {\n            list = typeof lyr.listDisabled !== 'undefined' ? lyr.listDisabled : false;\n            fields = lyr.li.symbolData.featureDisplayOptions.fields && lyr.li.symbolData.featureDisplayOptions.fields.length > 0;\n            if (!list && fields) {\n              lyr.isLoaded = false;\n            }\n            lyr.layerObject.refreshFeatures(responseLayer);\n            if (lyr.layerObject) {\n              this._loadList(lyr, true);\n            }\n          }\n        } else if (lyr.pl && lyr.pl.name) {\n          if (lyr.pl.name === responseLayer.layerDefinition.name) {\n            layerListLayer = lyr;\n            parentLayer = lyr.pl;\n            break;\n          }\n        }\n      }\n\n      if (responseLayer && layerListLayer && parentLayer && (parentLayer.featureSet || parentLayer.graphics)) {\n        var responseFeatureSetFeatures = responseLayer.featureSet.features;\n\n        var mapFeatureSetFeatures;\n        if (parentLayer.featureSet) {\n          mapFeatureSetFeatures = parentLayer.featureSet.features;\n        } else {\n          mapFeatureSetFeatures = [];\n          var responseSR = this._getSpatialReference(responseFeatureSetFeatures);\n          var mapSR = this._getSpatialReference(parentLayer.graphics);\n          array.forEach(parentLayer.graphics, function (gra) {\n            var g = gra.geometry;\n            var geom = g.rings ? { rings: g.rings } : g.paths ? { paths: g.paths } : g.points ? { points: g.points } : g.x && g.y ? { x: g.x, y: g.y } : {};\n            if (geom !== {}) {\n              mapFeatureSetFeatures.push({\n                attributes: gra.attributes,\n                geometry: lang.mixin({\n                  spatialReference: responseSR && mapSR && responseSR.wkid === mapSR.wkid ? responseSR : mapSR\n                }, geom)\n              });\n            }\n          });\n        }\n\n        if (responseLayer.featureSet.transform) {\n          var fs = new FeatureSet(responseLayer.featureSet);\n          responseFeatureSetFeatures = fs.features;\n        }\n\n        var shouldUpdate = true;\n        //TODO Figure out a better test for larger responses\n        if (responseFeatureSetFeatures.length < 10000) {\n          shouldUpdate = JSON.stringify(mapFeatureSetFeatures) !== JSON.stringify(responseFeatureSetFeatures);\n        }\n\n        if (shouldUpdate) {\n          list = typeof layerListLayer.listDisabled !== 'undefined' ? layerListLayer.listDisabled : false;\n          fields = layerListLayer.li.symbolData.featureDisplayOptions.fields && layerListLayer.li.symbolData.featureDisplayOptions.fields.length > 0;\n          if (!list && fields) {\n            layerListLayer.isLoaded = false;\n            layerListLayer.requiresReload = true;\n          }\n          if (list) {\n            layerListLayer.li.layerListExtentChanged = true;\n          }\n          layerListLayer.layerObject.clear();\n          var sr = layerListLayer.layerObject.spatialReference;\n          for (var j = 0; j < responseFeatureSetFeatures.length; j++) {\n            var item = responseFeatureSetFeatures[j];\n            if (item.geometry) {\n              //check li for renderer also\n              var go = this.getGraphicOptions(item, sr);\n              var gra = new Graphic(go);\n              //removed for https://devtopia.esri.com/WebGIS/arcgis-webappbuilder/issues/11551\n              //gra.setSymbol(go.symbol);\n              gra.setAttributes(item.attributes);\n              if (this._infoTemplate) {\n                gra.setInfoTemplate(this._infoTemplate);\n              }\n              layerListLayer.layerObject.add(gra);\n            } else {\n              console.log(\"Null geometry skipped\");\n            }\n          }\n          layerListLayer.layerObject.refresh();\n          if (parentLayer.featureSet) {\n            parentLayer.featureSet.features = responseFeatureSetFeatures;\n          }\n          this.countFeatures(layerListLayer);\n          if (layerListLayer.layerObject && layerListLayer.layerObject.visible) {\n            this._loadList(layerListLayer, true);\n          }\n        }\n      }\n    },\n\n    _getSpatialReference: function _getSpatialReference(features) {\n      var sr;\n      if (features && features.hasOwnProperty('length') && features.length > 0) {\n        var firstFeature = features[0];\n        if (firstFeature.geometry && firstFeature.geometry.spatialReference) {\n          sr = firstFeature.geometry.spatialReference;\n        }\n      }\n      return sr;\n    },\n\n    getGraphicOptions: function getGraphicOptions(item, sr) {\n      var graphicOptions;\n      if (typeof item.geometry.rings !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            rings: item.geometry.rings,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else if (typeof item.geometry.paths !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            paths: item.geometry.paths,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else if (typeof item.geometry.points !== 'undefined') {\n        graphicOptions = {\n          geometry: {\n            points: item.geometry.points,\n            \"spatialReference\": { \"wkid\": sr.wkid }\n          }\n        };\n      } else {\n        graphicOptions = {\n          geometry: new Point(item.geometry.x, item.geometry.y, item.geometry.spatialReference)\n        };\n      }\n      return graphicOptions;\n    },\n\n    _initWidget: function _initWidget() {\n      this.hidePanel = typeof this.config.hidePanel !== 'undefined' ? this.config.hidePanel : false;\n      this.showAllFeatures = typeof this.config.showAllFeatures !== 'undefined' ? this.config.showAllFeatures : false;\n      if (this.map.itemId) {\n        LayerInfos.getInstance(this.map, this.map.itemInfo).then(lang.hitch(this, function (operLayerInfos) {\n          this.wmLayerInfos = operLayerInfos.getLayerInfoArrayOfWebmap();\n          this.layerInfos = operLayerInfos.getLayerInfoArray();\n          this.operLayerInfos = operLayerInfos;\n          this._updateLayerIDs();\n          if (this.config.upgradeFields) {\n            this._upgradeFields();\n          }\n          this._createPanelUI(this.configLayerInfos, operLayerInfos);\n          this._addFilterChanged(operLayerInfos);\n          this._addVisibleChanged(operLayerInfos);\n          this._addZoomChanged(operLayerInfos);\n        }));\n      }\n    },\n\n    _updateLayerIDs: function _updateLayerIDs() {\n      var removeIDs = [];\n\n      //added to make sure the url we have uses the proxy url\n      //issue: https://devtopia.esri.com/WebGIS/arcgis-webappbuilder/issues/11551\n      var getUrl = function getUrl(configLayer, jimuLayerInfo) {\n        return jimuLayerInfo.layerObject && jimuLayerInfo.layerObject.url ? jimuLayerInfo.layerObject.url : configLayer.url;\n      };\n\n      config_layer_loop: for (var i = 0; i < this.configLayerInfos.length; i++) {\n        var configLayer = this.configLayerInfos[i];\n        var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(configLayer.id);\n\n        //If we cannot find the jimu layer info based on the stored ID we need to determine it\n        if (!jimuLayerInfo) {\n          var updated = false;\n          wm_layer_loop: for (var ii = 0; ii < this.wmLayerInfos.length; ii++) {\n            var _opLayer = this.wmLayerInfos[ii];\n            var originOpLayer = _opLayer ? _opLayer.originOperLayer : undefined;\n\n            var urlId = this._compareURL(originOpLayer, configLayer);\n            var itemId = this._compareItemID(originOpLayer, configLayer);\n            var subId = this._compareSubId(_opLayer, configLayer);\n\n            var id = urlId ? urlId : itemId ? itemId : subId ? subId : undefined;\n            jimuLayerInfo = id ? this.operLayerInfos.getLayerInfoById(id) : jimuLayerInfo;\n\n            if (jimuLayerInfo) {\n              this.configLayerInfos[i].id = jimuLayerInfo.id;\n              this.configLayerInfos[i].layer = jimuLayerInfo.id;\n              this.configLayerInfos[i].url = getUrl(this.configLayerInfos[i], jimuLayerInfo);\n              updated = true;\n              break wm_layer_loop;\n            }\n          }\n\n          if (!updated && !jimuLayerInfo) {\n            removeIDs.push(i);\n          }\n        } else {\n          configLayer.url = getUrl(configLayer, jimuLayerInfo);\n        }\n      }\n\n      //This needs to occur largest to smallest\n      if (removeIDs.length > 0) {\n        //removeIDs.sort((a, b) => (b - a));\n        removeIDs.sort(function (a, b) {\n          return b - a;\n        });\n        array.forEach(removeIDs, lang.hitch(this, function (id) {\n          this.configLayerInfos.splice(id, 1);\n        }));\n      }\n    },\n\n    _compareSubId: function _compareSubId(opLayer, configLayer) {\n      if (opLayer && opLayer.subId && opLayer.subId.indexOf(configLayer.id) > -1) {\n        if (opLayer.layerObject) {\n          var geomMatch = this._compareGeom(opLayer.layerObject, configLayer);\n          var fieldMatch = this._compareFields(opLayer.layerObject, configLayer);\n          if (geomMatch && fieldMatch) {\n            return opLayer.subId;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    _compareItemID: function _compareItemID(originOpLayer, configLayer) {\n      if (originOpLayer && originOpLayer.itemId && originOpLayer.itemId === configLayer.itemId) {\n        if (originOpLayer.featureCollection && originOpLayer.featureCollection.layers && originOpLayer.featureCollection.layers.hasOwnProperty('length')) {\n          var fcLayers = originOpLayer.featureCollection.layers;\n          for (var i = 0; i < fcLayers.length; i++) {\n            var fcLayer = fcLayers[i];\n            if (this._compareGeom(fcLayer, configLayer)) {\n              if (this._compareFields(fcLayer, configLayer)) {\n                return fcLayer.id;\n              }\n            }\n          }\n          return undefined;\n        } else {\n          console.log('error in checking item by itemID');\n        }\n      }\n    },\n\n    _compareURL: function _compareURL(originOpLayer, configLayer) {\n      return originOpLayer && originOpLayer.url && configLayer.url && originOpLayer.url === configLayer.url ? originOpLayer.id : undefined;\n    },\n\n    _compareGeom: function _compareGeom(layerObject, configLayer) {\n      return layerObject && layerObject.geometryType && configLayer.geometryType ? layerObject.geometryType === configLayer.geometryType : undefined;\n    },\n\n    _compareFields: function _compareFields(layerObject, configLayer) {\n      var fieldMatch;\n      if (layerObject && layerObject.fields && configLayer.fields && layerObject.fields.length === configLayer.fields.length) {\n        //test if Names match\n        var matchingFields = layerObject.fields.filter(function (f) {\n          for (var fn = 0; fn < configLayer.fields.length; fn++) {\n            var configField = configLayer.fields[fn];\n            if (f.name === configField.name) {\n              return f;\n            }\n          }\n        });\n        fieldMatch = matchingFields.length === layerObject.fields.length;\n      }\n      return fieldMatch;\n    },\n\n    //added for backwards compatability\n    //could not handle directly in VersionManager as some stored layerInfos\n    // do not have a valid infoTemplate saved\n    _upgradeFields: function _upgradeFields() {\n      if (this.configLayerInfos) {\n        for (var i = 0; i < this.configLayerInfos.length; i++) {\n          var li = this.configLayerInfos[i];\n          if (li && li.symbolData && li.symbolData.featureDisplayOptions) {\n            var lyrInfo = this.operLayerInfos.getLayerInfoById(li.id);\n            if (lyrInfo) {\n              var fields = li.symbolData.featureDisplayOptions.fields;\n              //At previous releases we would use the first field from the infoTemplate or\n              //the first non-OID field from the layer if no fields were selected by the user\n              if (typeof fields === 'undefined' || fields.hasOwnProperty('length') && fields.length === 0) {\n                //check layer fields\n                var layerObject = lyrInfo && lyrInfo.layerObject ? lyrInfo.layerObject : undefined;\n                var oidFieldName = layerObject && layerObject.objectIdField ? layerObject.objectIdField : undefined;\n                var firstLayerFieldName = \"\";\n                var firstLayerFieldAlias = \"\";\n                var layerFields = li.fields ? li.fields : layerObject ? layerObject.fields : undefined;\n                if (layerFields && layerFields.length > 0) {\n                  layer_field_loop: for (var _i = 0; _i < layerFields.length; _i++) {\n                    var f = layerFields[_i];\n                    if (firstLayerFieldName === \"\" && f.type !== \"esriFieldTypeOID\" && f.type !== \"esriFieldTypeGeometry\" && f.name !== oidFieldName) {\n                      firstLayerFieldName = f.name;\n                      firstLayerFieldAlias = f.alias || f.name;\n                    }\n                    if (!oidFieldName) {\n                      oidFieldName = f.type === \"esriFieldTypeOID\" ? f.name : oidFieldName;\n                    }\n                    if (oidFieldName && firstLayerFieldName !== \"\") {\n                      break layer_field_loop;\n                    }\n                  }\n                }\n\n                //check popup fields\n                var keyFieldName = \"\";\n                var keyFieldAlias = \"\";\n                var infoTemplate = li.infoTemplate && li.infoTemplate.info && li.infoTemplate.info.fieldInfos ? li.infoTemplate : lyrInfo ? lyrInfo.getInfoTemplate() : undefined;\n                if (!infoTemplate) {\n                  var subLayers = lyrInfo.getSubLayers();\n                  sub_layers_loop: for (var sli = 0; sli < subLayers.length; sli++) {\n                    var sl = subLayers[sli];\n                    if (sl.title && sl.layerObject && sl.layerObject.name && sl.title === sl.layerObject.name) {\n                      infoTemplate = sl.getInfoTemplate ? sl.getInfoTemplate() : infoTemplate;\n                      break sub_layers_loop;\n                    }\n                  }\n                }\n                var popupFields = infoTemplate ? infoTemplate.info.fieldInfos : [];\n                popup_field_loop: for (var j = 0; j < popupFields.length; j++) {\n                  var popupField = popupFields[j];\n                  if (popupField && popupField.visible) {\n                    if (!oidFieldName || oidFieldName !== popupField.fieldName) {\n                      keyFieldName = popupField.fieldName;\n                      keyFieldAlias = popupField.label || popupField.fieldName;\n                      break popup_field_loop;\n                    }\n                  }\n                }\n\n                //update the config\n                this.configLayerInfos[i].symbolData.featureDisplayOptions.fields = [{\n                  name: keyFieldName ? keyFieldName : firstLayerFieldName,\n                  label: keyFieldName ? keyFieldAlias : firstLayerFieldAlias\n                }];\n              }\n            }\n          }\n        }\n      }\n    },\n\n    _addFilterChanged: function _addFilterChanged(layerInfos) {\n      if (parseFloat(this.appConfig.wabVersion) >= 2.1) {\n        this.own(layerInfos.on('layerInfosFilterChanged', lang.hitch(this, function (changedLayerInfoArray) {\n          array.forEach(changedLayerInfoArray, lang.hitch(this, function (layerInfo) {\n            var id = layerInfo.id;\n            var clId = layerInfo.id + this.UNIQUE_APPEND_VAL_CL;\n            if (this.layerList.hasOwnProperty(id)) {\n              this.layerList[id].filter = layerInfo.getFilter();\n            } else if (this.layerList.hasOwnProperty(clId)) {\n              this.layerList[clId].layerObject.filter = layerInfo.getFilter();\n              this.layerList[clId].layerObject._initFeatures();\n            }\n          }));\n        })));\n      }\n    },\n\n    _updateVisibility: function _updateVisibility(layerInfo) {\n      if (layerInfo) {\n        var id = layerInfo.id;\n        var vis = layerInfo.isShowInMap();\n        if (this.layerList.hasOwnProperty(id)) {\n          var lyr = this.layerList[id];\n          if (id === lyr.li.id && lyr.visible !== vis) {\n            this._toggleLayerUI(lyr.li, vis);\n          } else if (id === lyr.id && lyr.visible !== vis) {\n            this._toggleLayerUI(layerInfo, vis);\n          }\n        }\n      }\n    },\n\n    _addVisibleChanged: function _addVisibleChanged(layerInfos) {\n      this.own(layerInfos.on('layerInfosIsVisibleChanged', lang.hitch(this, function (changedLayerInfos) {\n        array.forEach(changedLayerInfos, function (layerInfo) {\n          this._updateVisibility(layerInfo);\n        }, this);\n      })));\n    },\n\n    _addZoomChanged: function _addZoomChanged(layerInfos) {\n      this.own(on(this.map, 'zoom-end', lang.hitch(this, function () {\n        layerInfos.traversal(lang.hitch(this, function (layerInfo) {\n          this._updateVisibility(layerInfo);\n        }));\n      })));\n    },\n\n    _updatePanelHeader: function _updatePanelHeader() {\n      var panelTitle;\n      var w = this.map.width;\n      if (this.config.displayPanelIcon && w > 750) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n\n          if (this.config.refreshEnabled) {\n            if (this.config.mainPanelText !== \"\") {\n              html.addClass(this.pageHeader, \"pageHeaderRefresh\");\n            } else {\n              html.addClass(this.pageHeader, \"pageHeaderRefreshNoText\");\n            }\n          } else {\n            html.addClass(this.pageHeader, \"pageHeader\");\n          }\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          if (this.config.refreshEnabled) {\n            if (this.config.mainPanelText !== \"\") {\n              html.addClass(this.pageBody, \"pageBodyRefresh\");\n            } else {\n              html.addClass(this.pageBody, \"pageBodyRefreshNoText\");\n            }\n          } else {\n            html.addClass(this.pageBody, \"pageBody\");\n          }\n        }\n\n        if (this.pageTitle) {\n          html.addClass(this.pageTitle, \"pageTitleWidth\");\n          if (this.config.refreshEnabled) {\n            html.removeClass(this.pageTitle, \"pageTitle\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh-tab\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh\");\n            html.addClass(this.pageTitle, this.useDarkText ? \"pageTitleRefresh-tab\" : \"pageTitleRefresh\");\n          } else {\n            html.removeClass(this.pageTitle, \"pageTitleRefresh\");\n            html.removeClass(this.pageTitle, \"pageTitleRefresh-tab\");\n            html.addClass(this.pageTitle, \"pageTitle\");\n          }\n        }\n\n        panelTitle = this.config.mainPanelText;\n        if (typeof panelTitle === 'undefined') {\n          panelTitle = \"\";\n        }\n        this.pageTitle.innerHTML = panelTitle;\n        this.panelMainIcon.innerHTML = this.config.mainPanelIcon;\n      } else if (!this.config.displayPanelIcon && !this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n          html.addClass(this.pageHeader, \"pageHeaderNoIcon\");\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBody\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          html.addClass(this.pageBody, \"pageBodyNoIcon\");\n        }\n        this.pageTitle.innerHTML = \"<div></div>\";\n        this.panelMainIcon.innerHTML = \"<div></div>\";\n      } else if (!this.config.displayPanelIcon && this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.addClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBody\");\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.addClass(this.pageBody, \"pageBodyNoIconRefresh\");\n        }\n\n        if (this.pageTitle) {\n          html.removeClass(this.pageTitle, \"pageTitleWidth\");\n        }\n        this.pageTitle.innerHTML = \"<div></div>\";\n        this.panelMainIcon.innerHTML = \"<div></div>\";\n      } else if (this.config.displayPanelIcon && w <= 750 && this.config.refreshEnabled) {\n        if (this.pageHeader) {\n          html.removeClass(this.pageHeader, \"pageHeaderNoIcon\");\n          html.removeClass(this.pageHeader, \"pageHeaderNoIconRefresh\");\n          html.removeClass(this.pageHeader, \"pageHeader\");\n          if (this.config.mainPanelText !== \"\") {\n            html.addClass(this.pageHeader, \"pageHeaderRefresh\");\n          } else {\n            html.addClass(this.pageHeader, \"pageHeaderRefreshNoText\");\n          }\n        }\n\n        if (this.pageBody) {\n          html.removeClass(this.pageBody, \"pageBodyNoIcon\");\n          html.removeClass(this.pageBody, \"pageBodyNoIconRefresh\");\n          html.removeClass(this.pageBody, \"pageBody\");\n          if (this.config.mainPanelText !== \"\") {\n            html.addClass(this.pageBody, \"pageBodyRefresh\");\n          } else {\n            html.addClass(this.pageBody, \"pageBodyRefreshNoText\");\n          }\n        }\n\n        if (this.pageTitle) {\n          html.addClass(this.pageTitle, \"pageTitleWidth\");\n        }\n\n        panelTitle = this.config.mainPanelText;\n        if (typeof panelTitle === 'undefined') {\n          panelTitle = \"\";\n        }\n        this.pageTitle.innerHTML = panelTitle;\n      }\n    },\n\n    _createPanelUI: function _createPanelUI(configLayerInfos, jimuLayerInfos) {\n      this.numClusterLayers = 0;\n\n      if (!this.hidePanel) {\n        this._updatePanelHeader();\n        this._updateUI(null);\n        this._clearChildNodes(this.pageMain);\n        this.updateEnd = [];\n      }\n\n      for (var i = 0; i < configLayerInfos.length; i++) {\n        var lyrInfo = configLayerInfos[i];\n        if (lyrInfo.symbolData.clusterType === 'ThemeCluster') {\n          this.updateThemeClusterSymbol(lyrInfo, i);\n        }\n\n        var jimuLayerInfo = jimuLayerInfos.getLayerInfoById(lyrInfo.id);\n        if (jimuLayerInfo) {\n          jimuLayerInfo.getLayerType().then(lang.hitch(this, function (layerType) {\n            jimuLayerInfo.getLayerObject().then(lang.hitch(this, function (layerObject) {\n              this.updateLayerList(layerObject, lyrInfo, layerType, jimuLayerInfo);\n            }));\n          }));\n        }\n      }\n\n      if (!this.hidePanel) {\n        for (var k in this.layerList) {\n          var lyr = this.layerList[k];\n          if (lyr.type !== \"ClusterLayer\") {\n            if (lyr && lyr.layerObject) {\n              if (lyr.layerObject.hasOwnProperty('refreshInterval') && lyr.layerObject.refreshInterval > 0) {\n                this.updateEnd.push(this.own(on(lyr.layerObject, \"update-end\", lang.hitch(this, this._updateEnd))));\n              }\n            }\n          }\n        }\n      }\n      this.addMapLayers();\n    },\n\n    _updateEnd: function _updateEnd(results) {\n      var lid = this.layerList.hasOwnProperty(results.target.id) ? results.target.id : this.layerList.hasOwnProperty(results.target.id + \"_CL\") ? results.target.id + \"_CL\" : \"\";\n\n      //For map service with sub layers...the results ID is for the parent layer\n      if (lid === \"\") {\n        for (var i in this.layerList) {\n          var l = this.layerList[i];\n          if (l && l.layerObject && l.layerObject.id === results.target.id) {\n            lid = l.li.id;\n            break;\n          }\n        }\n      }\n      if (this.layerList.hasOwnProperty(lid)) {\n        var lyr = this.layerList[lid];\n        lyr.isLoaded = false;\n        lyr.updating = false;\n        lyr.requiresReload = true;\n        if (lyr) {\n          if (lyr.legendOpen) {\n            this._loadList(lyr, this.config.countEnabled);\n          } else if (this.config.countEnabled) {\n            this.countFeatures(lyr);\n          }\n        }\n      }\n    },\n\n    updateThemeClusterSymbol: function updateThemeClusterSymbol(lyrInfo, i) {\n      var sd = lyrInfo.symbolData;\n      if (this.appConfig.theme.styles && this.appConfig.theme.styles[0]) {\n        if (typeof this._styleColor === 'undefined') {\n          this._updateStyleColor(this.appConfig.theme.styles[0]);\n        }\n      }\n      if (this._styleColor) {\n        var _rgb = dojoColor.fromHex(this._styleColor);\n        var x = i + 1;\n        var xx = x > 0 ? x * 30 : 30;\n        var evenOdd = x % 2 === 0;\n        var r = _rgb.r;\n        var g = _rgb.g;\n        var b = _rgb.b;\n\n        var rr = r - xx;\n        if (evenOdd) {\n          if (rr > 255) {\n            rr = rr - 255;\n          } else if (rr < 0) {\n            rr = rr + 255;\n          }\n        }\n\n        var bb = b - xx;\n        if (x % 3 === 0) {\n          if (evenOdd) {\n            if (bb > 255) {\n              bb = bb - 255;\n            } else if (bb < 0) {\n              bb = bb + 255;\n            }\n          }\n        }\n\n        var gg = g - xx;\n        if (x % 5 === 0) {\n          if (evenOdd) {\n            if (gg > 255) {\n              gg = gg - 255;\n            } else if (gg < 0) {\n              gg = gg + 255;\n            }\n          }\n        }\n        sd.clusterType = 'CustomCluster';\n        sd.clusterSymbol = {\n          color: [rr, gg, bb, 1],\n          outline: {\n            color: [0, 0, 0, 0],\n            width: 0,\n            type: \"esriSLS\",\n            style: \"esriSLSNull\"\n          },\n          type: \"esriSFS\",\n          style: \"esriSFSSolid\"\n        };\n      }\n    },\n\n    removeOldClusterLayers: function removeOldClusterLayers(lInfos) {\n      //check if the widget was previously configured\n      // with a layer that it no longer consumes...if so remove it\n      var deleteLayers = [];\n      for (var id in this.layerList) {\n        var l = this.layerList[id];\n        if (l.type === \"ClusterLayer\") {\n          layer_info_loop: for (var i = 0; i < lInfos.length; i++) {\n            var lo = lInfos[i];\n            var potentialNewClusterID = lo.id + this.UNIQUE_APPEND_VAL_CL;\n            if (potentialNewClusterID === id) {\n              if (lo.symbolData && !lo.symbolData.clusteringEnabled) {\n                deleteLayers.push(id);\n              }\n              break layer_info_loop;\n            }\n          }\n        }\n      }\n      if (deleteLayers.length > 0) {\n        for (var dl in deleteLayers) {\n          if (this.layerList.hasOwnProperty(deleteLayers[dl])) {\n            if (this.map.graphicsLayerIds.indexOf(deleteLayers[dl]) > -1) {\n              var _dl = this.layerList[deleteLayers[dl]];\n              if (_dl && _dl.li) {\n                var jimuLayerInfo;\n                if (_dl.li.parentLayerID) {\n                  jimuLayerInfo = this.operLayerInfos.getLayerInfoById(_dl.li.parentLayerID);\n                }\n                if (!jimuLayerInfo && _dl.li.layer) {\n                  jimuLayerInfo = this.operLayerInfos.getLayerInfoById(_dl.li.layer);\n                }\n                if (jimuLayerInfo && _dl.hasOwnProperty('parentLayerVisible')) {\n                  jimuLayerInfo.setTopLayerVisible(_dl.parentLayerVisible);\n                }\n              }\n              this.map.removeLayer(this.layerList[deleteLayers[dl]].layerObject);\n            }\n            this.layerList[deleteLayers[dl]].layerObject.destroy();\n            delete this.layerList[deleteLayers[dl]];\n          }\n        }\n      }\n    },\n\n    addMapLayers: function addMapLayers() {\n      var ids = Object.keys(this.layerList).reverse();\n      for (var i = 0; i < ids.length; i++) {\n        var id = ids[i];\n        var l = this.layerList[id];\n        if (l.type && l.type === \"ClusterLayer\") {\n          if (this.map.graphicsLayerIds.indexOf(id) === -1) {\n            this.map.addLayer(l.layerObject);\n          }\n        }\n      }\n    },\n\n    updateLayerList: function updateLayerList(lyr, lyrInfo, lyrType, jimuLayerInfo) {\n      var l,\n          ll = null;\n      var type, id, layerObject, pl;\n\n      jimuLayerInfo = jimuLayerInfo || this.operLayerInfos.getLayerInfoById(lyr.id);\n\n      var selfType = this._checkSelfType(jimuLayerInfo, lyrInfo, lyrType, lyr);\n      var listDisabled = this._checkListDisabled(lyrInfo);\n\n      //Handle cluster layers\n      if (lyrInfo.symbolData.clusteringEnabled) {\n        l = this._getClusterLayer(lyrInfo, lyr, jimuLayerInfo, lyrType);\n        type = \"ClusterLayer\";\n        layerObject = l;\n        id = l.id;\n        if (!this.hidePanel) {\n          this.own(on(l, \"update-end\", lang.hitch(this, function () {\n            this._loadList(this.layerList[l.id], true);\n          })));\n        }\n        this.numClusterLayers += 1;\n      } else {\n        if (lyr.layerType === \"ArcGISStreamLayer\") {\n          type = \"StreamLayer\";\n          id = lyr.layerObject.id;\n          layerObject = lyr.layerObject;\n          pl = lyr;\n        } else {\n          id = lyrType === \"FeatureLayer\" ? lyrInfo.id : lyr.id;\n          var parentLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.parentLayerID) || lyr.parentLayerInfo;\n          if (parentLayerInfo) {\n            if (parentLayerInfo.layerObject) {\n              ll = parentLayerInfo.layerObject;\n              type = ll.type;\n              if (parentLayerInfo.originOperLayer && parentLayerInfo.originOperLayer.featureCollection) {\n                var layers = parentLayerInfo.originOperLayer.featureCollection.layers;\n                if (layers) {\n                  for (var j = 0; j < layers.length; j++) {\n                    var _lyr = layers[j];\n                    if (_lyr.id === id) {\n                      pl = _lyr;\n                    }\n                  }\n                }\n              }\n            }\n          }\n          l = lyr.layerObject ? lyr.layerObject : lyr;\n          type = lyrType;\n          layerObject = ll && !ll.empty ? ll : l ? l : lyr;\n          if (selfType === 'geo_rss' && layerObject && layerObject.getFeatureLayers) {\n            var featureLayers = layerObject.getFeatureLayers();\n            for (var i = 0; i < featureLayers.length; i++) {\n              var fl = featureLayers[i];\n              if (fl.id === lyrInfo.id) {\n                layerObject = fl;\n              }\n            }\n          }\n          pl = pl ? pl : lyr;\n        }\n      }\n\n      this.layerList[id] = {\n        type: type,\n        layerObject: layerObject,\n        pl: pl,\n        id: id,\n        visible: jimuLayerInfo && jimuLayerInfo.isShowInMap ? jimuLayerInfo.isShowInMap() : true,\n        li: lyrInfo,\n        filter: jimuLayerInfo ? jimuLayerInfo.getFilter() : \"1=1\",\n        infoTemplate: jimuLayerInfo.getInfoTemplate() || lyrInfo.infoTemplate,\n        selfType: selfType,\n        listDisabled: listDisabled,\n        showAllFeatures: this.showAllFeatures\n      };\n\n      if (lyr.layerType !== \"ArcGISStreamLayer\") {\n        this.updateRenderer(id);\n      }\n\n      if (!this.hidePanel) {\n        this._addPanelItem(ll ? ll : l ? l : lyr, lyrInfo, listDisabled, jimuLayerInfo);\n      }\n    },\n\n    _checkListDisabled: function _checkListDisabled(lyrInfo) {\n      return lyrInfo.symbolData.featureDisplayOptions.listDisabled ? lyrInfo.symbolData.featureDisplayOptions.listDisabled : lyrInfo.symbolData.featureDisplayOptions.fields ? lyrInfo.symbolData.featureDisplayOptions.fields.length === 0 : true;\n    },\n\n    _checkSelfType: function _checkSelfType(jimuLayerInfo, lyrInfo, lyrType, lyr) {\n      var _lo = lyrInfo.layerObject && !lyrInfo.layerObject.empty ? lyrInfo.layerObject : lyr;\n      var originOpLayer = _lo && _lo.originOperLayer ? _lo.originOperLayer : lyr;\n\n      var selfType = jimuLayerInfo.originOperLayer && jimuLayerInfo.originOperLayer.selfType ? jimuLayerInfo.originOperLayer.selfType : originOpLayer && originOpLayer.selfType ? originOpLayer.selfType : '';\n\n      selfType = selfType && selfType !== '' ? selfType : originOpLayer && originOpLayer.layerType && originOpLayer.layerType === \"CSV\" ? \"collection\" : lyrType === \"Feature Collection\" ? \"collection\" : '';\n      if (!selfType && lyrType && lyrType === \"KML\") {\n        selfType = \"kml\";\n      }\n      return selfType;\n    },\n\n    updateRenderer: function updateRenderer(id) {\n      var l = this.layerList[id];\n      if (l.li.symbolData.symbolType !== 'LayerSymbol') {\n        if (typeof l.li.orgRenderer === 'undefined') {\n          if (l.layerObject.renderer) {\n            l.li.orgRenderer = l.layerObject.renderer;\n          } else {\n            l.li.orgRenderer = l.li.renderer;\n          }\n        }\n        var renderer = new SimpleRenderer(jsonUtils.fromJson(l.li.symbolData.symbol));\n        l.li.newRenderer = renderer;\n        if (l.layerObject.setRenderer) {\n          l.layerObject.setRenderer(renderer);\n        } else if (l.layerObject.setLayerDrawingOptions) {\n          var optionsArray = [];\n          var drawingOptions = new LayerDrawingOptions();\n          drawingOptions.renderer = renderer;\n          optionsArray[l.li.subLayerId] = drawingOptions;\n          l.layerObject.setLayerDrawingOptions(optionsArray);\n        } else {\n          console.log(\"Error setting the new renderer...will use the default rendering of the layer\");\n        }\n\n        if (typeof l.layerObject.refresh === 'function') {\n          l.layerObject.refresh();\n        }\n      }\n    },\n\n    _onRecNodeMouseover: function _onRecNodeMouseover(rec) {\n      domClass.add(rec, this.isDartTheme ? \"layer-row-mouseover-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"layer-row-mouseover-dashboard\" : \"layer-row-mouseover\");\n    },\n\n    _onRecNodeMouseout: function _onRecNodeMouseout(rec) {\n      domClass.remove(rec, this.isDartTheme ? \"layer-row-mouseover-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"layer-row-mouseover-dashboard\" : \"layer-row-mouseover\");\n    },\n\n    _addPanelItem: function _addPanelItem(layer, lyrInfo, listDisabled, jimuLayerInfo) {\n      var potentialNewID = lyrInfo.id + this.UNIQUE_APPEND_VAL_CL;\n      var id = lyrInfo.id in this.layerList ? lyrInfo.id : potentialNewID in this.layerList ? potentialNewID : '';\n      var lyr = this.layerList[id];\n      if (lyr) {\n        var lyrType = lyr.type;\n        var cssAry;\n        if (this.isDashboardTheme) {\n          cssAry = ['rec', 'expand', 'expandDown-dashboard', 'solidBorder'];\n        } else if (this.isDartTheme) {\n          cssAry = ['rec-dart', 'expand-dart', 'expandDown-dart', 'solidBorder-dart'];\n        } else {\n          cssAry = ['rec', 'expand', 'expandDown', 'solidBorder'];\n        }\n        var rec = domConstruct.create(\"div\", {\n          'class': cssAry[0] + \" \" + cssAry[3],\n          id: 'rec_' + id\n        }, this.pageMain);\n\n        var expandClass;\n        if (!listDisabled) {\n          this.own(on(rec, 'mouseover', lang.hitch(this, this._onRecNodeMouseover, rec)));\n          this.own(on(rec, 'mouseout', lang.hitch(this, this._onRecNodeMouseout, rec)));\n          expandClass = cssAry[1] + \" \" + cssAry[2];\n          if (jimuLayerInfo && jimuLayerInfo.isInScale) {\n            expandClass += jimuLayerInfo.isInScale() ? \"\" : \" expandInActive\";\n          }\n        } else {\n          html.setStyle(rec, \"cursor\", \"default\");\n          expandClass = 'expand-empty';\n        }\n        domConstruct.create(\"div\", {\n          'class': expandClass,\n          id: \"exp_\" + id\n        }, rec);\n\n        var recIcon = domConstruct.create(\"div\", {\n          'class': \"recIcon active\",\n          id: \"recIcon_\" + id\n        }, rec);\n\n        if (lyrInfo.panelImageData && lyrInfo.panelImageData.toString().indexOf('<img') > -1) {\n          var img = document.createElement('div');\n          img.innerHTML = lyrInfo.panelImageData;\n          var icon = new PictureMarkerSymbol(img.children[0].src, 26, 26);\n          lyrInfo.panelImageData = this._createImageDataDiv(icon, 44, 44, undefined, true).innerHTML;\n        }\n        recIcon.innerHTML = lyrInfo.panelImageData;\n        domStyle.set(recIcon.firstChild, \"border-radius\", \"41px\");\n\n        var recLabel;\n        var recNum;\n        if (this.config.countEnabled) {\n          recLabel = domConstruct.create(\"div\", {\n            'class': \"recLabel\",\n            id: \"recLabel_\" + id,\n            innerHTML: \"<p>\" + lyrInfo.label + \"</p>\"\n          }, rec);\n          html.setStyle(recLabel, \"top\", \"20px\");\n          recNum = domConstruct.create(\"div\", {\n            'class': \"recNum\",\n            id: \"recNum_\" + id,\n            innerHTML: \"\"\n          }, rec);\n        } else {\n          recLabel = domConstruct.create(\"div\", {\n            'class': \"recLabelNoCount\",\n            id: \"recLabel_\" + id,\n            innerHTML: \"<p>\" + lyrInfo.label + \"</p>\"\n          }, rec);\n        }\n\n        if (lyrType === \"ClusterLayer\") {\n          layer.node = recNum;\n          if (!listDisabled) {\n            this._addLegend(id, lyr);\n          }\n          layer._updateNode(layer.nodeCount);\n        } else if (lyrType === \"StreamLayer\") {\n          lyr.node = recNum;\n          this.countFeatures(lyr);\n          if (!listDisabled) {\n            this._addLegend(id, lyr);\n          }\n        } else {\n          lyr.node = recNum;\n          this._addLegend(id, lyr);\n        }\n\n        on(recIcon, \"click\", lang.hitch(this, this._toggleLayerVisibility, lyr));\n\n        if (!listDisabled) {\n          lyr.toggleLegend = on(rec, \"click\", lang.hitch(this, this._toggleLegend, lyr));\n        }\n      }\n    },\n\n    _addLegend: function _addLegend(id, layerListLayer) {\n      layerListLayer.legendOpen = this.row === null && this.config.expandList;\n      var _class = layerListLayer.legendOpen ? \"legendOn\" : \"legendOff\";\n      layerListLayer.legendNode = domConstruct.create(\"div\", {\n        \"class\": \"legendLayer \" + _class,\n        \"id\": \"legend_\" + id\n      }, this.pageMain);\n      if (layerListLayer.type === 'ClusterLayer') {\n        layerListLayer.layerObject.legendNode = layerListLayer.legendNode;\n      }\n      this.row = 'firstRowExpanded';\n    },\n\n    _getListFields: function _getListFields(lyr) {\n      var popupFields = [];\n      var infoTemp = this._getInfoTemplate(lyr);\n\n      var fieldInfos = infoTemp && infoTemp.info && infoTemp.info.fieldInfos ? infoTemp.info.fieldInfos : [];\n      array.forEach(fieldInfos, function (fieldInfo) {\n        if (fieldInfo.visible) {\n          popupFields.push(fieldInfo.fieldName);\n        }\n      });\n\n      var displayOptions = lyr.li.symbolData && lyr.li.symbolData.featureDisplayOptions ? lyr.li.symbolData.featureDisplayOptions : {};\n      var fields = displayOptions.fields || [];\n      array.forEach(fields, function (field) {\n        if (popupFields.indexOf(field.name) === -1) {\n          popupFields.push(field.name);\n        }\n      });\n      if (displayOptions.groupField) {\n        if (popupFields.indexOf(displayOptions.groupField.name) === -1) {\n          popupFields.push(displayOptions.groupField.name);\n        }\n      }\n\n      if (popupFields.length === 0 || typeof infoTemp === 'undefined') {\n        popupFields = ['*'];\n      }\n\n      if (popupFields[0] !== '*') {\n        if (lyr.layerObject && lyr.layerObject.objectIdField) {\n          if (popupFields.indexOf(lyr.layerObject.objectIdField) === -1) {\n            popupFields.push(lyr.layerObject.objectIdField);\n          }\n        }\n      }\n      return popupFields;\n    },\n\n    _loadList: function _loadList(lyr, updateCount) {\n      if (!this.hidePanel) {\n        var id = lyr.layerObject.id in this.layerList ? lyr.layerObject.id : lyr.li.id;\n        if (updateCount) {\n          this._addSearching(id);\n        }\n\n        var popupFields = this._getListFields(lyr);\n        if (lyr.type === \"ClusterLayer\") {\n          if (lyr.li.layerListExtentChanged) {\n            lyr.layerObject.clusterFeatures();\n            lyr.li.layerListExtentChanged = false;\n          }\n          var features = [];\n          if (lyr.layerObject.clusterGraphics || lyr.layerObject._features) {\n            if (this.showAllFeatures) {\n              features = lyr.layerObject._features;\n            } else {\n              var clusterGraphics = lyr.layerObject.clusterGraphics;\n              for (var z = 0; z < clusterGraphics.length; z++) {\n                var clusterGraphic = clusterGraphics[z];\n                if (clusterGraphic.graphics && clusterGraphic.graphics.length > 0) {\n                  for (var f = 0; f < clusterGraphic.graphics.length; f++) {\n                    var g = clusterGraphic.graphics[f];\n                    features.push(g);\n                  }\n                }\n              }\n            }\n            setTimeout(lang.hitch(this, function () {\n              this._updateList(features, lyr.legendNode, lyr.layerObject.node, popupFields, updateCount, lyr);\n            }), 100);\n          } else {\n            this._removeSearching(id, lyr.legendNode ? !domClass.contains(lyr.legendNode, 'legendOff') : true);\n          }\n        } else {\n          this.getFeatures(lyr, popupFields, updateCount);\n          return;\n        }\n      }\n    },\n\n    _addSearching: function _addSearching(id) {\n      var disabled = this.layerList[id].listDisabled;\n      var eD = disabled ? 'expand-empty' : this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n      var eU = disabled ? 'expand-empty' : this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n      var eS = disabled ? \"expandSearching-empty\" : \"expandSearching\";\n      if (domClass.contains(\"exp_\" + id, eD)) {\n        domClass.remove(\"exp_\" + id, eD);\n        domClass.add(\"exp_\" + id, eS);\n      }\n      if (domClass.contains(\"exp_\" + id, eU)) {\n        domClass.remove(\"exp_\" + id, eU);\n        domClass.add(\"exp_\" + id, eS);\n      }\n    },\n\n    _removeSearching: function _removeSearching(id, legendOpen) {\n      var disabled = this.layerList[id].listDisabled;\n      var eD = disabled ? 'expand-empty' : this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n      var eU = disabled ? 'expand-empty' : this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n      var eS = disabled ? \"expandSearching-empty\" : \"expandSearching\";\n      if (domClass.contains(\"exp_\" + id, eS)) {\n        domClass.remove(\"exp_\" + id, eS);\n        domClass.add(\"exp_\" + id, legendOpen ? eU : eD);\n      }\n    },\n\n    _getClusterLayer: function _getClusterLayer(lyrInfo, layer, jimuLayerInfo, lyrType) {\n      var lyr = layer.layerObject ? layer.layerObject : layer;\n      var infoTemplate = lyrInfo.infoTemplate;\n      var originOperLayer = lyr && lyr.originOperLayer ? lyr.originOperLayer : layer.parentLayerInfo ? layer.parentLayerInfo : jimuLayerInfo ? jimuLayerInfo.originOperLayer : undefined;\n      var clusterLayer = null;\n      var n;\n      var potentialNewID = lyrInfo.id + this.UNIQUE_APPEND_VAL_CL;\n      var configChange = true;\n      if (this.map.graphicsLayerIds.indexOf(potentialNewID) > -1 || this.map._layers.indexOf(potentialNewID) > -1) {\n        clusterLayer = this.map.getLayer(potentialNewID);\n\n        var reloadData = false;\n        var refreshData = false;\n\n        //update the symbol if it has changed\n        if (JSON.stringify(clusterLayer.symbolData) !== JSON.stringify(lyrInfo.symbolData)) {\n          clusterLayer.symbolData = lyrInfo.symbolData;\n          clusterLayer.countColor = lyrInfo.symbolData._highLightColor;\n          refreshData = true;\n        }\n\n        //update the icon if it has changed\n        n = domConstruct.toDom(lyrInfo.panelImageData);\n        if (JSON.stringify(clusterLayer.icon) !== JSON.stringify(n.src)) {\n          clusterLayer.icon = n.src;\n          refreshData = true;\n        }\n        domConstruct.destroy(n.id);\n\n        clusterLayer.displayFeatureCount = lyrInfo.symbolData.displayFeatureCount;\n\n        if (clusterLayer.refresh !== lyrInfo.refresh) {\n          clusterLayer.refresh = lyrInfo.refresh;\n          reloadData = true;\n        }\n\n        if (refreshData) {\n          clusterLayer._setupSymbols();\n        }\n\n        clusterLayer.countEnabled = this.config.countEnabled;\n        clusterLayer.hidePanel = this.hidePanel;\n\n        if (clusterLayer.showAllFeatures !== this.showAllFeatures) {\n          reloadData = true;\n          clusterLayer.showAllFeatures = this.showAllFeatures;\n        }\n        if (clusterLayer.listDisabled !== this.listDisabled) {\n          reloadData = true;\n          clusterLayer.listDisabled = this.listDisabled;\n        }\n\n        if (reloadData) {\n          if (clusterLayer.url) {\n            clusterLayer.refreshFeatures(clusterLayer.url);\n          }\n        } else if (refreshData) {\n          clusterLayer.clusterFeatures();\n        }\n      } else {\n        configChange = false;\n        clusterLayer = new ClusterLayer({\n          name: lyrInfo.label + this.UNIQUE_APPEND_VAL_CL,\n          id: potentialNewID,\n          map: this.map,\n          node: dom.byId(\"recNum_\" + potentialNewID),\n          legendNode: dom.byId(\"legend_\" + potentialNewID),\n          infoTemplate: typeof lyr.infoTemplate !== 'undefined' ? lyr.infoTemplate : infoTemplate,\n          refreshInterval: this.config.refreshInterval,\n          refreshEnabled: this.config.refreshEnabled,\n          parentLayer: lyr,\n          lyrInfo: lyrInfo,\n          lyrType: lyrType,\n          _styleColor: this._styleColor,\n          originOperLayer: originOperLayer,\n          countEnabled: this.config.countEnabled,\n          hidePanel: this.hidePanel,\n          filter: jimuLayerInfo ? jimuLayerInfo.getFilter() : \"1=1\",\n          showAllFeatures: this.showAllFeatures,\n          listDisabled: this.listDisabled\n        });\n      }\n      clusterLayer.setVisibility(configChange ? clusterLayer.visible : jimuLayerInfo.isShowInMap ? jimuLayerInfo.isShowInMap() : true);\n      return clusterLayer;\n    },\n\n    _createImageDataDiv: function _createImageDataDiv(sym, w, h, parent, isCustom) {\n      var a;\n      var symbol = sym;\n      if (symbol) {\n        //TODO are these switched??\n        var height = w;\n        var width = h;\n        if (symbol.height && symbol.width) {\n          var ar;\n          if (symbol.height > symbol.width) {\n            ar = symbol.width / symbol.height;\n            width = w * ar;\n          } else if (symbol.width === symbol.height || symbol.width > symbol.height) {\n            width = w;\n            ar = symbol.width / symbol.height;\n            height = ar > 0 ? h * ar : h;\n          }\n        }\n        if (typeof symbol.setWidth !== 'undefined') {\n          if (typeof symbol.setHeight !== 'undefined') {\n            symbol.setWidth(isCustom ? width - width * 0.25 : width);\n            symbol.setHeight(isCustom ? height - height * 0.25 : height);\n          } else {\n            symbol.setWidth(2);\n          }\n        } else if (typeof symbol.size !== 'undefined') {\n          if (symbol.size > 20) {\n            symbol.setSize(20);\n          }\n        }\n        a = domConstruct.create(\"div\", { 'class': \"imageDataGFX\" }, parent);\n        var mySurface = gfx.createSurface(a, w, h);\n        var descriptors = jsonUtils.getShapeDescriptors(symbol);\n        var shape = mySurface.createShape(descriptors.defaultShape).setFill(descriptors.fill).setStroke(descriptors.stroke);\n        shape.applyTransform({ dx: w / 2, dy: h / 2 });\n      }\n      return a;\n    },\n\n    _updateUI: function _updateUI(styleName) {\n      this.styleName = styleName;\n\n      if (this.isDashboardTheme) {\n        this.isLightTheme = styleName ? styleName === 'light' : this.isLightTheme;\n\n        var removeDownClass = this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n        var addDownClass = this.isLightTheme ? 'expandDown' : 'expandDown-dashboard';\n        this._updateNodes(removeDownClass, addDownClass);\n\n        var removeUpClass = this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n        var addUpClass = this.isLightTheme ? 'expandUp' : 'expandUp-dashboard';\n        this._updateNodes(removeUpClass, addUpClass);\n\n        var removeExpandClass = this.isLightTheme ? 'expand-dashboard' : 'expand';\n        var addExpandClass = this.isLightTheme ? 'expand' : 'expand-dashboard';\n        this._updateNodes(removeExpandClass, addExpandClass);\n\n        var removeGroupItemUpClass = this.isLightTheme ? 'groupItemImageUp-dashboard' : 'groupItemImageUp';\n        var addGroupItemUpClass = this.isLightTheme ? 'groupItemImageUp' : 'groupItemImageUp-dashboard';\n        this._updateNodes(removeGroupItemUpClass, addGroupItemUpClass);\n\n        var removeGroupItemDownClass = this.isLightTheme ? 'groupItemImageDown-dashboard' : 'groupItemImageDown';\n        var addGroupItemDownClass = this.isLightTheme ? 'groupItemImageDown' : 'groupItemImageDown-dashboard';\n        this._updateNodes(removeGroupItemDownClass, addGroupItemDownClass);\n\n        var removeGroupItemClass = this.isLightTheme ? 'groupItemImage-dashboard' : 'groupItemImage';\n        var addGroupItemClass = this.isLightTheme ? 'groupItemImage' : 'groupItemImage-dashboard';\n        this._updateNodes(removeGroupItemClass, addGroupItemClass);\n      }\n    },\n\n    _updateNodes: function _updateNodes(remove, add) {\n      var nodes = query('.' + remove);\n      array.forEach(nodes, function (node) {\n        domClass.remove(node, remove);\n        domClass.add(node, add);\n      });\n    },\n\n    _toggleLayerVisibility: function _toggleLayerVisibility(obj, e) {\n      e.stopPropagation();\n      this.map.infoWindow.hide();\n      var id = obj.id ? obj.id : obj.layerObject.id;\n      var lyr = this.layerList[id];\n      if (!lyr) {\n        if (obj.pl) {\n          id = obj.pl.id;\n        }\n        lyr = this.layerList[id];\n      }\n\n      if (lyr) {\n        var hasSubLayerId = lyr.li && lyr.li.hasOwnProperty(\"subLayerId\") ? typeof lyr.li.subLayerId !== 'undefined' && lyr.li.subLayerId.toString() !== \"-1\" : false;\n\n        var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n        var _vis = !domClass.contains(\"recIcon_\" + id, \"active\");\n\n        if (hasSubLayerId && lyr.type !== 'ClusterLayer') {\n          if (_vis) {\n            var currentLayerInfo = lyrInfo.parentLayerInfo;\n            while (currentLayerInfo) {\n              currentLayerInfo.setTopLayerVisible(true);\n              currentLayerInfo = currentLayerInfo.parentLayerInfo;\n            }\n          }\n          lyrInfo.setTopLayerVisible(_vis);\n        } else if (lyr) {\n          lyr.layerObject.setVisibility(_vis);\n          if (lyr.type === 'ClusterLayer' && _vis) {\n            lyr.layerObject.handleMapExtentChange({ levelChange: true });\n            lyr.layerObject.flashFeatures();\n          }\n          if (typeof lyr.pl !== 'undefined') {\n            lyr.pl.visibility = _vis;\n            if (this.map.graphicsLayerIds.indexOf(id) > -1) {\n              var l = this.map.getLayer(id);\n              l.setVisibility(_vis);\n            }\n          }\n        }\n      }\n    },\n\n    _toggleLayerUI: function _toggleLayerUI(obj, vis) {\n      var id = obj.id ? obj.id : obj.layerObject.id;\n      var lyr = this.layerList[id];\n      if (!lyr) {\n        if (obj.pl) {\n          id = obj.pl.id;\n        }\n        lyr = this.layerList[id];\n      }\n      if (lyr) {\n        var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n        var visScalRange = lyrInfo.isCurrentScaleInTheScaleRange ? lyrInfo.isCurrentScaleInTheScaleRange() : true;\n\n        var c = dom.byId(\"recLabel_\" + id);\n\n        this.layerList[id].visible = vis;\n        this.layerList[id].parentLayerVisible = vis;\n        if (this.layerList[id].type === 'ClusterLayer') {\n          this.layerList[id].layerObject.parentLayerVisible = vis;\n        }\n        if (this.config.countEnabled) {\n          if (domClass.contains(\"recNum_\" + id, !vis ? \"recNum\" : \"recNumInActive\")) {\n            var _append = this.isDartTheme ? ' darkThemeColor' : ' lightThemeColor';\n            domClass.remove(\"recNum_\" + id, !vis ? \"recNum\" : \"recNumInActive\");\n            domClass.add(\"recNum_\" + id, (!vis ? \"recNumInActive\" : \"recNum\") + _append);\n          }\n        }\n\n        var eD = this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n        var eU = this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n\n        if (!vis) {\n          domClass.remove(\"recIcon_\" + id, \"active\");\n          //this._clearList(this.layerList[id]);\n          if (c && c.firstChild) {\n            domClass.add(c.firstChild, \"inActive\");\n          }\n          if (!domClass.contains(\"exp_\" + id, \"expandInActive\")) {\n            domClass.add(\"exp_\" + id, \"expandInActive\");\n          }\n          if (lyr.legendOpen) {\n            if (domClass.contains(\"legend_\" + id, \"legendOn\")) {\n              //this.layerList[id].legendOpen = false;\n              domClass.remove(\"legend_\" + id, \"legendOn\");\n              domClass.add(\"legend_\" + id, \"legendOff\");\n              if (domClass.contains(\"exp_\" + id, eU)) {\n                domClass.remove(\"exp_\" + id, eU);\n                domClass.add(\"exp_\" + id, eD);\n              }\n            }\n          }\n          if (lyr.toggleLegend) {\n            lyr.toggleLegend.remove();\n          }\n          if (domClass.contains(\"rec_\" + id, \"rec\")) {\n            domClass.add(\"rec_\" + id, \"recDefault\");\n          }\n        } else {\n          domClass.add(\"recIcon_\" + id, \"active\");\n          if (c && c.firstChild) {\n            domClass.remove(c.firstChild, \"inActive\");\n          }\n          if (domClass.contains(\"exp_\" + id, \"expandInActive\") && visScalRange) {\n            domClass.remove(\"exp_\" + id, \"expandInActive\");\n          }\n          if (lyr.toggleLegend) {\n            lyr.toggleLegend.remove();\n          }\n          var rec = dom.byId('rec_' + id);\n          if (rec) {\n            lyr.toggleLegend = on(rec, \"click\", lang.hitch(this, this._toggleLegend, lyr));\n          }\n\n          if (domClass.contains(\"rec_\" + id, \"recDefault\")) {\n            domClass.remove(\"rec_\" + id, \"recDefault\");\n          }\n\n          if (!lyr.listDisabled) {\n            this._loadList(lyr, true);\n            if (lyr.legendOpen) {\n              domClass.add(\"legend_\" + id, \"legendOn\");\n              domClass.remove(\"legend_\" + id, \"legendOff\");\n              if (domClass.contains(\"exp_\" + id, eD)) {\n                domClass.remove(\"exp_\" + id, eD);\n                domClass.add(\"exp_\" + id, eU);\n              }\n            }\n          }\n        }\n      }\n      return false;\n    },\n\n    _toggleLegend: function _toggleLegend(obj, evt) {\n      if (evt.currentTarget.className !== 'thumb2' && evt.currentTarget.className !== 'recIcon') {\n        var id = obj.layerObject.id in this.layerList ? obj.layerObject.id : obj.li.id;\n        if (domClass.contains(\"legend_\" + id, \"legendOff\")) {\n          this._addSearching(id);\n          this.layerList[id].legendOpen = true;\n          if (typeof this.layerList[id].li.layerListExtentChanged === 'undefined' || this.layerList[id].requiresReload) {\n            this.layerList[id].li.layerListExtentChanged = true;\n            this.layerList[id].requiresReload = false;\n          }\n          if (this.layerList[id].li.layerListExtentChanged) {\n            setTimeout(lang.hitch(this, function () {\n              this._loadList(obj, false);\n            }), 500);\n          } else {\n            this._removeSearching(id, true);\n          }\n          domClass.remove(\"legend_\" + id, \"legendOff\");\n          domClass.add(\"legend_\" + id, \"legendOn\");\n        } else {\n          if (domClass.contains(\"legend_\" + id, \"legendOn\")) {\n            this.layerList[id].legendOpen = false;\n            var eD = this.isDartTheme ? 'expandDown-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandDown-dashboard' : 'expandDown';\n            var eU = this.isDartTheme ? 'expandUp-dart' : this.isDashboardTheme && !this.isLightTheme ? 'expandUp-dashboard' : 'expandUp';\n            if (domClass.contains(\"exp_\" + id, eU)) {\n              domClass.remove(\"exp_\" + id, eU);\n              domClass.add(\"exp_\" + id, eD);\n            }\n            domClass.remove(\"legend_\" + id, \"legendOn\");\n            domClass.add(\"legend_\" + id, \"legendOff\");\n          }\n        }\n      }\n      evt.stopPropagation();\n    },\n\n    _toggleGroup: function _toggleGroup(obj, e) {\n      var id = e.currentTarget.id.slice(0, -2);\n      var fI = this.isDartTheme ? 'featureItem-dart' : 'featureItem';\n\n      var toggle = true;\n      if (e.target.parentNode) {\n        if (e.target.parentNode.id !== \"\") {\n          if (domClass.contains(e.target.parentNode.id, fI)) {\n            toggle = false;\n          }\n        }\n        if (e.target.id !== \"\") {\n          if (domClass.contains(e.target.id, fI)) {\n            toggle = false;\n          }\n        }\n      }\n\n      var gII = this.isDartTheme ? \"groupItemImage-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImage-dashboard\" : \"groupItemImage\";\n      var gIIUp = this.isDartTheme ? \"groupItemImageUp-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageUp-dashboard\" : \"groupItemImageUp\";\n      var gIIDown = this.isDartTheme ? \"groupItemImageDown-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageDown-dashboard\" : \"groupItemImageDown\";\n      if (toggle) {\n        var lId = obj.layerObject.id in this.layerList ? obj.layerObject.id : obj.li.id;\n        var node = document.getElementById(e.currentTarget.id);\n        var _idx = node.childNodes[0].childNodes.length - 1;\n        if (domClass.contains(id, \"groupOff\")) {\n          if (this.layerList[lId].openGroups && this.layerList[lId].openGroups.length > 0) {\n            if (this.layerList[lId].openGroups.indexOf(id) === -1) {\n              this.layerList[lId].openGroups.push(id);\n            }\n          } else {\n            this.layerList[lId].openGroups = [id];\n          }\n          domClass.remove(id, \"groupOff\");\n          domClass.add(id, \"groupOn\");\n          this.layerList[lId].groupOpen = true;\n          if (node.childNodes[0].childNodes[_idx].childNodes[0].className.indexOf(gII) > -1) {\n            html.removeClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIDown);\n            html.addClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIUp);\n          }\n        } else {\n          if (domClass.contains(id, \"groupOn\")) {\n            domClass.remove(id, \"groupOn\");\n            domClass.add(id, \"groupOff\");\n\n            if (this.layerList[lId].openGroups && this.layerList[lId].openGroups.length > 0) {\n              var idx = this.layerList[lId].openGroups.indexOf(id);\n              if (idx > -1) {\n                this.layerList[lId].openGroups.splice(idx, 1);\n              }\n              if (this.layerList[lId].openGroups.length === 0) {\n                this.layerList[lId].groupOpen = false;\n              }\n            } else {\n              this.layerList[lId].groupOpen = false;\n            }\n            if (node.childNodes[0].childNodes[_idx].childNodes[0].className.indexOf(gII) > -1) {\n              html.removeClass(node.childNodes[0].childNodes[_idx].childNodes[0], gIIUp);\n              html.addClass(e.currentTarget.childNodes[0].childNodes[_idx].childNodes[0], gIIDown);\n            }\n          }\n        }\n      }\n    },\n\n    /*jshint unused:false*/\n    onAppConfigChanged: function onAppConfigChanged(appConfig, reason, changedData) {\n      switch (reason) {\n        case 'themeChange':\n          this.inPanelOverrides(changedData);\n          this.destroy();\n          break;\n        case 'layoutChange':\n          this.inPanelOverrides(changedData);\n          break;\n        case 'styleChange':\n          if (!this.hidePanel) {\n            this._updateUI(changedData);\n            this._updateStyleColor(changedData);\n          }\n          break;\n        case 'widgetChange':\n          this.widgetChange = true;\n          if (changedData && changedData.config && changedData.config.layerInfos) {\n            this.removeOldClusterLayers(changedData.config.layerInfos);\n          }\n          this.row = null;\n          break;\n        case 'mapChange':\n          this._clearMap();\n      }\n    },\n\n    _updateStyleColor: function _updateStyleColor(changedData) {\n      setTimeout(lang.hitch(this, function () {\n        var p = this.getPanel();\n        var node;\n        switch (this.appConfig.theme.name) {\n          case 'BoxTheme':\n            node = p.containerNode.parentNode.parentNode.children[0];\n            break;\n          case 'DartTheme':\n            node = p.containerNode.parentNode;\n            break;\n          case 'TabTheme':\n            node = p.containerNode;\n            break;\n          case 'BillboardTheme':\n            node = p.containerNode.parentNode;\n            break;\n          case 'FoldableTheme':\n            node = p.containerNode.parentNode.firstChild;\n            break;\n          default:\n            node = this.pageHeader;\n            break;\n        }\n        var bc = window.getComputedStyle(node, null).getPropertyValue('background-color');\n        this._styleColor = Color.fromRgb(bc).toHex();\n        for (var k in this.layerList) {\n          var l = this.layerList[k];\n          if (l.type === \"ClusterLayer\") {\n            l.layerObject.setStyleColor(this._styleColor);\n          }\n        }\n        this._updateUI(changedData);\n      }), 50);\n    },\n\n    _clearMap: function _clearMap() {\n      if (this.layerList) {\n        for (var k in this.layerList) {\n          var l = this.layerList[k];\n          if (l.type === \"ClusterLayer\") {\n            var _clear = true;\n            if (typeof this.continuousRefreshEnabled !== 'undefined') {\n              _clear = !this.continuousRefreshEnabled;\n            }\n            if (_clear) {\n              l.layerObject._clear();\n              this.map.removeLayer(l.layerObject);\n            }\n          }\n        }\n        this.layerList = {};\n      }\n    },\n\n    _close: function _close() {\n      this.widgetManager.closeWidget(this.id);\n    },\n\n    onClose: function onClose() {\n      this.inherited(arguments);\n\n      for (var key in this.layerList) {\n        var layerListLayer = this.layerList[key];\n        if (layerListLayer.li && layerListLayer.li.orgRenderer) {\n          if (layerListLayer.layerObject.setRenderer) {\n            layerListLayer.layerObject.setRenderer(layerListLayer.li.orgRenderer);\n          } else if (layerListLayer.layerObject.setLayerDrawingOptions) {\n            layerListLayer.layerObject.setLayerDrawingOptions([]);\n          } else {\n            console.log(\"Error re-setting the renderer\");\n          }\n          layerListLayer.layerObject.refresh();\n        }\n      }\n\n      var disableRefresh = true;\n      if (typeof this.config.continuousRefreshEnabled !== 'undefined') {\n        disableRefresh = !this.config.continuousRefreshEnabled;\n      }\n      if (disableRefresh) {\n        if (this.refreshInterval !== 0) {\n          this.refreshIntervalValue = 0;\n          clearInterval(this.refreshInterval);\n          this.refreshInterval = 0;\n        }\n      }\n\n      if (!this.hidePanel) {\n        if (typeof this.mapExtentChangedHandler !== 'undefined') {\n          this.mapExtentChangedHandler.remove();\n          this.mapExtentChangedHandler = undefined;\n        } else {\n          if (typeof this.iconClickHandler !== 'undefined') {\n            this.iconClickHandler.remove();\n            this.iconClickHandler = undefined;\n          }\n        }\n      }\n    },\n\n    _clearChildNodes: function _clearChildNodes(parentNode) {\n      while (parentNode.hasChildNodes()) {\n        parentNode.removeChild(parentNode.lastChild);\n      }\n    },\n\n    _inVisibleRange: function _inVisibleRange(lyr, id) {\n      var visScaleRange = true;\n      if (lyr.layerObject && lyr.layerObject.hasOwnProperty('visibleAtMapScale')) {\n        visScaleRange = lyr.layerObject.visibleAtMapScale;\n      }\n      var lyrInfo = this.operLayerInfos.getLayerInfoById(id);\n      if (lyrInfo && lyrInfo.isCurrentScaleInTheScaleRange) {\n        visScaleRange = lyrInfo.isCurrentScaleInTheScaleRange();\n      }\n      return visScaleRange;\n    },\n\n    _mapExtentChange: function _mapExtentChange() {\n      var countEnabled = this.config.countEnabled;\n      var queries = [];\n      for (var key in this.layerList) {\n        var lyr = this.layerList[key];\n        lyr.visScaleRange = this._inVisibleRange(lyr, key);\n        if (!this.showAllFeatures) {\n          this._clearList(lyr);\n        }\n        if (!lyr.legendOpen || lyr.groupEnabled && !lyr.groupOpen) {\n          if (lyr.li) {\n            lyr.li.layerListExtentChanged = true;\n          }\n          if (lyr.visible && lyr.visScaleRange) {\n            if (lyr.type === \"ClusterLayer\" && lyr.layerObject.initalLoad && this.config.countEnabled) {\n              lyr.layerObject._updateNode(lyr.layerObject.node.innerHTML);\n            }\n\n            if (lyr.type !== 'ClusterLayer') {\n              var uNode = this.config.countEnabled ? lyr.node : lyr.legendNode;\n              if (typeof lyr.layerObject === 'undefined') {\n                console.log(\"layer object not known\");\n              } else {\n                this.countFeatures(lyr);\n              }\n            }\n          } else if (!lyr.visScaleRange) {\n            this._updateList([], lyr.legendNode, lyr.node, [], true, lyr);\n          }\n        } else {\n          if (lyr.visible && lyr.visScaleRange) {\n            lyr.updateList = true;\n            this._loadList(lyr, lyr.updateList);\n          } else {\n            this._updateList([], lyr.legendNode, lyr.node, [], true, lyr);\n          }\n        }\n      }\n    },\n\n    getFeatures: function getFeatures(lyrInfo, fields, updateCount) {\n      var lyr = lyrInfo.layerObject;\n      var legendNode = lyrInfo.legendNode;\n      var node = lyrInfo.node;\n      var _needsGeom = !lyrInfo.listDisabled && lyrInfo.legendOpen ? true : false;\n      var visScaleRange = lyrInfo.visScaleRange;\n      var maxRecordCount = lyr && lyr.maxRecordCount ? lyr.maxRecordCount : undefined;\n      var url;\n      var queries = [];\n      var q = this._getQuery(lyrInfo, fields, _needsGeom);\n      if (lyrInfo.visible && visScaleRange) {\n        if (lyr.queryFeatures) {\n          //get the first set of features\n          if (!lyrInfo.listDisabled) {\n            queries.push(lyr.queryFeatures(q));\n          }\n          //query the ids incase we need more than maxRecordCount\n          queries.push(lyr.queryIds(q));\n        } else {\n          url = lyrInfo.li.url;\n          if (url.indexOf(\"MapServer\") > -1 || url.indexOf(\"FeatureServer\") > -1) {\n            var qt = new QueryTask(url);\n            //get the first set of features\n            if (!lyrInfo.listDisabled) {\n              queries.push(qt.execute(q));\n            }\n            //query the ids incase we need more than maxRecordCount\n            queries.push(qt.executeForIds(q));\n          }\n        }\n      } else {\n        //if it's not visible and not within the visible scale range\n        this._updateList([], lyrInfo.legendNode, lyrInfo.node, [], true, lyrInfo);\n      }\n      if (queries.length > 0) {\n        var featurePromises = all(queries);\n        featurePromises.then(lang.hitch(this, function (results) {\n          var s_id = lyrInfo.layerObject.id in this.layerList ? lyrInfo.layerObject.id : lyrInfo.li.id;\n          var updateNode;\n          if (node) {\n            updateNode = this.config.countEnabled ? node.parentNode : node.previousSibling;\n          }\n          if (results && results.length > 1) {\n            var _queries = [];\n            var queryIDs = results[1];\n            var count = 0;\n            //if IDs exceed max count we need to chunk\n            if (queryIDs && maxRecordCount && queryIDs.length > maxRecordCount) {\n              this._chunkRequest(lyr, url, queryIDs, maxRecordCount, fields, _needsGeom).then(lang.hitch(this, function (fullFeatures) {\n                this._updateList(fullFeatures, legendNode, node, fields, updateCount, lyrInfo);\n              }));\n            } else {\n              this._updateList(results[0].features, legendNode, node, fields, updateCount, lyrInfo);\n            }\n          } else if (results && results.length === 1) {\n            if (this.config.countEnabled) {\n              node.innerHTML = utils.localizeNumber(results[0].length);\n            }\n            this._removeSearching(s_id, false);\n          } else {\n            if (this.config.countEnabled) {\n              node.innerHTML = utils.localizeNumber(0);\n            }\n            this.updateExpand(updateNode, true);\n            this._removeSearching(s_id, lyrInfo.legendOpen);\n          }\n        }));\n      }\n    },\n\n    _chunkRequest: function _chunkRequest(lyr, url, IDs, max, fields, needsGeom) {\n      var def = new Deferred();\n      var queries = [];\n      var i, j;\n      for (i = 0, j = IDs.length; i < j; i += max) {\n        var ids = IDs.slice(i, i + max);\n\n        var q = new Query();\n        q.outFields = fields;\n        q.objectIds = ids;\n        q.returnGeometry = needsGeom;\n\n        if (lyr.queryFeatures) {\n          queries.push(lyr.queryFeatures(q));\n        } else if (url) {\n          var qt = new QueryTask(url);\n          queries.push(qt.execute(q));\n        }\n      }\n      var queryList = new DeferredList(queries);\n      queryList.then(lang.hitch(this, function (queryResults) {\n        if (queryResults) {\n          var allFeatures = [];\n          for (var i = 0; i < queryResults.length; i++) {\n            if (queryResults[i][1].features) {\n              allFeatures.push.apply(allFeatures, queryResults[i][1].features);\n            }\n          }\n          def.resolve(allFeatures);\n        }\n      }));\n      return def;\n    },\n\n    _clearList: function _clearList(lyrInfo) {\n      if (!lyrInfo.isLoaded && lyrInfo.legendNode) {\n        lyrInfo.isLoaded = false;\n        lyrInfo.legendNode.innerHTML = '';\n      }\n    },\n\n    _updateList: function _updateList(features, legendNode, node, fields, updateCount, lyrInfo, countOnly) {\n      var li = lyrInfo.li ? lyrInfo.li : lyrInfo;\n\n      if (lyrInfo.type === 'ClusterLayer') {\n        if (lyrInfo.layerObject.node) {\n          if (domClass.contains(lyrInfo.layerObject.node.id, 'searching')) {\n            domClass.remove(lyrInfo.layerObject.node.id, 'searching');\n          }\n        }\n      }\n\n      var visScaleRange = lyrInfo.visScaleRange;\n      var infoTemplate = lyrInfo.infoTemplate;\n      var displayOptions = lyrInfo.symbolData ? lyrInfo.symbolData.featureDisplayOptions : li && li.symbolData ? li.symbolData.featureDisplayOptions : {};\n\n      if (node || legendNode) {\n        if (legendNode && (lyrInfo.hasOwnProperty('isLoaded') ? !lyrInfo.isLoaded : true)) {\n          legendNode.innerHTML = '';\n        }\n        if (updateCount && node && this.config.countEnabled) {\n          if (visScaleRange) {\n            node.innerHTML = utils.localizeNumber(features.length);\n          } else {\n            this.countFeatures(lyrInfo, lyrInfo.id || li.id);\n          }\n        }\n        var updateNode = this.config.countEnabled ? node.parentNode : legendNode.previousSibling;\n        if (lyrInfo.type === 'ClusterLayer' && lyrInfo.visible || lyrInfo.type !== 'ClusterLayer') {\n          this.updateExpand(updateNode, visScaleRange ? features.length === 0 : true);\n        }\n      }\n      if (countOnly) {\n        return;\n      }\n\n      if (!lyrInfo.listDisabled && !lyrInfo.isLoaded) {\n        if (features.length > 0) {\n          var jimuLayerInfo = this.operLayerInfos.getLayerInfoById(lyrInfo.id);\n\n          var renderer = lyrInfo.type === \"ClusterLayer\" ? lyrInfo.layerObject.renderer : jimuLayerInfo && jimuLayerInfo.layerObject && jimuLayerInfo.layerObject.renderer ? jimuLayerInfo.layerObject.renderer : features[0]._graphicsLayer ? features[0]._graphicsLayer.renderer : lyrInfo.layerObject && lyrInfo.layerObject.renderer ? lyrInfo.layerObject.renderer : li && li.renderer ? jsonUtil.fromJson(li.renderer) || li.renderer : lyrInfo.renderer ? jsonUtil.fromJson(lyrInfo.renderer) || lyrInfo.renderer : undefined;\n          var _fields = lyrInfo.li && lyrInfo.li.fields ? lyrInfo.li.fields : lyrInfo.fields;\n\n          var groupNodes = [];\n          var finalGroupNodes = [];\n          var finalDomNodes = [];\n          for (var i = 0; i < features.length; i++) {\n            var groupAdded = false;\n            var feature = features[i];\n            if (typeof feature.infoTemplate === 'undefined' && infoTemplate) {\n              feature.infoTemplate = infoTemplate;\n            }\n\n            var symbol = renderer && renderer.getSymbol ? renderer.getSymbol(feature) : feature.symbol ? jsonUtils.fromJson(feature.symbol) : undefined;\n\n            var oidName = feature._layer && feature._layer.objectIdField ? feature._layer.objectIdField : li && li.oidFieldName && li.oidFieldName.name ? li.oidFieldName.name : lyrInfo.layerObject && lyrInfo.layerObject.objectIdField ? lyrInfo.layerObject.objectIdField : lyrInfo && lyrInfo.oidFieldName ? lyrInfo.oidFieldName : undefined;\n\n            var id = oidName ? feature.attributes[oidName] : legendNode.id + i;\n\n            var flds = fields[0] === '*' ? feature.attributes : fields;\n            var isNames = fields[0] === '*' ? false : true;\n\n            var displayStringObj = this.getDisplayString(feature, lyrInfo, flds, displayOptions, oidName, isNames);\n            var displayString = displayStringObj.displayString;\n            var aliasNames = displayStringObj.aliasNames;\n            var firstValue = displayStringObj.firstValue;\n            var groupField, groupNode, groupContainer, displayValue, groupType;\n            if (displayOptions.groupEnabled) {\n              var featureValue;\n              var _value;\n              var appendVal = undefined; // jshint ignore:line\n              if (typeof displayOptions.groupByField === 'undefined' || displayOptions.groupByField) {\n                groupField = displayOptions.groupField;\n                featureValue = feature.attributes[groupField.name];\n                groupType = 'byField';\n                appendVal = featureValue;\n              } else {\n                groupField = displayOptions.groupByRendererOptions.fields[0];\n                featureValue = feature.attributes[groupField.name];\n                var groubByFields = displayOptions.groupByRendererOptions.fields;\n                var groupByValues = displayOptions.groupByRendererOptions.values;\n                groupType = 'byRenderer';\n\n                if (featureValue !== null && featureValue !== \"\") {\n                  expression_loop: for (var ii = 0; ii < groupByValues.length; ii++) {\n                    var _val = groupByValues[ii];\n                    var exp = _val.value;\n                    var expParts = exp.split(\"&&\");\n                    if (expParts && expParts.length > 1) {\n                      exp = featureValue + expParts[0] + \"&& \" + featureValue + expParts[1];\n                    } else {\n                      exp = isNaN(featureValue) ? \"'\" + featureValue + \"'\" + _val.value : featureValue + _val.value;\n                    }\n                    if (eval(exp)) {\n                      // jshint ignore:line\n                      _value = _val;\n                      break expression_loop;\n                    }\n                  }\n                  if (typeof _value !== 'undefined' && _value !== null) {\n                    appendVal = _value.label.replace(/ /g, '');\n                  }\n                }\n              }\n              var gId = 'group_' + li.id + \"_\" + groupField.name + \"_\" + appendVal;\n              var addGroup = true;\n              var n;\n              if (groupNodes.length > 0) {\n                node_loop: for (var iii = 0; iii < groupNodes.length; iii++) {\n                  var gNode = groupNodes[iii];\n                  if (gId === gNode.id) {\n                    if (groupType === 'byField' && featureValue === gNode.value || groupType === 'byRenderer') {\n                      addGroup = false;\n                      n = gNode.node;\n                      groupContainer = gNode.parent;\n                      break node_loop;\n                    }\n                  }\n                }\n              }\n              if (addGroup) {\n                groupAdded = true;\n                groupContainer = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupItem-dart' : 'groupItem',\n                  id: gId + \"_c\"\n                });\n                var groupTitle = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupItemTitle-dart' : 'groupItemTitle',\n                  id: gId + \"_t\"\n                }, groupContainer);\n                var label = \"\";\n                var title = groupType === 'byRenderer' ? \"\" : groupField.name + \": \";\n                if (typeof aliasNames !== 'undefined') {\n                  if (aliasNames.hasOwnProperty(groupField.name) && aliasNames[groupField.name] !== '') {\n                    if (groupType === 'byField') {\n                      title = aliasNames[groupField.name] + \": \";\n                    } else {\n                      title = \"\";\n                    }\n                  }\n                }\n                if (groupType === 'byField') {\n                  if (typeof groupField.label !== 'undefined' && groupField.label !== \"\") {\n                    label = groupField.label + \": \";\n                    title = label;\n                  }\n                  if (label === \": \") {\n                    label = \"\";\n                    title = \"\";\n                  }\n                } else {\n                  if (typeof _value !== 'undefined') {\n                    if (typeof _value.label !== 'undefined' && _value.label !== \"\") {\n                      label = title + _value.label;\n                      title = label;\n                    }\n                  } else {\n                    label = title + featureValue;\n                    title = label;\n                  }\n                  if (label === \": \") {\n                    label = \"\";\n                    title = \"\";\n                  }\n                }\n\n                displayValue = this._getFormattedValue(feature, groupField.name, lyrInfo, _fields);\n\n                if (groupType === 'byRenderer' && symbol) {\n                  this._createImageDataDiv(lang.clone(symbol), 30, 30, groupTitle, isCustom);\n                }\n\n                domConstruct.create('div', {\n                  'class': groupType === 'byField' ? 'groupField' : 'groupFieldImage',\n                  innerHTML: groupType === 'byField' ? label + displayValue : label,\n                  title: groupType === 'byField' ? title + displayValue : title\n                }, groupTitle);\n\n                var inGrpList = false;\n                if (lyrInfo.openGroups && lyrInfo.openGroups.length > 0) {\n                  inGrpList = lyrInfo.openGroups.indexOf(gId) > -1;\n                }\n                var _append = this.isDartTheme ? ' darkThemeColor' : ' lightThemeColor';\n                var groupCountNode = domConstruct.create('div', {\n                  'class': this.isDartTheme ? 'groupCountLabel' : 'groupCountLabel' + _append\n                }, groupTitle);\n\n                var imageContainer = domConstruct.create('div', {\n                  'class': this.isDartTheme || this.isDashboardTheme && !this.isLightTheme ? 'expandImageContainer-dart' : 'expandImageContainer'\n                }, groupTitle);\n\n                var gIIUp = this.isDartTheme ? \"groupItemImageUp-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageUp-dashboard\" : \"groupItemImageUp\";\n                var gIIDown = this.isDartTheme ? \"groupItemImageDown-dart\" : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImageDown-dashboard\" : \"groupItemImageDown\";\n                var cNames = this.isDartTheme ? 'groupItemImage-dart' : this.isDashboardTheme && !this.isLightTheme ? \"groupItemImage-dashboard\" : 'groupItemImage';\n                cNames += inGrpList ? ' ' + gIIUp : ' ' + gIIDown;\n                domConstruct.create('div', {\n                  'class': cNames\n                }, imageContainer);\n\n                cNames = this.isDartTheme ? 'groupItem-dart' : 'groupItem';\n                cNames += lyrInfo.groupOpen && inGrpList ? ' groupOn' : ' groupOff';\n                groupNode = domConstruct.create('div', {\n                  'class': cNames,\n                  id: gId\n                }, groupContainer);\n\n                groupNodes.push({\n                  id: 'group_' + li.id + \"_\" + groupField.name + \"_\" + appendVal,\n                  node: groupNode,\n                  parent: groupContainer,\n                  value: featureValue\n                });\n\n                finalGroupNodes.push({\n                  value: featureValue,\n                  node: groupContainer,\n                  countNode: groupCountNode,\n                  count: 1\n                });\n\n                on(groupContainer, \"click\", lang.hitch(this, this._toggleGroup, lyrInfo));\n              } else {\n                var result = finalGroupNodes.filter(function (o) {\n                  if (o.node.id === n.id + \"_c\") {\n                    return o;\n                  }\n                });\n\n                result[0].count += 1;\n                groupNode = n;\n              }\n            }\n            var featureItem = domConstruct.create('div', {\n              'class': this.isDartTheme ? 'featureItem-dart' : 'featureItem',\n              id: 'feature_' + li.id + \"_\" + id\n            });\n\n            var isCustom = false;\n            if (li && li.symbolData) {\n              isCustom = li.symbolData.symbolType === \"CustomSymbol\";\n            }\n            if (symbol) {\n              if (displayOptions.groupEnabled && groupType === 'byRenderer') {\n                //this._createImageDataDiv(lang.clone(symbol), 30, 30, groupTitle, isCustom);\n              } else {\n                this._createImageDataDiv(lang.clone(symbol), 30, 30, featureItem, isCustom);\n              }\n            }\n\n            on(featureItem, \"click\", lang.hitch(this, this._panToFeature, feature));\n\n            if (displayString.indexOf(\" - \") > -1) {\n              displayString = displayString.slice(0, -3);\n            }\n            var _margin = displayOptions.groupEnabled && groupType === 'byRenderer' ? \"15px\" : \"50px\";\n            var _txtAlign = window.isRTL ? \"right\" : \"left\";\n            domConstruct.create('div', {\n              style: \"padding: 7px 5px 5px \" + _margin + \"; text-align: \" + _txtAlign + \";\",\n              innerHTML: displayString,\n              title: displayString\n            }, featureItem);\n\n            finalDomNodes.push({\n              node: featureItem,\n              updateNode: groupNode ? groupNode : legendNode,\n              firstValue: firstValue\n            });\n          }\n\n          if (finalGroupNodes.length > 0) {\n            //sort and place at legendNode\n            var nodes = finalGroupNodes.sort(function (a, b) {\n              if (typeof a.value === 'undefined') {\n                return b.value;\n              } else if (typeof b.value === 'undefined') {\n                return a.value;\n              }\n              if (isNaN(a.value)) {\n                return a.value.localeCompare(b.value);\n              } else {\n                return parseFloat(a.value) - parseFloat(b.value);\n              }\n            });\n            var cE = this.config.countEnabled;\n            array.forEach(nodes, function (n) {\n              if (cE) {\n                n.countNode.innerHTML = utils.localizeNumber(n.count);\n              }\n              legendNode.appendChild(n.node);\n            });\n          }\n\n          if (finalDomNodes.length > 0) {\n            var sortedNodes = finalDomNodes.sort(function (a, b) {\n              var _a = a.firstValue;\n              var _b = b.firstValue;\n              if (typeof _a === 'undefined' || _a === null || _a === \"\") {\n                return 1;\n              } else if (typeof _b === 'undefined' || _b === null || _b === \"\") {\n                return -1;\n              } else if (_a === _b) {\n                return 0;\n              }\n              return _a.toString().localeCompare(_b.toString());\n            });\n            array.forEach(sortedNodes, function (fdn) {\n              domConstruct.place(fdn.node, fdn.updateNode);\n            });\n          }\n        }\n      }\n      li.layerListExtentChanged = false;\n\n      var s_id = lyrInfo.layerObject && lyrInfo.layerObject.id && lyrInfo.layerObject.id in this.layerList ? lyrInfo.layerObject.id : li.id;\n      if (this.showAllFeatures && lyrInfo.visible) {\n        var loaded = true;\n        if (lyrInfo.layerObject && lyrInfo.type === 'ClusterLayer') {\n          loaded = !lyrInfo.layerObject.queryPending;\n          if (lyrInfo.layerObject.hasOwnProperty('requiresReload')) {\n            loaded = loaded && !lyrInfo.layerObject.requiresReload;\n            lyrInfo.layerObject.requiresReload = false;\n          }\n        }\n        lyrInfo.isLoaded = loaded;\n      }\n\n      this._removeSearching(s_id, lyrInfo.legendOpen);\n    },\n\n    updateExpand: function updateExpand(node, hide) {\n      if (typeof node !== 'undefined') {\n        var id;\n        var en;\n        if (node.id.indexOf('rec_') > -1) {\n          id = node.id.replace('rec_', '');\n          en = dom.byId(\"exp_\" + id);\n        }\n\n        if (hide) {\n          if (node) {\n            html.addClass(node, \"recDefault\");\n            html.addClass(node, \"inActive\");\n          }\n          if (en) {\n            if (!domClass.contains(en, 'expand-empty')) {\n              html.addClass(en, \"expandInActive\");\n            }\n          }\n        } else {\n          if (node) {\n            html.removeClass(node, \"recDefault\");\n            html.removeClass(node, \"inActive\");\n          }\n          if (en) {\n            if (!domClass.contains(en, 'expand-empty')) {\n              html.removeClass(en, \"expandInActive\");\n            }\n          }\n        }\n      }\n    },\n\n    getDisplayString: function getDisplayString(feature, lyrInfo, fields, displayOptions, oidName, isNames) {\n      var displayString = \"\";\n      var aliasNames = {};\n      var firstValue = \"\";\n      if (displayOptions.fields.length > 0) {\n        //get the layer fields\n        var _fields = lyrInfo.li && lyrInfo.li.fields ? lyrInfo.li.fields : lyrInfo.fields;\n        array.forEach(displayOptions.fields, lang.hitch(this, function (displayField) {\n          for (var a in fields) {\n            var fieldName = isNames ? fields[a] : a;\n            if (fieldName === displayField.name) {\n\n              //get the value with proper formatting\n              var featureValue = this._getFormattedValue(feature, fieldName, lyrInfo, _fields);\n              //set the alias name\n              aliasNames[fieldName] = this._checkAliasName(_fields, fieldName);\n\n              firstValue = firstValue === \"\" ? featureValue : firstValue;\n              var hasLabel = typeof displayField.label !== 'undefined';\n              var append = hasLabel ? displayField.label.trim() === \"\" ? \"\" : \": \" : \"\";\n              var label = hasLabel ? displayField.label : \"\";\n\n              displayString += label + append + featureValue + \" - \";\n              break;\n            }\n          }\n        }));\n      }\n      return {\n        displayString: displayString,\n        aliasNames: aliasNames,\n        firstValue: firstValue\n      };\n    },\n\n    _getFormattedValue: function _getFormattedValue(feature, fieldName, lyrInfo, fields) {\n      //get raw feature value\n      var featureValue = feature.attributes[fieldName] || \"\";\n\n      //get the fieldInfos\n      var fieldInfos;\n      var infoTemplate = this._getInfoTemplate(lyrInfo);\n      if (infoTemplate) {\n        if (infoTemplate.info && infoTemplate.info.fieldInfos) {\n          fieldInfos = infoTemplate.info.fieldInfos;\n        } else if (infoTemplate._fieldsMap) {\n          fieldInfos = infoTemplate._fieldsMap;\n        }\n      }\n      //get fieldInfo and field\n      var fieldInfo;\n      if (fieldInfos && Array.isArray(fieldInfos) && fieldInfos.hasOwnProperty('length')) {\n        fieldInfo = this._getFieldByName(fieldInfos, fieldName);\n      }\n      var field = this._getFieldByName(fields, fieldName);\n      if (field) {\n        var intField = this._checkIntField(field);\n        var domainField = this._checkDomainField(field);\n        var dateField = this._checkDateField(field);\n\n        featureValue = dateField ? this.formatDateValue(featureValue, fieldInfo) : domainField ? this.formatDomainValue(featureValue, domainField) : intField ? this.formatNumberValue(featureValue, fieldInfo) : featureValue;\n      }\n      return featureValue;\n    },\n\n    _getFieldByName: function _getFieldByName(fields, fieldName) {\n      if (fields) {\n        var _fields = fields.filter(function (f) {\n          return f.name === fieldName || f.fieldName === fieldName || fields.hasOwnProperty(f) && fields[f].fieldName === fieldName;\n        });\n        if (_fields && _fields.length > 0) {\n          return _fields[0];\n        }\n      }\n      return undefined;\n    },\n\n    _getInfoTemplate: function _getInfoTemplate(lyrInfo) {\n      var infoTemplate = lyrInfo.infoTemplate;\n      if (!infoTemplate) {\n        if (lyrInfo.layerObject && lyrInfo.layerObject.infoTemplate) {\n          infoTemplate = lyrInfo.layerObject.infoTemplate;\n        } else if (lyrInfo.li && lyrInfo.li.infoTemplate) {\n          infoTemplate = lyrInfo.li.infoTemplate;\n        }\n      }\n      if (!infoTemplate) {\n        if (typeof lyrInfo.li.subLayerId !== 'undefined') {\n          var infoTemplates = lyrInfo.layerObject.infoTemplates;\n          if (infoTemplates && infoTemplates.hasOwnProperty(lyrInfo.li.subLayerId)) {\n            infoTemplate = infoTemplates[lyrInfo.li.subLayerId].infoTemplate;\n          }\n        }\n      }\n      return infoTemplate;\n    },\n\n    formatNumberValue: function formatNumberValue(v, fieldInfo) {\n      var num = v;\n      if (!isNaN(v)) {\n        var options = fieldInfo && fieldInfo.format ? fieldInfo : undefined;\n        num = utils.localizeNumberByFieldInfo(v, options);\n      }\n      return num || \"\";\n    },\n\n    formatDomainValue: function formatDomainValue(v, domain) {\n      if (domain && domain.codedValues) {\n        var cvs = domain.codedValues;\n        for (var i = 0; i < cvs.length; i++) {\n          var cv = cvs[i];\n          if (cv.code === v) {\n            return cv.name;\n          }\n        }\n      }\n      return undefined;\n    },\n\n    formatDateValue: function formatDateValue(v, fieldInfo) {\n      if (v) {\n        var options = fieldInfo && fieldInfo.format ? fieldInfo : undefined;\n        var d = new Date(parseInt(v, 10));\n        return options ? utils.localizeDateByFieldInfo(d, options) : utils.localizeDate(d);\n      } else {\n        return \"\";\n      }\n    },\n\n    _checkAliasName: function _checkAliasName(field) {\n      return typeof field.alias !== 'undefined' ? field.alias : false;\n    },\n\n    _checkDomainField: function _checkDomainField(field) {\n      return typeof field.domain !== 'undefined' ? field.domain : false;\n    },\n\n    _checkDateField: function _checkDateField(field) {\n      return field.type === 'esriFieldTypeDate';\n    },\n\n    _checkIntField: function _checkIntField(field) {\n      var testTypes = ['esriFieldTypeSmallInteger', 'esriFieldTypeInteger', 'esriFieldTypeSingle', 'esriFieldTypeDouble'];\n      return testTypes.indexOf(field.type) > -1;\n    },\n\n    _checkDisplayField: function _checkDisplayField(displayFields, featureField) {\n      var includeField = true;\n      if (displayFields) {\n        for (var j = 0; j < displayFields.length; j++) {\n          if (displayFields[j].name === featureField) {\n            return displayFields[j];\n          } else {\n            includeField = false;\n          }\n        }\n      }\n      return includeField;\n    },\n\n    flashGraphics: function flashGraphics(graphics) {\n      for (var i = 0; i < graphics.length; i++) {\n        var g = graphics[i];\n        this._flashFeature(g);\n      }\n    },\n\n    _flashFeature: function _flashFeature(feature) {\n      var symbol;\n      if (feature.geometry) {\n        var color = Color.fromHex(this._styleColor);\n        var color2 = lang.clone(color);\n        color2.a = 0.4;\n        switch (feature.geometry.type) {\n          case 'point':\n            symbol = new SimpleMarkerSymbol(SimpleMarkerSymbol.STYLE_CIRCLE, 15, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 1), color2);\n            break;\n          case 'polyline':\n            symbol = new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 3);\n            break;\n          case 'polygon':\n            symbol = new SimpleFillSymbol(SimpleFillSymbol.STYLE_DIAGONAL_CROSS, new SimpleLineSymbol(SimpleLineSymbol.STYLE_SOLID, color, 2), color2);\n            break;\n        }\n      }\n\n      var g = new Graphic(feature.geometry, symbol);\n      this.map.graphics.add(g);\n      var dShape = g.getDojoShape();\n      if (dShape) {\n        fx.animateStroke({\n          shape: dShape,\n          duration: 900,\n          color: {\n            start: dShape.strokeStyle.color,\n            end: dShape.strokeStyle.color\n          },\n          width: {\n            start: 25,\n            end: 0\n          }\n        }).play();\n        setTimeout(this._clearFeature, 1075, g);\n      }\n    },\n\n    _clearFeature: function _clearFeature(f) {\n      var gl = f.getLayer();\n      gl.remove(f);\n    },\n\n    _panToFeature: function _panToFeature(feature) {\n      if (feature.geometry) {\n        var geom = feature.geometry;\n        if (geom.type === 'polyline') {\n          var path = geom.paths[Math.ceil(geom.paths.length / 2) - 1];\n          var g = path[Math.ceil((path.length - 1) / 2)];\n          geom = new Point(g[0], g[1], geom.spatialReference);\n        }\n        if (geom.type !== 'point') {\n          geom = geom.getExtent().getCenter();\n        }\n        this._pan(feature, geom).then(lang.hitch(this, function () {\n          this._flashFeature(feature);\n          if (feature._layer && feature._layer.infoTemplate || feature.infoTemplate) {\n            this.map.infoWindow.setFeatures([feature]);\n            this.map.infoWindow.select(0);\n            this.map.infoWindow.show(geom);\n          }\n        }));\n      }\n    },\n\n    _pan: function _pan(feature, centerPoint) {\n      var def = new Deferred();\n      if (this.showAllFeatures && !this.map.extent.contains(feature.geometry)) {\n        this.map.centerAt(centerPoint).then(function (ext) {\n          def.resolve(ext);\n        });\n      } else {\n        def.resolve(undefined);\n      }\n      return def;\n    },\n\n    _getQuery: function _getQuery(layerListLayer, fields, needsGeom) {\n      var layerObject = layerListLayer.layerObject;\n      var q = new Query();\n      q.geometry = !this.showAllFeatures ? this.map.extent : null;\n      q.outFields = fields;\n      q.returnGeometry = needsGeom;\n      var collectionTypes = ['collection', 'kml', 'geo_rss'];\n      var isCollection = layerListLayer.selfType ? collectionTypes.indexOf(layerListLayer.selfType) > -1 : false;\n      //layer types from feature collection don't support where\n      if (!isCollection && layerObject.url) {\n        q.where = layerListLayer.filter ? layerListLayer.filter : \"1=1\";\n      } else if (this.showAllFeatures && layerObject && layerObject.fullExtent) {\n        //still need a way to support showing of all features\n        q.geometry = layerObject.fullExtent;\n      }\n      return q;\n    },\n\n    countFeatures: function countFeatures(layerListLayer) {\n      if (!this.hidePanel) {\n        var lyr = layerListLayer.layerObject;\n        var visible = typeof layerListLayer.visible !== 'undefined' ? layerListLayer.visible : lyr.visible;\n        var visScaleRange = layerListLayer.visScaleRange;\n        var node = this.config.countEnabled ? layerListLayer.node : layerListLayer.legendNode;\n        var q = this._getQuery(layerListLayer);\n        if (lyr.queryCount && lyr.visible) {\n          lyr.queryCount(q, lang.hitch(this, function (r) {\n            if (node) {\n              var updateNode;\n              if (this.config.countEnabled) {\n                node.innerHTML = utils.localizeNumber(r);\n                updateNode = node.parentNode;\n              } else {\n                updateNode = node.previousSibling;\n              }\n              this.updateExpand(updateNode, visScaleRange ? r === 0 : true);\n            }\n          }));\n        } else if (layerListLayer && layerListLayer.li && layerListLayer.li.url && visible) {\n          var url = layerListLayer.li.url;\n          if (url.indexOf(\"MapServer\") > -1 || url.indexOf(\"FeatureServer\") > -1) {\n            var qt = new QueryTask(url);\n            qt.executeForIds(q).then(lang.hitch(this, function (ids) {\n              if (node) {\n                var updateNode;\n                var length = ids ? ids.length : 0;\n                if (this.config.countEnabled) {\n                  node.innerHTML = utils.localizeNumber(length);\n                  updateNode = node.parentNode;\n                } else {\n                  updateNode = node.previousSibling;\n                }\n                this.updateExpand(updateNode, visScaleRange ? length === 0 : true);\n              }\n            }));\n          }\n        }\n      }\n    }\n  });\n});\n//# sourceMappingURL=Widget.js.map\n"]}